(self.webpackChunkqfdtd2d=self.webpackChunkqfdtd2d||[]).push([[179],{550:(Si,Kn,Cs)=>{"use strict";function st(e){return"function"==typeof e}function T(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const B=T(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function q(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class F{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const s of n)s.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(st(r))try{r()}catch(s){t=s instanceof B?s.errors:[s]}const{_teardowns:i}=this;if(i){this._teardowns=null;for(const s of i)try{x(s)}catch(a){t=null!=t?t:[],a instanceof B?t=[...t,...a.errors]:t.push(a)}}if(t)throw new B(t)}}add(t){var n;if(t&&t!==this)if(this.closed)x(t);else{if(t instanceof F){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&q(n,t)}remove(t){const{_teardowns:n}=this;n&&q(n,t),t instanceof F&&t._removeParent(this)}}F.EMPTY=(()=>{const e=new F;return e.closed=!0,e})();const L=F.EMPTY;function A(e){return e instanceof F||e&&"closed"in e&&st(e.remove)&&st(e.add)&&st(e.unsubscribe)}function x(e){st(e)?e():e.unsubscribe()}const h={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},d={setTimeout(...e){const{delegate:t}=d;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=d;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function u(e){d.setTimeout(()=>{const{onUnhandledError:t}=h;if(!t)throw e;t(e)})}function l(){}const y=w("C",void 0,void 0);function w(e,t,n){return{kind:e,value:t,error:n}}let R=null;function M(e){if(h.useDeprecatedSynchronousErrorHandling){const t=!R;if(t&&(R={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=R;if(R=null,n)throw r}}else e()}class S extends F{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,A(t)&&t.add(this)):this.destination=g}static create(t,n,r){return new I(t,n,r)}next(t){this.isStopped?v(function N(e){return w("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?v(function E(e){return w("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?v(y,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class I extends S{constructor(t,n,r){let i;if(super(),st(t))i=t;else if(t){let s;({next:i,error:n,complete:r}=t),this&&h.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe()):s=t,i=null==i?void 0:i.bind(s),n=null==n?void 0:n.bind(s),r=null==r?void 0:r.bind(s)}this.destination={next:i?U(i):l,error:U(null!=n?n:W),complete:r?U(r):l}}}function U(e,t){return(...n)=>{try{e(...n)}catch(r){h.useDeprecatedSynchronousErrorHandling?function b(e){h.useDeprecatedSynchronousErrorHandling&&R&&(R.errorThrown=!0,R.error=e)}(r):u(r)}}}function W(e){throw e}function v(e,t){const{onStoppedNotification:n}=h;n&&d.setTimeout(()=>n(e,t))}const g={closed:!0,next:l,error:W,complete:l},O="function"==typeof Symbol&&Symbol.observable||"@@observable";function $(e){return e}let j=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,i){const s=function ge(e){return e&&e instanceof S||function X(e){return e&&st(e.next)&&st(e.error)&&st(e.complete)}(e)&&A(e)}(n)?n:new I(n,r,i);return M(()=>{const{operator:a,source:c}=this;s.add(a?a.call(s,c):c?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=ie(r))((i,s)=>{let a;a=this.subscribe(c=>{try{n(c)}catch(p){s(p),null==a||a.unsubscribe()}},s,i)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[O](){return this}pipe(...n){return function G(e){return 0===e.length?$:1===e.length?e[0]:function(n){return e.reduce((r,i)=>i(r),n)}}(n)(this)}toPromise(n){return new(n=ie(n))((r,i)=>{let s;this.subscribe(a=>s=a,a=>i(a),()=>r(s))})}}return e.create=t=>new e(t),e})();function ie(e){var t;return null!==(t=null!=e?e:h.Promise)&&void 0!==t?t:Promise}const fe=T(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let re=(()=>{class e extends j{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new pe(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new fe}next(n){M(()=>{if(this._throwIfClosed(),!this.isStopped){const r=this.observers.slice();for(const i of r)i.next(n)}})}error(n){M(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){M(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:i,observers:s}=this;return r||i?L:(s.push(n),new F(()=>q(s,n)))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:i,isStopped:s}=this;r?n.error(i):s&&n.complete()}asObservable(){const n=new j;return n.source=this,n}}return e.create=(t,n)=>new pe(t,n),e})();class pe extends re{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:L}}function ye(e){return t=>{if(function _e(e){return st(null==e?void 0:e.lift)}(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}class le extends S{constructor(t,n,r,i,s){super(t),this.onFinalize=s,this._next=n?function(a){try{n(a)}catch(c){t.error(c)}}:super._next,this._error=i?function(a){try{i(a)}catch(c){t.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}function Tn(e){return this instanceof Tn?(this.v=e,this):new Tn(e)}function Is(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(P){r[P]&&(i[P]=function(z){return new Promise(function(K,Z){s.push([P,z,K,Z])>1||c(P,z)})})}function c(P,z){try{!function p(P){P.value instanceof Tn?Promise.resolve(P.value.v).then(m,_):k(s[0][2],P)}(r[P](z))}catch(K){k(s[0][3],K)}}function m(P){c("next",P)}function _(P){c("throw",P)}function k(P,z){P(z),s.shift(),s.length&&c(s[0][0],s[0][1])}}function On(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function Tt(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=e[s]&&function(a){return new Promise(function(c,p){!function i(s,a,c,p){Promise.resolve(p).then(function(m){s({value:m,done:c})},a)}(c,p,(a=e[s](a)).done,a.value)})}}}const Ms=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Wn(e){return st(null==e?void 0:e.then)}function wr(e){return st(e[O])}function Ii(e){return Symbol.asyncIterator&&st(null==e?void 0:e[Symbol.asyncIterator])}function Xt(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Fs=function Ae(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function lr(e){return st(null==e?void 0:e[Fs])}function an(e){return Is(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:i}=yield Tn(n.read());if(i)return yield Tn(void 0);yield yield Tn(r)}}finally{n.releaseLock()}})}function Rs(e){return st(null==e?void 0:e.getReader)}function un(e){if(e instanceof j)return e;if(null!=e){if(wr(e))return function Er(e){return new j(t=>{const n=e[O]();if(st(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Ms(e))return function ks(e){return new j(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Wn(e))return function Ot(e){return new j(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,u)})}(e);if(Ii(e))return cr(e);if(lr(e))return function et(e){return new j(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Rs(e))return function Ns(e){return cr(an(e))}(e)}throw Xt(e)}function cr(e){return new j(t=>{(function Ls(e,t){var n,r,i,s;return function rt(e,t,n,r){return new(n||(n=Promise))(function(s,a){function c(_){try{m(r.next(_))}catch(k){a(k)}}function p(_){try{m(r.throw(_))}catch(k){a(k)}}function m(_){_.done?s(_.value):function i(s){return s instanceof n?s:new n(function(a){a(s)})}(_.value).then(c,p)}m((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=On(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(a){i={error:a}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function wn(e,t,n,r=0,i=!1){const s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function Ai(e,t,n=1/0){return st(t)?Ai((r,i)=>function he(e,t){return ye((n,r)=>{let i=0;n.subscribe(new le(r,s=>{r.next(e.call(t,s,i++))}))})}((s,a)=>t(r,s,i,a))(un(e(r,i))),n):("number"==typeof t&&(n=t),ye((r,i)=>function da(e,t,n,r,i,s,a,c){const p=[];let m=0,_=0,k=!1;const P=()=>{k&&!p.length&&!m&&t.complete()},z=Z=>m<r?K(Z):p.push(Z),K=Z=>{s&&t.next(Z),m++;let te=!1;un(n(Z,_++)).subscribe(new le(t,ne=>{null==i||i(ne),s?z(ne):t.next(ne)},()=>{te=!0},void 0,()=>{if(te)try{for(m--;p.length&&m<r;){const ne=p.shift();a?wn(t,a,()=>K(ne)):K(ne)}P()}catch(ne){t.error(ne)}}))};return e.subscribe(new le(t,z,()=>{k=!0,P()})),()=>{null==c||c()}}(r,i,e,n)))}const Sr=new j(e=>e.complete());function hr(e){return e[e.length-1]}function Mi(e,t=0){return ye((n,r)=>{n.subscribe(new le(r,i=>wn(r,e,()=>r.next(i),t),()=>wn(r,e,()=>r.complete(),t),i=>wn(r,e,()=>r.error(i),t)))})}function Vs(e,t=0){return ye((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function Fi(e,t){if(!e)throw new Error("Iterable cannot be null");return new j(n=>{wn(n,t,()=>{const r=e[Symbol.asyncIterator]();wn(n,t,()=>{r.next().then(i=>{i.done?n.complete():n.next(i.value)})},0,!0)})})}function Ri(e,t){return t?function Ir(e,t){if(null!=e){if(wr(e))return function ga(e,t){return un(e).pipe(Vs(t),Mi(t))}(e,t);if(Ms(e))return function ma(e,t){return new j(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(Wn(e))return function $s(e,t){return un(e).pipe(Vs(t),Mi(t))}(e,t);if(Ii(e))return Fi(e,t);if(lr(e))return function ya(e,t){return new j(n=>{let r;return wn(n,t,()=>{r=e[Fs](),wn(n,t,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(a){return void n.error(a)}s?n.complete():n.next(i)},0,!0)}),()=>st(null==r?void 0:r.return)&&r.return()})}(e,t);if(Rs(e))return function xa(e,t){return Fi(an(e),t)}(e,t)}throw Xt(e)}(e,t):un(e)}function Bs(...e){const t=function ln(e){return function Os(e){return e&&st(e.schedule)}(hr(e))?e.pop():void 0}(e),n=function Cr(e,t){return"number"==typeof hr(e)?e.pop():t}(e,1/0),r=e;return r.length?1===r.length?un(r[0]):function Ps(e=1/0){return Ai($,e)}(n)(Ri(r,t)):Sr}function Ne(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(function zs(e){return e<=0?()=>Sr:ye((t,n)=>{let r=0;t.subscribe(new le(n,i=>{++r<=e&&(n.next(i),e<=r&&n.complete())}))})}(1)).subscribe(()=>e())}function je(e){for(let t in e)if(e[t]===je)return t;throw Error("Could not find renamed property on target object.")}function Be(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Be).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Fr(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Us=je({__forward_ref__:je});function ki(e){return e.__forward_ref__=ki,e.toString=function(){return Be(this())},e}function Ie(e){return function Gs(e){return"function"==typeof e&&e.hasOwnProperty(Us)&&e.__forward_ref__===ki}(e)?e():e}class f extends Error{constructor(t,n){super(function D(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function C(e){return"string"==typeof e?e:null==e?"":String(e)}function V(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():C(e)}function ue(e,t){const n=t?` in ${t}`:"";throw new f(-201,`No provider for ${V(e)} found${n}`)}function zt(e,t){null==e&&function Ze(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}(t,e,null,"!=")}function ot(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Rr(e){return{providers:e.providers||[],imports:e.imports||[]}}function ba(e){return Dc(e,js)||Dc(e,wc)}function Dc(e,t){return e.hasOwnProperty(t)?e[t]:null}function Tc(e){return e&&(e.hasOwnProperty(va)||e.hasOwnProperty(Km))?e[va]:null}const js=je({\u0275prov:je}),va=je({\u0275inj:je}),wc=je({ngInjectableDef:je}),Km=je({ngInjectorDef:je});var Me=(()=>((Me=Me||{})[Me.Default=0]="Default",Me[Me.Host=1]="Host",Me[Me.Self=2]="Self",Me[Me.SkipSelf=4]="SkipSelf",Me[Me.Optional=8]="Optional",Me))();let _a;function Yn(e){const t=_a;return _a=e,t}function Ec(e,t,n){const r=ba(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Me.Optional?null:void 0!==t?t:void ue(Be(e),"Injector")}function qn(e){return{toString:e}.toString()}var cn=(()=>((cn=cn||{})[cn.OnPush=0]="OnPush",cn[cn.Default=1]="Default",cn))(),En=(()=>{return(e=En||(En={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",En;var e})();const Xm="undefined"!=typeof globalThis&&globalThis,Ym="undefined"!=typeof window&&window,qm="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ke=Xm||"undefined"!=typeof global&&global||Ym||qm,kr={},Xe=[],Hs=je({\u0275cmp:je}),Da=je({\u0275dir:je}),Ta=je({\u0275pipe:je}),Sc=je({\u0275mod:je}),Vn=je({\u0275fac:je}),Li=je({__NG_ELEMENT_ID__:je});let Qm=0;function wa(e){return qn(()=>{const n={},r={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===cn.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Xe,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||En.Emulated,id:"c",styles:e.styles||Xe,_:null,setInput:null,schemas:e.schemas||null,tView:null},i=e.directives,s=e.features,a=e.pipes;return r.id+=Qm++,r.inputs=Mc(e.inputs,n),r.outputs=Mc(e.outputs),s&&s.forEach(c=>c(r)),r.directiveDefs=i?()=>("function"==typeof i?i():i).map(Cc):null,r.pipeDefs=a?()=>("function"==typeof a?a():a).map(Ic):null,r})}function Cc(e){return St(e)||function Qn(e){return e[Da]||null}(e)}function Ic(e){return function pr(e){return e[Ta]||null}(e)}const Ac={};function Pi(e){return qn(()=>{const t={type:e.type,bootstrap:e.bootstrap||Xe,declarations:e.declarations||Xe,imports:e.imports||Xe,exports:e.exports||Xe,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(Ac[e.id]=e.type),t})}function Mc(e,t){if(null==e)return kr;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),n[i]=r,t&&(t[i]=s)}return n}function Vt(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function St(e){return e[Hs]||null}function qt(e,t){const n=e[Sc]||null;if(!n&&!0===t)throw new Error(`Type ${Be(e)} does not have '\u0275mod' property.`);return n}function Sn(e){return Array.isArray(e)&&"object"==typeof e[1]}function fn(e){return Array.isArray(e)&&!0===e[1]}function Ca(e){return 0!=(8&e.flags)}function Ys(e){return 2==(2&e.flags)}function dn(e){return null!==e.template}function ry(e){return 0!=(512&e[2])}function xr(e,t){return e.hasOwnProperty(Vn)?e[Vn]:null}class oy{constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function Rc(e){return e.type.prototype.ngOnChanges&&(e.setInput=uy),ay}function ay(){const e=Nc(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===kr)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function uy(e,t,n,r){const i=Nc(e)||function ly(e,t){return e[kc]=t}(e,{previous:kr,current:null}),s=i.current||(i.current={}),a=i.previous,c=this.declaredInputs[n],p=a[c];s[c]=new oy(p&&p.currentValue,t,a===kr),e[r]=t}const kc="__ngSimpleChanges__";function Nc(e){return e[kc]||null}let Ma;function at(e){return!!e.listen}const Oc={createRenderer:(e,t)=>function Fa(){return void 0!==Ma?Ma:"undefined"!=typeof document?document:void 0}()};function dt(e){for(;Array.isArray(e);)e=e[0];return e}function Jt(e,t){return dt(t[e.index])}function Ra(e,t){return e.data[t]}function Vr(e,t){return e[t]}function Gt(e,t){const n=t[e];return Sn(n)?n:n[0]}function ka(e){return 128==(128&e[2])}function Zn(e,t){return null==t?null:e[t]}function $c(e){e[18]=0}function Na(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Te={lFrame:Wc(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Bc(){return Te.bindingsEnabled}function J(){return Te.lFrame.lView}function Ve(){return Te.lFrame.tView}function yt(){let e=zc();for(;null!==e&&64===e.type;)e=e.parent;return e}function zc(){return Te.lFrame.currentTNode}function Cn(e,t){const n=Te.lFrame;n.currentTNode=e,n.isParent=t}function La(){return Te.lFrame.isParent}function Js(){return Te.isInCheckNoChangesMode}function eo(e){Te.isInCheckNoChangesMode=e}function Ft(){const e=Te.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function wy(e,t){const n=Te.lFrame;n.bindingIndex=n.bindingRootIndex=e,Oa(t)}function Oa(e){Te.lFrame.currentDirectiveIndex=e}function $a(e){Te.lFrame.currentQueryIndex=e}function Sy(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function Hc(e,t,n){if(n&Me.SkipSelf){let i=t,s=e;for(;!(i=i.parent,null!==i||n&Me.Host||(i=Sy(s),null===i||(s=s[15],10&i.type))););if(null===i)return!1;t=i,e=s}const r=Te.lFrame=Kc();return r.currentTNode=t,r.lView=e,!0}function to(e){const t=Kc(),n=e[1];Te.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function Kc(){const e=Te.lFrame,t=null===e?null:e.child;return null===t?Wc(e):t}function Wc(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function Xc(){const e=Te.lFrame;return Te.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Yc=Xc;function no(){const e=Xc();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Rt(){return Te.lFrame.selectedIndex}function Jn(e){Te.lFrame.selectedIndex=e}function ro(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const s=e.data[n].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:c,ngAfterViewInit:p,ngAfterViewChecked:m,ngOnDestroy:_}=s;a&&(e.contentHooks||(e.contentHooks=[])).push(-n,a),c&&((e.contentHooks||(e.contentHooks=[])).push(n,c),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,c)),p&&(e.viewHooks||(e.viewHooks=[])).push(-n,p),m&&((e.viewHooks||(e.viewHooks=[])).push(n,m),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,m)),null!=_&&(e.destroyHooks||(e.destroyHooks=[])).push(n,_)}}function io(e,t,n){qc(e,t,3,n)}function so(e,t,n,r){(3&e[2])===n&&qc(e,t,n,r)}function Ba(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function qc(e,t,n,r){const s=null!=r?r:-1,a=t.length-1;let c=0;for(let p=void 0!==r?65535&e[18]:0;p<a;p++)if("number"==typeof t[p+1]){if(c=t[p],null!=r&&c>=r)break}else t[p]<0&&(e[18]+=65536),(c<s||-1==s)&&(Ly(e,n,t,p),e[18]=(4294901760&e[18])+p+2),p++}function Ly(e,t,n,r){const i=n[r]<0,s=n[r+1],c=e[i?-n[r]:n[r]];if(i){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{s.call(c)}finally{}}}else try{s.call(c)}finally{}}class zi{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function oo(e,t,n){const r=at(e);let i=0;for(;i<n.length;){const s=n[i];if("number"==typeof s){if(0!==s)break;i++;const a=n[i++],c=n[i++],p=n[i++];r?e.setAttribute(t,c,p,a):t.setAttributeNS(a,c,p)}else{const a=s,c=n[++i];Ua(a)?r&&e.setProperty(t,a,c):r?e.setAttribute(t,a,c):t.setAttribute(a,c),i++}}return i}function Qc(e){return 3===e||4===e||6===e}function Ua(e){return 64===e.charCodeAt(0)}function ao(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||Zc(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function Zc(e,t,n,r,i){let s=0,a=e.length;if(-1===t)a=-1;else for(;s<e.length;){const c=e[s++];if("number"==typeof c){if(c===t){a=-1;break}if(c>t){a=s-1;break}}}for(;s<e.length;){const c=e[s];if("number"==typeof c)break;if(c===n){if(null===r)return void(null!==i&&(e[s+1]=i));if(r===e[s+1])return void(e[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==a&&(e.splice(a,0,t),s=a+1),e.splice(s++,0,n),null!==r&&e.splice(s++,0,r),null!==i&&e.splice(s++,0,i)}function Br(e){return 32767&e}function zr(e,t){let n=function By(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let Ga=!0;function uo(e){const t=Ga;return Ga=e,t}let zy=0;function Gi(e,t){const n=Ha(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,ja(r.data,e),ja(t,null),ja(r.blueprint,null));const i=lo(e,t),s=e.injectorIndex;if(function Jc(e){return-1!==e}(i)){const a=Br(i),c=zr(i,t),p=c[1].data;for(let m=0;m<8;m++)t[s+m]=c[a+m]|p[a+m]}return t[s+8]=i,s}function ja(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Ha(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function lo(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const s=i[1],a=s.type;if(r=2===a?s.declTNode:1===a?i[6]:null,null===r)return-1;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function co(e,t,n){!function Uy(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Li)&&(r=n[Li]),null==r&&(r=n[Li]=zy++);const i=255&r;t.data[e+(i>>5)]|=1<<i}(e,t,n)}function nh(e,t,n){if(n&Me.Optional)return e;ue(t,"NodeInjector")}function rh(e,t,n,r){if(n&Me.Optional&&void 0===r&&(r=null),0==(n&(Me.Self|Me.Host))){const i=e[9],s=Yn(void 0);try{return i?i.get(t,r,n&Me.Optional):Ec(t,r,n&Me.Optional)}finally{Yn(s)}}return nh(r,t,n)}function ih(e,t,n,r=Me.Default,i){if(null!==e){const s=function Ky(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Li)?e[Li]:void 0;return"number"==typeof t?t>=0?255&t:jy:t}(n);if("function"==typeof s){if(!Hc(t,e,r))return r&Me.Host?nh(i,n,r):rh(t,n,r,i);try{const a=s(r);if(null!=a||r&Me.Optional)return a;ue(n)}finally{Yc()}}else if("number"==typeof s){let a=null,c=Ha(e,t),p=-1,m=r&Me.Host?t[16][6]:null;for((-1===c||r&Me.SkipSelf)&&(p=-1===c?lo(e,t):t[c+8],-1!==p&&ah(r,!1)?(a=t[1],c=Br(p),t=zr(p,t)):c=-1);-1!==c;){const _=t[1];if(oh(s,c,_.data)){const k=Hy(c,t,n,a,r,m);if(k!==sh)return k}p=t[c+8],-1!==p&&ah(r,t[1].data[c+8]===m)&&oh(s,c,t)?(a=_,c=Br(p),t=zr(p,t)):c=-1}}}return rh(t,n,r,i)}const sh={};function jy(){return new Ur(yt(),J())}function Hy(e,t,n,r,i,s){const a=t[1],c=a.data[e+8],_=function ho(e,t,n,r,i){const s=e.providerIndexes,a=t.data,c=1048575&s,p=e.directiveStart,_=s>>20,P=i?c+_:e.directiveEnd;for(let z=r?c:c+_;z<P;z++){const K=a[z];if(z<p&&n===K||z>=p&&K.type===n)return z}if(i){const z=a[p];if(z&&dn(z)&&z.type===n)return p}return null}(c,a,n,null==r?Ys(c)&&Ga:r!=a&&0!=(3&c.type),i&Me.Host&&s===c);return null!==_?ji(t,a,_,c):sh}function ji(e,t,n,r){let i=e[n];const s=t.data;if(function Py(e){return e instanceof zi}(i)){const a=i;a.resolving&&function H(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new f(-200,`Circular dependency in DI detected for ${e}${n}`)}(V(s[n]));const c=uo(a.canSeeViewProviders);a.resolving=!0;const p=a.injectImpl?Yn(a.injectImpl):null;Hc(e,r,Me.Default);try{i=e[n]=a.factory(void 0,s,e,r),t.firstCreatePass&&n>=r.directiveStart&&function Ny(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=t.type.prototype;if(r){const a=Rc(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,a),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,a)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),s&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,s),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,s))}(n,s[n],t)}finally{null!==p&&Yn(p),uo(c),a.resolving=!1,Yc()}}return i}function oh(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function ah(e,t){return!(e&Me.Self||e&Me.Host&&t)}class Ur{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return ih(this._tNode,this._lView,t,r,n)}}const jr="__parameters__";function Kr(e,t,n){return qn(()=>{const r=function Xa(e){return function(...n){if(e){const r=e(...n);for(const i in r)this[i]=r[i]}}}(t);function i(...s){if(this instanceof i)return r.apply(this,s),this;const a=new i(...s);return c.annotation=a,c;function c(p,m,_){const k=p.hasOwnProperty(jr)?p[jr]:Object.defineProperty(p,jr,{value:[]})[jr];for(;k.length<=_;)k.push(null);return(k[_]=k[_]||[]).push(a),p}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}class He{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=ot({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}function In(e,t){e.forEach(n=>Array.isArray(n)?In(n,t):t(n))}function fo(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const Xi={},Za="__NG_DI_FLAG__",go="ngTempTokenPath",ix=/\n/gm,ph="__source",ox=je({provide:String,useValue:je});let Yi;function gh(e){const t=Yi;return Yi=e,t}function ax(e,t=Me.Default){if(void 0===Yi)throw new f(203,"");return null===Yi?Ec(e,void 0,t):Yi.get(e,t&Me.Optional?null:void 0,t)}function qe(e,t=Me.Default){return(function Wm(){return _a}()||ax)(Ie(e),t)}function Ja(e){const t=[];for(let n=0;n<e.length;n++){const r=Ie(e[n]);if(Array.isArray(r)){if(0===r.length)throw new f(900,"");let i,s=Me.Default;for(let a=0;a<r.length;a++){const c=r[a],p=ux(c);"number"==typeof p?-1===p?i=c.token:s|=p:i=c}t.push(qe(i,s))}else t.push(qe(r))}return t}function qi(e,t){return e[Za]=t,e.prototype[Za]=t,e}function ux(e){return e[Za]}const mo=qi(Kr("Inject",e=>({token:e})),-1),Xr=qi(Kr("Optional"),8),Qi=qi(Kr("SkipSelf"),4),Lh="__ngContext__";function It(e,t){e[Lh]=t}function uu(e){const t=function ns(e){return e[Lh]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function cu(e){return e.ngOriginalError}function e0(e,...t){e.error(...t)}class Qr{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t),r=function Jx(e){return e&&e.ngErrorLogger||e0}(t);r(this._console,"ERROR",t),n&&r(this._console,"ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&cu(t);for(;n&&cu(n);)n=cu(n);return n||null}}const Bh=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ke))();function Mn(e){return e instanceof Function?e():e}var Ht=(()=>((Ht=Ht||{})[Ht.Important=1]="Important",Ht[Ht.DashCase=2]="DashCase",Ht))();function fu(e,t){return undefined(e,t)}function rs(e){const t=e[3];return fn(t)?t[3]:t}function du(e){return Hh(e[13])}function pu(e){return Hh(e[4])}function Hh(e){for(;null!==e&&!fn(e);)e=e[4];return e}function Jr(e,t,n,r,i){if(null!=r){let s,a=!1;fn(r)?s=r:Sn(r)&&(a=!0,r=r[0]);const c=dt(r);0===e&&null!==n?null==i?Qh(t,n,c):br(t,n,c,i||null,!0):1===e&&null!==n?br(t,n,c,i||null,!0):2===e?function sf(e,t,n){const r=function Do(e,t){return at(e)?e.parentNode(t):t.parentNode}(e,t);r&&function w0(e,t,n,r){at(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}(t,c,a):3===e&&t.destroyNode(c),null!=s&&function C0(e,t,n,r,i){const s=n[7];s!==dt(n)&&Jr(t,e,r,s,i);for(let c=10;c<n.length;c++){const p=n[c];is(p[1],p,e,t,r,s)}}(t,e,s,n,i)}}function mu(e,t,n){return at(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Wh(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Na(i,-1)),n.splice(r,1)}function xu(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function T0(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const i=t[n[r]];if(!(i instanceof zi)){const s=n[r+1];if(Array.isArray(s))for(let a=0;a<s.length;a+=2){const c=i[s[a]],p=s[a+1];try{p.call(c)}finally{}}else try{s.call(i)}finally{}}}}(e,t),function D0(e,t){const n=e.cleanup,r=t[7];let i=-1;if(null!==n)for(let s=0;s<n.length-1;s+=2)if("string"==typeof n[s]){const a=n[s+1],c="function"==typeof a?a(t):dt(t[a]),p=r[i=n[s+2]],m=n[s+3];"boolean"==typeof m?c.removeEventListener(n[s],p,m):m>=0?r[i=m]():r[i=-m].unsubscribe(),s+=2}else{const a=r[i=n[s+1]];n[s].call(a)}if(null!==r){for(let s=i+1;s<r.length;s++)r[s]();t[7]=null}}(e,t),1===t[1].type&&at(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&fn(t[3])){n!==t[3]&&Wh(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function Yh(e,t,n){return function qh(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const i=e.data[r.directiveStart].encapsulation;if(i===En.None||i===En.Emulated)return null}return Jt(r,n)}(e,t.parent,n)}function br(e,t,n,r,i){at(e)?e.insertBefore(t,n,r,i):t.insertBefore(n,r,i)}function Qh(e,t,n){at(e)?e.appendChild(t,n):t.appendChild(n)}function Zh(e,t,n,r,i){null!==r?br(e,t,n,r,i):Qh(e,t,n)}let tf=function ef(e,t,n){return 40&e.type?Jt(e,n):null};function To(e,t,n,r){const i=Yh(e,r,t),s=t[11],c=function Jh(e,t,n){return tf(e,t,n)}(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(n))for(let p=0;p<n.length;p++)Zh(s,i,n[p],c,!1);else Zh(s,i,n,c,!1)}function rf(e,t){return null!==t?e[16][6].projection[t.projection]:null}function _u(e,t,n,r,i,s,a){for(;null!=n;){const c=r[n.index],p=n.type;if(a&&0===t&&(c&&It(dt(c),r),n.flags|=4),64!=(64&n.flags))if(8&p)_u(e,t,n.child,r,i,s,!1),Jr(t,e,i,c,s);else if(32&p){const m=fu(n,r);let _;for(;_=m();)Jr(t,e,i,_,s);Jr(t,e,i,c,s)}else 16&p?of(e,t,r,n,i,s):Jr(t,e,i,c,s);n=a?n.projectionNext:n.next}}function is(e,t,n,r,i,s){_u(n,r,e.firstChild,t,i,s,!1)}function of(e,t,n,r,i,s){const a=n[16],p=a[6].projection[r.projection];if(Array.isArray(p))for(let m=0;m<p.length;m++)Jr(t,e,i,p[m],s);else _u(e,t,p,a[3],i,s,!0)}function af(e,t,n){at(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function Du(e,t,n){at(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function uf(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const s=t.length;if(i+s===r||e.charCodeAt(i+s)<=32)return i}n=i+1}}const lf="ng-template";function A0(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==uf(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function cf(e){return 4===e.type&&e.value!==lf}function M0(e,t,n){return t===(4!==e.type||n?e.value:lf)}function F0(e,t,n){let r=4;const i=e.attrs||[],s=function N0(e){for(let t=0;t<e.length;t++)if(Qc(e[t]))return t;return e.length}(i);let a=!1;for(let c=0;c<t.length;c++){const p=t[c];if("number"!=typeof p){if(!a)if(4&r){if(r=2|1&r,""!==p&&!M0(e,p,n)||""===p&&1===t.length){if(pn(r))return!1;a=!0}}else{const m=8&r?p:t[++c];if(8&r&&null!==e.attrs){if(!A0(e.attrs,m,n)){if(pn(r))return!1;a=!0}continue}const k=R0(8&r?"class":p,i,cf(e),n);if(-1===k){if(pn(r))return!1;a=!0;continue}if(""!==m){let P;P=k>s?"":i[k+1].toLowerCase();const z=8&r?P:null;if(z&&-1!==uf(z,m,0)||2&r&&m!==P){if(pn(r))return!1;a=!0}}}}else{if(!a&&!pn(r)&&!pn(p))return!1;if(a&&pn(p))continue;a=!1,r=p|1&r}}return pn(r)||a}function pn(e){return 0==(1&e)}function R0(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let s=!1;for(;i<t.length;){const a=t[i];if(a===e)return i;if(3===a||6===a)s=!0;else{if(1===a||2===a){let c=t[++i];for(;"string"==typeof c;)c=t[++i];continue}if(4===a)break;if(0===a){i+=4;continue}}i+=s?1:2}return-1}return function L0(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function hf(e,t,n=!1){for(let r=0;r<t.length;r++)if(F0(e,t[r],n))return!0;return!1}function ff(e,t){return e?":not("+t.trim()+")":t}function O0(e){let t=e[0],n=1,r=2,i="",s=!1;for(;n<e.length;){let a=e[n];if("string"==typeof a)if(2&r){const c=e[++n];i+="["+a+(c.length>0?'="'+c+'"':"")+"]"}else 8&r?i+="."+a:4&r&&(i+=" "+a);else""!==i&&!pn(a)&&(t+=ff(s,i),i=""),r=a,s=s||!pn(r);n++}return""!==i&&(t+=ff(s,i)),t}const Se={};function Eo(e){df(Ve(),J(),Rt()+e,Js())}function df(e,t,n,r){if(!r)if(3==(3&t[2])){const s=e.preOrderCheckHooks;null!==s&&io(t,s,n)}else{const s=e.preOrderHooks;null!==s&&so(t,s,0,n)}Jn(n)}function wf(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],s=n[r+1];if(-1!==s){const a=e.data[s];$a(i),a.contentQueries(2,t[s],s)}}}function ss(e,t,n,r,i,s,a,c,p,m){const _=t.blueprint.slice();return _[0]=i,_[2]=140|r,$c(_),_[3]=_[15]=e,_[8]=n,_[10]=a||e&&e[10],_[11]=c||e&&e[11],_[12]=p||e&&e[12]||null,_[9]=m||e&&e[9]||null,_[6]=s,_[16]=2==t.type?e[16]:_,_}function ei(e,t,n,r,i){let s=e.data[t];if(null===s)s=function Nu(e,t,n,r,i){const s=zc(),a=La(),p=e.data[t]=function tb(e,t,n,r,i,s){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,a?s:s&&s.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=p),null!==s&&(a?null==s.child&&null!==p.parent&&(s.child=p):null===s.next&&(s.next=p)),p}(e,t,n,r,i),function Ty(){return Te.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=n,s.value=r,s.attrs=i;const a=function Bi(){const e=Te.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();s.injectorIndex=null===a?-1:a.injectorIndex}return Cn(s,!0),s}function ti(e,t,n,r){if(0===n)return-1;const i=t.length;for(let s=0;s<n;s++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function os(e,t,n){to(t);try{const r=e.viewQuery;null!==r&&Gu(1,r,n);const i=e.template;null!==i&&Ef(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&wf(e,t),e.staticViewQueries&&Gu(2,e.viewQuery,n);const s=e.components;null!==s&&function Z0(e,t){for(let n=0;n<t.length;n++)bb(e,t[n])}(t,s)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,no()}}function ni(e,t,n,r){const i=t[2];if(256==(256&i))return;to(t);const s=Js();try{$c(t),function Uc(e){return Te.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Ef(e,t,n,2,r);const a=3==(3&i);if(!s)if(a){const m=e.preOrderCheckHooks;null!==m&&io(t,m,null)}else{const m=e.preOrderHooks;null!==m&&so(t,m,0,null),Ba(t,0)}if(function yb(e){for(let t=du(e);null!==t;t=pu(t)){if(!t[2])continue;const n=t[9];for(let r=0;r<n.length;r++){const i=n[r],s=i[3];0==(1024&i[2])&&Na(s,1),i[2]|=1024}}}(t),function mb(e){for(let t=du(e);null!==t;t=pu(t))for(let n=10;n<t.length;n++){const r=t[n],i=r[1];ka(r)&&ni(i,r,i.template,r[8])}}(t),null!==e.contentQueries&&wf(e,t),!s)if(a){const m=e.contentCheckHooks;null!==m&&io(t,m)}else{const m=e.contentHooks;null!==m&&so(t,m,1),Ba(t,1)}!function q0(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const i=n[r];if(i<0)Jn(~i);else{const s=i,a=n[++r],c=n[++r];wy(a,s),c(2,t[s])}}}finally{Jn(-1)}}(e,t);const c=e.components;null!==c&&function Q0(e,t){for(let n=0;n<t.length;n++)xb(e,t[n])}(t,c);const p=e.viewQuery;if(null!==p&&Gu(2,p,r),!s)if(a){const m=e.viewCheckHooks;null!==m&&io(t,m)}else{const m=e.viewHooks;null!==m&&so(t,m,2),Ba(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),s||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Na(t[3],-1))}finally{no()}}function J0(e,t,n,r){const i=t[10],s=!Js(),a=function Vc(e){return 4==(4&e[2])}(t);try{s&&!a&&i.begin&&i.begin(),a&&os(e,t,r),ni(e,t,n,r)}finally{s&&!a&&i.end&&i.end()}}function Ef(e,t,n,r,i){const s=Rt(),a=2&r;try{Jn(-1),a&&t.length>20&&df(e,t,20,Js()),n(r,i)}finally{Jn(s)}}function Cf(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Ao(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Ao(e,t,n,r,i,s,a,c,p,m){const _=20+r,k=_+i,P=function eb(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Se);return n}(_,k),z="function"==typeof m?m():m;return P[1]={type:e,blueprint:P,template:n,queries:null,viewQuery:c,declTNode:t,data:P.slice().fill(null,_),bindingStartIndex:_,expandoStartIndex:k,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:p,consts:z,incompleteFirstPass:!1}}function Ff(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function kf(e,t,n,r,i,s){const a=s.hostBindings;if(a){let c=e.hostBindingOpCodes;null===c&&(c=e.hostBindingOpCodes=[]);const p=~t.index;(function ab(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(c)!=p&&c.push(p),c.push(r,i,a)}}function Nf(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Lf(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function fb(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;dn(t)&&(n[""]=e)}}function Pf(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function Of(e,t,n,r,i){e.data[r]=i;const s=i.factory||(i.factory=xr(i.type)),a=new zi(s,dn(i),null);e.blueprint[r]=a,n[r]=a,kf(e,t,0,r,ti(e,n,i.hostVars,Se),i)}function db(e,t,n){const r=Jt(t,e),i=Cf(n),s=e[10],a=Mo(e,ss(e,i,null,n.onPush?64:16,r,t,s,s.createRenderer(r,n),null,null));e[t.index]=a}function pb(e,t,n,r,i,s){const a=s[t];if(null!==a){const c=r.setInput;for(let p=0;p<a.length;){const m=a[p++],_=a[p++],k=a[p++];null!==c?r.setInput(n,k,m,_):n[_]=k}}}function gb(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function xb(e,t){const n=Gt(t,e);if(ka(n)){const r=n[1];80&n[2]?ni(r,n,r.template,n[8]):n[5]>0&&$u(n)}}function $u(e){for(let r=du(e);null!==r;r=pu(r))for(let i=10;i<r.length;i++){const s=r[i];if(1024&s[2]){const a=s[1];ni(a,s,a.template,s[8])}else s[5]>0&&$u(s)}const n=e[1].components;if(null!==n)for(let r=0;r<n.length;r++){const i=Gt(n[r],e);ka(i)&&i[5]>0&&$u(i)}}function bb(e,t){const n=Gt(t,e),r=n[1];(function vb(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),os(r,n,n[8])}function Mo(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function Uu(e,t,n){const r=t[10];r.begin&&r.begin();try{ni(e,t,e.template,n)}catch(i){throw function Gf(e,t){const n=e[9],r=n?n.get(Qr,null):null;r&&r.handleError(t)}(t,i),i}finally{r.end&&r.end()}}function $f(e){!function zu(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=uu(n),i=r[1];J0(i,r,i.template,n)}}(e[8])}function Gu(e,t,n){$a(0),t(e,n)}const wb=(()=>Promise.resolve(null))();function jf(e,t,n,r,i){for(let s=0;s<n.length;){const a=n[s++],c=n[s++],p=t[a],m=e.data[a];null!==m.setInput?m.setInput(p,i,r,c):p[c]=i}}function Un(e,t,n){const r=function Zs(e,t){return dt(t[e])}(t,e);!function Kh(e,t,n){at(e)?e.setValue(t,n):t.textContent=n}(e[11],r,n)}function Fo(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,s=0;if(null!==t)for(let a=0;a<t.length;a++){const c=t[a];"number"==typeof c?s=c:1==s?i=Fr(i,c):2==s&&(r=Fr(r,c+": "+t[++a]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}const ju=new He("INJECTOR",-1);class Hf{get(t,n=Xi){if(n===Xi){const r=new Error(`NullInjectorError: No provider for ${Be(t)}!`);throw r.name="NullInjectorError",r}return n}}const Hu=new He("Set Injector scope."),as={},Cb={};let Ku;function Kf(){return void 0===Ku&&(Ku=new Hf),Ku}function Wf(e,t=null,n=null,r){const i=Xf(e,t,n,r);return i._resolveInjectorDefTypes(),i}function Xf(e,t=null,n=null,r){return new Ib(e,n,t||Kf(),r)}class Ib{constructor(t,n,r,i=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const s=[];n&&In(n,c=>this.processProvider(c,t,n)),In([t],c=>this.processInjectorType(c,[],s)),this.records.set(ju,ri(void 0,this));const a=this.records.get(Hu);this.scope=null!=a?a.value:null,this.source=i||("object"==typeof t?null:Be(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,n=Xi,r=Me.Default){this.assertNotDestroyed();const i=gh(this),s=Yn(void 0);try{if(!(r&Me.SkipSelf)){let c=this.records.get(t);if(void 0===c){const p=function Pb(e){return"function"==typeof e||"object"==typeof e&&e instanceof He}(t)&&ba(t);c=p&&this.injectableDefInScope(p)?ri(Wu(t),as):null,this.records.set(t,c)}if(null!=c)return this.hydrate(t,c)}return(r&Me.Self?Kf():this.parent).get(t,n=r&Me.Optional&&n===Xi?null:n)}catch(a){if("NullInjectorError"===a.name){if((a[go]=a[go]||[]).unshift(Be(t)),i)throw a;return function lx(e,t,n,r){const i=e[go];throw t[ph]&&i.unshift(t[ph]),e.message=function cx(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=Be(t);if(Array.isArray(t))i=t.map(Be).join(" -> ");else if("object"==typeof t){let s=[];for(let a in t)if(t.hasOwnProperty(a)){let c=t[a];s.push(a+":"+("string"==typeof c?JSON.stringify(c):Be(c)))}i=`{${s.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(ix,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e[go]=null,e}(a,t,"R3InjectorError",this.source)}throw a}finally{Yn(s),gh(i)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((r,i)=>t.push(Be(i))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new f(205,"")}processInjectorType(t,n,r){if(!(t=Ie(t)))return!1;let i=Tc(t);const s=null==i&&t.ngModule||void 0,a=void 0===s?t:s,c=-1!==r.indexOf(a);if(void 0!==s&&(i=Tc(s)),null==i)return!1;if(null!=i.imports&&!c){let _;r.push(a);try{In(i.imports,k=>{this.processInjectorType(k,n,r)&&(void 0===_&&(_=[]),_.push(k))})}finally{}if(void 0!==_)for(let k=0;k<_.length;k++){const{ngModule:P,providers:z}=_[k];In(z,K=>this.processProvider(K,P,z||Xe))}}this.injectorDefTypes.add(a);const p=xr(a)||(()=>new a);this.records.set(a,ri(p,as));const m=i.providers;if(null!=m&&!c){const _=t;In(m,k=>this.processProvider(k,_,m))}return void 0!==s&&void 0!==t.providers}processProvider(t,n,r){let i=ii(t=Ie(t))?t:Ie(t&&t.provide);const s=function Mb(e,t,n){return qf(e)?ri(void 0,e.useValue):ri(function Yf(e,t,n){let r;if(ii(e)){const i=Ie(e);return xr(i)||Wu(i)}if(qf(e))r=()=>Ie(e.useValue);else if(function Rb(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Ja(e.deps||[]));else if(function Fb(e){return!(!e||!e.useExisting)}(e))r=()=>qe(Ie(e.useExisting));else{const i=Ie(e&&(e.useClass||e.provide));if(!function Nb(e){return!!e.deps}(e))return xr(i)||Wu(i);r=()=>new i(...Ja(e.deps))}return r}(e),as)}(t);if(ii(t)||!0!==t.multi)this.records.get(i);else{let a=this.records.get(i);a||(a=ri(void 0,as,!0),a.factory=()=>Ja(a.multi),this.records.set(i,a)),i=t,a.multi.push(t)}this.records.set(i,s)}hydrate(t,n){return n.value===as&&(n.value=Cb,n.value=n.factory()),"object"==typeof n.value&&n.value&&function Lb(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Ie(t.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function Wu(e){const t=ba(e),n=null!==t?t.factory:xr(e);if(null!==n)return n;if(e instanceof He)throw new f(204,"");if(e instanceof Function)return function Ab(e){const t=e.length;if(t>0)throw function Wi(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}(t,"?"),new f(204,"");const n=function jm(e){const t=e&&(e[js]||e[wc]);if(t){const n=function Hm(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new f(204,"")}function ri(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function qf(e){return null!==e&&"object"==typeof e&&ox in e}function ii(e){return"function"==typeof e}let tn=(()=>{class e{static create(n,r){var i;if(Array.isArray(n))return Wf({name:""},r,n,"");{const s=null!==(i=n.name)&&void 0!==i?i:"";return Wf({name:s},n.parent,n.providers,s)}}}return e.THROW_IF_NOT_FOUND=Xi,e.NULL=new Hf,e.\u0275prov=ot({token:e,providedIn:"any",factory:()=>qe(ju)}),e.__NG_ELEMENT_ID__=-1,e})();function jb(e,t){ro(uu(e)[1],yt())}let Ro=null;function si(){if(!Ro){const e=Ke.Symbol;if(e&&e.iterator)Ro=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Ro=r)}}}return Ro}function us(e){return!!Qu(e)&&(Array.isArray(e)||!(e instanceof Map)&&si()in e)}function Qu(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Rn(e,t,n){return e[t]=n}function At(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function ai(e,t,n,r){return At(e,function $r(){return Te.lFrame.bindingIndex++}(),n)?t+C(n)+r:Se}function Pe(e,t=Me.Default){const n=J();return null===n?qe(e,t):ih(yt(),n,Ie(e),t)}function nl(e,t,n,r,i){const a=i?"class":"style";jf(e,n,t.inputs[a],a,r)}function ir(e,t,n,r){const i=J(),s=Ve(),a=20+e,c=i[11],p=i[a]=mu(c,t,function ky(){return Te.lFrame.currentNamespace}()),m=s.firstCreatePass?function Ev(e,t,n,r,i,s,a){const c=t.consts,m=ei(t,e,2,i,Zn(c,s));return function Ou(e,t,n,r){let i=!1;if(Bc()){const s=function cb(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let s=0;s<r.length;s++){const a=r[s];hf(n,a.selectors,!1)&&(i||(i=[]),co(Gi(n,t),e,a.type),dn(a)?(Lf(e,n),i.unshift(a)):i.push(a))}return i}(e,t,n),a=null===r?null:{"":-1};if(null!==s){i=!0,Pf(n,e.data.length,s.length);for(let _=0;_<s.length;_++){const k=s[_];k.providersResolver&&k.providersResolver(k)}let c=!1,p=!1,m=ti(e,t,s.length,null);for(let _=0;_<s.length;_++){const k=s[_];n.mergedAttrs=ao(n.mergedAttrs,k.hostAttrs),Of(e,n,t,m,k),fb(m,k,a),null!==k.contentQueries&&(n.flags|=8),(null!==k.hostBindings||null!==k.hostAttrs||0!==k.hostVars)&&(n.flags|=128);const P=k.type.prototype;!c&&(P.ngOnChanges||P.ngOnInit||P.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),c=!0),!p&&(P.ngOnChanges||P.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),p=!0),m++}!function nb(e,t){const r=t.directiveEnd,i=e.data,s=t.attrs,a=[];let c=null,p=null;for(let m=t.directiveStart;m<r;m++){const _=i[m],k=_.inputs,P=null===s||cf(t)?null:gb(k,s);a.push(P),c=Ff(k,m,c),p=Ff(_.outputs,m,p)}null!==c&&(c.hasOwnProperty("class")&&(t.flags|=16),c.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=a,t.inputs=c,t.outputs=p}(e,n)}a&&function hb(e,t,n){if(t){const r=e.localNames=[];for(let i=0;i<t.length;i+=2){const s=n[t[i+1]];if(null==s)throw new f(-301,`Export of name '${t[i+1]}' not found!`);r.push(t[i],s)}}}(n,r,a)}return n.mergedAttrs=ao(n.mergedAttrs,n.attrs),i}(t,n,m,Zn(c,a)),null!==m.attrs&&Fo(m,m.attrs,!1),null!==m.mergedAttrs&&Fo(m,m.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,m),m}(a,s,i,0,t,n,r):s.data[a];Cn(m,!0);const _=m.mergedAttrs;null!==_&&oo(c,p,_);const k=m.classes;null!==k&&Du(c,p,k);const P=m.styles;null!==P&&af(c,p,P),64!=(64&m.flags)&&To(s,i,p,m),0===function my(){return Te.lFrame.elementDepthCount}()&&It(p,i),function yy(){Te.lFrame.elementDepthCount++}(),function qs(e){return 1==(1&e.flags)}(m)&&(function Lu(e,t,n){!Bc()||(function ub(e,t,n,r){const i=n.directiveStart,s=n.directiveEnd;e.firstCreatePass||Gi(n,t),It(r,t);const a=n.initialInputs;for(let c=i;c<s;c++){const p=e.data[c],m=dn(p);m&&db(t,n,p);const _=ji(t,e,c,n);It(_,t),null!==a&&pb(0,c-i,_,p,0,a),m&&(Gt(n.index,t)[8]=_)}}(e,t,n,Jt(n,t)),128==(128&n.flags)&&function lb(e,t,n){const r=n.directiveStart,i=n.directiveEnd,a=n.index,c=function Ey(){return Te.lFrame.currentDirectiveIndex}();try{Jn(a);for(let p=r;p<i;p++){const m=e.data[p],_=t[p];Oa(p),(null!==m.hostBindings||0!==m.hostVars||null!==m.hostAttrs)&&Nf(m,_)}}finally{Jn(-1),Oa(c)}}(e,t,n))}(s,i,m),function Sf(e,t,n){if(Ca(t)){const i=t.directiveEnd;for(let s=t.directiveStart;s<i;s++){const a=e.data[s];a.contentQueries&&a.contentQueries(1,n[s],s)}}}(s,m,i)),null!==r&&function Pu(e,t,n=Jt){const r=t.localNames;if(null!==r){let i=t.index+1;for(let s=0;s<r.length;s+=2){const a=r[s+1],c=-1===a?n(t,e):e[a];e[i++]=c}}}(i,m)}function sr(){let e=yt();La()?function Pa(){Te.lFrame.isParent=!1}():(e=e.parent,Cn(e,!1));const t=e;!function xy(){Te.lFrame.elementDepthCount--}();const n=Ve();n.firstCreatePass&&(ro(n,e),Ca(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Vy(e){return 0!=(16&e.flags)}(t)&&nl(n,t,J(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function $y(e){return 0!=(32&e.flags)}(t)&&nl(n,t,J(),t.stylesWithoutHost,!1)}function rl(e){return!!e&&"function"==typeof e.then}const Av=function Nd(e){return!!e&&"function"==typeof e.subscribe};function Lo(e,t,n){return sl(e,"",t,"",n),Lo}function sl(e,t,n,r,i){const s=J(),a=ai(s,t,n,r);return a!==Se&&function Kt(e,t,n,r,i,s,a,c){const p=Jt(t,n);let _,m=t.inputs;!c&&null!=m&&(_=m[r])?(jf(e,n,_,r,i),Ys(t)&&function ib(e,t){const n=Gt(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r=function rb(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=a?a(i,t.value||"",r):i,at(s)?s.setProperty(p,r,i):Ua(r)||(p.setProperty?p.setProperty(r,i):p[r]=i))}(Ve(),function ut(){const e=Te.lFrame;return Ra(e.tView,e.selectedIndex)}(),s,e,a,s[11],i,!1),sl}function al(e,t=""){const n=J(),r=Ve(),i=e+20,s=r.firstCreatePass?ei(r,i,1,t,null):r.data[i],a=n[i]=function gu(e,t){return at(e)?e.createText(t):e.createTextNode(t)}(n[11],t);To(r,n,a,s),Cn(s,!1)}function ul(e){return Oo("",e,""),ul}function Oo(e,t,n){const r=J(),i=ai(r,e,t,n);return i!==Se&&Un(r,Rt(),i),Oo}const _r=void 0;var x_=["en",[["a","p"],["AM","PM"],_r],[["AM","PM"],_r,_r],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],_r,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],_r,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",_r,"{1} 'at' {0}",_r],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function y_(e){const n=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===r?1:5}];let yi={};function Nt(e){const t=function b_(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=Ip(t);if(n)return n;const r=t.split("-")[0];if(n=Ip(r),n)return n;if("en"===r)return x_;throw new Error(`Missing locale data for the locale "${e}".`)}function Ip(e){return e in yi||(yi[e]=Ke.ng&&Ke.ng.common&&Ke.ng.common.locales&&Ke.ng.common.locales[e]),yi[e]}var ae=(()=>((ae=ae||{})[ae.LocaleId=0]="LocaleId",ae[ae.DayPeriodsFormat=1]="DayPeriodsFormat",ae[ae.DayPeriodsStandalone=2]="DayPeriodsStandalone",ae[ae.DaysFormat=3]="DaysFormat",ae[ae.DaysStandalone=4]="DaysStandalone",ae[ae.MonthsFormat=5]="MonthsFormat",ae[ae.MonthsStandalone=6]="MonthsStandalone",ae[ae.Eras=7]="Eras",ae[ae.FirstDayOfWeek=8]="FirstDayOfWeek",ae[ae.WeekendRange=9]="WeekendRange",ae[ae.DateFormat=10]="DateFormat",ae[ae.TimeFormat=11]="TimeFormat",ae[ae.DateTimeFormat=12]="DateTimeFormat",ae[ae.NumberSymbols=13]="NumberSymbols",ae[ae.NumberFormats=14]="NumberFormats",ae[ae.CurrencyCode=15]="CurrencyCode",ae[ae.CurrencySymbol=16]="CurrencySymbol",ae[ae.CurrencyName=17]="CurrencyName",ae[ae.Currencies=18]="Currencies",ae[ae.Directionality=19]="Directionality",ae[ae.PluralCase=20]="PluralCase",ae[ae.ExtraData=21]="ExtraData",ae))();const Vo="en-US";let Ap=Vo;class eg{}class _D{resolveComponentFactory(t){throw function vD(e){const t=Error(`No component factory found for ${Be(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let gs=(()=>{class e{}return e.NULL=new _D,e})();function DD(){return bi(yt(),J())}function bi(e,t){return new vi(Jt(e,t))}let vi=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=DD,e})();class ng{}let SD=(()=>{class e{}return e.\u0275prov=ot({token:e,providedIn:"root",factory:()=>null}),e})();class gl{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const CD=new gl("13.1.3"),ml={};function Go(e,t,n,r,i=!1){for(;null!==n;){const s=t[n.index];if(null!==s&&r.push(dt(s)),fn(s))for(let c=10;c<s.length;c++){const p=s[c],m=p[1].firstChild;null!==m&&Go(p[1],p,m,r)}const a=n.type;if(8&a)Go(e,t,n.child,r);else if(32&a){const c=fu(n,t);let p;for(;p=c();)r.push(p)}else if(16&a){const c=rf(t,n);if(Array.isArray(c))r.push(...c);else{const p=rs(t[16]);Go(p[1],p,c,r,!0)}}n=i?n.projectionNext:n.next}return r}class ID extends class ms{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return Go(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(fn(t)){const n=t[8],r=n?n.indexOf(this):-1;r>-1&&(function yu(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const i=r[17];null!==i&&i!==e&&Wh(i,r),t>0&&(e[n-1][4]=r[4]);const s=fo(e,10+t);!function m0(e,t){is(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const a=s[19];null!==a&&a.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}(t,r),fo(n,r))}this._attachedToViewContainer=!1}!function Xh(e,t){if(!(256&t[2])){const n=t[11];at(n)&&n.destroyNode&&is(e,t,n,3,null,null),function b0(e){let t=e[13];if(!t)return xu(e[1],e);for(;t;){let n=null;if(Sn(t))n=t[13];else{const r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)Sn(t)&&xu(t[1],t),t=t[3];null===t&&(t=e),Sn(t)&&xu(t[1],t),n=t&&t[4]}t=n}}(t)}}(this._lView[1],this._lView)}onDestroy(t){!function Mf(e,t,n,r){const i=function Bf(e){return e[7]||(e[7]=[])}(t);null===n?i.push(r):(i.push(n),e.firstCreatePass&&function zf(e){return e.cleanup||(e.cleanup=[])}(e).push(r,i.length-1))}(this._lView[1],this._lView,null,t)}markForCheck(){!function Bu(e){for(;e;){e[2]|=64;const t=rs(e);if(ry(e)&&!t)return e;e=t}return null}(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Uu(this._lView[1],this._lView,this.context)}checkNoChanges(){!function Db(e,t,n){eo(!0);try{Uu(e,t,n)}finally{eo(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new f(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function x0(e,t){is(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new f(902,"");this._appRef=t}}{constructor(t){super(t),this._view=t}detectChanges(){$f(this._view)}checkNoChanges(){!function Tb(e){eo(!0);try{$f(e)}finally{eo(!1)}}(this._view)}get context(){return null}}class ig extends gs{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=St(t);return new yl(n,this.ngModule)}}function sg(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const MD=new He("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Bh});class yl extends eg{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function V0(e){return e.map(O0).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return sg(this.componentDef.inputs)}get outputs(){return sg(this.componentDef.outputs)}create(t,n,r,i){const s=(i=i||this.ngModule)?function FD(e,t){return{get:(n,r,i)=>{const s=e.get(n,ml,i);return s!==ml||r===ml?s:t.get(n,r,i)}}}(t,i.injector):t,a=s.get(ng,Oc),c=s.get(SD,null),p=a.createRenderer(null,this.componentDef),m=this.componentDef.selectors[0][0]||"div",_=r?function Af(e,t,n){if(at(e))return e.selectRootElement(t,n===En.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(p,r,this.componentDef.encapsulation):mu(a.createRenderer(null,this.componentDef),m,function AD(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(m)),k=this.componentDef.onPush?576:528,P=function ad(e,t){return{components:[],scheduler:e||Bh,clean:wb,playerHandler:t||null,flags:0}}(),z=Ao(0,null,null,1,0,null,null,null,null,null),K=ss(null,z,P,k,null,null,a,p,c,s);let Z,te;to(K);try{const ne=function sd(e,t,n,r,i,s){const a=n[1];n[20]=e;const p=ei(a,20,2,"#host",null),m=p.mergedAttrs=t.hostAttrs;null!==m&&(Fo(p,m,!0),null!==e&&(oo(i,e,m),null!==p.classes&&Du(i,e,p.classes),null!==p.styles&&af(i,e,p.styles)));const _=r.createRenderer(e,t),k=ss(n,Cf(t),null,t.onPush?64:16,n[20],p,r,_,s||null,null);return a.firstCreatePass&&(co(Gi(p,n),a,t.type),Lf(a,p),Pf(p,n.length,1)),Mo(n,k),n[20]=k}(_,this.componentDef,K,a,p);if(_)if(r)oo(p,_,["ng-version",CD.full]);else{const{attrs:Q,classes:ce}=function $0(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let s=e[r];if("string"==typeof s)2===i?""!==s&&t.push(s,e[++r]):8===i&&n.push(s);else{if(!pn(i))break;i=s}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);Q&&oo(p,_,Q),ce&&ce.length>0&&Du(p,_,ce.join(" "))}if(te=Ra(z,20),void 0!==n){const Q=te.projection=[];for(let ce=0;ce<this.ngContentSelectors.length;ce++){const ke=n[ce];Q.push(null!=ke?Array.from(ke):null)}}Z=function od(e,t,n,r,i){const s=n[1],a=function ob(e,t,n){const r=yt();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),Of(e,r,t,ti(e,t,1,null),n));const i=ji(t,e,r.directiveStart,r);It(i,t);const s=Jt(r,t);return s&&It(s,t),i}(s,n,t);if(r.components.push(a),e[8]=a,i&&i.forEach(p=>p(a,t)),t.contentQueries){const p=yt();t.contentQueries(1,a,p.directiveStart)}const c=yt();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Jn(c.index),kf(n[1],c,0,c.directiveStart,c.directiveEnd,t),Nf(t,a)),a}(ne,this.componentDef,K,P,[jb]),os(z,K,null)}finally{no()}return new kD(this.componentType,Z,bi(te,K),K,te)}}class kD extends class bD{}{constructor(t,n,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.instance=n,this.hostView=this.changeDetectorRef=new ID(i),this.componentType=t}get injector(){return new Ur(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class _i{}const Di=new Map;class ug extends _i{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new ig(this);const r=qt(t);this._bootstrapComponents=Mn(r.bootstrap),this._r3Injector=Xf(t,n,[{provide:_i,useValue:this},{provide:gs,useValue:this.componentFactoryResolver}],Be(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,n=tn.THROW_IF_NOT_FOUND,r=Me.Default){return t===tn||t===_i||t===ju?this:this._r3Injector.get(t,n,r)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class xl extends class LD{}{constructor(t){super(),this.moduleType=t,null!==qt(t)&&function PD(e){const t=new Set;!function n(r){const i=qt(r,!0),s=i.id;null!==s&&(function og(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${Be(t)} vs ${Be(t.name)}`)}(s,Di.get(s),r),Di.set(s,r));const a=Mn(i.imports);for(const c of a)t.has(c)||(t.add(c),n(c))}(e)}(t)}create(t){return new ug(this.moduleType,t)}}function ys(e,t){const n=e[t];return n===Se?void 0:n}function cg(e,t,n,r,i,s,a){const c=t+n;return function vr(e,t,n,r){const i=At(e,t,n);return At(e,t+1,r)||i}(e,c,i,s)?Rn(e,c+2,a?r.call(a,i,s):r(i,s)):ys(e,c+2)}function bl(e,t){const n=Ve();let r;const i=e+20;n.firstCreatePass?(r=function WD(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(i,r.onDestroy)):r=n.data[i];const s=r.factory||(r.factory=xr(r.type)),a=Yn(Pe);try{const c=uo(!1),p=s();return uo(c),function rv(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,J(),i,p),p}finally{Yn(a)}}function pg(e,t,n){const r=e+20,i=J(),s=Vr(i,r);return xs(i,r)?function lg(e,t,n,r,i,s){const a=t+n;return At(e,a,i)?Rn(e,a+1,s?r.call(s,i):r(i)):ys(e,a+1)}(i,Ft(),t,s.transform,n,s):s.transform(n)}function xs(e,t){return e[1].data[t].pure}function vl(e){return t=>{setTimeout(e,void 0,t)}}const Gn=class QD extends re{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,r){var i,s,a;let c=t,p=n||(()=>null),m=r;if(t&&"object"==typeof t){const k=t;c=null===(i=k.next)||void 0===i?void 0:i.bind(k),p=null===(s=k.error)||void 0===s?void 0:s.bind(k),m=null===(a=k.complete)||void 0===a?void 0:a.bind(k)}this.__isAsync&&(p=vl(p),c&&(c=vl(c)),m&&(m=vl(m)));const _=super.subscribe({next:c,error:p,complete:m});return t instanceof F&&t.add(_),_}};function Wo(...e){}Symbol;const kl=new He("Application Initializer");let wi=(()=>{class e{constructor(n){this.appInits=n,this.resolve=Wo,this.reject=Wo,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i})}runInitializers(){if(this.initialized)return;const n=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const s=this.appInits[i]();if(rl(s))n.push(s);else if(Av(s)){const a=new Promise((c,p)=>{s.subscribe({complete:c,error:p})});n.push(a)}}Promise.all(n).then(()=>{r()}).catch(i=>{this.reject(i)}),0===n.length&&r(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(qe(kl,8))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();const vs=new He("AppId"),NT={provide:vs,useFactory:function kT(){return`${Nl()}${Nl()}${Nl()}`},deps:[]};function Nl(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Bg=new He("Platform Initializer"),Ll=new He("Platform ID"),LT=new He("appBootstrapListener");let PT=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();const or=new He("LocaleId"),zg=new He("DefaultCurrencyCode");class OT{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let Ug=(()=>{class e{compileModuleSync(n){return new xl(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),s=Mn(qt(n).declarations).reduce((a,c)=>{const p=St(c);return p&&a.push(new yl(p)),a},[]);return new OT(r,s)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();const $T=(()=>Promise.resolve(0))();function Pl(e){"undefined"==typeof Zone?$T.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Mt{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Gn(!1),this.onMicrotaskEmpty=new Gn(!1),this.onStable=new Gn(!1),this.onError=new Gn(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&n,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function BT(){let e=Ke.requestAnimationFrame,t=Ke.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function GT(e){const t=()=>{!function UT(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Ke,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Vl(e),e.isCheckStableRunning=!0,Ol(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Vl(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,s,a,c)=>{try{return Gg(e),n.invokeTask(i,s,a,c)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&t(),jg(e)}},onInvoke:(n,r,i,s,a,c,p)=>{try{return Gg(e),n.invoke(i,s,a,c,p)}finally{e.shouldCoalesceRunChangeDetection&&t(),jg(e)}},onHasTask:(n,r,i,s)=>{n.hasTask(i,s),r===i&&("microTask"==s.change?(e._hasPendingMicrotasks=s.microTask,Vl(e),Ol(e)):"macroTask"==s.change&&(e.hasPendingMacrotasks=s.macroTask))},onHandleError:(n,r,i,s)=>(n.handleError(i,s),e.runOutsideAngular(()=>e.onError.emit(s)),!1)})}(i)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Mt.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Mt.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,i){const s=this._inner,a=s.scheduleEventTask("NgZoneEvent: "+i,t,zT,Wo,Wo);try{return s.runTask(a,n,r)}finally{s.cancelTask(a)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const zT={};function Ol(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Vl(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function Gg(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function jg(e){e._nesting--,Ol(e)}class jT{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Gn,this.onMicrotaskEmpty=new Gn,this.onStable=new Gn,this.onError=new Gn}run(t,n,r){return t.apply(n,r)}runGuarded(t,n,r){return t.apply(n,r)}runOutsideAngular(t){return t()}runTask(t,n,r,i){return t.apply(n,r)}}let $l=(()=>{class e{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Mt.assertNotInAngularZone(),Pl(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Pl(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,i){let s=-1;r&&r>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==s),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:s,updateCb:i})}whenStable(n,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,r,i){return[]}}return e.\u0275fac=function(n){return new(n||e)(qe(Mt))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})(),Hg=(()=>{class e{constructor(){this._applications=new Map,Bl.addToWindow(this)}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return Bl.findTestabilityInTree(this,n,r)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();class HT{addToWindow(t){}findTestabilityInTree(t,n,r){return null}}let bn,Bl=new HT;const Kg=new He("AllowMultipleToken");function Wg(e,t,n=[]){const r=`Platform: ${t}`,i=new He(r);return(s=[])=>{let a=Xg();if(!a||a.injector.get(Kg,!1))if(e)e(n.concat(s).concat({provide:i,useValue:!0}));else{const c=n.concat(s).concat({provide:i,useValue:!0},{provide:Hu,useValue:"platform"});!function YT(e){if(bn&&!bn.destroyed&&!bn.injector.get(Kg,!1))throw new f(400,"");bn=e.get(Yg);const t=e.get(Bg,null);t&&t.forEach(n=>n())}(tn.create({providers:c,name:r}))}return function qT(e){const t=Xg();if(!t)throw new f(401,"");return t}()}}function Xg(){return bn&&!bn.destroyed?bn:null}let Yg=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const c=function QT(e,t){let n;return n="noop"===e?new jT:("zone.js"===e?void 0:e)||new Mt({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(r?r.ngZone:void 0,{ngZoneEventCoalescing:r&&r.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:r&&r.ngZoneRunCoalescing||!1}),p=[{provide:Mt,useValue:c}];return c.run(()=>{const m=tn.create({providers:p,parent:this.injector,name:n.moduleType.name}),_=n.create(m),k=_.injector.get(Qr,null);if(!k)throw new f(402,"");return c.runOutsideAngular(()=>{const P=c.onError.subscribe({next:z=>{k.handleError(z)}});_.onDestroy(()=>{zl(this._modules,_),P.unsubscribe()})}),function ZT(e,t,n){try{const r=n();return rl(r)?r.catch(i=>{throw t.runOutsideAngular(()=>e.handleError(i)),i}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(k,c,()=>{const P=_.injector.get(wi);return P.runInitializers(),P.donePromise.then(()=>(function T_(e){zt(e,"Expected localeId to be defined"),"string"==typeof e&&(Ap=e.toLowerCase().replace(/_/g,"-"))}(_.injector.get(or,Vo)||Vo),this._moduleDoBootstrap(_),_))})})}bootstrapModule(n,r=[]){const i=qg({},r);return function WT(e,t,n){const r=new xl(n);return Promise.resolve(r)}(0,0,n).then(s=>this.bootstrapModuleFactory(s,i))}_moduleDoBootstrap(n){const r=n.injector.get(Xo);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!n.instance.ngDoBootstrap)throw new f(403,"");n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new f(404,"");this._modules.slice().forEach(n=>n.destroy()),this._destroyListeners.forEach(n=>n()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(qe(tn))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();function qg(e,t){return Array.isArray(t)?t.reduce(qg,e):Object.assign(Object.assign({},e),t)}let Xo=(()=>{class e{constructor(n,r,i,s,a){this._zone=n,this._injector=r,this._exceptionHandler=i,this._componentFactoryResolver=s,this._initStatus=a,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const c=new j(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),p=new j(m=>{let _;this._zone.runOutsideAngular(()=>{_=this._zone.onStable.subscribe(()=>{Mt.assertNotInAngularZone(),Pl(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const k=this._zone.onUnstable.subscribe(()=>{Mt.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{_.unsubscribe(),k.unsubscribe()}});this.isStable=Bs(c,p.pipe(function Ar(e={}){const{connector:t=(()=>new re),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=e;return s=>{let a=null,c=null,p=null,m=0,_=!1,k=!1;const P=()=>{null==c||c.unsubscribe(),c=null},z=()=>{P(),a=p=null,_=k=!1},K=()=>{const Z=a;z(),null==Z||Z.unsubscribe()};return ye((Z,te)=>{m++,!k&&!_&&P();const ne=p=null!=p?p:t();te.add(()=>{m--,0===m&&!k&&!_&&(c=Ne(K,i))}),ne.subscribe(te),a||(a=new I({next:Q=>ne.next(Q),error:Q=>{k=!0,P(),c=Ne(z,n,Q),ne.error(Q)},complete:()=>{_=!0,P(),c=Ne(z,r),ne.complete()}}),Ri(Z).subscribe(a))})(s)}}()))}bootstrap(n,r){if(!this._initStatus.done)throw new f(405,"");let i;i=n instanceof eg?n:this._componentFactoryResolver.resolveComponentFactory(n),this.componentTypes.push(i.componentType);const s=function XT(e){return e.isBoundToModule}(i)?void 0:this._injector.get(_i),c=i.create(tn.NULL,[],r||i.selector,s),p=c.location.nativeElement,m=c.injector.get($l,null),_=m&&c.injector.get(Hg);return m&&_&&_.registerApplication(p,m),c.onDestroy(()=>{this.detachView(c.hostView),zl(this.components,c),_&&_.unregisterApplication(p)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new f(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;zl(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(LT,[]).concat(this._bootstrapListeners).forEach(i=>i(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(n){return new(n||e)(qe(Mt),qe(tn),qe(Qr),qe(gs),qe(wi))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();function zl(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let Zg=!0;class sm{constructor(){}supports(t){return us(t)}create(t){return new lw(t)}}const uw=(e,t)=>t;class lw{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||uw}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,r=this._removalsHead,i=0,s=null;for(;n||r;){const a=!r||n&&n.currentIndex<am(r,i,s)?n:r,c=am(a,i,s),p=a.currentIndex;if(a===r)i--,r=r._nextRemoved;else if(n=n._next,null==a.previousIndex)i++;else{s||(s=[]);const m=c-i,_=p-i;if(m!=_){for(let P=0;P<m;P++){const z=P<s.length?s[P]:s[P]=0,K=z+P;_<=K&&K<m&&(s[P]=z+1)}s[a.previousIndex]=_-m}}c!==p&&t(a,c,p)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!us(t))throw new f(900,"");return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i,s,a,n=this._itHead,r=!1;if(Array.isArray(t)){this.length=t.length;for(let c=0;c<this.length;c++)s=t[c],a=this._trackByFn(c,s),null!==n&&Object.is(n.trackById,a)?(r&&(n=this._verifyReinsertion(n,s,a,c)),Object.is(n.item,s)||this._addIdentityChange(n,s)):(n=this._mismatch(n,s,a,c),r=!0),n=n._next}else i=0,function ev(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[si()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(t,c=>{a=this._trackByFn(i,c),null!==n&&Object.is(n.trackById,a)?(r&&(n=this._verifyReinsertion(n,c,a,i)),Object.is(n.item,c)||this._addIdentityChange(n,c)):(n=this._mismatch(n,c,a,i),r=!0),n=n._next,i++}),this.length=i;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,r,i){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,s,i)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,i))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,s,i)):t=this._addAfter(new cw(n,r),s,i),t}_verifyReinsertion(t,n,r,i){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==s?t=this._reinsertAfter(s,t._prev,i):t.currentIndex!=i&&(t.currentIndex=i,this._addToMoves(t,i)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const i=t._prevRemoved,s=t._nextRemoved;return null===i?this._removalsHead=s:i._nextRemoved=s,null===s?this._removalsTail=i:s._prevRemoved=i,this._insertAfter(t,n,r),this._addToMoves(t,r),t}_moveAfter(t,n,r){return this._unlink(t),this._insertAfter(t,n,r),this._addToMoves(t,r),t}_addAfter(t,n,r){return this._insertAfter(t,n,r),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,r){const i=null===n?this._itHead:n._next;return t._next=i,t._prev=n,null===i?this._itTail=t:i._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new om),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,r=t._next;return null===n?this._itHead=r:n._next=r,null===r?this._itTail=n:r._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new om),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class cw{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class hw{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===n||n<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){const n=t._prevDup,r=t._nextDup;return null===n?this._head=r:n._nextDup=r,null===r?this._tail=n:r._prevDup=n,null===this._head}}class om{constructor(){this.map=new Map}put(t){const n=t.trackById;let r=this.map.get(n);r||(r=new hw,this.map.set(n,r)),r.add(t)}get(t,n){const i=this.map.get(t);return i?i.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function am(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class um{constructor(){}supports(t){return t instanceof Map||Qu(t)}create(){return new fw}}class fw{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let n;for(n=this._mapHead;null!==n;n=n._next)t(n)}forEachPreviousItem(t){let n;for(n=this._previousMapHead;null!==n;n=n._nextPrevious)t(n)}forEachChangedItem(t){let n;for(n=this._changesHead;null!==n;n=n._nextChanged)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}diff(t){if(t){if(!(t instanceof Map||Qu(t)))throw new f(900,"")}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(t,(r,i)=>{if(n&&n.key===i)this._maybeAddToChanges(n,r),this._appendAfter=n,n=n._next;else{const s=this._getOrCreateRecordForKey(i,r);n=this._insertBeforeOrAppend(n,s)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,n){if(t){const r=t._prev;return n._next=t,n._prev=r,t._prev=n,r&&(r._next=n),t===this._mapHead&&(this._mapHead=n),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(t,n){if(this._records.has(t)){const i=this._records.get(t);this._maybeAddToChanges(i,n);const s=i._prev,a=i._next;return s&&(s._next=a),a&&(a._prev=s),i._next=null,i._prev=null,i}const r=new dw(t);return this._records.set(t,r),r.currentValue=n,this._addToAdditions(r),r}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,n){Object.is(n,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=n,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,n){t instanceof Map?t.forEach(n):Object.keys(t).forEach(r=>n(t[r],r))}}class dw{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function lm(){return new _s([new sm])}let _s=(()=>{class e{constructor(n){this.factories=n}static create(n,r){if(null!=r){const i=r.factories.slice();n=n.concat(i)}return new e(n)}static extend(n){return{provide:e,useFactory:r=>e.create(n,r||lm()),deps:[[e,new Qi,new Xr]]}}find(n){const r=this.factories.find(i=>i.supports(n));if(null!=r)return r;throw new f(901,"")}}return e.\u0275prov=ot({token:e,providedIn:"root",factory:lm}),e})();function cm(){return new Ei([new um])}let Ei=(()=>{class e{constructor(n){this.factories=n}static create(n,r){if(r){const i=r.factories.slice();n=n.concat(i)}return new e(n)}static extend(n){return{provide:e,useFactory:r=>e.create(n,r||cm()),deps:[[e,new Qi,new Xr]]}}find(n){const r=this.factories.find(s=>s.supports(n));if(r)return r;throw new f(901,"")}}return e.\u0275prov=ot({token:e,providedIn:"root",factory:cm}),e})();const pw=[new um],mw=new _s([new sm]),yw=new Ei(pw),xw=Wg(null,"core",[{provide:Ll,useValue:"unknown"},{provide:Yg,deps:[tn]},{provide:Hg,deps:[]},{provide:PT,deps:[]}]),Tw=[{provide:Xo,useClass:Xo,deps:[Mt,tn,Qr,gs,wi]},{provide:MD,deps:[Mt],useFactory:function ww(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(n){t.push(n)}}},{provide:wi,useClass:wi,deps:[[new Xr,kl]]},{provide:Ug,useClass:Ug,deps:[]},NT,{provide:_s,useFactory:function bw(){return mw},deps:[]},{provide:Ei,useFactory:function vw(){return yw},deps:[]},{provide:or,useFactory:function _w(e){return e||function Dw(){return"undefined"!=typeof $localize&&$localize.locale||Vo}()},deps:[[new mo(or),new Xr,new Qi]]},{provide:zg,useValue:"USD"}];let Ew=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(qe(Xo))},e.\u0275mod=Pi({type:e}),e.\u0275inj=Rr({providers:Tw}),e})(),qo=null;function Ds(){return qo}const Pn=new He("DocumentToken");var Bt=(()=>((Bt=Bt||{})[Bt.Decimal=0]="Decimal",Bt[Bt.Percent=1]="Percent",Bt[Bt.Currency=2]="Currency",Bt[Bt.Scientific=3]="Scientific",Bt))(),gt=(()=>((gt=gt||{})[gt.Zero=0]="Zero",gt[gt.One=1]="One",gt[gt.Two=2]="Two",gt[gt.Few=3]="Few",gt[gt.Many=4]="Many",gt[gt.Other=5]="Other",gt))(),me=(()=>((me=me||{})[me.Decimal=0]="Decimal",me[me.Group=1]="Group",me[me.List=2]="List",me[me.PercentSign=3]="PercentSign",me[me.PlusSign=4]="PlusSign",me[me.MinusSign=5]="MinusSign",me[me.Exponential=6]="Exponential",me[me.SuperscriptingExponent=7]="SuperscriptingExponent",me[me.PerMille=8]="PerMille",me[me.Infinity=9]="Infinity",me[me.NaN=10]="NaN",me[me.TimeSeparator=11]="TimeSeparator",me[me.CurrencyDecimal=12]="CurrencyDecimal",me[me.CurrencyGroup=13]="CurrencyGroup",me))();function rn(e,t){const n=Nt(e),r=n[ae.NumberSymbols][t];if(void 0===r){if(t===me.CurrencyDecimal)return n[ae.NumberSymbols][me.Decimal];if(t===me.CurrencyGroup)return n[ae.NumberSymbols][me.Group]}return r}const Vw=function Cp(e){return Nt(e)[ae.PluralCase]},rE=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Jl(e){const t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}class oa{}let dE=(()=>{class e extends oa{constructor(n){super(),this.locale=n}getPluralCategory(n,r){switch(Vw(r||this.locale)(n)){case gt.Zero:return"zero";case gt.One:return"one";case gt.Two:return"two";case gt.Few:return"few";case gt.Many:return"many";default:return"other"}}}return e.\u0275fac=function(n){return new(n||e)(qe(or))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();let wm=(()=>{class e{transform(n){return JSON.stringify(n,null,2)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275pipe=Vt({name:"json",type:e,pure:!1}),e})(),Sm=(()=>{class e{constructor(n){this._locale=n}transform(n,r,i){if(!function nc(e){return!(null==e||""===e||e!=e)}(n))return null;i=i||this._locale;try{return function lE(e,t,n){return function Ql(e,t,n,r,i,s,a=!1){let c="",p=!1;if(isFinite(e)){let m=function hE(e){let r,i,s,a,c,t=Math.abs(e)+"",n=0;for((i=t.indexOf("."))>-1&&(t=t.replace(".","")),(s=t.search(/e/i))>0?(i<0&&(i=s),i+=+t.slice(s+1),t=t.substring(0,s)):i<0&&(i=t.length),s=0;"0"===t.charAt(s);s++);if(s===(c=t.length))r=[0],i=1;else{for(c--;"0"===t.charAt(c);)c--;for(i-=s,r=[],a=0;s<=c;s++,a++)r[a]=Number(t.charAt(s))}return i>22&&(r=r.splice(0,21),n=i-1,i=1),{digits:r,exponent:n,integerLen:i}}(e);a&&(m=function cE(e){if(0===e.digits[0])return e;const t=e.digits.length-e.integerLen;return e.exponent?e.exponent+=2:(0===t?e.digits.push(0,0):1===t&&e.digits.push(0),e.integerLen+=2),e}(m));let _=t.minInt,k=t.minFrac,P=t.maxFrac;if(s){const Q=s.match(rE);if(null===Q)throw new Error(`${s} is not a valid digit info`);const ce=Q[1],ke=Q[3],ze=Q[5];null!=ce&&(_=Jl(ce)),null!=ke&&(k=Jl(ke)),null!=ze?P=Jl(ze):null!=ke&&k>P&&(P=k)}!function fE(e,t,n){if(t>n)throw new Error(`The minimum number of digits after fraction (${t}) is higher than the maximum (${n}).`);let r=e.digits,i=r.length-e.integerLen;const s=Math.min(Math.max(t,i),n);let a=s+e.integerLen,c=r[a];if(a>0){r.splice(Math.max(e.integerLen,a));for(let k=a;k<r.length;k++)r[k]=0}else{i=Math.max(0,i),e.integerLen=1,r.length=Math.max(1,a=s+1),r[0]=0;for(let k=1;k<a;k++)r[k]=0}if(c>=5)if(a-1<0){for(let k=0;k>a;k--)r.unshift(0),e.integerLen++;r.unshift(1),e.integerLen++}else r[a-1]++;for(;i<Math.max(0,s);i++)r.push(0);let p=0!==s;const m=t+e.integerLen,_=r.reduceRight(function(k,P,z,K){return K[z]=(P+=k)<10?P:P-10,p&&(0===K[z]&&z>=m?K.pop():p=!1),P>=10?1:0},0);_&&(r.unshift(_),e.integerLen++)}(m,k,P);let z=m.digits,K=m.integerLen;const Z=m.exponent;let te=[];for(p=z.every(Q=>!Q);K<_;K++)z.unshift(0);for(;K<0;K++)z.unshift(0);K>0?te=z.splice(K,z.length):(te=z,z=[0]);const ne=[];for(z.length>=t.lgSize&&ne.unshift(z.splice(-t.lgSize,z.length).join(""));z.length>t.gSize;)ne.unshift(z.splice(-t.gSize,z.length).join(""));z.length&&ne.unshift(z.join("")),c=ne.join(rn(n,r)),te.length&&(c+=rn(n,i)+te.join("")),Z&&(c+=rn(n,me.Exponential)+"+"+Z)}else c=rn(n,me.Infinity);return c=e<0&&!p?t.negPre+c+t.negSuf:t.posPre+c+t.posSuf,c}(e,function Zl(e,t="-"){const n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=e.split(";"),i=r[0],s=r[1],a=-1!==i.indexOf(".")?i.split("."):[i.substring(0,i.lastIndexOf("0")+1),i.substring(i.lastIndexOf("0")+1)],c=a[0],p=a[1]||"";n.posPre=c.substr(0,c.indexOf("#"));for(let _=0;_<p.length;_++){const k=p.charAt(_);"0"===k?n.minFrac=n.maxFrac=_+1:"#"===k?n.maxFrac=_+1:n.posSuf+=k}const m=c.split(",");if(n.gSize=m[1]?m[1].length:0,n.lgSize=m[2]||m[1]?(m[2]||m[1]).length:0,s){const _=i.length-n.posPre.length-n.posSuf.length,k=s.indexOf("#");n.negPre=s.substr(0,k).replace(/'/g,""),n.negSuf=s.substr(k+_).replace(/'/g,"")}else n.negPre=t+n.posPre,n.negSuf=n.posSuf;return n}(function Kl(e,t){return Nt(e)[ae.NumberFormats][t]}(t,Bt.Decimal),rn(t,me.MinusSign)),t,me.Group,me.Decimal,n)}(function rc(e){if("string"==typeof e&&!isNaN(Number(e)-parseFloat(e)))return Number(e);if("number"!=typeof e)throw new Error(`${e} is not a number`);return e}(n),i,r)}catch(s){throw function _n(e,t){return new f(2100,"")}()}}}return e.\u0275fac=function(n){return new(n||e)(Pe(or,16))},e.\u0275pipe=Vt({name:"number",type:e,pure:!0}),e})();let HE=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Pi({type:e}),e.\u0275inj=Rr({providers:[{provide:oa,useClass:dE}]}),e})();class ic extends class QE extends class Iw{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function Cw(e){qo||(qo=e)}(new ic)}onAndCancel(t,n,r){return t.addEventListener(n,r,!1),()=>{t.removeEventListener(n,r,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function ZE(){return Es=Es||document.querySelector("base"),Es?Es.getAttribute("href"):null}();return null==n?null:function JE(e){aa=aa||document.createElement("a"),aa.setAttribute("href",e);const t=aa.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){Es=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function pE(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[i,s]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(i.trim()===t)return decodeURIComponent(s)}return null}(document.cookie,t)}}let aa,Es=null;const Am=new He("TRANSITION_ID"),tS=[{provide:kl,useFactory:function eS(e,t,n){return()=>{n.get(wi).donePromise.then(()=>{const r=Ds(),i=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let s=0;s<i.length;s++)r.remove(i[s])})}},deps:[Am,Pn,tn],multi:!0}];class sc{static init(){!function KT(e){Bl=e}(new sc)}addToWindow(t){Ke.getAngularTestability=(r,i=!0)=>{const s=t.findTestabilityInTree(r,i);if(null==s)throw new Error("Could not find testability for element.");return s},Ke.getAllAngularTestabilities=()=>t.getAllTestabilities(),Ke.getAllAngularRootElements=()=>t.getAllRootElements(),Ke.frameworkStabilizers||(Ke.frameworkStabilizers=[]),Ke.frameworkStabilizers.push(r=>{const i=Ke.getAllAngularTestabilities();let s=i.length,a=!1;const c=function(p){a=a||p,s--,0==s&&r(a)};i.forEach(function(p){p.whenStable(c)})})}findTestabilityInTree(t,n,r){if(null==n)return null;const i=t.getTestability(n);return null!=i?i:r?Ds().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null}}let nS=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();const ua=new He("EventManagerPlugins");let la=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(i=>i.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,r,i){return this._findPluginFor(r).addEventListener(n,r,i)}addGlobalEventListener(n,r,i){return this._findPluginFor(r).addGlobalEventListener(n,r,i)}getZone(){return this._zone}_findPluginFor(n){const r=this._eventNameToPlugin.get(n);if(r)return r;const i=this._plugins;for(let s=0;s<i.length;s++){const a=i[s];if(a.supports(n))return this._eventNameToPlugin.set(n,a),a}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(qe(ua),qe(Mt))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();class Mm{constructor(t){this._doc=t}addGlobalEventListener(t,n,r){const i=Ds().getGlobalEventTarget(this._doc,t);if(!i)throw new Error(`Unsupported event target ${i} for event ${n}`);return this.addEventListener(i,n,r)}}let Fm=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const r=new Set;n.forEach(i=>{this._stylesSet.has(i)||(this._stylesSet.add(i),r.add(i))}),this.onStylesAdded(r)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})(),Ss=(()=>{class e extends Fm{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,r,i){n.forEach(s=>{const a=this._doc.createElement("style");a.textContent=s,i.push(r.appendChild(a))})}addHost(n){const r=[];this._addStylesToHost(this._stylesSet,n,r),this._hostNodes.set(n,r)}removeHost(n){const r=this._hostNodes.get(n);r&&r.forEach(Rm),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((r,i)=>{this._addStylesToHost(n,i,r)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(Rm))}}return e.\u0275fac=function(n){return new(n||e)(qe(Pn))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();function Rm(e){Ds().remove(e)}const oc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},ac=/%COMP%/g;function ca(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?ca(e,i,n):(i=i.replace(ac,e),n.push(i))}return n}function Lm(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let uc=(()=>{class e{constructor(n,r,i){this.eventManager=n,this.sharedStylesHost=r,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new lc(n)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;switch(r.encapsulation){case En.Emulated:{let i=this.rendererByCompId.get(r.id);return i||(i=new uS(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,i)),i.applyToHost(n),i}case 1:case En.ShadowDom:return new lS(this.eventManager,this.sharedStylesHost,n,r);default:if(!this.rendererByCompId.has(r.id)){const i=ca(r.id,r.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(qe(la),qe(Ss),qe(vs))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();class lc{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(oc[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){t.appendChild(n)}insertBefore(t,n,r){t&&t.insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,i){if(i){n=i+":"+n;const s=oc[i];s?t.setAttributeNS(s,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const i=oc[r];i?t.removeAttributeNS(i,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,i){i&(Ht.DashCase|Ht.Important)?t.style.setProperty(n,r,i&Ht.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&Ht.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){t[n]=r}setValue(t,n){t.nodeValue=n}listen(t,n,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,Lm(r)):this.eventManager.addEventListener(t,n,Lm(r))}}class uS extends lc{constructor(t,n,r,i){super(t),this.component=r;const s=ca(i+"-"+r.id,r.styles,[]);n.addStyles(s),this.contentAttr=function sS(e){return"_ngcontent-%COMP%".replace(ac,e)}(i+"-"+r.id),this.hostAttr=function oS(e){return"_nghost-%COMP%".replace(ac,e)}(i+"-"+r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}class lS extends lc{constructor(t,n,r,i){super(t),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=ca(i.id,i.styles,[]);for(let a=0;a<s.length;a++){const c=document.createElement("style");c.textContent=s[a],this.shadowRoot.appendChild(c)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let cS=(()=>{class e extends Mm{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,i){return n.addEventListener(r,i,!1),()=>this.removeEventListener(n,r,i)}removeEventListener(n,r,i){return n.removeEventListener(r,i)}}return e.\u0275fac=function(n){return new(n||e)(qe(Pn))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();const Om=["alt","control","meta","shift"],fS={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Vm={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},dS={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let pS=(()=>{class e extends Mm{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,i){const s=e.parseEventName(r),a=e.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ds().onAndCancel(n,s.domEventName,a))}static parseEventName(n){const r=n.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const s=e._normalizeKey(r.pop());let a="";if(Om.forEach(p=>{const m=r.indexOf(p);m>-1&&(r.splice(m,1),a+=p+".")}),a+=s,0!=r.length||0===s.length)return null;const c={};return c.domEventName=i,c.fullKey=a,c}static getEventFullKey(n){let r="",i=function gS(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Vm.hasOwnProperty(t)&&(t=Vm[t]))}return fS[t]||t}(n);return i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),Om.forEach(s=>{s!=i&&dS[s](n)&&(r+=s+".")}),r+=i,r}static eventCallback(n,r,i){return s=>{e.getEventFullKey(s)===n&&i.runGuarded(()=>r(s))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(qe(Pn))},e.\u0275prov=ot({token:e,factory:e.\u0275fac}),e})();const bS=Wg(xw,"browser",[{provide:Ll,useValue:"browser"},{provide:Bg,useValue:function mS(){ic.makeCurrent(),sc.init()},multi:!0},{provide:Pn,useFactory:function xS(){return function hy(e){Ma=e}(document),document},deps:[]}]),vS=[{provide:Hu,useValue:"root"},{provide:Qr,useFactory:function yS(){return new Qr},deps:[]},{provide:ua,useClass:cS,multi:!0,deps:[Pn,Mt,Ll]},{provide:ua,useClass:pS,multi:!0,deps:[Pn]},{provide:uc,useClass:uc,deps:[la,Ss,vs]},{provide:ng,useExisting:uc},{provide:Fm,useExisting:Ss},{provide:Ss,useClass:Ss,deps:[Pn]},{provide:$l,useClass:$l,deps:[Mt]},{provide:la,useClass:la,deps:[ua,Mt]},{provide:class qE{},useClass:nS,deps:[]}];let _S=(()=>{class e{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:e,providers:[{provide:vs,useValue:n.appId},{provide:Am,useExisting:vs},tS]}}}return e.\u0275fac=function(n){return new(n||e)(qe(e,12))},e.\u0275mod=Pi({type:e}),e.\u0275inj=Rr({providers:vS,imports:[HE,Ew]}),e})();function zm(e,t,n,r,i,s,a){try{var c=e[s](a),p=c.value}catch(m){return void n(m)}c.done?t(p):Promise.resolve(p).then(r,i)}"undefined"!=typeof window&&window;var kS=Cs(218);let NS=(()=>{class e{constructor(){this.constants={width:600,height:250,steps_per_update:20,dx:1,mass:1,hbar:1,sigma:40,k0:Math.PI/3,v0:10,c1:0,c2:0,dt:0},this.time=0,this.psi_present_r=this.new_grid(this.constants.width,this.constants.height),this.psi_present_i=this.new_grid(this.constants.width,this.constants.height),this.psi_future_r=this.new_grid(this.constants.width,this.constants.height),this.psi_future_i=this.new_grid(this.constants.width,this.constants.height),this.psi_past_r=this.new_grid(this.constants.width,this.constants.height),this.psi_past_i=this.new_grid(this.constants.width,this.constants.height),this.potential=this.new_grid(this.constants.width,this.constants.height),this.psi_p=this.new_grid(this.constants.width,this.constants.height),this.max_p=0,this.c2V=this.new_grid(this.constants.width,this.constants.height),this.initializeConstants(),this.initializePotential(),this.initializePsi(),this.initializeGPU(),this.normalize()}ngOnInit(){var n=this;return function RS(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var s=e.apply(t,n);function a(p){zm(s,r,i,a,c,"next",p)}function c(p){zm(s,r,i,a,c,"throw",p)}a(void 0)})}}(function*(){n.gpuStep(),n.drawPotential(),n.drawPsi(),n.start=performance.now(),requestAnimationFrame(()=>n.animateStep())})()}initializeGPU(){this.gpu=new kS.GPU,this.leapStepKernel=this.gpu.createKernel(function(n,r,i,s,a){let c=this.constants.c1,p=this.constants.width,_=this.thread.x,k=this.thread.y,P=_%p,z=Math.floor(_/p);return 1==k?c*(n[z*p+P+1]+n[(z+1)*p+P]-4*n[z*p+P]+n[z*p+P-1]+n[(z-1)*p+P])-a[z*p+P]*n[z*p+P]+s[z*p+P]:0==k?-c*(r[z*p+P+1]+r[(z+1)*p+P]-4*r[z*p+P]+r[z*p+P-1]+r[(z-1)*p+P])+a[z*p+P]*r[z*p+P]+i[z*p+P]:0},{output:[this.constants.height*this.constants.width,2],constants:{c1:this.constants.c1,width:this.constants.width,height:this.constants.height},optimizeFloatMemory:!0,tactic:"speed"})}initializeConstants(){this.constants.dt=this.constants.hbar/(2*this.constants.hbar**2/(this.constants.mass*this.constants.dx**2)+this.constants.v0),this.constants.c1=this.constants.dt*this.constants.hbar/2/this.constants.mass,this.constants.c2=this.constants.dt/this.constants.hbar}new_grid(n,r){return new Float32Array(n*r).fill(0)}gaussian(n,r,i,s,a){return Math.exp(-((n-i)**2+(r-s)**2)/(2*a**2))}initializePotential(){for(let n=Math.round(1*this.constants.width/2);n<Math.round(1*this.constants.width/2)+5;n++){for(let r=0;r<3*this.constants.height/10;r++)this.potential[this.index2D(n,r)]=this.constants.v0;for(let r=4*this.constants.height/10;r<6*this.constants.height/10;r++)this.potential[this.index2D(n,r)]=this.constants.v0;for(let r=7*this.constants.height/10;r<this.constants.height;r++)this.potential[this.index2D(n,r)]=this.constants.v0}for(let n=0;n<this.constants.height;n++)for(let r=0;r<this.constants.width;r++)this.c2V[this.index2D(r,n)]=this.constants.c2*this.potential[this.index2D(r,n)]}initializePsi(){for(let n=0;n<this.constants.height;n++)for(let r=0;r<this.constants.width;r++)this.psi_present_r[this.index2D(r,n)]=Math.cos(this.constants.k0*r)*this.gaussian(r,n,this.constants.width/4,this.constants.height/2,this.constants.sigma),this.psi_present_i[this.index2D(r,n)]=Math.sin(this.constants.k0*r)*this.gaussian(r,n,this.constants.width/4,this.constants.height/2,this.constants.sigma),this.psi_past_r[this.index2D(r,n)]=Math.cos(this.constants.k0*r)*this.gaussian(r,n,this.constants.width/4,this.constants.height/2,this.constants.sigma),this.psi_past_i[this.index2D(r,n)]=Math.sin(this.constants.k0*r)*this.gaussian(r,n,this.constants.width/4,this.constants.height/2,this.constants.sigma)}normalize(){let n=0;for(let r=0;r<this.constants.height;r++)for(let i=0;i<this.constants.width;i++)this.psi_p[this.index2D(i,r)]=this.psi_present_r[this.index2D(i,r)]**2+this.psi_present_i[this.index2D(i,r)]**2,n+=this.psi_p[this.index2D(i,r)];n=Math.sqrt(n);for(let r=0;r<this.constants.height;r++)for(let i=0;i<this.constants.width;i++)this.psi_present_r[this.index2D(i,r)]/=n,this.psi_present_i[this.index2D(i,r)]/=n,this.psi_past_r[this.index2D(i,r)]/=n,this.psi_past_i[this.index2D(i,r)]/=n}drawPotential(){var r=document.getElementById("canvas").getContext("2d");r.fillStyle="black";for(let i=0;i<this.constants.height;i++)for(let s=0;s<this.constants.width;s++)0!=this.potential[this.index2D(s,i)]&&r.fillRect(s,i,1,1)}drawPsi(){var r=document.getElementById("canvas").getContext("2d"),i=r.createImageData(this.constants.width,this.constants.height);for(let s=0;s<this.constants.height;s++)for(let a=0;a<this.constants.width;a++){let c=Math.floor(255-Math.round(this.psi_p[this.index2D(a,s)]/this.max_p*255)),p=4*(this.constants.width*s+a);i.data[p+0]=c,i.data[p+1]=c,i.data[p+2]=c,i.data[p+3]=255}r.putImageData(i,0,0)}animateStep(){for(let n=0;n<this.constants.steps_per_update;n++)this.gpuStep();this.gpuStep(!0),this.drawPsi(),this.drawPotential(),requestAnimationFrame(()=>{this.animateStep()})}index2D(n,r){return this.constants.width*r+n}gpuStep(n=!1){let r=this.leapStepKernel(this.psi_present_r,this.psi_present_i,this.psi_past_r,this.psi_past_i,this.c2V);[this.psi_future_r,this.psi_future_i]=r,this.stepCleanup(n)}step(n=!1){this.stepCleanup(n)}stepCleanup(n){if(this.max_p=0,this.psi_past_r=this.psi_present_r,this.psi_present_r=this.psi_future_r,this.psi_past_i=this.psi_present_i,this.psi_present_i=this.psi_future_i,n){for(let r=0;r<this.constants.height;r++)for(let i=0;i<this.constants.width;i++)this.psi_p[this.index2D(i,r)]=this.psi_present_r[this.index2D(i,r)]**2+this.psi_present_i[this.index2D(i,r)]**2,this.psi_p[this.index2D(i,r)]>this.max_p&&(this.max_p=this.psi_p[this.index2D(i,r)]);this.fps=this.time/(performance.now()-this.start)*1e3}this.time+=1}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=wa({type:e,selectors:[["app-root"]],decls:11,vars:9,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-6"],["id","canvas",2,"border","1px solid",3,"width","height"]],template:function(n,r){1&n&&(ir(0,"div",0),ir(1,"div",1),ir(2,"div",2),function Fd(e,t,n,r){ir(e,t,n,r),sr()}(3,"canvas",3),sr(),ir(4,"div",2),ir(5,"p"),al(6),bl(7,"number"),sr(),ir(8,"pre"),al(9),bl(10,"json"),sr(),sr(),sr(),sr()),2&n&&(Eo(3),Lo("width",r.constants.width),Lo("height",r.constants.height),Eo(3),Oo("FPS: ",function gg(e,t,n,r){const i=e+20,s=J(),a=Vr(s,i);return xs(s,i)?cg(s,Ft(),t,a.transform,n,r,a):a.transform(n,r)}(7,4,r.fps,"1.1-1"),""),Eo(3),ul(pg(10,7,r.constants)))},pipes:[Sm,wm],encapsulation:2}),e})(),LS=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Pi({type:e,bootstrap:[NS]}),e.\u0275inj=Rr({providers:[],imports:[[_S]]}),e})();(function ew(){Zg=!1})(),bS().bootstrapModule(LS).catch(e=>console.error(e))},218:Si=>{Si.exports=function T(B,q,F){function L(h,d){if(!q[h]){if(!B[h]){if(A)return A(h,!0);var l=new Error("Cannot find module '"+h+"'");throw l.code="MODULE_NOT_FOUND",l}var y=q[h]={exports:{}};B[h][0].call(y.exports,function(E){return L(B[h][1][E]||E)},y,y.exports,T,B,q,F)}return q[h].exports}for(var A=void 0,x=0;x<F.length;x++)L(F[x]);return L}({1:[function(T,B,q){var F,L;F=this,L=function(F){"use strict";var L={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},A="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",x={5:A,"5module":A+" export import",6:A+" const class extends export import super"},h=/^in(stanceof)?$/,d="\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0560-\u0588\u05d0-\u05ea\u05ef-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u0860-\u086a\u08a0-\u08b4\u08b6-\u08c7\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u09fc\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0af9\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58-\u0c5a\u0c60\u0c61\u0c80\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d04-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d54-\u0d56\u0d5f-\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e86-\u0e8a\u0e8c-\u0ea3\u0ea5\u0ea7-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f5\u13f8-\u13fd\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1878\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1c80-\u1c88\u1c90-\u1cba\u1cbd-\u1cbf\u1ce9-\u1cec\u1cee-\u1cf3\u1cf5\u1cf6\u1cfa\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2118-\u211d\u2124\u2126\u2128\u212a-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309b-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312f\u3131-\u318e\u31a0-\u31bf\u31f0-\u31ff\u3400-\u4dbf\u4e00-\u9ffc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua7bf\ua7c2-\ua7ca\ua7f5-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua8fd\ua8fe\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab69\uab70-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc",u="\u200c\u200d\xb7\u0300-\u036f\u0387\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u07fd\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08d3-\u08e1\u08e3-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u09fe\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0afa-\u0aff\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b55-\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c00-\u0c04\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c81-\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d00-\u0d03\u0d3b\u0d3c\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d81-\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0de6-\u0def\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19d0-\u19da\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1ab0-\u1abd\u1abf\u1ac0\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf4\u1cf7-\u1cf9\u1dc0-\u1df9\u1dfb-\u1dff\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69e\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua82c\ua880\ua881\ua8b4-\ua8c5\ua8d0-\ua8d9\ua8e0-\ua8f1\ua8ff-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\ua9e5\ua9f0-\ua9f9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b-\uaa7d\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe2f\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f",l=new RegExp("["+d+"]"),y=new RegExp("["+d+u+"]");d=u=null;var E=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],N=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function w(o,f){for(var D=65536,C=0;C<f.length;C+=2){if((D+=f[C])>o)return!1;if((D+=f[C+1])>=o)return!0}}function R(o,f){return o<65?36===o:o<91||(o<97?95===o:o<123||(o<=65535?o>=170&&l.test(String.fromCharCode(o)):!1!==f&&w(o,E)))}function M(o,f){return o<48?36===o:o<58||!(o<65)&&(o<91||(o<97?95===o:o<123||(o<=65535?o>=170&&y.test(String.fromCharCode(o)):!1!==f&&(w(o,E)||w(o,N)))))}var b=function(f,D){void 0===D&&(D={}),this.label=f,this.keyword=D.keyword,this.beforeExpr=!!D.beforeExpr,this.startsExpr=!!D.startsExpr,this.isLoop=!!D.isLoop,this.isAssign=!!D.isAssign,this.prefix=!!D.prefix,this.postfix=!!D.postfix,this.binop=D.binop||null,this.updateContext=null};function S(o,f){return new b(o,{beforeExpr:!0,binop:f})}var I={beforeExpr:!0},U={startsExpr:!0},W={};function v(o,f){return void 0===f&&(f={}),f.keyword=o,W[o]=new b(o,f)}var g={num:new b("num",U),regexp:new b("regexp",U),string:new b("string",U),name:new b("name",U),eof:new b("eof"),bracketL:new b("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new b("]"),braceL:new b("{",{beforeExpr:!0,startsExpr:!0}),braceR:new b("}"),parenL:new b("(",{beforeExpr:!0,startsExpr:!0}),parenR:new b(")"),comma:new b(",",I),semi:new b(";",I),colon:new b(":",I),dot:new b("."),question:new b("?",I),questionDot:new b("?."),arrow:new b("=>",I),template:new b("template"),invalidTemplate:new b("invalidTemplate"),ellipsis:new b("...",I),backQuote:new b("`",U),dollarBraceL:new b("${",{beforeExpr:!0,startsExpr:!0}),eq:new b("=",{beforeExpr:!0,isAssign:!0}),assign:new b("_=",{beforeExpr:!0,isAssign:!0}),incDec:new b("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new b("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:S("||",1),logicalAND:S("&&",2),bitwiseOR:S("|",3),bitwiseXOR:S("^",4),bitwiseAND:S("&",5),equality:S("==/!=/===/!==",6),relational:S("</>/<=/>=",7),bitShift:S("<</>>/>>>",8),plusMin:new b("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:S("%",10),star:S("*",10),slash:S("/",10),starstar:new b("**",{beforeExpr:!0}),coalesce:S("??",1),_break:v("break"),_case:v("case",I),_catch:v("catch"),_continue:v("continue"),_debugger:v("debugger"),_default:v("default",I),_do:v("do",{isLoop:!0,beforeExpr:!0}),_else:v("else",I),_finally:v("finally"),_for:v("for",{isLoop:!0}),_function:v("function",U),_if:v("if"),_return:v("return",I),_switch:v("switch"),_throw:v("throw",I),_try:v("try"),_var:v("var"),_const:v("const"),_while:v("while",{isLoop:!0}),_with:v("with"),_new:v("new",{beforeExpr:!0,startsExpr:!0}),_this:v("this",U),_super:v("super",U),_class:v("class",U),_extends:v("extends",I),_export:v("export"),_import:v("import",U),_null:v("null",U),_true:v("true",U),_false:v("false",U),_in:v("in",{beforeExpr:!0,binop:7}),_instanceof:v("instanceof",{beforeExpr:!0,binop:7}),_typeof:v("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:v("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:v("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},O=/\r\n?|\n|\u2028|\u2029/,$=new RegExp(O.source,"g");function ee(o,f){return 10===o||13===o||!f&&(8232===o||8233===o)}var G=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,j=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,ie=Object.prototype,X=ie.hasOwnProperty,ge=ie.toString;function fe(o,f){return X.call(o,f)}var re=Array.isArray||function(o){return"[object Array]"===ge.call(o)};function pe(o){return new RegExp("^(?:"+o.replace(/ /g,"|")+")$")}var _e=function(f,D){this.line=f,this.column=D};_e.prototype.offset=function(f){return new _e(this.line,this.column+f)};var ye=function(f,D,C){this.start=D,this.end=C,null!==f.sourceFile&&(this.source=f.sourceFile)};function le(o,f){for(var D=1,C=0;;){$.lastIndex=C;var V=$.exec(o);if(!(V&&V.index<f))return new _e(D,f-C);++D,C=V.index+V[0].length}}var he={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ue(o){var f={};for(var D in he)f[D]=o&&fe(o,D)?o[D]:he[D];if(f.ecmaVersion>=2015&&(f.ecmaVersion-=2009),null==f.allowReserved&&(f.allowReserved=f.ecmaVersion<5),re(f.onToken)){var C=f.onToken;f.onToken=function(V){return C.push(V)}}return re(f.onComment)&&(f.onComment=function ve(o,f){return function(D,C,V,H,Y,se){var ue={type:D?"Block":"Line",value:C,start:V,end:H};o.locations&&(ue.loc=new ye(this,Y,se)),o.ranges&&(ue.range=[V,H]),f.push(ue)}}(f,f.onComment)),f}function Tt(o,f){return 2|(o?4:0)|(f?8:0)}var Je=function(f,D,C){this.options=f=Ue(f),this.sourceFile=f.sourceFile,this.keywords=pe(x[f.ecmaVersion>=6?6:"module"===f.sourceType?"5module":5]);var V="";if(!0!==f.allowReserved){for(var H=f.ecmaVersion;!(V=L[H]);H--);"module"===f.sourceType&&(V+=" await")}this.reservedWords=pe(V);var Y=(V?V+" ":"")+L.strict;this.reservedWordsStrict=pe(Y),this.reservedWordsStrictBind=pe(Y+" "+L.strictBind),this.input=String(D),this.containsEsc=!1,C?(this.pos=C,this.lineStart=this.input.lastIndexOf("\n",C-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(O).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=g.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===f.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&f.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},On={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Je.prototype.parse=function(){var f=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(f)},On.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},On.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},On.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},On.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},On.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},On.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Je.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},Je.extend=function(){for(var f=[],D=arguments.length;D--;)f[D]=arguments[D];for(var C=this,V=0;V<f.length;V++)C=f[V](C);return C},Je.parse=function(f,D){return new this(D,f).parse()},Je.parseExpressionAt=function(f,D,C){var V=new this(C,f,D);return V.nextToken(),V.parseExpression()},Je.tokenizer=function(f,D){return new this(D,f)},Object.defineProperties(Je.prototype,On);var wt=Je.prototype,fa=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)")/;function Ci(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}wt.strictDirective=function(o){for(;;){j.lastIndex=o,o+=j.exec(this.input)[0].length;var f=fa.exec(this.input.slice(o));if(!f)return!1;if("use strict"===(f[1]||f[2])){j.lastIndex=o+f[0].length;var D=j.exec(this.input),C=D.index+D[0].length,V=this.input.charAt(C);return";"===V||"}"===V||O.test(D[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(V)||"!"===V&&"="===this.input.charAt(C+1))}j.lastIndex=o+=f[0].length,o+=j.exec(this.input)[0].length,";"===this.input[o]&&o++}},wt.eat=function(o){return this.type===o&&(this.next(),!0)},wt.isContextual=function(o){return this.type===g.name&&this.value===o&&!this.containsEsc},wt.eatContextual=function(o){return!!this.isContextual(o)&&(this.next(),!0)},wt.expectContextual=function(o){this.eatContextual(o)||this.unexpected()},wt.canInsertSemicolon=function(){return this.type===g.eof||this.type===g.braceR||O.test(this.input.slice(this.lastTokEnd,this.start))},wt.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},wt.semicolon=function(){!this.eat(g.semi)&&!this.insertSemicolon()&&this.unexpected()},wt.afterTrailingComma=function(o,f){if(this.type===o)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),f||this.next(),!0},wt.expect=function(o){this.eat(o)||this.unexpected()},wt.unexpected=function(o){this.raise(null!=o?o:this.start,"Unexpected token")},wt.checkPatternErrors=function(o,f){if(o){o.trailingComma>-1&&this.raiseRecoverable(o.trailingComma,"Comma is not permitted after the rest element");var D=f?o.parenthesizedAssign:o.parenthesizedBind;D>-1&&this.raiseRecoverable(D,"Parenthesized pattern")}},wt.checkExpressionErrors=function(o,f){if(!o)return!1;var D=o.shorthandAssign,C=o.doubleProto;if(!f)return D>=0||C>=0;D>=0&&this.raise(D,"Shorthand property assignments are valid only in destructuring patterns"),C>=0&&this.raiseRecoverable(C,"Redefinition of __proto__ property")},wt.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},wt.isSimpleAssignTarget=function(o){return"ParenthesizedExpression"===o.type?this.isSimpleAssignTarget(o.expression):"Identifier"===o.type||"MemberExpression"===o.type};var Ce=Je.prototype;Ce.parseTopLevel=function(o){var f={};for(o.body||(o.body=[]);this.type!==g.eof;){var D=this.parseStatement(null,!0,f);o.body.push(D)}if(this.inModule)for(var C=0,V=Object.keys(this.undefinedExports);C<V.length;C+=1){var H=V[C];this.raiseRecoverable(this.undefinedExports[H].start,"Export '"+H+"' is not defined")}return this.adaptDirectivePrologue(o.body),this.next(),o.sourceType=this.options.sourceType,this.finishNode(o,"Program")};var As={kind:"loop"},vc={kind:"switch"};Ce.isLet=function(o){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;j.lastIndex=this.pos;var f=j.exec(this.input),D=this.pos+f[0].length,C=this.input.charCodeAt(D);if(91===C)return!0;if(o)return!1;if(123===C)return!0;if(R(C,!0)){for(var V=D+1;M(this.input.charCodeAt(V),!0);)++V;var H=this.input.slice(D,V);if(!h.test(H))return!0}return!1},Ce.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;j.lastIndex=this.pos;var o=j.exec(this.input),f=this.pos+o[0].length;return!(O.test(this.input.slice(this.pos,f))||"function"!==this.input.slice(f,f+8)||f+8!==this.input.length&&M(this.input.charAt(f+8)))},Ce.parseStatement=function(o,f,D){var H,C=this.type,V=this.startNode();switch(this.isLet(o)&&(C=g._var,H="let"),C){case g._break:case g._continue:return this.parseBreakContinueStatement(V,C.keyword);case g._debugger:return this.parseDebuggerStatement(V);case g._do:return this.parseDoStatement(V);case g._for:return this.parseForStatement(V);case g._function:return o&&(this.strict||"if"!==o&&"label"!==o)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(V,!1,!o);case g._class:return o&&this.unexpected(),this.parseClass(V,!0);case g._if:return this.parseIfStatement(V);case g._return:return this.parseReturnStatement(V);case g._switch:return this.parseSwitchStatement(V);case g._throw:return this.parseThrowStatement(V);case g._try:return this.parseTryStatement(V);case g._const:case g._var:return H=H||this.value,o&&"var"!==H&&this.unexpected(),this.parseVarStatement(V,H);case g._while:return this.parseWhileStatement(V);case g._with:return this.parseWithStatement(V);case g.braceL:return this.parseBlock(!0,V);case g.semi:return this.parseEmptyStatement(V);case g._export:case g._import:if(this.options.ecmaVersion>10&&C===g._import){j.lastIndex=this.pos;var Y=j.exec(this.input),ue=this.input.charCodeAt(this.pos+Y[0].length);if(40===ue||46===ue)return this.parseExpressionStatement(V,this.parseExpression())}return this.options.allowImportExportEverywhere||(f||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),C===g._import?this.parseImport(V):this.parseExport(V,D);default:if(this.isAsyncFunction())return o&&this.unexpected(),this.next(),this.parseFunctionStatement(V,!0,!o);var xe=this.value,We=this.parseExpression();return C===g.name&&"Identifier"===We.type&&this.eat(g.colon)?this.parseLabeledStatement(V,xe,We,o):this.parseExpressionStatement(V,We)}},Ce.parseBreakContinueStatement=function(o,f){var D="break"===f;this.next(),this.eat(g.semi)||this.insertSemicolon()?o.label=null:this.type!==g.name?this.unexpected():(o.label=this.parseIdent(),this.semicolon());for(var C=0;C<this.labels.length;++C){var V=this.labels[C];if((null==o.label||V.name===o.label.name)&&(null!=V.kind&&(D||"loop"===V.kind)||o.label&&D))break}return C===this.labels.length&&this.raise(o.start,"Unsyntactic "+f),this.finishNode(o,D?"BreakStatement":"ContinueStatement")},Ce.parseDebuggerStatement=function(o){return this.next(),this.semicolon(),this.finishNode(o,"DebuggerStatement")},Ce.parseDoStatement=function(o){return this.next(),this.labels.push(As),o.body=this.parseStatement("do"),this.labels.pop(),this.expect(g._while),o.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(g.semi):this.semicolon(),this.finishNode(o,"DoWhileStatement")},Ce.parseForStatement=function(o){this.next();var f=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(As),this.enterScope(0),this.expect(g.parenL),this.type===g.semi)return f>-1&&this.unexpected(f),this.parseFor(o,null);var D=this.isLet();if(this.type===g._var||this.type===g._const||D){var C=this.startNode(),V=D?"let":this.value;return this.next(),this.parseVar(C,!0,V),this.finishNode(C,"VariableDeclaration"),(this.type===g._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===C.declarations.length?(this.options.ecmaVersion>=9&&(this.type===g._in?f>-1&&this.unexpected(f):o.await=f>-1),this.parseForIn(o,C)):(f>-1&&this.unexpected(f),this.parseFor(o,C))}var H=new Ci,Y=this.parseExpression(!0,H);return this.type===g._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===g._in?f>-1&&this.unexpected(f):o.await=f>-1),this.toAssignable(Y,!1,H),this.checkLVal(Y),this.parseForIn(o,Y)):(this.checkExpressionErrors(H,!0),f>-1&&this.unexpected(f),this.parseFor(o,Y))},Ce.parseFunctionStatement=function(o,f,D){return this.next(),this.parseFunction(o,Wn|(D?0:wr),!1,f)},Ce.parseIfStatement=function(o){return this.next(),o.test=this.parseParenExpression(),o.consequent=this.parseStatement("if"),o.alternate=this.eat(g._else)?this.parseStatement("if"):null,this.finishNode(o,"IfStatement")},Ce.parseReturnStatement=function(o){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(g.semi)||this.insertSemicolon()?o.argument=null:(o.argument=this.parseExpression(),this.semicolon()),this.finishNode(o,"ReturnStatement")},Ce.parseSwitchStatement=function(o){this.next(),o.discriminant=this.parseParenExpression(),o.cases=[],this.expect(g.braceL),this.labels.push(vc),this.enterScope(0);for(var f,D=!1;this.type!==g.braceR;)if(this.type===g._case||this.type===g._default){var C=this.type===g._case;f&&this.finishNode(f,"SwitchCase"),o.cases.push(f=this.startNode()),f.consequent=[],this.next(),C?f.test=this.parseExpression():(D&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),D=!0,f.test=null),this.expect(g.colon)}else f||this.unexpected(),f.consequent.push(this.parseStatement(null));return this.exitScope(),f&&this.finishNode(f,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(o,"SwitchStatement")},Ce.parseThrowStatement=function(o){return this.next(),O.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),o.argument=this.parseExpression(),this.semicolon(),this.finishNode(o,"ThrowStatement")};var Ms=[];Ce.parseTryStatement=function(o){if(this.next(),o.block=this.parseBlock(),o.handler=null,this.type===g._catch){var f=this.startNode();if(this.next(),this.eat(g.parenL)){f.param=this.parseBindingAtom();var D="Identifier"===f.param.type;this.enterScope(D?32:0),this.checkLVal(f.param,D?4:2),this.expect(g.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),f.param=null,this.enterScope(0);f.body=this.parseBlock(!1),this.exitScope(),o.handler=this.finishNode(f,"CatchClause")}return o.finalizer=this.eat(g._finally)?this.parseBlock():null,!o.handler&&!o.finalizer&&this.raise(o.start,"Missing catch or finally clause"),this.finishNode(o,"TryStatement")},Ce.parseVarStatement=function(o,f){return this.next(),this.parseVar(o,!1,f),this.semicolon(),this.finishNode(o,"VariableDeclaration")},Ce.parseWhileStatement=function(o){return this.next(),o.test=this.parseParenExpression(),this.labels.push(As),o.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(o,"WhileStatement")},Ce.parseWithStatement=function(o){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),o.object=this.parseParenExpression(),o.body=this.parseStatement("with"),this.finishNode(o,"WithStatement")},Ce.parseEmptyStatement=function(o){return this.next(),this.finishNode(o,"EmptyStatement")},Ce.parseLabeledStatement=function(o,f,D,C){for(var V=0,H=this.labels;V<H.length;V+=1)H[V].name===f&&this.raise(D.start,"Label '"+f+"' is already declared");for(var se=this.type.isLoop?"loop":this.type===g._switch?"switch":null,ue=this.labels.length-1;ue>=0;ue--){var xe=this.labels[ue];if(xe.statementStart!==o.start)break;xe.statementStart=this.start,xe.kind=se}return this.labels.push({name:f,kind:se,statementStart:this.start}),o.body=this.parseStatement(C?-1===C.indexOf("label")?C+"label":C:"label"),this.labels.pop(),o.label=D,this.finishNode(o,"LabeledStatement")},Ce.parseExpressionStatement=function(o,f){return o.expression=f,this.semicolon(),this.finishNode(o,"ExpressionStatement")},Ce.parseBlock=function(o,f,D){for(void 0===o&&(o=!0),void 0===f&&(f=this.startNode()),f.body=[],this.expect(g.braceL),o&&this.enterScope(0);this.type!==g.braceR;){var C=this.parseStatement(null);f.body.push(C)}return D&&(this.strict=!1),this.next(),o&&this.exitScope(),this.finishNode(f,"BlockStatement")},Ce.parseFor=function(o,f){return o.init=f,this.expect(g.semi),o.test=this.type===g.semi?null:this.parseExpression(),this.expect(g.semi),o.update=this.type===g.parenR?null:this.parseExpression(),this.expect(g.parenR),o.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(o,"ForStatement")},Ce.parseForIn=function(o,f){var D=this.type===g._in;return this.next(),"VariableDeclaration"===f.type&&null!=f.declarations[0].init&&(!D||this.options.ecmaVersion<8||this.strict||"var"!==f.kind||"Identifier"!==f.declarations[0].id.type)?this.raise(f.start,(D?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===f.type&&this.raise(f.start,"Invalid left-hand side in for-loop"),o.left=f,o.right=D?this.parseExpression():this.parseMaybeAssign(),this.expect(g.parenR),o.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(o,D?"ForInStatement":"ForOfStatement")},Ce.parseVar=function(o,f,D){for(o.declarations=[],o.kind=D;;){var C=this.startNode();if(this.parseVarId(C,D),this.eat(g.eq)?C.init=this.parseMaybeAssign(f):"const"!==D||this.type===g._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===C.id.type||f&&(this.type===g._in||this.isContextual("of"))?C.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),o.declarations.push(this.finishNode(C,"VariableDeclarator")),!this.eat(g.comma))break}return o},Ce.parseVarId=function(o,f){o.id=this.parseBindingAtom(),this.checkLVal(o.id,"var"===f?1:2,!1)};var Wn=1,wr=2;Ce.parseFunction=function(o,f,D,C){this.initFunction(o),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!C)&&(this.type===g.star&&f&wr&&this.unexpected(),o.generator=this.eat(g.star)),this.options.ecmaVersion>=8&&(o.async=!!C),f&Wn&&(o.id=4&f&&this.type!==g.name?null:this.parseIdent(),o.id&&!(f&wr)&&this.checkLVal(o.id,this.strict||o.generator||o.async?this.treatFunctionsAsVar?1:2:3));var V=this.yieldPos,H=this.awaitPos,Y=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Tt(o.async,o.generator)),f&Wn||(o.id=this.type===g.name?this.parseIdent():null),this.parseFunctionParams(o),this.parseFunctionBody(o,D,!1),this.yieldPos=V,this.awaitPos=H,this.awaitIdentPos=Y,this.finishNode(o,f&Wn?"FunctionDeclaration":"FunctionExpression")},Ce.parseFunctionParams=function(o){this.expect(g.parenL),o.params=this.parseBindingList(g.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Ce.parseClass=function(o,f){this.next();var D=this.strict;this.strict=!0,this.parseClassId(o,f),this.parseClassSuper(o);var C=this.startNode(),V=!1;for(C.body=[],this.expect(g.braceL);this.type!==g.braceR;){var H=this.parseClassElement(null!==o.superClass);H&&(C.body.push(H),"MethodDefinition"===H.type&&"constructor"===H.kind&&(V&&this.raise(H.start,"Duplicate constructor in the same class"),V=!0))}return this.strict=D,this.next(),o.body=this.finishNode(C,"ClassBody"),this.finishNode(o,f?"ClassDeclaration":"ClassExpression")},Ce.parseClassElement=function(o){var f=this;if(this.eat(g.semi))return null;var D=this.startNode(),C=function(ue,xe){void 0===xe&&(xe=!1);var We=f.start,_t=f.startLoc;return!(!f.eatContextual(ue)||(f.type===g.parenL||xe&&f.canInsertSemicolon())&&(D.key&&f.unexpected(),D.computed=!1,D.key=f.startNodeAt(We,_t),D.key.name=ue,f.finishNode(D.key,"Identifier"),1))};D.kind="method",D.static=C("static");var V=this.eat(g.star),H=!1;V||(this.options.ecmaVersion>=8&&C("async",!0)?(H=!0,V=this.options.ecmaVersion>=9&&this.eat(g.star)):C("get")?D.kind="get":C("set")&&(D.kind="set")),D.key||this.parsePropertyName(D);var Y=D.key,se=!1;return D.computed||D.static||!("Identifier"===Y.type&&"constructor"===Y.name||"Literal"===Y.type&&"constructor"===Y.value)?D.static&&"Identifier"===Y.type&&"prototype"===Y.name&&this.raise(Y.start,"Classes may not have a static property named prototype"):("method"!==D.kind&&this.raise(Y.start,"Constructor can't have get/set modifier"),V&&this.raise(Y.start,"Constructor can't be a generator"),H&&this.raise(Y.start,"Constructor can't be an async method"),D.kind="constructor",se=o),this.parseClassMethod(D,V,H,se),"get"===D.kind&&0!==D.value.params.length&&this.raiseRecoverable(D.value.start,"getter should have no params"),"set"===D.kind&&1!==D.value.params.length&&this.raiseRecoverable(D.value.start,"setter should have exactly one param"),"set"===D.kind&&"RestElement"===D.value.params[0].type&&this.raiseRecoverable(D.value.params[0].start,"Setter cannot use rest params"),D},Ce.parseClassMethod=function(o,f,D,C){return o.value=this.parseMethod(f,D,C),this.finishNode(o,"MethodDefinition")},Ce.parseClassId=function(o,f){this.type===g.name?(o.id=this.parseIdent(),f&&this.checkLVal(o.id,2,!1)):(!0===f&&this.unexpected(),o.id=null)},Ce.parseClassSuper=function(o){o.superClass=this.eat(g._extends)?this.parseExprSubscripts():null},Ce.parseExport=function(o,f){if(this.next(),this.eat(g.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(o.exported=this.parseIdent(!0),this.checkExport(f,o.exported.name,this.lastTokStart)):o.exported=null),this.expectContextual("from"),this.type!==g.string&&this.unexpected(),o.source=this.parseExprAtom(),this.semicolon(),this.finishNode(o,"ExportAllDeclaration");if(this.eat(g._default)){var D;if(this.checkExport(f,"default",this.lastTokStart),this.type===g._function||(D=this.isAsyncFunction())){var C=this.startNode();this.next(),D&&this.next(),o.declaration=this.parseFunction(C,4|Wn,!1,D)}else if(this.type===g._class){var V=this.startNode();o.declaration=this.parseClass(V,"nullableID")}else o.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(o,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())o.declaration=this.parseStatement(null),"VariableDeclaration"===o.declaration.type?this.checkVariableExport(f,o.declaration.declarations):this.checkExport(f,o.declaration.id.name,o.declaration.id.start),o.specifiers=[],o.source=null;else{if(o.declaration=null,o.specifiers=this.parseExportSpecifiers(f),this.eatContextual("from"))this.type!==g.string&&this.unexpected(),o.source=this.parseExprAtom();else{for(var H=0,Y=o.specifiers;H<Y.length;H+=1){var se=Y[H];this.checkUnreserved(se.local),this.checkLocalExport(se.local)}o.source=null}this.semicolon()}return this.finishNode(o,"ExportNamedDeclaration")},Ce.checkExport=function(o,f,D){!o||(fe(o,f)&&this.raiseRecoverable(D,"Duplicate export '"+f+"'"),o[f]=!0)},Ce.checkPatternExport=function(o,f){var D=f.type;if("Identifier"===D)this.checkExport(o,f.name,f.start);else if("ObjectPattern"===D)for(var C=0,V=f.properties;C<V.length;C+=1)this.checkPatternExport(o,V[C]);else if("ArrayPattern"===D)for(var Y=0,se=f.elements;Y<se.length;Y+=1){var ue=se[Y];ue&&this.checkPatternExport(o,ue)}else"Property"===D?this.checkPatternExport(o,f.value):"AssignmentPattern"===D?this.checkPatternExport(o,f.left):"RestElement"===D?this.checkPatternExport(o,f.argument):"ParenthesizedExpression"===D&&this.checkPatternExport(o,f.expression)},Ce.checkVariableExport=function(o,f){if(o)for(var D=0,C=f;D<C.length;D+=1)this.checkPatternExport(o,C[D].id)},Ce.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},Ce.parseExportSpecifiers=function(o){var f=[],D=!0;for(this.expect(g.braceL);!this.eat(g.braceR);){if(D)D=!1;else if(this.expect(g.comma),this.afterTrailingComma(g.braceR))break;var C=this.startNode();C.local=this.parseIdent(!0),C.exported=this.eatContextual("as")?this.parseIdent(!0):C.local,this.checkExport(o,C.exported.name,C.exported.start),f.push(this.finishNode(C,"ExportSpecifier"))}return f},Ce.parseImport=function(o){return this.next(),this.type===g.string?(o.specifiers=Ms,o.source=this.parseExprAtom()):(o.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),o.source=this.type===g.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(o,"ImportDeclaration")},Ce.parseImportSpecifiers=function(){var o=[],f=!0;if(this.type===g.name){var D=this.startNode();if(D.local=this.parseIdent(),this.checkLVal(D.local,2),o.push(this.finishNode(D,"ImportDefaultSpecifier")),!this.eat(g.comma))return o}if(this.type===g.star){var C=this.startNode();return this.next(),this.expectContextual("as"),C.local=this.parseIdent(),this.checkLVal(C.local,2),o.push(this.finishNode(C,"ImportNamespaceSpecifier")),o}for(this.expect(g.braceL);!this.eat(g.braceR);){if(f)f=!1;else if(this.expect(g.comma),this.afterTrailingComma(g.braceR))break;var V=this.startNode();V.imported=this.parseIdent(!0),this.eatContextual("as")?V.local=this.parseIdent():(this.checkUnreserved(V.imported),V.local=V.imported),this.checkLVal(V.local,2),o.push(this.finishNode(V,"ImportSpecifier"))}return o},Ce.adaptDirectivePrologue=function(o){for(var f=0;f<o.length&&this.isDirectiveCandidate(o[f]);++f)o[f].directive=o[f].expression.raw.slice(1,-1)},Ce.isDirectiveCandidate=function(o){return"ExpressionStatement"===o.type&&"Literal"===o.expression.type&&"string"==typeof o.expression.value&&('"'===this.input[o.start]||"'"===this.input[o.start])};var Xt=Je.prototype;Xt.toAssignable=function(o,f,D){if(this.options.ecmaVersion>=6&&o)switch(o.type){case"Identifier":this.inAsync&&"await"===o.name&&this.raise(o.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":o.type="ObjectPattern",D&&this.checkPatternErrors(D,!0);for(var C=0,V=o.properties;C<V.length;C+=1){var H=V[C];this.toAssignable(H,f),"RestElement"===H.type&&("ArrayPattern"===H.argument.type||"ObjectPattern"===H.argument.type)&&this.raise(H.argument.start,"Unexpected token")}break;case"Property":"init"!==o.kind&&this.raise(o.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(o.value,f);break;case"ArrayExpression":o.type="ArrayPattern",D&&this.checkPatternErrors(D,!0),this.toAssignableList(o.elements,f);break;case"SpreadElement":o.type="RestElement",this.toAssignable(o.argument,f),"AssignmentPattern"===o.argument.type&&this.raise(o.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==o.operator&&this.raise(o.left.end,"Only '=' operator can be used for specifying default value."),o.type="AssignmentPattern",delete o.operator,this.toAssignable(o.left,f);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(o.expression,f,D);break;case"ChainExpression":this.raiseRecoverable(o.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!f)break;default:this.raise(o.start,"Assigning to rvalue")}else D&&this.checkPatternErrors(D,!0);return o},Xt.toAssignableList=function(o,f){for(var D=o.length,C=0;C<D;C++){var V=o[C];V&&this.toAssignable(V,f)}if(D){var H=o[D-1];6===this.options.ecmaVersion&&f&&H&&"RestElement"===H.type&&"Identifier"!==H.argument.type&&this.unexpected(H.argument.start)}return o},Xt.parseSpread=function(o){var f=this.startNode();return this.next(),f.argument=this.parseMaybeAssign(!1,o),this.finishNode(f,"SpreadElement")},Xt.parseRestBinding=function(){var o=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==g.name&&this.unexpected(),o.argument=this.parseBindingAtom(),this.finishNode(o,"RestElement")},Xt.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case g.bracketL:var o=this.startNode();return this.next(),o.elements=this.parseBindingList(g.bracketR,!0,!0),this.finishNode(o,"ArrayPattern");case g.braceL:return this.parseObj(!0)}return this.parseIdent()},Xt.parseBindingList=function(o,f,D){for(var C=[],V=!0;!this.eat(o);)if(V?V=!1:this.expect(g.comma),f&&this.type===g.comma)C.push(null);else{if(D&&this.afterTrailingComma(o))break;if(this.type===g.ellipsis){var H=this.parseRestBinding();this.parseBindingListItem(H),C.push(H),this.type===g.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(o);break}var Y=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Y),C.push(Y)}return C},Xt.parseBindingListItem=function(o){return o},Xt.parseMaybeDefault=function(o,f,D){if(D=D||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(g.eq))return D;var C=this.startNodeAt(o,f);return C.left=D,C.right=this.parseMaybeAssign(),this.finishNode(C,"AssignmentPattern")},Xt.checkLVal=function(o,f,D){switch(void 0===f&&(f=0),o.type){case"Identifier":2===f&&"let"===o.name&&this.raiseRecoverable(o.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(o.name)&&this.raiseRecoverable(o.start,(f?"Binding ":"Assigning to ")+o.name+" in strict mode"),D&&(fe(D,o.name)&&this.raiseRecoverable(o.start,"Argument name clash"),D[o.name]=!0),0!==f&&5!==f&&this.declareName(o.name,f,o.start);break;case"ChainExpression":this.raiseRecoverable(o.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":f&&this.raiseRecoverable(o.start,"Binding member expression");break;case"ObjectPattern":for(var C=0,V=o.properties;C<V.length;C+=1)this.checkLVal(V[C],f,D);break;case"Property":this.checkLVal(o.value,f,D);break;case"ArrayPattern":for(var Y=0,se=o.elements;Y<se.length;Y+=1){var ue=se[Y];ue&&this.checkLVal(ue,f,D)}break;case"AssignmentPattern":this.checkLVal(o.left,f,D);break;case"RestElement":this.checkLVal(o.argument,f,D);break;case"ParenthesizedExpression":this.checkLVal(o.expression,f,D);break;default:this.raise(o.start,(f?"Binding":"Assigning to")+" rvalue")}};var Ae=Je.prototype;Ae.checkPropClash=function(o,f,D){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===o.type||this.options.ecmaVersion>=6&&(o.computed||o.method||o.shorthand))){var V,C=o.key;switch(C.type){case"Identifier":V=C.name;break;case"Literal":V=String(C.value);break;default:return}var H=o.kind;if(this.options.ecmaVersion>=6)return void("__proto__"===V&&"init"===H&&(f.proto&&(D?D.doubleProto<0&&(D.doubleProto=C.start):this.raiseRecoverable(C.start,"Redefinition of __proto__ property")),f.proto=!0));var Y=f[V="$"+V];Y?("init"===H?this.strict&&Y.init||Y.get||Y.set:Y.init||Y[H])&&this.raiseRecoverable(C.start,"Redefinition of property"):Y=f[V]={init:!1,get:!1,set:!1},Y[H]=!0}},Ae.parseExpression=function(o,f){var D=this.start,C=this.startLoc,V=this.parseMaybeAssign(o,f);if(this.type===g.comma){var H=this.startNodeAt(D,C);for(H.expressions=[V];this.eat(g.comma);)H.expressions.push(this.parseMaybeAssign(o,f));return this.finishNode(H,"SequenceExpression")}return V},Ae.parseMaybeAssign=function(o,f,D){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(o);this.exprAllowed=!1}var C=!1,V=-1,H=-1;f?(V=f.parenthesizedAssign,H=f.trailingComma,f.parenthesizedAssign=f.trailingComma=-1):(f=new Ci,C=!0);var Y=this.start,se=this.startLoc;(this.type===g.parenL||this.type===g.name)&&(this.potentialArrowAt=this.start);var ue=this.parseMaybeConditional(o,f);if(D&&(ue=D.call(this,ue,Y,se)),this.type.isAssign){var xe=this.startNodeAt(Y,se);return xe.operator=this.value,xe.left=this.type===g.eq?this.toAssignable(ue,!1,f):ue,C||(f.parenthesizedAssign=f.trailingComma=f.doubleProto=-1),f.shorthandAssign>=xe.left.start&&(f.shorthandAssign=-1),this.checkLVal(ue),this.next(),xe.right=this.parseMaybeAssign(o),this.finishNode(xe,"AssignmentExpression")}return C&&this.checkExpressionErrors(f,!0),V>-1&&(f.parenthesizedAssign=V),H>-1&&(f.trailingComma=H),ue},Ae.parseMaybeConditional=function(o,f){var D=this.start,C=this.startLoc,V=this.parseExprOps(o,f);if(this.checkExpressionErrors(f))return V;if(this.eat(g.question)){var H=this.startNodeAt(D,C);return H.test=V,H.consequent=this.parseMaybeAssign(),this.expect(g.colon),H.alternate=this.parseMaybeAssign(o),this.finishNode(H,"ConditionalExpression")}return V},Ae.parseExprOps=function(o,f){var D=this.start,C=this.startLoc,V=this.parseMaybeUnary(f,!1);return this.checkExpressionErrors(f)||V.start===D&&"ArrowFunctionExpression"===V.type?V:this.parseExprOp(V,D,C,-1,o)},Ae.parseExprOp=function(o,f,D,C,V){var H=this.type.binop;if(null!=H&&(!V||this.type!==g._in)&&H>C){var Y=this.type===g.logicalOR||this.type===g.logicalAND,se=this.type===g.coalesce;se&&(H=g.logicalAND.binop);var ue=this.value;this.next();var xe=this.start,We=this.startLoc,_t=this.parseExprOp(this.parseMaybeUnary(null,!1),xe,We,H,V),Xn=this.buildBinary(f,D,o,_t,ue,Y||se);return(Y&&this.type===g.coalesce||se&&(this.type===g.logicalOR||this.type===g.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Xn,f,D,C,V)}return o},Ae.buildBinary=function(o,f,D,C,V,H){var Y=this.startNodeAt(o,f);return Y.left=D,Y.operator=V,Y.right=C,this.finishNode(Y,H?"LogicalExpression":"BinaryExpression")},Ae.parseMaybeUnary=function(o,f){var V,D=this.start,C=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))V=this.parseAwait(),f=!0;else if(this.type.prefix){var H=this.startNode(),Y=this.type===g.incDec;H.operator=this.value,H.prefix=!0,this.next(),H.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(o,!0),Y?this.checkLVal(H.argument):this.strict&&"delete"===H.operator&&"Identifier"===H.argument.type?this.raiseRecoverable(H.start,"Deleting local variable in strict mode"):f=!0,V=this.finishNode(H,Y?"UpdateExpression":"UnaryExpression")}else{if(V=this.parseExprSubscripts(o),this.checkExpressionErrors(o))return V;for(;this.type.postfix&&!this.canInsertSemicolon();){var se=this.startNodeAt(D,C);se.operator=this.value,se.prefix=!1,se.argument=V,this.checkLVal(V),this.next(),V=this.finishNode(se,"UpdateExpression")}}return!f&&this.eat(g.starstar)?this.buildBinary(D,C,V,this.parseMaybeUnary(null,!1),"**",!1):V},Ae.parseExprSubscripts=function(o){var f=this.start,D=this.startLoc,C=this.parseExprAtom(o);if("ArrowFunctionExpression"===C.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return C;var V=this.parseSubscripts(C,f,D);return o&&"MemberExpression"===V.type&&(o.parenthesizedAssign>=V.start&&(o.parenthesizedAssign=-1),o.parenthesizedBind>=V.start&&(o.parenthesizedBind=-1)),V},Ae.parseSubscripts=function(o,f,D,C){for(var V=this.options.ecmaVersion>=8&&"Identifier"===o.type&&"async"===o.name&&this.lastTokEnd===o.end&&!this.canInsertSemicolon()&&o.end-o.start==5&&this.potentialArrowAt===o.start,H=!1;;){var Y=this.parseSubscript(o,f,D,C,V,H);if(Y.optional&&(H=!0),Y===o||"ArrowFunctionExpression"===Y.type){if(H){var se=this.startNodeAt(f,D);se.expression=Y,Y=this.finishNode(se,"ChainExpression")}return Y}o=Y}},Ae.parseSubscript=function(o,f,D,C,V,H){var Y=this.options.ecmaVersion>=11,se=Y&&this.eat(g.questionDot);C&&se&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var ue=this.eat(g.bracketL);if(ue||se&&this.type!==g.parenL&&this.type!==g.backQuote||this.eat(g.dot)){var xe=this.startNodeAt(f,D);xe.object=o,xe.property=ue?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),xe.computed=!!ue,ue&&this.expect(g.bracketR),Y&&(xe.optional=se),o=this.finishNode(xe,"MemberExpression")}else if(!C&&this.eat(g.parenL)){var We=new Ci,_t=this.yieldPos,Xn=this.awaitPos,Et=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Ni=this.parseExprList(g.parenR,this.options.ecmaVersion>=8,!1,We);if(V&&!se&&!this.canInsertSemicolon()&&this.eat(g.arrow))return this.checkPatternErrors(We,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=_t,this.awaitPos=Xn,this.awaitIdentPos=Et,this.parseArrowExpression(this.startNodeAt(f,D),Ni,!0);this.checkExpressionErrors(We,!0),this.yieldPos=_t||this.yieldPos,this.awaitPos=Xn||this.awaitPos,this.awaitIdentPos=Et||this.awaitIdentPos;var fr=this.startNodeAt(f,D);fr.callee=o,fr.arguments=Ni,Y&&(fr.optional=se),o=this.finishNode(fr,"CallExpression")}else if(this.type===g.backQuote){(se||H)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var dr=this.startNodeAt(f,D);dr.tag=o,dr.quasi=this.parseTemplate({isTagged:!0}),o=this.finishNode(dr,"TaggedTemplateExpression")}return o},Ae.parseExprAtom=function(o){this.type===g.slash&&this.readRegexp();var f,D=this.potentialArrowAt===this.start;switch(this.type){case g._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),f=this.startNode(),this.next(),this.type===g.parenL&&!this.allowDirectSuper&&this.raise(f.start,"super() call outside constructor of a subclass"),this.type!==g.dot&&this.type!==g.bracketL&&this.type!==g.parenL&&this.unexpected(),this.finishNode(f,"Super");case g._this:return f=this.startNode(),this.next(),this.finishNode(f,"ThisExpression");case g.name:var C=this.start,V=this.startLoc,H=this.containsEsc,Y=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!H&&"async"===Y.name&&!this.canInsertSemicolon()&&this.eat(g._function))return this.parseFunction(this.startNodeAt(C,V),0,!1,!0);if(D&&!this.canInsertSemicolon()){if(this.eat(g.arrow))return this.parseArrowExpression(this.startNodeAt(C,V),[Y],!1);if(this.options.ecmaVersion>=8&&"async"===Y.name&&this.type===g.name&&!H)return Y=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(g.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(C,V),[Y],!0)}return Y;case g.regexp:var se=this.value;return(f=this.parseLiteral(se.value)).regex={pattern:se.pattern,flags:se.flags},f;case g.num:case g.string:return this.parseLiteral(this.value);case g._null:case g._true:case g._false:return(f=this.startNode()).value=this.type===g._null?null:this.type===g._true,f.raw=this.type.keyword,this.next(),this.finishNode(f,"Literal");case g.parenL:var ue=this.start,xe=this.parseParenAndDistinguishExpression(D);return o&&(o.parenthesizedAssign<0&&!this.isSimpleAssignTarget(xe)&&(o.parenthesizedAssign=ue),o.parenthesizedBind<0&&(o.parenthesizedBind=ue)),xe;case g.bracketL:return f=this.startNode(),this.next(),f.elements=this.parseExprList(g.bracketR,!0,!0,o),this.finishNode(f,"ArrayExpression");case g.braceL:return this.parseObj(!1,o);case g._function:return f=this.startNode(),this.next(),this.parseFunction(f,0);case g._class:return this.parseClass(this.startNode(),!1);case g._new:return this.parseNew();case g.backQuote:return this.parseTemplate();case g._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Ae.parseExprImport=function(){var o=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var f=this.parseIdent(!0);switch(this.type){case g.parenL:return this.parseDynamicImport(o);case g.dot:return o.meta=f,this.parseImportMeta(o);default:this.unexpected()}},Ae.parseDynamicImport=function(o){if(this.next(),o.source=this.parseMaybeAssign(),!this.eat(g.parenR)){var f=this.start;this.eat(g.comma)&&this.eat(g.parenR)?this.raiseRecoverable(f,"Trailing comma is not allowed in import()"):this.unexpected(f)}return this.finishNode(o,"ImportExpression")},Ae.parseImportMeta=function(o){this.next();var f=this.containsEsc;return o.property=this.parseIdent(!0),"meta"!==o.property.name&&this.raiseRecoverable(o.property.start,"The only valid meta property for import is 'import.meta'"),f&&this.raiseRecoverable(o.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(o.start,"Cannot use 'import.meta' outside a module"),this.finishNode(o,"MetaProperty")},Ae.parseLiteral=function(o){var f=this.startNode();return f.value=o,f.raw=this.input.slice(this.start,this.end),110===f.raw.charCodeAt(f.raw.length-1)&&(f.bigint=f.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(f,"Literal")},Ae.parseParenExpression=function(){this.expect(g.parenL);var o=this.parseExpression();return this.expect(g.parenR),o},Ae.parseParenAndDistinguishExpression=function(o){var C,f=this.start,D=this.startLoc,V=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Et,H=this.start,Y=this.startLoc,se=[],ue=!0,xe=!1,We=new Ci,_t=this.yieldPos,Xn=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==g.parenR;){if(ue?ue=!1:this.expect(g.comma),V&&this.afterTrailingComma(g.parenR,!0)){xe=!0;break}if(this.type===g.ellipsis){Et=this.start,se.push(this.parseParenItem(this.parseRestBinding())),this.type===g.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}se.push(this.parseMaybeAssign(!1,We,this.parseParenItem))}var Ni=this.start,fr=this.startLoc;if(this.expect(g.parenR),o&&!this.canInsertSemicolon()&&this.eat(g.arrow))return this.checkPatternErrors(We,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=_t,this.awaitPos=Xn,this.parseParenArrowList(f,D,se);(!se.length||xe)&&this.unexpected(this.lastTokStart),Et&&this.unexpected(Et),this.checkExpressionErrors(We,!0),this.yieldPos=_t||this.yieldPos,this.awaitPos=Xn||this.awaitPos,se.length>1?((C=this.startNodeAt(H,Y)).expressions=se,this.finishNodeAt(C,"SequenceExpression",Ni,fr)):C=se[0]}else C=this.parseParenExpression();if(this.options.preserveParens){var dr=this.startNodeAt(f,D);return dr.expression=C,this.finishNode(dr,"ParenthesizedExpression")}return C},Ae.parseParenItem=function(o){return o},Ae.parseParenArrowList=function(o,f,D){return this.parseArrowExpression(this.startNodeAt(o,f),D)};var Fs=[];Ae.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var o=this.startNode(),f=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(g.dot)){o.meta=f;var D=this.containsEsc;return o.property=this.parseIdent(!0),"target"!==o.property.name&&this.raiseRecoverable(o.property.start,"The only valid meta property for new is 'new.target'"),D&&this.raiseRecoverable(o.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(o.start,"'new.target' can only be used in functions"),this.finishNode(o,"MetaProperty")}var C=this.start,V=this.startLoc,H=this.type===g._import;return o.callee=this.parseSubscripts(this.parseExprAtom(),C,V,!0),H&&"ImportExpression"===o.callee.type&&this.raise(C,"Cannot use new with import()"),o.arguments=this.eat(g.parenL)?this.parseExprList(g.parenR,this.options.ecmaVersion>=8,!1):Fs,this.finishNode(o,"NewExpression")},Ae.parseTemplateElement=function(o){var f=o.isTagged,D=this.startNode();return this.type===g.invalidTemplate?(f||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),D.value={raw:this.value,cooked:null}):D.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),D.tail=this.type===g.backQuote,this.finishNode(D,"TemplateElement")},Ae.parseTemplate=function(o){void 0===o&&(o={});var f=o.isTagged;void 0===f&&(f=!1);var D=this.startNode();this.next(),D.expressions=[];var C=this.parseTemplateElement({isTagged:f});for(D.quasis=[C];!C.tail;)this.type===g.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(g.dollarBraceL),D.expressions.push(this.parseExpression()),this.expect(g.braceR),D.quasis.push(C=this.parseTemplateElement({isTagged:f}));return this.next(),this.finishNode(D,"TemplateLiteral")},Ae.isAsyncProp=function(o){return!o.computed&&"Identifier"===o.key.type&&"async"===o.key.name&&(this.type===g.name||this.type===g.num||this.type===g.string||this.type===g.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===g.star)&&!O.test(this.input.slice(this.lastTokEnd,this.start))},Ae.parseObj=function(o,f){var D=this.startNode(),C=!0,V={};for(D.properties=[],this.next();!this.eat(g.braceR);){if(C)C=!1;else if(this.expect(g.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(g.braceR))break;var H=this.parseProperty(o,f);o||this.checkPropClash(H,V,f),D.properties.push(H)}return this.finishNode(D,o?"ObjectPattern":"ObjectExpression")},Ae.parseProperty=function(o,f){var C,V,H,Y,D=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(g.ellipsis))return o?(D.argument=this.parseIdent(!1),this.type===g.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(D,"RestElement")):(this.type===g.parenL&&f&&(f.parenthesizedAssign<0&&(f.parenthesizedAssign=this.start),f.parenthesizedBind<0&&(f.parenthesizedBind=this.start)),D.argument=this.parseMaybeAssign(!1,f),this.type===g.comma&&f&&f.trailingComma<0&&(f.trailingComma=this.start),this.finishNode(D,"SpreadElement"));this.options.ecmaVersion>=6&&(D.method=!1,D.shorthand=!1,(o||f)&&(H=this.start,Y=this.startLoc),o||(C=this.eat(g.star)));var se=this.containsEsc;return this.parsePropertyName(D),!o&&!se&&this.options.ecmaVersion>=8&&!C&&this.isAsyncProp(D)?(V=!0,C=this.options.ecmaVersion>=9&&this.eat(g.star),this.parsePropertyName(D,f)):V=!1,this.parsePropertyValue(D,o,C,V,H,Y,f,se),this.finishNode(D,"Property")},Ae.parsePropertyValue=function(o,f,D,C,V,H,Y,se){if((D||C)&&this.type===g.colon&&this.unexpected(),this.eat(g.colon))o.value=f?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Y),o.kind="init";else if(this.options.ecmaVersion>=6&&this.type===g.parenL)f&&this.unexpected(),o.kind="init",o.method=!0,o.value=this.parseMethod(D,C);else if(f||se||!(this.options.ecmaVersion>=5)||o.computed||"Identifier"!==o.key.type||"get"!==o.key.name&&"set"!==o.key.name||this.type===g.comma||this.type===g.braceR||this.type===g.eq)this.options.ecmaVersion>=6&&!o.computed&&"Identifier"===o.key.type?((D||C)&&this.unexpected(),this.checkUnreserved(o.key),"await"===o.key.name&&!this.awaitIdentPos&&(this.awaitIdentPos=V),o.kind="init",f?o.value=this.parseMaybeDefault(V,H,o.key):this.type===g.eq&&Y?(Y.shorthandAssign<0&&(Y.shorthandAssign=this.start),o.value=this.parseMaybeDefault(V,H,o.key)):o.value=o.key,o.shorthand=!0):this.unexpected();else if((D||C)&&this.unexpected(),o.kind=o.key.name,this.parsePropertyName(o),o.value=this.parseMethod(!1),o.value.params.length!==("get"===o.kind?0:1)){this.raiseRecoverable(o.value.start,"get"===o.kind?"getter should have no params":"setter should have exactly one param")}else"set"===o.kind&&"RestElement"===o.value.params[0].type&&this.raiseRecoverable(o.value.params[0].start,"Setter cannot use rest params")},Ae.parsePropertyName=function(o){if(this.options.ecmaVersion>=6){if(this.eat(g.bracketL))return o.computed=!0,o.key=this.parseMaybeAssign(),this.expect(g.bracketR),o.key;o.computed=!1}return o.key=this.type===g.num||this.type===g.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},Ae.initFunction=function(o){o.id=null,this.options.ecmaVersion>=6&&(o.generator=o.expression=!1),this.options.ecmaVersion>=8&&(o.async=!1)},Ae.parseMethod=function(o,f,D){var C=this.startNode(),V=this.yieldPos,H=this.awaitPos,Y=this.awaitIdentPos;return this.initFunction(C),this.options.ecmaVersion>=6&&(C.generator=o),this.options.ecmaVersion>=8&&(C.async=!!f),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|Tt(f,C.generator)|(D?128:0)),this.expect(g.parenL),C.params=this.parseBindingList(g.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(C,!1,!0),this.yieldPos=V,this.awaitPos=H,this.awaitIdentPos=Y,this.finishNode(C,"FunctionExpression")},Ae.parseArrowExpression=function(o,f,D){var C=this.yieldPos,V=this.awaitPos,H=this.awaitIdentPos;return this.enterScope(16|Tt(D,!1)),this.initFunction(o),this.options.ecmaVersion>=8&&(o.async=!!D),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,o.params=this.toAssignableList(f,!0),this.parseFunctionBody(o,!0,!1),this.yieldPos=C,this.awaitPos=V,this.awaitIdentPos=H,this.finishNode(o,"ArrowFunctionExpression")},Ae.parseFunctionBody=function(o,f,D){var V=this.strict,H=!1;if(f&&this.type!==g.braceL)o.body=this.parseMaybeAssign(),o.expression=!0,this.checkParams(o,!1);else{var Y=this.options.ecmaVersion>=7&&!this.isSimpleParamList(o.params);(!V||Y)&&(H=this.strictDirective(this.end))&&Y&&this.raiseRecoverable(o.start,"Illegal 'use strict' directive in function with non-simple parameter list");var se=this.labels;this.labels=[],H&&(this.strict=!0),this.checkParams(o,!V&&!H&&!f&&!D&&this.isSimpleParamList(o.params)),this.strict&&o.id&&this.checkLVal(o.id,5),o.body=this.parseBlock(!1,void 0,H&&!V),o.expression=!1,this.adaptDirectivePrologue(o.body.body),this.labels=se}this.exitScope()},Ae.isSimpleParamList=function(o){for(var f=0,D=o;f<D.length;f+=1)if("Identifier"!==D[f].type)return!1;return!0},Ae.checkParams=function(o,f){for(var D={},C=0,V=o.params;C<V.length;C+=1)this.checkLVal(V[C],1,f?null:D)},Ae.parseExprList=function(o,f,D,C){for(var V=[],H=!0;!this.eat(o);){if(H)H=!1;else if(this.expect(g.comma),f&&this.afterTrailingComma(o))break;var Y=void 0;D&&this.type===g.comma?Y=null:this.type===g.ellipsis?(Y=this.parseSpread(C),C&&this.type===g.comma&&C.trailingComma<0&&(C.trailingComma=this.start)):Y=this.parseMaybeAssign(!1,C),V.push(Y)}return V},Ae.checkUnreserved=function(o){var f=o.start,D=o.end,C=o.name;this.inGenerator&&"yield"===C&&this.raiseRecoverable(f,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===C&&this.raiseRecoverable(f,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(C)&&this.raise(f,"Unexpected keyword '"+C+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(f,D).indexOf("\\")||(this.strict?this.reservedWordsStrict:this.reservedWords).test(C)&&(!this.inAsync&&"await"===C&&this.raiseRecoverable(f,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(f,"The keyword '"+C+"' is reserved"))},Ae.parseIdent=function(o,f){var D=this.startNode();return this.type===g.name?D.name=this.value:this.type.keyword?(D.name=this.type.keyword,("class"===D.name||"function"===D.name)&&(this.lastTokEnd!==this.lastTokStart+1||46!==this.input.charCodeAt(this.lastTokStart))&&this.context.pop()):this.unexpected(),this.next(!!o),this.finishNode(D,"Identifier"),o||(this.checkUnreserved(D),"await"===D.name&&!this.awaitIdentPos&&(this.awaitIdentPos=D.start)),D},Ae.parseYield=function(o){this.yieldPos||(this.yieldPos=this.start);var f=this.startNode();return this.next(),this.type===g.semi||this.canInsertSemicolon()||this.type!==g.star&&!this.type.startsExpr?(f.delegate=!1,f.argument=null):(f.delegate=this.eat(g.star),f.argument=this.parseMaybeAssign(o)),this.finishNode(f,"YieldExpression")},Ae.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var o=this.startNode();return this.next(),o.argument=this.parseMaybeUnary(null,!1),this.finishNode(o,"AwaitExpression")};var lr=Je.prototype;lr.raise=function(o,f){var D=le(this.input,o),C=new SyntaxError(f+=" ("+D.line+":"+D.column+")");throw C.pos=o,C.loc=D,C.raisedAt=this.pos,C},lr.raiseRecoverable=lr.raise,lr.curPosition=function(){if(this.options.locations)return new _e(this.curLine,this.pos-this.lineStart)};var an=Je.prototype,Rs=function(f){this.flags=f,this.var=[],this.lexical=[],this.functions=[]};an.enterScope=function(o){this.scopeStack.push(new Rs(o))},an.exitScope=function(){this.scopeStack.pop()},an.treatFunctionsAsVarInScope=function(o){return 2&o.flags||!this.inModule&&1&o.flags},an.declareName=function(o,f,D){var C=!1;if(2===f){var V=this.currentScope();C=V.lexical.indexOf(o)>-1||V.functions.indexOf(o)>-1||V.var.indexOf(o)>-1,V.lexical.push(o),this.inModule&&1&V.flags&&delete this.undefinedExports[o]}else if(4===f)this.currentScope().lexical.push(o);else if(3===f){var Y=this.currentScope();C=this.treatFunctionsAsVar?Y.lexical.indexOf(o)>-1:Y.lexical.indexOf(o)>-1||Y.var.indexOf(o)>-1,Y.functions.push(o)}else for(var se=this.scopeStack.length-1;se>=0;--se){var ue=this.scopeStack[se];if(ue.lexical.indexOf(o)>-1&&!(32&ue.flags&&ue.lexical[0]===o)||!this.treatFunctionsAsVarInScope(ue)&&ue.functions.indexOf(o)>-1){C=!0;break}if(ue.var.push(o),this.inModule&&1&ue.flags&&delete this.undefinedExports[o],3&ue.flags)break}C&&this.raiseRecoverable(D,"Identifier '"+o+"' has already been declared")},an.checkLocalExport=function(o){-1===this.scopeStack[0].lexical.indexOf(o.name)&&-1===this.scopeStack[0].var.indexOf(o.name)&&(this.undefinedExports[o.name]=o)},an.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},an.currentVarScope=function(){for(var o=this.scopeStack.length-1;;o--){var f=this.scopeStack[o];if(3&f.flags)return f}},an.currentThisScope=function(){for(var o=this.scopeStack.length-1;;o--){var f=this.scopeStack[o];if(3&f.flags&&!(16&f.flags))return f}};var un=function(f,D,C){this.type="",this.start=D,this.end=0,f.options.locations&&(this.loc=new ye(f,C)),f.options.directSourceFile&&(this.sourceFile=f.options.directSourceFile),f.options.ranges&&(this.range=[D,0])},Er=Je.prototype;function ks(o,f,D,C){return o.type=f,o.end=D,this.options.locations&&(o.loc.end=C),this.options.ranges&&(o.range[1]=D),o}Er.startNode=function(){return new un(this,this.start,this.startLoc)},Er.startNodeAt=function(o,f){return new un(this,o,f)},Er.finishNode=function(o,f){return ks.call(this,o,f,this.lastTokEnd,this.lastTokEndLoc)},Er.finishNodeAt=function(o,f,D,C){return ks.call(this,o,f,D,C)};var Ot=function(f,D,C,V,H){this.token=f,this.isExpr=!!D,this.preserveSpace=!!C,this.override=V,this.generator=!!H},et={b_stat:new Ot("{",!1),b_expr:new Ot("{",!0),b_tmpl:new Ot("${",!1),p_stat:new Ot("(",!1),p_expr:new Ot("(",!0),q_tmpl:new Ot("`",!0,!0,function(o){return o.tryReadTemplateToken()}),f_stat:new Ot("function",!1),f_expr:new Ot("function",!0),f_expr_gen:new Ot("function",!0,!1,null,!0),f_gen:new Ot("function",!1,!1,null,!0)},cr=Je.prototype;cr.initialContext=function(){return[et.b_stat]},cr.braceIsBlock=function(o){var f=this.curContext();return f===et.f_expr||f===et.f_stat||(o!==g.colon||f!==et.b_stat&&f!==et.b_expr?o===g._return||o===g.name&&this.exprAllowed?O.test(this.input.slice(this.lastTokEnd,this.start)):o===g._else||o===g.semi||o===g.eof||o===g.parenR||o===g.arrow||(o===g.braceL?f===et.b_stat:o!==g._var&&o!==g._const&&o!==g.name&&!this.exprAllowed):!f.isExpr)},cr.inGeneratorContext=function(){for(var o=this.context.length-1;o>=1;o--){var f=this.context[o];if("function"===f.token)return f.generator}return!1},cr.updateContext=function(o){var f,D=this.type;D.keyword&&o===g.dot?this.exprAllowed=!1:(f=D.updateContext)?f.call(this,o):this.exprAllowed=D.beforeExpr},g.parenR.updateContext=g.braceR.updateContext=function(){if(1!==this.context.length){var o=this.context.pop();o===et.b_stat&&"function"===this.curContext().token&&(o=this.context.pop()),this.exprAllowed=!o.isExpr}else this.exprAllowed=!0},g.braceL.updateContext=function(o){this.context.push(this.braceIsBlock(o)?et.b_stat:et.b_expr),this.exprAllowed=!0},g.dollarBraceL.updateContext=function(){this.context.push(et.b_tmpl),this.exprAllowed=!0},g.parenL.updateContext=function(o){this.context.push(o===g._if||o===g._for||o===g._with||o===g._while?et.p_stat:et.p_expr),this.exprAllowed=!0},g.incDec.updateContext=function(){},g._function.updateContext=g._class.updateContext=function(o){!o.beforeExpr||o===g.semi||o===g._else||o===g._return&&O.test(this.input.slice(this.lastTokEnd,this.start))||(o===g.colon||o===g.braceL)&&this.curContext()===et.b_stat?this.context.push(et.f_stat):this.context.push(et.f_expr),this.exprAllowed=!1},g.backQuote.updateContext=function(){this.curContext()===et.q_tmpl?this.context.pop():this.context.push(et.q_tmpl),this.exprAllowed=!1},g.star.updateContext=function(o){if(o===g._function){var f=this.context.length-1;this.context[f]=this.context[f]===et.f_expr?et.f_expr_gen:et.f_gen}this.exprAllowed=!0},g.name.updateContext=function(o){var f=!1;this.options.ecmaVersion>=6&&o!==g.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(f=!0),this.exprAllowed=f};var Ns="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Ls=Ns+" Extended_Pictographic",da={9:Ns,10:Ls,11:Ls},Ai="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ps="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Sr=Ps+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",pa={9:Ps,10:Sr,11:Sr+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},Os={};function hr(o){var f=Os[o]={binary:pe(da[o]+" "+Ai),nonBinary:{General_Category:pe(Ai),Script:pe(pa[o])}};f.nonBinary.Script_Extensions=f.nonBinary.Script,f.nonBinary.gc=f.nonBinary.General_Category,f.nonBinary.sc=f.nonBinary.Script,f.nonBinary.scx=f.nonBinary.Script_Extensions}hr(9),hr(10),hr(11);var de=Je.prototype,ln=function(f){this.parser=f,this.validFlags="gim"+(f.options.ecmaVersion>=6?"uy":"")+(f.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Os[f.options.ecmaVersion>=11?11:f.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function Cr(o){return o<=65535?String.fromCharCode(o):(o-=65536,String.fromCharCode(55296+(o>>10),56320+(1023&o)))}function Mi(o){return 36===o||o>=40&&o<=43||46===o||63===o||o>=91&&o<=94||o>=123&&o<=125}function $s(o){return o>=65&&o<=90||o>=97&&o<=122}function Fi(o){return $s(o)||95===o}function xa(o){return Fi(o)||Ir(o)}function Ir(o){return o>=48&&o<=57}function Ri(o){return o>=48&&o<=57||o>=65&&o<=70||o>=97&&o<=102}function Bs(o){return o>=65&&o<=70?o-65+10:o>=97&&o<=102?o-97+10:o-48}function zs(o){return o>=48&&o<=55}ln.prototype.reset=function(f,D,C){var V=-1!==C.indexOf("u");this.start=0|f,this.source=D+"",this.flags=C,this.switchU=V&&this.parser.options.ecmaVersion>=6,this.switchN=V&&this.parser.options.ecmaVersion>=9},ln.prototype.raise=function(f){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+f)},ln.prototype.at=function(f,D){void 0===D&&(D=!1);var C=this.source,V=C.length;if(f>=V)return-1;var H=C.charCodeAt(f);if(!D&&!this.switchU||H<=55295||H>=57344||f+1>=V)return H;var Y=C.charCodeAt(f+1);return Y>=56320&&Y<=57343?(H<<10)+Y-56613888:H},ln.prototype.nextIndex=function(f,D){void 0===D&&(D=!1);var C=this.source,V=C.length;if(f>=V)return V;var Y,H=C.charCodeAt(f);return!D&&!this.switchU||H<=55295||H>=57344||f+1>=V||(Y=C.charCodeAt(f+1))<56320||Y>57343?f+1:f+2},ln.prototype.current=function(f){return void 0===f&&(f=!1),this.at(this.pos,f)},ln.prototype.lookahead=function(f){return void 0===f&&(f=!1),this.at(this.nextIndex(this.pos,f),f)},ln.prototype.advance=function(f){void 0===f&&(f=!1),this.pos=this.nextIndex(this.pos,f)},ln.prototype.eat=function(f,D){return void 0===D&&(D=!1),this.current(D)===f&&(this.advance(D),!0)},de.validateRegExpFlags=function(o){for(var f=o.validFlags,D=o.flags,C=0;C<D.length;C++){var V=D.charAt(C);-1===f.indexOf(V)&&this.raise(o.start,"Invalid regular expression flag"),D.indexOf(V,C+1)>-1&&this.raise(o.start,"Duplicate regular expression flag")}},de.validateRegExpPattern=function(o){this.regexp_pattern(o),!o.switchN&&this.options.ecmaVersion>=9&&o.groupNames.length>0&&(o.switchN=!0,this.regexp_pattern(o))},de.regexp_pattern=function(o){o.pos=0,o.lastIntValue=0,o.lastStringValue="",o.lastAssertionIsQuantifiable=!1,o.numCapturingParens=0,o.maxBackReference=0,o.groupNames.length=0,o.backReferenceNames.length=0,this.regexp_disjunction(o),o.pos!==o.source.length&&(o.eat(41)&&o.raise("Unmatched ')'"),(o.eat(93)||o.eat(125))&&o.raise("Lone quantifier brackets")),o.maxBackReference>o.numCapturingParens&&o.raise("Invalid escape");for(var f=0,D=o.backReferenceNames;f<D.length;f+=1)-1===o.groupNames.indexOf(D[f])&&o.raise("Invalid named capture referenced")},de.regexp_disjunction=function(o){for(this.regexp_alternative(o);o.eat(124);)this.regexp_alternative(o);this.regexp_eatQuantifier(o,!0)&&o.raise("Nothing to repeat"),o.eat(123)&&o.raise("Lone quantifier brackets")},de.regexp_alternative=function(o){for(;o.pos<o.source.length&&this.regexp_eatTerm(o););},de.regexp_eatTerm=function(o){return this.regexp_eatAssertion(o)?(o.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(o)&&o.switchU&&o.raise("Invalid quantifier"),!0):!!(o.switchU?this.regexp_eatAtom(o):this.regexp_eatExtendedAtom(o))&&(this.regexp_eatQuantifier(o),!0)},de.regexp_eatAssertion=function(o){var f=o.pos;if(o.lastAssertionIsQuantifiable=!1,o.eat(94)||o.eat(36))return!0;if(o.eat(92)){if(o.eat(66)||o.eat(98))return!0;o.pos=f}if(o.eat(40)&&o.eat(63)){var D=!1;if(this.options.ecmaVersion>=9&&(D=o.eat(60)),o.eat(61)||o.eat(33))return this.regexp_disjunction(o),o.eat(41)||o.raise("Unterminated group"),o.lastAssertionIsQuantifiable=!D,!0}return o.pos=f,!1},de.regexp_eatQuantifier=function(o,f){return void 0===f&&(f=!1),!!this.regexp_eatQuantifierPrefix(o,f)&&(o.eat(63),!0)},de.regexp_eatQuantifierPrefix=function(o,f){return o.eat(42)||o.eat(43)||o.eat(63)||this.regexp_eatBracedQuantifier(o,f)},de.regexp_eatBracedQuantifier=function(o,f){var D=o.pos;if(o.eat(123)){var C=0,V=-1;if(this.regexp_eatDecimalDigits(o)&&(C=o.lastIntValue,o.eat(44)&&this.regexp_eatDecimalDigits(o)&&(V=o.lastIntValue),o.eat(125)))return-1!==V&&V<C&&!f&&o.raise("numbers out of order in {} quantifier"),!0;o.switchU&&!f&&o.raise("Incomplete quantifier"),o.pos=D}return!1},de.regexp_eatAtom=function(o){return this.regexp_eatPatternCharacters(o)||o.eat(46)||this.regexp_eatReverseSolidusAtomEscape(o)||this.regexp_eatCharacterClass(o)||this.regexp_eatUncapturingGroup(o)||this.regexp_eatCapturingGroup(o)},de.regexp_eatReverseSolidusAtomEscape=function(o){var f=o.pos;if(o.eat(92)){if(this.regexp_eatAtomEscape(o))return!0;o.pos=f}return!1},de.regexp_eatUncapturingGroup=function(o){var f=o.pos;if(o.eat(40)){if(o.eat(63)&&o.eat(58)){if(this.regexp_disjunction(o),o.eat(41))return!0;o.raise("Unterminated group")}o.pos=f}return!1},de.regexp_eatCapturingGroup=function(o){if(o.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(o):63===o.current()&&o.raise("Invalid group"),this.regexp_disjunction(o),o.eat(41))return o.numCapturingParens+=1,!0;o.raise("Unterminated group")}return!1},de.regexp_eatExtendedAtom=function(o){return o.eat(46)||this.regexp_eatReverseSolidusAtomEscape(o)||this.regexp_eatCharacterClass(o)||this.regexp_eatUncapturingGroup(o)||this.regexp_eatCapturingGroup(o)||this.regexp_eatInvalidBracedQuantifier(o)||this.regexp_eatExtendedPatternCharacter(o)},de.regexp_eatInvalidBracedQuantifier=function(o){return this.regexp_eatBracedQuantifier(o,!0)&&o.raise("Nothing to repeat"),!1},de.regexp_eatSyntaxCharacter=function(o){var f=o.current();return!!Mi(f)&&(o.lastIntValue=f,o.advance(),!0)},de.regexp_eatPatternCharacters=function(o){for(var f=o.pos,D=0;-1!==(D=o.current())&&!Mi(D);)o.advance();return o.pos!==f},de.regexp_eatExtendedPatternCharacter=function(o){var f=o.current();return!(-1===f||36===f||f>=40&&f<=43||46===f||63===f||91===f||94===f||124===f||(o.advance(),0))},de.regexp_groupSpecifier=function(o){if(o.eat(63)){if(this.regexp_eatGroupName(o))return-1!==o.groupNames.indexOf(o.lastStringValue)&&o.raise("Duplicate capture group name"),void o.groupNames.push(o.lastStringValue);o.raise("Invalid group")}},de.regexp_eatGroupName=function(o){if(o.lastStringValue="",o.eat(60)){if(this.regexp_eatRegExpIdentifierName(o)&&o.eat(62))return!0;o.raise("Invalid capture group name")}return!1},de.regexp_eatRegExpIdentifierName=function(o){if(o.lastStringValue="",this.regexp_eatRegExpIdentifierStart(o)){for(o.lastStringValue+=Cr(o.lastIntValue);this.regexp_eatRegExpIdentifierPart(o);)o.lastStringValue+=Cr(o.lastIntValue);return!0}return!1},de.regexp_eatRegExpIdentifierStart=function(o){var f=o.pos,D=this.options.ecmaVersion>=11,C=o.current(D);return o.advance(D),92===C&&this.regexp_eatRegExpUnicodeEscapeSequence(o,D)&&(C=o.lastIntValue),function Vs(o){return R(o,!0)||36===o||95===o}(C)?(o.lastIntValue=C,!0):(o.pos=f,!1)},de.regexp_eatRegExpIdentifierPart=function(o){var f=o.pos,D=this.options.ecmaVersion>=11,C=o.current(D);return o.advance(D),92===C&&this.regexp_eatRegExpUnicodeEscapeSequence(o,D)&&(C=o.lastIntValue),function ga(o){return M(o,!0)||36===o||95===o||8204===o||8205===o}(C)?(o.lastIntValue=C,!0):(o.pos=f,!1)},de.regexp_eatAtomEscape=function(o){return!!(this.regexp_eatBackReference(o)||this.regexp_eatCharacterClassEscape(o)||this.regexp_eatCharacterEscape(o)||o.switchN&&this.regexp_eatKGroupName(o))||(o.switchU&&(99===o.current()&&o.raise("Invalid unicode escape"),o.raise("Invalid escape")),!1)},de.regexp_eatBackReference=function(o){var f=o.pos;if(this.regexp_eatDecimalEscape(o)){var D=o.lastIntValue;if(o.switchU)return D>o.maxBackReference&&(o.maxBackReference=D),!0;if(D<=o.numCapturingParens)return!0;o.pos=f}return!1},de.regexp_eatKGroupName=function(o){if(o.eat(107)){if(this.regexp_eatGroupName(o))return o.backReferenceNames.push(o.lastStringValue),!0;o.raise("Invalid named reference")}return!1},de.regexp_eatCharacterEscape=function(o){return this.regexp_eatControlEscape(o)||this.regexp_eatCControlLetter(o)||this.regexp_eatZero(o)||this.regexp_eatHexEscapeSequence(o)||this.regexp_eatRegExpUnicodeEscapeSequence(o,!1)||!o.switchU&&this.regexp_eatLegacyOctalEscapeSequence(o)||this.regexp_eatIdentityEscape(o)},de.regexp_eatCControlLetter=function(o){var f=o.pos;if(o.eat(99)){if(this.regexp_eatControlLetter(o))return!0;o.pos=f}return!1},de.regexp_eatZero=function(o){return 48===o.current()&&!Ir(o.lookahead())&&(o.lastIntValue=0,o.advance(),!0)},de.regexp_eatControlEscape=function(o){var f=o.current();return 116===f?(o.lastIntValue=9,o.advance(),!0):110===f?(o.lastIntValue=10,o.advance(),!0):118===f?(o.lastIntValue=11,o.advance(),!0):102===f?(o.lastIntValue=12,o.advance(),!0):114===f&&(o.lastIntValue=13,o.advance(),!0)},de.regexp_eatControlLetter=function(o){var f=o.current();return!!$s(f)&&(o.lastIntValue=f%32,o.advance(),!0)},de.regexp_eatRegExpUnicodeEscapeSequence=function(o,f){void 0===f&&(f=!1);var D=o.pos,C=f||o.switchU;if(o.eat(117)){if(this.regexp_eatFixedHexDigits(o,4)){var V=o.lastIntValue;if(C&&V>=55296&&V<=56319){var H=o.pos;if(o.eat(92)&&o.eat(117)&&this.regexp_eatFixedHexDigits(o,4)){var Y=o.lastIntValue;if(Y>=56320&&Y<=57343)return o.lastIntValue=1024*(V-55296)+(Y-56320)+65536,!0}o.pos=H,o.lastIntValue=V}return!0}if(C&&o.eat(123)&&this.regexp_eatHexDigits(o)&&o.eat(125)&&function ma(o){return o>=0&&o<=1114111}(o.lastIntValue))return!0;C&&o.raise("Invalid unicode escape"),o.pos=D}return!1},de.regexp_eatIdentityEscape=function(o){if(o.switchU)return!!this.regexp_eatSyntaxCharacter(o)||!!o.eat(47)&&(o.lastIntValue=47,!0);var f=o.current();return!(99===f||o.switchN&&107===f||(o.lastIntValue=f,o.advance(),0))},de.regexp_eatDecimalEscape=function(o){o.lastIntValue=0;var f=o.current();if(f>=49&&f<=57){do{o.lastIntValue=10*o.lastIntValue+(f-48),o.advance()}while((f=o.current())>=48&&f<=57);return!0}return!1},de.regexp_eatCharacterClassEscape=function(o){var f=o.current();if(function ya(o){return 100===o||68===o||115===o||83===o||119===o||87===o}(f))return o.lastIntValue=-1,o.advance(),!0;if(o.switchU&&this.options.ecmaVersion>=9&&(80===f||112===f)){if(o.lastIntValue=-1,o.advance(),o.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(o)&&o.eat(125))return!0;o.raise("Invalid property name")}return!1},de.regexp_eatUnicodePropertyValueExpression=function(o){var f=o.pos;if(this.regexp_eatUnicodePropertyName(o)&&o.eat(61)){var D=o.lastStringValue;if(this.regexp_eatUnicodePropertyValue(o))return this.regexp_validateUnicodePropertyNameAndValue(o,D,o.lastStringValue),!0}return o.pos=f,!!this.regexp_eatLoneUnicodePropertyNameOrValue(o)&&(this.regexp_validateUnicodePropertyNameOrValue(o,o.lastStringValue),!0)},de.regexp_validateUnicodePropertyNameAndValue=function(o,f,D){fe(o.unicodeProperties.nonBinary,f)||o.raise("Invalid property name"),o.unicodeProperties.nonBinary[f].test(D)||o.raise("Invalid property value")},de.regexp_validateUnicodePropertyNameOrValue=function(o,f){o.unicodeProperties.binary.test(f)||o.raise("Invalid property name")},de.regexp_eatUnicodePropertyName=function(o){var f=0;for(o.lastStringValue="";Fi(f=o.current());)o.lastStringValue+=Cr(f),o.advance();return""!==o.lastStringValue},de.regexp_eatUnicodePropertyValue=function(o){var f=0;for(o.lastStringValue="";xa(f=o.current());)o.lastStringValue+=Cr(f),o.advance();return""!==o.lastStringValue},de.regexp_eatLoneUnicodePropertyNameOrValue=function(o){return this.regexp_eatUnicodePropertyValue(o)},de.regexp_eatCharacterClass=function(o){if(o.eat(91)){if(o.eat(94),this.regexp_classRanges(o),o.eat(93))return!0;o.raise("Unterminated character class")}return!1},de.regexp_classRanges=function(o){for(;this.regexp_eatClassAtom(o);){var f=o.lastIntValue;if(o.eat(45)&&this.regexp_eatClassAtom(o)){var D=o.lastIntValue;o.switchU&&(-1===f||-1===D)&&o.raise("Invalid character class"),-1!==f&&-1!==D&&f>D&&o.raise("Range out of order in character class")}}},de.regexp_eatClassAtom=function(o){var f=o.pos;if(o.eat(92)){if(this.regexp_eatClassEscape(o))return!0;if(o.switchU){var D=o.current();(99===D||zs(D))&&o.raise("Invalid class escape"),o.raise("Invalid escape")}o.pos=f}var C=o.current();return 93!==C&&(o.lastIntValue=C,o.advance(),!0)},de.regexp_eatClassEscape=function(o){var f=o.pos;if(o.eat(98))return o.lastIntValue=8,!0;if(o.switchU&&o.eat(45))return o.lastIntValue=45,!0;if(!o.switchU&&o.eat(99)){if(this.regexp_eatClassControlLetter(o))return!0;o.pos=f}return this.regexp_eatCharacterClassEscape(o)||this.regexp_eatCharacterEscape(o)},de.regexp_eatClassControlLetter=function(o){var f=o.current();return!(!Ir(f)&&95!==f||(o.lastIntValue=f%32,o.advance(),0))},de.regexp_eatHexEscapeSequence=function(o){var f=o.pos;if(o.eat(120)){if(this.regexp_eatFixedHexDigits(o,2))return!0;o.switchU&&o.raise("Invalid escape"),o.pos=f}return!1},de.regexp_eatDecimalDigits=function(o){var f=o.pos,D=0;for(o.lastIntValue=0;Ir(D=o.current());)o.lastIntValue=10*o.lastIntValue+(D-48),o.advance();return o.pos!==f},de.regexp_eatHexDigits=function(o){var f=o.pos,D=0;for(o.lastIntValue=0;Ri(D=o.current());)o.lastIntValue=16*o.lastIntValue+Bs(D),o.advance();return o.pos!==f},de.regexp_eatLegacyOctalEscapeSequence=function(o){if(this.regexp_eatOctalDigit(o)){var f=o.lastIntValue;if(this.regexp_eatOctalDigit(o)){var D=o.lastIntValue;o.lastIntValue=f<=3&&this.regexp_eatOctalDigit(o)?64*f+8*D+o.lastIntValue:8*f+D}else o.lastIntValue=f;return!0}return!1},de.regexp_eatOctalDigit=function(o){var f=o.current();return zs(f)?(o.lastIntValue=f-48,o.advance(),!0):(o.lastIntValue=0,!1)},de.regexp_eatFixedHexDigits=function(o,f){var D=o.pos;o.lastIntValue=0;for(var C=0;C<f;++C){var V=o.current();if(!Ri(V))return o.pos=D,!1;o.lastIntValue=16*o.lastIntValue+Bs(V),o.advance()}return!0};var Ar=function(f){this.type=f.type,this.value=f.value,this.start=f.start,this.end=f.end,f.options.locations&&(this.loc=new ye(f,f.startLoc,f.endLoc)),f.options.ranges&&(this.range=[f.start,f.end])},Ne=Je.prototype;function Mr(o){return"function"!=typeof BigInt?null:BigInt(o.replace(/_/g,""))}function Be(o){return o<=65535?String.fromCharCode(o):(o-=65536,String.fromCharCode(55296+(o>>10),56320+(1023&o)))}Ne.next=function(o){!o&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ar(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ne.getToken=function(){return this.next(),new Ar(this)},"undefined"!=typeof Symbol&&(Ne[Symbol.iterator]=function(){var o=this;return{next:function(){var f=o.getToken();return{done:f.type===g.eof,value:f}}}}),Ne.curContext=function(){return this.context[this.context.length-1]},Ne.nextToken=function(){var o=this.curContext();return(!o||!o.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(g.eof):o.override?o.override(this):void this.readToken(this.fullCharCodeAtPos())},Ne.readToken=function(o){return R(o,this.options.ecmaVersion>=6)||92===o?this.readWord():this.getTokenFromCode(o)},Ne.fullCharCodeAtPos=function(){var o=this.input.charCodeAt(this.pos);return o<=55295||o>=57344?o:(o<<10)+this.input.charCodeAt(this.pos+1)-56613888},Ne.skipBlockComment=function(){var o=this.options.onComment&&this.curPosition(),f=this.pos,D=this.input.indexOf("*/",this.pos+=2);if(-1===D&&this.raise(this.pos-2,"Unterminated comment"),this.pos=D+2,this.options.locations){$.lastIndex=f;for(var C;(C=$.exec(this.input))&&C.index<this.pos;)++this.curLine,this.lineStart=C.index+C[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(f+2,D),f,this.pos,o,this.curPosition())},Ne.skipLineComment=function(o){for(var f=this.pos,D=this.options.onComment&&this.curPosition(),C=this.input.charCodeAt(this.pos+=o);this.pos<this.input.length&&!ee(C);)C=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(f+o,this.pos),f,this.pos,D,this.curPosition())},Ne.skipSpace=function(){e:for(;this.pos<this.input.length;){var o=this.input.charCodeAt(this.pos);switch(o){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(o>8&&o<14||o>=5760&&G.test(String.fromCharCode(o))))break e;++this.pos}}},Ne.finishToken=function(o,f){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var D=this.type;this.type=o,this.value=f,this.updateContext(D)},Ne.readToken_dot=function(){var o=this.input.charCodeAt(this.pos+1);if(o>=48&&o<=57)return this.readNumber(!0);var f=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===o&&46===f?(this.pos+=3,this.finishToken(g.ellipsis)):(++this.pos,this.finishToken(g.dot))},Ne.readToken_slash=function(){var o=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===o?this.finishOp(g.assign,2):this.finishOp(g.slash,1)},Ne.readToken_mult_modulo_exp=function(o){var f=this.input.charCodeAt(this.pos+1),D=1,C=42===o?g.star:g.modulo;return this.options.ecmaVersion>=7&&42===o&&42===f&&(++D,C=g.starstar,f=this.input.charCodeAt(this.pos+2)),61===f?this.finishOp(g.assign,D+1):this.finishOp(C,D)},Ne.readToken_pipe_amp=function(o){var f=this.input.charCodeAt(this.pos+1);return f===o?this.options.ecmaVersion>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(g.assign,3):this.finishOp(124===o?g.logicalOR:g.logicalAND,2):61===f?this.finishOp(g.assign,2):this.finishOp(124===o?g.bitwiseOR:g.bitwiseAND,1)},Ne.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(g.assign,2):this.finishOp(g.bitwiseXOR,1)},Ne.readToken_plus_min=function(o){var f=this.input.charCodeAt(this.pos+1);return f===o?45!==f||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!O.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(g.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===f?this.finishOp(g.assign,2):this.finishOp(g.plusMin,1)},Ne.readToken_lt_gt=function(o){var f=this.input.charCodeAt(this.pos+1),D=1;return f===o?(D=62===o&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+D)?this.finishOp(g.assign,D+1):this.finishOp(g.bitShift,D)):33!==f||60!==o||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===f&&(D=2),this.finishOp(g.relational,D)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},Ne.readToken_eq_excl=function(o){var f=this.input.charCodeAt(this.pos+1);return 61===f?this.finishOp(g.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===o&&62===f&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(g.arrow)):this.finishOp(61===o?g.eq:g.prefix,1)},Ne.readToken_question=function(){var o=this.options.ecmaVersion;if(o>=11){var f=this.input.charCodeAt(this.pos+1);if(46===f){var D=this.input.charCodeAt(this.pos+2);if(D<48||D>57)return this.finishOp(g.questionDot,2)}if(63===f)return o>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(g.assign,3):this.finishOp(g.coalesce,2)}return this.finishOp(g.question,1)},Ne.getTokenFromCode=function(o){switch(o){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(g.parenL);case 41:return++this.pos,this.finishToken(g.parenR);case 59:return++this.pos,this.finishToken(g.semi);case 44:return++this.pos,this.finishToken(g.comma);case 91:return++this.pos,this.finishToken(g.bracketL);case 93:return++this.pos,this.finishToken(g.bracketR);case 123:return++this.pos,this.finishToken(g.braceL);case 125:return++this.pos,this.finishToken(g.braceR);case 58:return++this.pos,this.finishToken(g.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(g.backQuote);case 48:var f=this.input.charCodeAt(this.pos+1);if(120===f||88===f)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===f||79===f)return this.readRadixNumber(8);if(98===f||66===f)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(o);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(o);case 124:case 38:return this.readToken_pipe_amp(o);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(o);case 60:case 62:return this.readToken_lt_gt(o);case 61:case 33:return this.readToken_eq_excl(o);case 63:return this.readToken_question();case 126:return this.finishOp(g.prefix,1)}this.raise(this.pos,"Unexpected character '"+Be(o)+"'")},Ne.finishOp=function(o,f){var D=this.input.slice(this.pos,this.pos+f);return this.pos+=f,this.finishToken(o,D)},Ne.readRegexp=function(){for(var o,f,D=this.pos;;){this.pos>=this.input.length&&this.raise(D,"Unterminated regular expression");var C=this.input.charAt(this.pos);if(O.test(C)&&this.raise(D,"Unterminated regular expression"),o)o=!1;else{if("["===C)f=!0;else if("]"===C&&f)f=!1;else if("/"===C&&!f)break;o="\\"===C}++this.pos}var V=this.input.slice(D,this.pos);++this.pos;var H=this.pos,Y=this.readWord1();this.containsEsc&&this.unexpected(H);var se=this.regexpState||(this.regexpState=new ln(this));se.reset(D,V,Y),this.validateRegExpFlags(se),this.validateRegExpPattern(se);var ue=null;try{ue=new RegExp(V,Y)}catch(xe){}return this.finishToken(g.regexp,{pattern:V,flags:Y,value:ue})},Ne.readInt=function(o,f,D){for(var C=this.options.ecmaVersion>=12&&void 0===f,V=D&&48===this.input.charCodeAt(this.pos),H=this.pos,Y=0,se=0,ue=0,xe=null==f?1/0:f;ue<xe;++ue,++this.pos){var We=this.input.charCodeAt(this.pos),_t=void 0;if(C&&95===We)V&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===se&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===ue&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),se=We;else{if((_t=We>=97?We-97+10:We>=65?We-65+10:We>=48&&We<=57?We-48:1/0)>=o)break;se=We,Y=Y*o+_t}}return C&&95===se&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===H||null!=f&&this.pos-H!==f?null:Y},Ne.readRadixNumber=function(o){var f=this.pos;this.pos+=2;var D=this.readInt(o);return null==D&&this.raise(this.start+2,"Expected number in radix "+o),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(D=Mr(this.input.slice(f,this.pos)),++this.pos):R(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(g.num,D)},Ne.readNumber=function(o){var f=this.pos;!o&&null===this.readInt(10,void 0,!0)&&this.raise(f,"Invalid number");var D=this.pos-f>=2&&48===this.input.charCodeAt(f);D&&this.strict&&this.raise(f,"Invalid number");var C=this.input.charCodeAt(this.pos);if(!D&&!o&&this.options.ecmaVersion>=11&&110===C){var V=Mr(this.input.slice(f,this.pos));return++this.pos,R(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(g.num,V)}D&&/[89]/.test(this.input.slice(f,this.pos))&&(D=!1),46===C&&!D&&(++this.pos,this.readInt(10),C=this.input.charCodeAt(this.pos)),(69===C||101===C)&&!D&&((43===(C=this.input.charCodeAt(++this.pos))||45===C)&&++this.pos,null===this.readInt(10)&&this.raise(f,"Invalid number")),R(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var H=function je(o,f){return f?parseInt(o,8):parseFloat(o.replace(/_/g,""))}(this.input.slice(f,this.pos),D);return this.finishToken(g.num,H)},Ne.readCodePoint=function(){var f;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var D=++this.pos;f=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,f>1114111&&this.invalidStringToken(D,"Code point out of bounds")}else f=this.readHexChar(4);return f},Ne.readString=function(o){for(var f="",D=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var C=this.input.charCodeAt(this.pos);if(C===o)break;92===C?(f+=this.input.slice(D,this.pos),f+=this.readEscapedChar(!1),D=this.pos):(ee(C,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return f+=this.input.slice(D,this.pos++),this.finishToken(g.string,f)};var Fr={};Ne.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(o){if(o!==Fr)throw o;this.readInvalidTemplateToken()}this.inTemplateElement=!1},Ne.invalidStringToken=function(o,f){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Fr;this.raise(o,f)},Ne.readTmplToken=function(){for(var o="",f=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var D=this.input.charCodeAt(this.pos);if(96===D||36===D&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==g.template&&this.type!==g.invalidTemplate?(o+=this.input.slice(f,this.pos),this.finishToken(g.template,o)):36===D?(this.pos+=2,this.finishToken(g.dollarBraceL)):(++this.pos,this.finishToken(g.backQuote));if(92===D)o+=this.input.slice(f,this.pos),o+=this.readEscapedChar(!0),f=this.pos;else if(ee(D)){switch(o+=this.input.slice(f,this.pos),++this.pos,D){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:o+="\n";break;default:o+=String.fromCharCode(D)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),f=this.pos}else++this.pos}},Ne.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(g.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ne.readEscapedChar=function(o){var f=this.input.charCodeAt(++this.pos);switch(++this.pos,f){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Be(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(o)return this.invalidStringToken(this.pos-1,"Invalid escape sequence in template string"),null;default:if(f>=48&&f<=55){var C=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],V=parseInt(C,8);return V>255&&(C=C.slice(0,-1),V=parseInt(C,8)),this.pos+=C.length-1,f=this.input.charCodeAt(this.pos),("0"!==C||56===f||57===f)&&(this.strict||o)&&this.invalidStringToken(this.pos-1-C.length,o?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(V)}return ee(f)?"":String.fromCharCode(f)}},Ne.readHexChar=function(o){var f=this.pos,D=this.readInt(16,o);return null===D&&this.invalidStringToken(f,"Bad character escape sequence"),D},Ne.readWord1=function(){this.containsEsc=!1;for(var o="",f=!0,D=this.pos,C=this.options.ecmaVersion>=6;this.pos<this.input.length;){var V=this.fullCharCodeAtPos();if(M(V,C))this.pos+=V<=65535?1:2;else{if(92!==V)break;this.containsEsc=!0,o+=this.input.slice(D,this.pos);var H=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Y=this.readCodePoint();(f?R:M)(Y,C)||this.invalidStringToken(H,"Invalid Unicode escape"),o+=Be(Y),D=this.pos}f=!1}return o+this.input.slice(D,this.pos)},Ne.readWord=function(){var o=this.readWord1(),f=g.name;return this.keywords.test(o)&&(f=W[o]),this.finishToken(f,o)};Je.acorn={Parser:Je,version:"7.4.0",defaultOptions:he,Position:_e,SourceLocation:ye,getLineInfo:le,Node:un,TokenType:b,tokTypes:g,keywordTypes:W,TokContext:Ot,tokContexts:et,isIdentifierChar:M,isIdentifierStart:R,Token:Ar,isNewLine:ee,lineBreak:O,lineBreakG:$,nonASCIIwhitespace:G},F.Node=un,F.Parser=Je,F.Position=_e,F.SourceLocation=ye,F.TokContext=Ot,F.Token=Ar,F.TokenType=b,F.defaultOptions=he,F.getLineInfo=le,F.isIdentifierChar=M,F.isIdentifierStart=R,F.isNewLine=ee,F.keywordTypes=W,F.lineBreak=O,F.lineBreakG=$,F.nonASCIIwhitespace=G,F.parse=function ki(o,f){return Je.parse(o,f)},F.parseExpressionAt=function Ie(o,f,D){return Je.parseExpressionAt(o,f,D)},F.tokContexts=et,F.tokTypes=g,F.tokenizer=function Gs(o,f){return Je.tokenizer(o,f)},F.version="7.4.0",Object.defineProperty(F,"__esModule",{value:!0})},L("object"==typeof q&&void 0!==B?q:(F=F||self).acorn={})},{}],2:[function(T,B,q){},{}],3:[function(T,B,q){function F(d,u={}){const{contextName:l="gl",throwGetError:y,useTrackablePrimitives:E,readPixelsFile:N,recording:w=[],variables:R={},onReadPixels:M,onUnrecognizedArgumentLookup:b}=u,S=new Proxy(d,{get:function O(le,he){switch(he){case"addComment":return fe;case"checkThrowError":return re;case"getReadPixelsVariableName":return g;case"insertVariable":return G;case"reset":return ee;case"setIndent":return ie;case"toString":return $;case"getContextVariableName":return ye}return"function"==typeof d[he]?function(){switch(he){case"getError":return w.push(y?`${v}if (${l}.getError() !== ${l}.NONE) throw new Error('error');`:`${v}${l}.getError();`),d.getError();case"getExtension":{const we=`${l}Variables${I.length}`;w.push(`${v}const ${we} = ${l}.getExtension('${arguments[0]}');`);const Ge=d.getExtension(arguments[0]);if(Ge&&"object"==typeof Ge){const nt=L(Ge,{getEntity:j,useTrackablePrimitives:E,recording:w,contextName:we,contextVariables:I,variables:R,indent:v,onUnrecognizedArgumentLookup:b});return I.push(nt),nt}return I.push(null),Ge}case"readPixels":const ve=I.indexOf(arguments[6]);let De;if(-1===ve){const we=_e(arguments[6]);we?(De=we,w.push(`${v}${we}`)):(De=`${l}Variable${I.length}`,I.push(arguments[6]),w.push(`${v}const ${De} = new ${arguments[6].constructor.name}(${arguments[6].length});`))}else De=`${l}Variable${ve}`;g=De;const Pt=[arguments[0],arguments[1],arguments[2],arguments[3],j(arguments[4]),j(arguments[5]),De];return w.push(`${v}${l}.readPixels(${Pt.join(", ")});`),N&&ge(arguments[2],arguments[3]),M&&M(De,Pt),d.readPixels.apply(d,arguments);case"drawBuffers":return w.push(`${v}${l}.drawBuffers([${A(arguments[0],{contextName:l,contextVariables:I,getEntity:j,addVariable:X,variables:R,onUnrecognizedArgumentLookup:b})}]);`),d.drawBuffers(arguments[0])}let Ue=d[he].apply(d,arguments);switch(typeof Ue){case"undefined":return void w.push(`${v}${pe(he,arguments)};`);case"number":case"boolean":if(E&&-1===I.indexOf(h(Ue))){w.push(`${v}const ${l}Variable${I.length} = ${pe(he,arguments)};`),I.push(Ue=h(Ue));break}default:w.push(null===Ue?`${pe(he,arguments)};`:`${v}const ${l}Variable${I.length} = ${pe(he,arguments)};`),I.push(Ue)}return Ue}:(U[d[he]]=he,d[he])}}),I=[],U={};let g,W=0,v="";return S;function $(){return w.join("\n")}function ee(){for(;w.length>0;)w.pop()}function G(le,he){R[le]=he}function j(le){const he=U[le];return he?l+"."+he:le}function ie(le){v=" ".repeat(le)}function X(le,he){const Ue=`${l}Variable${I.length}`;return w.push(`${v}const ${Ue} = ${he};`),I.push(le),Ue}function ge(le,he){const Ue=`${l}Variable${I.length}`,ve=`imageDatum${W}`;w.push(`${v}let ${ve} = ["P3\\n# ${N}.ppm\\n", ${le}, ' ', ${he}, "\\n255\\n"].join("");`),w.push(`${v}for (let i = 0; i < ${ve}.length; i += 4) {`),w.push(`${v}  ${ve} += ${Ue}[i] + ' ' + ${Ue}[i + 1] + ' ' + ${Ue}[i + 2] + ' ';`),w.push(`${v}}`),w.push(`${v}if (typeof require !== "undefined") {`),w.push(`${v}  require('fs').writeFileSync('./${N}.ppm', ${ve});`),w.push(`${v}}`),W++}function fe(le){w.push(`${v}// ${le}`)}function re(){w.push(`${v}(() => {\n${v}const error = ${l}.getError();\n${v}if (error !== ${l}.NONE) {\n${v}  const names = Object.getOwnPropertyNames(gl);\n${v}  for (let i = 0; i < names.length; i++) {\n${v}    const name = names[i];\n${v}    if (${l}[name] === error) {\n${v}      throw new Error('${l} threw ' + name);\n${v}    }\n${v}  }\n${v}}\n${v}})();`)}function pe(le,he){return`${l}.${le}(${A(he,{contextName:l,contextVariables:I,getEntity:j,addVariable:X,variables:R,onUnrecognizedArgumentLookup:b})})`}function _e(le){if(R)for(const he in R)if(R[he]===le)return he;return null}function ye(le){const he=I.indexOf(le);return-1!==he?`${l}Variable${he}`:null}}function L(d,u){const l=new Proxy(d,{get:function U(O,$){return"function"==typeof O[$]?function(){if("drawBuffersWEBGL"===$)return M.push(`${S}${E}.drawBuffersWEBGL([${A(arguments[0],{contextName:E,contextVariables:N,getEntity:W,addVariable:g,variables:b,onUnrecognizedArgumentLookup:I})}]);`),d.drawBuffersWEBGL(arguments[0]);let ee=d[$].apply(d,arguments);switch(typeof ee){case"undefined":return void M.push(`${S}${v($,arguments)};`);case"number":case"boolean":R&&-1===N.indexOf(h(ee))?(M.push(`${S}const ${E}Variable${N.length} = ${v($,arguments)};`),N.push(ee=h(ee))):(M.push(`${S}const ${E}Variable${N.length} = ${v($,arguments)};`),N.push(ee));break;default:M.push(null===ee?`${v($,arguments)};`:`${S}const ${E}Variable${N.length} = ${v($,arguments)};`),N.push(ee)}return ee}:(y[d[$]]=$,d[$])}}),y={},{contextName:E,contextVariables:N,getEntity:w,useTrackablePrimitives:R,recording:M,variables:b,indent:S,onUnrecognizedArgumentLookup:I}=u;return l;function W(O){return y.hasOwnProperty(O)?`${E}.${y[O]}`:w(O)}function v(O,$){return`${E}.${O}(${A($,{contextName:E,contextVariables:N,getEntity:W,addVariable:g,variables:b,onUnrecognizedArgumentLookup:I})})`}function g(O,$){const ee=`${E}Variable${N.length}`;return N.push(O),M.push(`${S}const ${ee} = ${$};`),ee}}function A(d,u){const{variables:l,onUnrecognizedArgumentLookup:y}=u;return Array.from(d).map(N=>function E(N){if(l)for(const w in l)if(l.hasOwnProperty(w)&&l[w]===N)return w;return y?y(N):null}(N)||function x(d,u){const{contextName:l,contextVariables:y,getEntity:E,addVariable:N,onUnrecognizedArgumentLookup:w}=u;if(void 0===d)return"undefined";if(null===d)return"null";const R=y.indexOf(d);if(R>-1)return`${l}Variable${R}`;switch(d.constructor.name){case"String":const M=/\n/.test(d),b=/'/.test(d),S=/"/.test(d);return M?"`"+d+"`":b&&!S?'"'+d+'"':"'"+d+"'";case"Number":case"Boolean":return E(d);case"Array":return N(d,`new ${d.constructor.name}([${Array.from(d).join(",")}])`);case"Float32Array":case"Uint8Array":case"Uint16Array":case"Int32Array":return N(d,`new ${d.constructor.name}(${JSON.stringify(Array.from(d))})`);default:if(w){const I=w(d);if(I)return I}throw new Error(`unrecognized argument type ${d.constructor.name}`)}}(N,u)).join(", ")}function h(d){return new d.constructor(d)}void 0!==B&&(B.exports={glWiretap:F,glExtensionWiretap:L}),"undefined"!=typeof window&&(F.glExtensionWiretap=L,window.glWiretap=F)},{}],4:[function(T,B,q){function F(N){const w=new Array(N.length);for(let R=0;R<N.length;R++){const M=N[R];w[R]=M.toArray?M.toArray():M}return w}function L(){const N=F(arguments),w=new Float32Array(this.output.x);for(let R=0;R<this.output.x;R++)this.thread.x=R,this.thread.y=0,this.thread.z=0,w[R]=this._fn.apply(this,N);return w}function A(){const N=F(arguments),w=new Array(this.output.y);for(let R=0;R<this.output.y;R++){const M=new Float32Array(this.output.x);for(let b=0;b<this.output.x;b++)this.thread.x=b,this.thread.y=R,this.thread.z=0,M[b]=this._fn.apply(this,N);w[R]=M}return w}function x(){const N=F(arguments);for(let w=0;w<this.output.y;w++)for(let R=0;R<this.output.x;R++)this.thread.x=R,this.thread.y=w,this.thread.z=0,this._fn.apply(this,N)}function h(){const N=F(arguments),w=new Array(this.output.z);for(let R=0;R<this.output.z;R++){const M=new Array(this.output.y);for(let b=0;b<this.output.y;b++){const S=new Float32Array(this.output.x);for(let I=0;I<this.output.x;I++)this.thread.x=I,this.thread.y=b,this.thread.z=R,S[I]=this._fn.apply(this,N);M[b]=S}w[R]=M}return w}function d(N){N.setOutput=M=>{N.output=l(M),N.graphical&&u(N)},N.toJSON=()=>{throw new Error("Not usable with gpuMock")},N.setConstants=M=>(N.constants=M,N),N.setGraphical=M=>(N.graphical=M,N),N.setCanvas=M=>(N.canvas=M,N),N.setContext=M=>(N.context=M,N),N.destroy=()=>{},N.validateSettings=()=>{},N.graphical&&N.output&&u(N),N.exec=function(){return new Promise((M,b)=>{try{M(N.apply(N,arguments))}catch(S){b(S)}})},N.getPixels=M=>{const{x:b,y:S}=N.output;return M?function E(N,w,R){const M=R/2|0,b=4*w,S=new Uint8ClampedArray(4*w),I=N.slice(0);for(let U=0;U<M;++U){const W=U*b,v=(R-U-1)*b;S.set(I.subarray(W,W+b)),I.copyWithin(W,v,v+b),I.set(S,v)}return I}(N._imageData.data,b,S):N._imageData.data.slice(0)},N.color=function(M,b,S,I){void 0===I&&(I=1),M=Math.floor(255*M),b=Math.floor(255*b),S=Math.floor(255*S),I=Math.floor(255*I);const O=N.thread.x+(N.output.y-N.thread.y-1)*N.output.x;N._colorData[4*O+0]=M,N._colorData[4*O+1]=b,N._colorData[4*O+2]=S,N._colorData[4*O+3]=I};const w=()=>N,R=["setWarnVarUsage","setArgumentTypes","setTactic","setOptimizeFloatMemory","setDebug","setLoopMaxIterations","setConstantTypes","setFunctions","setNativeFunctions","setInjectedNative","setPipeline","setPrecision","setOutputToTexture","setImmutable","setStrictIntegers","setDynamicOutput","setHardcodeConstants","setDynamicArguments","setUseLegacyEncoder","setWarnVarUsage","addSubKernel"];for(let M=0;M<R.length;M++)N[R[M]]=w;return N}function u(N){const{x:w,y:R}=N.output;if(N.context&&N.context.createImageData){const M=new Uint8ClampedArray(w*R*4);N._imageData=N.context.createImageData(w,R),N._colorData=M}else{const M=new Uint8ClampedArray(w*R*4);N._imageData={data:M},N._colorData=M}}function l(N){let w=null;if(N.length)if(3===N.length){const[R,M,b]=N;w={x:R,y:M,z:b}}else if(2===N.length){const[R,M]=N;w={x:R,y:M}}else{const[R]=N;w={x:R}}else w=N;return w}B.exports={gpuMock:function y(N,w={}){const R=w.output?l(w.output):null;function M(){return M.output.z?h.apply(M,arguments):M.output.y?M.graphical?x.apply(M,arguments):A.apply(M,arguments):L.apply(M,arguments)}return M._fn=N,M.constants=w.constants||null,M.context=w.context||null,M.canvas=w.canvas||null,M.graphical=w.graphical||!1,M._imageData=null,M._colorData=null,M.output=R,M.thread={x:0,y:0,z:0},d(M)}}},{}],5:[function(T,B,q){const{utils:F}=T("./utils");B.exports={alias:function L(A,x){const h=x.toString();return new Function(`return function ${A} (${F.getArgumentNamesFromString(h).join(", ")}) {\n  ${F.getFunctionBodyFromString(h)}\n}`)()}}},{"./utils":114}],6:[function(T,B,q){const{FunctionNode:F}=T("../function-node");B.exports={CPUFunctionNode:class L extends F{astFunction(x,h){if(!this.isRootKernel){h.push("function"),h.push(" "),h.push(this.name),h.push("(");for(let d=0;d<this.argumentNames.length;++d){const u=this.argumentNames[d];d>0&&h.push(", "),h.push("user_"),h.push(u)}h.push(") {\n")}for(let d=0;d<x.body.body.length;++d)this.astGeneric(x.body.body[d],h),h.push("\n");return this.isRootKernel||h.push("}\n"),h}astReturnStatement(x,h){const d=this.returnType||this.getType(x.argument);return this.returnType||(this.returnType=d),this.isRootKernel?(h.push(this.leadingReturnStatement),this.astGeneric(x.argument,h),h.push(";\n"),h.push(this.followingReturnStatement),h.push("continue;\n")):this.isSubKernel?(h.push(`subKernelResult_${this.name} = `),this.astGeneric(x.argument,h),h.push(";"),h.push(`return subKernelResult_${this.name};`)):(h.push("return "),this.astGeneric(x.argument,h),h.push(";")),h}astLiteral(x,h){if(isNaN(x.value))throw this.astErrorOutput("Non-numeric literal not supported : "+x.value,x);return h.push(x.value),h}astBinaryExpression(x,h){return h.push("("),this.astGeneric(x.left,h),h.push(x.operator),this.astGeneric(x.right,h),h.push(")"),h}astIdentifierExpression(x,h){if("Identifier"!==x.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",x);return"Infinity"===x.name?h.push("Infinity"):this.constants&&this.constants.hasOwnProperty(x.name)?h.push("constants_"+x.name):h.push("user_"+x.name),h}astForStatement(x,h){if("ForStatement"!==x.type)throw this.astErrorOutput("Invalid for statement",x);const d=[],u=[],l=[],y=[];let E=null;if(x.init){this.pushState("in-for-loop-init"),this.astGeneric(x.init,d);for(let N=0;N<d.length;N++)d[N].includes&&d[N].includes(",")&&(E=!1);this.popState("in-for-loop-init")}else E=!1;if(x.test?this.astGeneric(x.test,u):E=!1,x.update?this.astGeneric(x.update,l):E=!1,x.body&&(this.pushState("loop-body"),this.astGeneric(x.body,y),this.popState("loop-body")),null===E&&(E=this.isSafe(x.init)&&this.isSafe(x.test)),E)h.push(`for (${d.join("")};${u.join("")};${l.join("")}){\n`),h.push(y.join("")),h.push("}\n");else{const N=this.getInternalVariableName("safeI");d.length>0&&h.push(d.join(""),";\n"),h.push(`for (let ${N}=0;${N}<LOOP_MAX;${N}++){\n`),u.length>0&&h.push(`if (!${u.join("")}) break;\n`),h.push(y.join("")),h.push(`\n${l.join("")};`),h.push("}\n")}return h}astWhileStatement(x,h){if("WhileStatement"!==x.type)throw this.astErrorOutput("Invalid while statement",x);return h.push("for (let i = 0; i < LOOP_MAX; i++) {"),h.push("if ("),this.astGeneric(x.test,h),h.push(") {\n"),this.astGeneric(x.body,h),h.push("} else {\n"),h.push("break;\n"),h.push("}\n"),h.push("}\n"),h}astDoWhileStatement(x,h){if("DoWhileStatement"!==x.type)throw this.astErrorOutput("Invalid while statement",x);return h.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(x.body,h),h.push("if (!"),this.astGeneric(x.test,h),h.push(") {\n"),h.push("break;\n"),h.push("}\n"),h.push("}\n"),h}astAssignmentExpression(x,h){const d=this.getDeclaration(x.left);if(d&&!d.assignable)throw this.astErrorOutput(`Variable ${x.left.name} is not assignable here`,x);return this.astGeneric(x.left,h),h.push(x.operator),this.astGeneric(x.right,h),h}astBlockStatement(x,h){if(this.isState("loop-body")){this.pushState("block-body");for(let d=0;d<x.body.length;d++)this.astGeneric(x.body[d],h);this.popState("block-body")}else{h.push("{\n");for(let d=0;d<x.body.length;d++)this.astGeneric(x.body[d],h);h.push("}\n")}return h}astVariableDeclaration(x,h){h.push(`${x.kind} `);const{declarations:d}=x;for(let u=0;u<d.length;u++){u>0&&h.push(",");const l=d[u],y=this.getDeclaration(l.id);y.valueType||(y.valueType=this.getType(l.init)),this.astGeneric(l,h)}return this.isState("in-for-loop-init")||h.push(";"),h}astIfStatement(x,h){return h.push("if ("),this.astGeneric(x.test,h),h.push(")"),"BlockStatement"===x.consequent.type?this.astGeneric(x.consequent,h):(h.push(" {\n"),this.astGeneric(x.consequent,h),h.push("\n}\n")),x.alternate&&(h.push("else "),"BlockStatement"===x.alternate.type||"IfStatement"===x.alternate.type?this.astGeneric(x.alternate,h):(h.push(" {\n"),this.astGeneric(x.alternate,h),h.push("\n}\n"))),h}astSwitchStatement(x,h){const{discriminant:d,cases:u}=x;h.push("switch ("),this.astGeneric(d,h),h.push(") {\n");for(let l=0;l<u.length;l++)null!==u[l].test?(h.push("case "),this.astGeneric(u[l].test,h),h.push(":\n"),u[l].consequent&&u[l].consequent.length>0&&(this.astGeneric(u[l].consequent,h),h.push("break;\n"))):(h.push("default:\n"),this.astGeneric(u[l].consequent,h),u[l].consequent&&u[l].consequent.length>0&&h.push("break;\n"));h.push("\n}")}astThisExpression(x,h){return h.push("_this"),h}astMemberExpression(x,h){const{signature:d,type:u,property:l,xProperty:y,yProperty:E,zProperty:N,name:w,origin:R}=this.getMemberExpressionDetails(x);switch(d){case"this.thread.value":return h.push(`_this.thread.${w}`),h;case"this.output.value":switch(w){case"x":h.push("outputX");break;case"y":h.push("outputY");break;case"z":h.push("outputZ");break;default:throw this.astErrorOutput("Unexpected expression",x)}return h;case"value":default:throw this.astErrorOutput("Unexpected expression",x);case"value[]":case"value[][]":case"value[][][]":case"value.value":if("Math"===R)return h.push(Math[w]),h;switch(l){case"r":return h.push(`user_${w}[0]`),h;case"g":return h.push(`user_${w}[1]`),h;case"b":return h.push(`user_${w}[2]`),h;case"a":return h.push(`user_${w}[3]`),h}break;case"this.constants.value":case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":break;case"fn()[]":return this.astGeneric(x.object,h),h.push("["),this.astGeneric(x.property,h),h.push("]"),h;case"fn()[][]":return this.astGeneric(x.object.object,h),h.push("["),this.astGeneric(x.object.property,h),h.push("]"),h.push("["),this.astGeneric(x.property,h),h.push("]"),h}if(!x.computed)switch(u){case"Number":case"Integer":case"Float":case"Boolean":return h.push(`${R}_${w}`),h}const M=`${R}_${w}`;{let b,S;if("constants"===R){const I=this.constants[w];S="Input"===this.constantTypes[w],b=S?I.size:null}else S=this.isInput(w),b=S?this.argumentSizes[this.argumentNames.indexOf(w)]:null;h.push(`${M}`),N&&E?S?(h.push("[("),this.astGeneric(N,h),h.push(`*${this.dynamicArguments?"(outputY * outputX)":b[1]*b[0]})+(`),this.astGeneric(E,h),h.push(`*${this.dynamicArguments?"outputX":b[0]})+`),this.astGeneric(y,h),h.push("]")):(h.push("["),this.astGeneric(N,h),h.push("]"),h.push("["),this.astGeneric(E,h),h.push("]"),h.push("["),this.astGeneric(y,h),h.push("]")):E?S?(h.push("[("),this.astGeneric(E,h),h.push(`*${this.dynamicArguments?"outputX":b[0]})+`),this.astGeneric(y,h),h.push("]")):(h.push("["),this.astGeneric(E,h),h.push("]"),h.push("["),this.astGeneric(y,h),h.push("]")):void 0!==y&&(h.push("["),this.astGeneric(y,h),h.push("]"))}return h}astCallExpression(x,h){if("CallExpression"!==x.type)throw this.astErrorOutput("Unknown CallExpression",x);let d=this.astMemberExpressionUnroll(x.callee);this.calledFunctions.indexOf(d)<0&&this.calledFunctions.push(d),this.isAstMathFunction(x),this.onFunctionCall&&this.onFunctionCall(this.name,d,x.arguments),h.push(d),h.push("(");const l=this.lookupFunctionArgumentTypes(d)||[];for(let y=0;y<x.arguments.length;++y){const E=x.arguments[y];let N=this.getType(E);l[y]||this.triggerImplyArgumentType(d,y,N,this),y>0&&h.push(", "),this.astGeneric(E,h)}return h.push(")"),h}astArrayExpression(x,h){const d=this.getType(x),u=x.elements.length,l=[];for(let y=0;y<u;++y){const E=[];this.astGeneric(x.elements[y],E),l.push(E.join(""))}switch(d){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":h.push(`[${l.join(", ")}]`);break;default:h.push(`new Float32Array([${l.join(", ")}])`)}return h}astDebuggerStatement(x,h){return h.push("debugger;"),h}}}},{"../function-node":10}],7:[function(T,B,q){const{utils:F}=T("../../utils");B.exports={cpuKernelString:function A(x,h){const d=[],u=[],l=[],y=!/^function/.test(x.color.toString());if(d.push("  const { context, canvas, constants: incomingConstants } = settings;",`  const output = new Int32Array(${JSON.stringify(Array.from(x.output))});`,`  const _constantTypes = ${JSON.stringify(x.constantTypes)};`,`  const _constants = ${function L(x,h){const d=[];for(const u in h){if(!h.hasOwnProperty(u))continue;const y=x[u];switch(h[u]){case"Number":case"Integer":case"Float":case"Boolean":d.push(`${u}:${y}`);break;case"Array(2)":case"Array(3)":case"Array(4)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":d.push(`${u}:new ${y.constructor.name}(${JSON.stringify(Array.from(y))})`)}}return`{ ${d.join()} }`}(x.constants,x.constantTypes)};`),u.push("    constants: _constants,","    context,","    output,","    thread: {x: 0, y: 0, z: 0},"),x.graphical){d.push(`  const _imageData = context.createImageData(${x.output[0]}, ${x.output[1]});`),d.push(`  const _colorData = new Uint8ClampedArray(${x.output[0]} * ${x.output[1]} * 4);`);const w=F.flattenFunctionToString((y?"function ":"")+x.color.toString(),{thisLookup:M=>{switch(M){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(x[M])},findDependency:(M,b)=>null}),R=F.flattenFunctionToString((y?"function ":"")+x.getPixels.toString(),{thisLookup:M=>{switch(M){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(x[M])},findDependency:()=>null});u.push("    _imageData,","    _colorData,",`    color: ${w},`),l.push(`  kernel.getPixels = ${R};`)}const E=[],N=Object.keys(x.constantTypes);for(let w=0;w<N.length;w++)E.push(x.constantTypes[N]);if(-1!==x.argumentTypes.indexOf("HTMLImageArray")||-1!==E.indexOf("HTMLImageArray")){const w=F.flattenFunctionToString((y?"function ":"")+x._imageTo3DArray.toString(),{doNotDefine:["canvas"],findDependency:(R,M)=>"this"===R?(y?"function ":"")+x[M].toString():null,thisLookup:R=>{switch(R){case"canvas":return;case"context":return"context"}}});l.push(w),u.push("    _mediaTo2DArray,"),u.push("    _imageTo3DArray,")}else if(-1!==x.argumentTypes.indexOf("HTMLImage")||-1!==E.indexOf("HTMLImage")){const w=F.flattenFunctionToString((y?"function ":"")+x._mediaTo2DArray.toString(),{findDependency:(R,M)=>null,thisLookup:R=>{switch(R){case"canvas":return"settings.canvas";case"context":return"settings.context"}throw new Error("unhandled thisLookup")}});l.push(w),u.push("    _mediaTo2DArray,")}return`function(settings) {\n${d.join("\n")}\n  for (const p in _constantTypes) {\n    if (!_constantTypes.hasOwnProperty(p)) continue;\n    const type = _constantTypes[p];\n    switch (type) {\n      case 'Number':\n      case 'Integer':\n      case 'Float':\n      case 'Boolean':\n      case 'Array(2)':\n      case 'Array(3)':\n      case 'Array(4)':\n      case 'Matrix(2)':\n      case 'Matrix(3)':\n      case 'Matrix(4)':\n        if (incomingConstants.hasOwnProperty(p)) {\n          console.warn('constant ' + p + ' of type ' + type + ' cannot be resigned');\n        }\n        continue;\n    }\n    if (!incomingConstants.hasOwnProperty(p)) {\n      throw new Error('constant ' + p + ' not found');\n    }\n    _constants[p] = incomingConstants[p];\n  }\n  const kernel = (function() {\n${x._kernelString}\n  })\n    .apply({ ${u.join("\n")} });\n  ${l.join("\n")}\n  return kernel;\n}`}}},{"../../utils":114}],8:[function(T,B,q){const{Kernel:F}=T("../kernel"),{FunctionBuilder:L}=T("../function-builder"),{CPUFunctionNode:A}=T("./function-node"),{utils:x}=T("../../utils"),{cpuKernelString:h}=T("./kernel-string");B.exports={CPUKernel:class d extends F{static getFeatures(){return this.features}static get features(){return Object.freeze({kernelMap:!0,isIntegerDivisionAccurate:!0})}static get isSupported(){return!0}static isContextMatch(l){return!1}static get mode(){return"cpu"}static nativeFunctionArguments(){return null}static nativeFunctionReturnType(){throw new Error(`Looking up native function return type not supported on ${this.name}`)}static combineKernels(l){return l}static getSignature(l,y){return"cpu"+(y.length>0?":"+y.join(","):"")}constructor(l,y){super(l,y),this.mergeSettings(l.settings||y),this._imageData=null,this._colorData=null,this._kernelString=null,this._prependedString=[],this.thread={x:0,y:0,z:0},this.translatedSources=null}initCanvas(){return"undefined"!=typeof document?document.createElement("canvas"):"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(0,0):void 0}initContext(){return this.canvas?this.canvas.getContext("2d"):null}initPlugins(l){return[]}validateSettings(l){if(!this.output||0===this.output.length){if(1!==l.length)throw new Error("Auto output only supported for kernels with only one input");const y=x.getVariableType(l[0],this.strictIntegers);if("Array"===y)this.output=x.getDimensions(y);else{if("NumberTexture"!==y&&"ArrayTexture(4)"!==y)throw new Error("Auto output not supported for input type: "+y);this.output=l[0].output}}if(this.graphical&&2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.checkOutput()}translateSource(){if(this.leadingReturnStatement=this.output.length>1?"resultX[x] = ":"result[x] = ",this.subKernels){const y=[];for(let E=0;E<this.subKernels.length;E++){const{name:N}=this.subKernels[E];y.push(this.output.length>1?`resultX_${N}[x] = subKernelResult_${N};\n`:`result_${N}[x] = subKernelResult_${N};\n`)}this.followingReturnStatement=y.join("")}const l=L.fromKernel(this,A);this.translatedSources=l.getPrototypes("kernel"),!this.graphical&&!this.returnType&&(this.returnType=l.getKernelResultType())}build(){if(this.built)return;if(this.setupConstants(),this.setupArguments(arguments),this.validateSettings(arguments),this.translateSource(),this.graphical){const{canvas:y,output:E}=this;if(!y)throw new Error("no canvas available for using graphical output");const N=E[0],w=E[1]||1;y.width=N,y.height=w,this._imageData=this.context.createImageData(N,w),this._colorData=new Uint8ClampedArray(N*w*4)}const l=this.getKernelString();this.kernelString=l,this.debug&&(console.log("Function output:"),console.log(l));try{this.run=new Function([],l).bind(this)()}catch(y){console.error("An error occurred compiling the javascript: ",y)}this.buildSignature(arguments),this.built=!0}color(l,y,E,N){void 0===N&&(N=1),l=Math.floor(255*l),y=Math.floor(255*y),E=Math.floor(255*E),N=Math.floor(255*N);const S=this.thread.x+(this.output[1]-this.thread.y-1)*this.output[0];this._colorData[4*S+0]=l,this._colorData[4*S+1]=y,this._colorData[4*S+2]=E,this._colorData[4*S+3]=N}getKernelString(){if(null!==this._kernelString)return this._kernelString;let l=null,{translatedSources:y}=this;return y.length>1?y=y.filter(E=>/^function/.test(E)?E:(l=E,!1)):l=y.shift(),this._kernelString=`  const LOOP_MAX = ${this._getLoopMaxString()};\n  ${this.injectedNative||""}\n  const _this = this;\n  ${this._resultKernelHeader()}\n  ${this._processConstants()}\n  return (${this.argumentNames.map(E=>"user_"+E).join(", ")}) => {\n    ${this._prependedString.join("")}\n    ${this._earlyThrows()}\n    ${this._processArguments()}\n    ${this.graphical?this._graphicalKernelBody(l):this._resultKernelBody(l)}\n    ${y.length>0?y.join("\n"):""}\n  };`}toString(){return h(this)}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};`:" 1000;"}_processConstants(){if(!this.constants)return"";const l=[];for(let y in this.constants)switch(this.constantTypes[y]){case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLVideo":l.push(`    const constants_${y} = this._mediaTo2DArray(this.constants.${y});\n`);break;case"HTMLImageArray":l.push(`    const constants_${y} = this._imageTo3DArray(this.constants.${y});\n`);break;case"Input":l.push(`    const constants_${y} = this.constants.${y}.value;\n`);break;default:l.push(`    const constants_${y} = this.constants.${y};\n`)}return l.join("")}_earlyThrows(){if(this.graphical||this.immutable||!this.pipeline)return"";const l=[];for(let E=0;E<this.argumentTypes.length;E++)"Array"===this.argumentTypes[E]&&l.push(this.argumentNames[E]);if(0===l.length)return"";const y=[];for(let E=0;E<l.length;E++){const N=l[E],w=this._mapSubKernels(R=>`user_${N} === result_${R.name}`).join(" || ");y.push(`user_${N} === result${w?` || ${w}`:""}`)}return`if (${y.join(" || ")}) throw new Error('Source and destination arrays are the same.  Use immutable = true');`}_processArguments(){const l=[];for(let y=0;y<this.argumentTypes.length;y++){const E=`user_${this.argumentNames[y]}`;switch(this.argumentTypes[y]){case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLVideo":l.push(`    ${E} = this._mediaTo2DArray(${E});\n`);break;case"HTMLImageArray":l.push(`    ${E} = this._imageTo3DArray(${E});\n`);break;case"Input":l.push(`    ${E} = ${E}.value;\n`);break;case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"NumberTexture":case"MemoryOptimizedNumberTexture":l.push(`\n    if (${E}.toArray) {\n      if (!_this.textureCache) {\n        _this.textureCache = [];\n        _this.arrayCache = [];\n      }\n      const textureIndex = _this.textureCache.indexOf(${E});\n      if (textureIndex !== -1) {\n        ${E} = _this.arrayCache[textureIndex];\n      } else {\n        _this.textureCache.push(${E});\n        ${E} = ${E}.toArray();\n        _this.arrayCache.push(${E});\n      }\n    }`)}}return l.join("")}_mediaTo2DArray(l){const y=this.canvas,E=l.width>0?l.width:l.videoWidth,N=l.height>0?l.height:l.videoHeight;y.width<E&&(y.width=E),y.height<N&&(y.height=N);const w=this.context;let R;l.constructor===ImageData?R=l.data:(w.drawImage(l,0,0,E,N),R=w.getImageData(0,0,E,N).data);const M=new Array(N);let b=0;for(let S=N-1;S>=0;S--){const I=M[S]=new Array(E);for(let U=0;U<E;U++){const W=new Float32Array(4);W[0]=R[b++]/255,W[1]=R[b++]/255,W[2]=R[b++]/255,W[3]=R[b++]/255,I[U]=W}}return M}getPixels(l){const[y,E]=this.output;return l?x.flipPixels(this._imageData.data,y,E):this._imageData.data.slice(0)}_imageTo3DArray(l){const y=new Array(l.length);for(let E=0;E<l.length;E++)y[E]=this._mediaTo2DArray(l[E]);return y}_resultKernelHeader(){if(this.graphical||this.immutable||!this.pipeline)return"";switch(this.output.length){case 1:return this._mutableKernel1DResults();case 2:return this._mutableKernel2DResults();case 3:return this._mutableKernel3DResults()}}_resultKernelBody(l){switch(this.output.length){case 1:return(!this.immutable&&this.pipeline?this._resultMutableKernel1DLoop(l):this._resultImmutableKernel1DLoop(l))+this._kernelOutput();case 2:return(!this.immutable&&this.pipeline?this._resultMutableKernel2DLoop(l):this._resultImmutableKernel2DLoop(l))+this._kernelOutput();case 3:return(!this.immutable&&this.pipeline?this._resultMutableKernel3DLoop(l):this._resultImmutableKernel3DLoop(l))+this._kernelOutput();default:throw new Error("unsupported size kernel")}}_graphicalKernelBody(l){if(2===this.output.length)return this._graphicalKernel2DLoop(l)+this._graphicalOutput();throw new Error("unsupported size kernel")}_graphicalOutput(){return"\n    this._imageData.data.set(this._colorData);\n    this.context.putImageData(this._imageData, 0, 0);\n    return;"}_getKernelResultTypeConstructorString(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return"Float32Array";case"Array(2)":case"Array(3)":case"Array(4)":return"Array";default:if(this.graphical)return"Float32Array";throw new Error(`unhandled returnType ${this.returnType}`)}}_resultImmutableKernel1DLoop(l){const y=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const result = new ${y}(outputX);\n    ${this._mapSubKernels(E=>`const result_${E.name} = new ${y}(outputX);\n`).join("    ")}\n    ${this._mapSubKernels(E=>`let subKernelResult_${E.name};\n`).join("    ")}\n    for (let x = 0; x < outputX; x++) {\n      this.thread.x = x;\n      this.thread.y = 0;\n      this.thread.z = 0;\n      ${l}\n    }`}_mutableKernel1DResults(){const l=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const result = new ${l}(outputX);\n    ${this._mapSubKernels(y=>`const result_${y.name} = new ${l}(outputX);\n`).join("    ")}\n    ${this._mapSubKernels(y=>`let subKernelResult_${y.name};\n`).join("    ")}`}_resultMutableKernel1DLoop(l){return`  const outputX = _this.output[0];\n    for (let x = 0; x < outputX; x++) {\n      this.thread.x = x;\n      this.thread.y = 0;\n      this.thread.z = 0;\n      ${l}\n    }`}_resultImmutableKernel2DLoop(l){const y=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const result = new Array(outputY);\n    ${this._mapSubKernels(E=>`const result_${E.name} = new Array(outputY);\n`).join("    ")}\n    ${this._mapSubKernels(E=>`let subKernelResult_${E.name};\n`).join("    ")}\n    for (let y = 0; y < outputY; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      const resultX = result[y] = new ${y}(outputX);\n      ${this._mapSubKernels(E=>`const resultX_${E.name} = result_${E.name}[y] = new ${y}(outputX);\n`).join("")}\n      for (let x = 0; x < outputX; x++) {\n        this.thread.x = x;\n        ${l}\n      }\n    }`}_mutableKernel2DResults(){const l=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const result = new Array(outputY);\n    ${this._mapSubKernels(y=>`const result_${y.name} = new Array(outputY);\n`).join("    ")}\n    ${this._mapSubKernels(y=>`let subKernelResult_${y.name};\n`).join("    ")}\n    for (let y = 0; y < outputY; y++) {\n      const resultX = result[y] = new ${l}(outputX);\n      ${this._mapSubKernels(y=>`const resultX_${y.name} = result_${y.name}[y] = new ${l}(outputX);\n`).join("")}\n    }`}_resultMutableKernel2DLoop(l){const y=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    for (let y = 0; y < outputY; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      const resultX = result[y];\n      ${this._mapSubKernels(E=>`const resultX_${E.name} = result_${E.name}[y] = new ${y}(outputX);\n`).join("")}\n      for (let x = 0; x < outputX; x++) {\n        this.thread.x = x;\n        ${l}\n      }\n    }`}_graphicalKernel2DLoop(l){return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    for (let y = 0; y < outputY; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      for (let x = 0; x < outputX; x++) {\n        this.thread.x = x;\n        ${l}\n      }\n    }`}_resultImmutableKernel3DLoop(l){const y=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const outputZ = _this.output[2];\n    const result = new Array(outputZ);\n    ${this._mapSubKernels(E=>`const result_${E.name} = new Array(outputZ);\n`).join("    ")}\n    ${this._mapSubKernels(E=>`let subKernelResult_${E.name};\n`).join("    ")}\n    for (let z = 0; z < outputZ; z++) {\n      this.thread.z = z;\n      const resultY = result[z] = new Array(outputY);\n      ${this._mapSubKernels(E=>`const resultY_${E.name} = result_${E.name}[z] = new Array(outputY);\n`).join("      ")}\n      for (let y = 0; y < outputY; y++) {\n        this.thread.y = y;\n        const resultX = resultY[y] = new ${y}(outputX);\n        ${this._mapSubKernels(E=>`const resultX_${E.name} = resultY_${E.name}[y] = new ${y}(outputX);\n`).join("        ")}\n        for (let x = 0; x < outputX; x++) {\n          this.thread.x = x;\n          ${l}\n        }\n      }\n    }`}_mutableKernel3DResults(){const l=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const outputZ = _this.output[2];\n    const result = new Array(outputZ);\n    ${this._mapSubKernels(y=>`const result_${y.name} = new Array(outputZ);\n`).join("    ")}\n    ${this._mapSubKernels(y=>`let subKernelResult_${y.name};\n`).join("    ")}\n    for (let z = 0; z < outputZ; z++) {\n      const resultY = result[z] = new Array(outputY);\n      ${this._mapSubKernels(y=>`const resultY_${y.name} = result_${y.name}[z] = new Array(outputY);\n`).join("      ")}\n      for (let y = 0; y < outputY; y++) {\n        const resultX = resultY[y] = new ${l}(outputX);\n        ${this._mapSubKernels(y=>`const resultX_${y.name} = resultY_${y.name}[y] = new ${l}(outputX);\n`).join("        ")}\n      }\n    }`}_resultMutableKernel3DLoop(l){return`  const outputX = _this.output[0];\n    const outputY = _this.output[1];\n    const outputZ = _this.output[2];\n    for (let z = 0; z < outputZ; z++) {\n      this.thread.z = z;\n      const resultY = result[z];\n      for (let y = 0; y < outputY; y++) {\n        this.thread.y = y;\n        const resultX = resultY[y];\n        for (let x = 0; x < outputX; x++) {\n          this.thread.x = x;\n          ${l}\n        }\n      }\n    }`}_kernelOutput(){return this.subKernels?`\n    return {\n      result: result,\n      ${this.subKernels.map(l=>`${l.property}: result_${l.name}`).join(",\n      ")}\n    };`:"\n    return result;"}_mapSubKernels(l){return null===this.subKernels?[""]:this.subKernels.map(l)}destroy(l){l&&delete this.canvas}static destroyContext(l){}toJSON(){const l=super.toJSON();return l.functionNodes=L.fromKernel(this,A).toJSON(),l}setOutput(l){super.setOutput(l);const[y,E]=this.output;this.graphical&&(this._imageData=this.context.createImageData(y,E),this._colorData=new Uint8ClampedArray(y*E*4))}prependString(l){if(this._kernelString)throw new Error("Kernel already built");this._prependedString.push(l)}hasPrependString(l){return this._prependedString.indexOf(l)>-1}}}},{"../../utils":114,"../function-builder":9,"../kernel":36,"./function-node":6,"./kernel-string":7}],9:[function(T,B,q){class F{static fromKernel(A,x,h){const{kernelArguments:d,kernelConstants:u,argumentNames:l,argumentSizes:y,argumentBitRatios:E,constants:N,constantBitRatios:w,debug:R,loopMaxIterations:M,nativeFunctions:b,output:S,optimizeFloatMemory:I,precision:U,plugins:W,source:v,subKernels:g,functions:O,leadingReturnStatement:$,followingReturnStatement:ee,dynamicArguments:G,dynamicOutput:j}=A,ie=new Array(d.length),X={};for(let Ee=0;Ee<d.length;Ee++)ie[Ee]=d[Ee].type;for(let Ee=0;Ee<u.length;Ee++){const $e=u[Ee];X[$e.name]=$e.type}const ge=(Ee,$e)=>rt.needsArgumentType(Ee,$e),fe=(Ee,$e,ft)=>{rt.assignArgumentType(Ee,$e,ft)},re=(Ee,$e,ft)=>rt.lookupReturnType(Ee,$e,ft),pe=Ee=>rt.lookupFunctionArgumentTypes(Ee),_e=(Ee,$e)=>rt.lookupFunctionArgumentName(Ee,$e),ye=(Ee,$e)=>rt.lookupFunctionArgumentBitRatio(Ee,$e),le=(Ee,$e,ft,Tt)=>{rt.assignArgumentType(Ee,$e,ft,Tt)},he=(Ee,$e,ft,Tt)=>{rt.assignArgumentBitRatio(Ee,$e,ft,Tt)},Ue=(Ee,$e,ft)=>{rt.trackFunctionCall(Ee,$e,ft)},ve=(Ee,$e)=>{const ft=[];for(let on=0;on<Ee.params.length;on++)ft.push(Ee.params[on].name);const Tt=new x($e,Object.assign({},De,{returnType:null,ast:Ee,name:Ee.id.name,argumentNames:ft,lookupReturnType:re,lookupFunctionArgumentTypes:pe,lookupFunctionArgumentName:_e,lookupFunctionArgumentBitRatio:ye,needsArgumentType:ge,assignArgumentType:fe,triggerImplyArgumentType:le,triggerImplyArgumentBitRatio:he,onFunctionCall:Ue}));Tt.traceFunctionAST(Ee),rt.addFunctionNode(Tt)},De=Object.assign({isRootKernel:!1,onNestedFunction:ve,lookupReturnType:re,lookupFunctionArgumentTypes:pe,lookupFunctionArgumentName:_e,lookupFunctionArgumentBitRatio:ye,needsArgumentType:ge,assignArgumentType:fe,triggerImplyArgumentType:le,triggerImplyArgumentBitRatio:he,onFunctionCall:Ue,optimizeFloatMemory:I,precision:U,constants:N,constantTypes:X,constantBitRatios:w,debug:R,loopMaxIterations:M,output:S,plugins:W,dynamicArguments:G,dynamicOutput:j},h||{}),Pt=Object.assign({},De,{isRootKernel:!0,name:"kernel",argumentNames:l,argumentTypes:ie,argumentSizes:y,argumentBitRatios:E,leadingReturnStatement:$,followingReturnStatement:ee});if("object"==typeof v&&v.functionNodes)return(new F).fromJSON(v.functionNodes,x);const we=new x(v,Pt);let Ge=null;O&&(Ge=O.map(Ee=>new x(Ee.source,{returnType:Ee.returnType,argumentTypes:Ee.argumentTypes,output:S,plugins:W,constants:N,constantTypes:X,constantBitRatios:w,optimizeFloatMemory:I,precision:U,lookupReturnType:re,lookupFunctionArgumentTypes:pe,lookupFunctionArgumentName:_e,lookupFunctionArgumentBitRatio:ye,needsArgumentType:ge,assignArgumentType:fe,triggerImplyArgumentType:le,triggerImplyArgumentBitRatio:he,onFunctionCall:Ue,onNestedFunction:ve})));let nt=null;g&&(nt=g.map(Ee=>{const{name:$e,source:ft}=Ee;return new x(ft,Object.assign({},De,{name:$e,isSubKernel:!0,isRootKernel:!1}))}));const rt=new F({kernel:A,rootNode:we,functionNodes:Ge,nativeFunctions:b,subKernelNodes:nt});return rt}constructor(A){if(this.kernel=(A=A||{}).kernel,this.rootNode=A.rootNode,this.functionNodes=A.functionNodes||[],this.subKernelNodes=A.subKernelNodes||[],this.nativeFunctions=A.nativeFunctions||[],this.functionMap={},this.nativeFunctionNames=[],this.lookupChain=[],this.functionNodeDependencies={},this.functionCalls={},this.rootNode&&(this.functionMap.kernel=this.rootNode),this.functionNodes)for(let x=0;x<this.functionNodes.length;x++)this.functionMap[this.functionNodes[x].name]=this.functionNodes[x];if(this.subKernelNodes)for(let x=0;x<this.subKernelNodes.length;x++)this.functionMap[this.subKernelNodes[x].name]=this.subKernelNodes[x];if(this.nativeFunctions)for(let x=0;x<this.nativeFunctions.length;x++)this.nativeFunctionNames.push(this.nativeFunctions[x].name)}addFunctionNode(A){if(!A.name)throw new Error("functionNode.name needs set");this.functionMap[A.name]=A,A.isRootKernel&&(this.rootNode=A)}traceFunctionCalls(A,x){if(x=x||[],this.nativeFunctionNames.indexOf(A=A||"kernel")>-1){const d=x.indexOf(A);if(-1===d)x.push(A);else{const u=x.splice(d,1)[0];x.push(u)}return x}const h=this.functionMap[A];if(h){const d=x.indexOf(A);if(-1===d){x.push(A),h.toString();for(let u=0;u<h.calledFunctions.length;++u)this.traceFunctionCalls(h.calledFunctions[u],x)}else{const u=x.splice(d,1)[0];x.push(u)}}return x}getPrototypeString(A){return this.getPrototypes(A).join("\n")}getPrototypes(A){return this.rootNode&&this.rootNode.toString(),this.getPrototypesFromFunctionNames(A?this.traceFunctionCalls(A,[]).reverse():Object.keys(this.functionMap))}getStringFromFunctionNames(A){const x=[];for(let h=0;h<A.length;++h)this.functionMap[A[h]]&&x.push(this.functionMap[A[h]].toString());return x.join("\n")}getPrototypesFromFunctionNames(A){const x=[];for(let h=0;h<A.length;++h){const d=A[h],u=this.nativeFunctionNames.indexOf(d);if(u>-1){x.push(this.nativeFunctions[u].source);continue}const l=this.functionMap[d];l&&x.push(l.toString())}return x}toJSON(){return this.traceFunctionCalls(this.rootNode.name).reverse().map(A=>{const x=this.nativeFunctions.indexOf(A);if(x>-1)return{name:A,source:this.nativeFunctions[x].source};if(this.functionMap[A])return this.functionMap[A].toJSON();throw new Error(`function ${A} not found`)})}fromJSON(A,x){this.functionMap={};for(let h=0;h<A.length;h++){const d=A[h];this.functionMap[d.settings.name]=new x(d.ast,d.settings)}return this}getString(A){return this.getStringFromFunctionNames(A?this.traceFunctionCalls(A).reverse():Object.keys(this.functionMap))}lookupReturnType(A,x,h){if("CallExpression"!==x.type)throw new Error(`expected ast type of "CallExpression", but is ${x.type}`);if(this._isNativeFunction(A))return this._lookupNativeFunctionReturnType(A);if(this._isFunction(A)){const d=this._getFunction(A);if(d.returnType)return d.returnType;{for(let l=0;l<this.lookupChain.length;l++)if(this.lookupChain[l].ast===x){if(0===d.argumentTypes.length&&x.arguments.length>0){const y=x.arguments;for(let E=0;E<y.length;E++)this.lookupChain.push({name:h.name,ast:y[l],requestingNode:h}),d.argumentTypes[E]=h.getType(y[E]),this.lookupChain.pop();return d.returnType=d.getType(d.getJsAST())}throw new Error("circlical logic detected!")}this.lookupChain.push({name:h.name,ast:x,requestingNode:h});const u=d.getType(d.getJsAST());return this.lookupChain.pop(),d.returnType=u}}return null}_getFunction(A){return this._isFunction(A)||new Error(`Function ${A} not found`),this.functionMap[A]}_isFunction(A){return Boolean(this.functionMap[A])}_getNativeFunction(A){for(let x=0;x<this.nativeFunctions.length;x++)if(this.nativeFunctions[x].name===A)return this.nativeFunctions[x];return null}_isNativeFunction(A){return Boolean(this._getNativeFunction(A))}_lookupNativeFunctionReturnType(A){let x=this._getNativeFunction(A);if(x)return x.returnType;throw new Error(`Native function ${A} not found`)}lookupFunctionArgumentTypes(A){return this._isNativeFunction(A)?this._getNativeFunction(A).argumentTypes:this._isFunction(A)?this._getFunction(A).argumentTypes:null}lookupFunctionArgumentName(A,x){return this._getFunction(A).argumentNames[x]}lookupFunctionArgumentBitRatio(A,x){if(!this._isFunction(A))throw new Error("function not found");if(this.rootNode.name===A){const l=this.rootNode.argumentNames.indexOf(x);if(-1!==l)return this.rootNode.argumentBitRatios[l]}const h=this._getFunction(A),d=h.argumentNames.indexOf(x);if(-1===d)throw new Error("argument not found");const u=h.argumentBitRatios[d];if("number"!=typeof u)throw new Error("argument bit ratio not found");return u}needsArgumentType(A,x){return!!this._isFunction(A)&&!this._getFunction(A).argumentTypes[x]}assignArgumentType(A,x,h,d){if(!this._isFunction(A))return;const u=this._getFunction(A);u.argumentTypes[x]||(u.argumentTypes[x]=h)}assignArgumentBitRatio(A,x,h,d){const u=this._getFunction(A);if(this._isNativeFunction(h))return null;const l=this._getFunction(h),y=u.argumentNames.indexOf(x);if(-1===y)throw new Error(`Argument ${x} not found in arguments from function ${A}`);const E=u.argumentBitRatios[y];if("number"!=typeof E)throw new Error(`Bit ratio for argument ${x} not found in function ${A}`);l.argumentBitRatios||(l.argumentBitRatios=new Array(l.argumentNames.length));const N=l.argumentBitRatios[y];if("number"==typeof N){if(N!==E)throw new Error(`Incompatible bit ratio found at function ${A} at argument ${x}`);return N}return l.argumentBitRatios[y]=E,E}trackFunctionCall(A,x,h){this.functionNodeDependencies[A]||(this.functionNodeDependencies[A]=new Set,this.functionCalls[A]=[]),this.functionNodeDependencies[A].add(x),this.functionCalls[A].push(h)}getKernelResultType(){return this.rootNode.returnType||this.rootNode.getType(this.rootNode.ast)}getSubKernelResultType(A){const x=this.subKernelNodes[A];let h=!1;for(let d=0;d<this.rootNode.functionCalls.length;d++)this.rootNode.functionCalls[d].ast.callee.name===x.name&&(h=!0);if(!h)throw new Error(`SubKernel ${x.name} never called by kernel`);return x.returnType||x.getType(x.getJsAST())}getReturnTypes(){const A={[this.rootNode.name]:this.rootNode.getType(this.rootNode.ast)},x=this.traceFunctionCalls(this.rootNode.name);for(let h=0;h<x.length;h++){const d=x[h],u=this.functionMap[d];A[d]=u.getType(u.ast)}return A}}B.exports={FunctionBuilder:F}},{}],10:[function(T,B,q){const F=T("acorn"),{utils:L}=T("../utils"),{FunctionTracer:A}=T("./function-tracer");const h={Number:"Number",Float:"Float",Integer:"Integer",Array:"Number","Array(2)":"Number","Array(3)":"Number","Array(4)":"Number","Matrix(2)":"Number","Matrix(3)":"Number","Matrix(4)":"Number",Array2D:"Number",Array3D:"Number",Input:"Number",HTMLCanvas:"Array(4)",OffscreenCanvas:"Array(4)",HTMLImage:"Array(4)",ImageBitmap:"Array(4)",ImageData:"Array(4)",HTMLVideo:"Array(4)",HTMLImageArray:"Array(4)",NumberTexture:"Number",MemoryOptimizedNumberTexture:"Number","Array1D(2)":"Array(2)","Array1D(3)":"Array(3)","Array1D(4)":"Array(4)","Array2D(2)":"Array(2)","Array2D(3)":"Array(3)","Array2D(4)":"Array(4)","Array3D(2)":"Array(2)","Array3D(3)":"Array(3)","Array3D(4)":"Array(4)","ArrayTexture(1)":"Number","ArrayTexture(2)":"Array(2)","ArrayTexture(3)":"Array(3)","ArrayTexture(4)":"Array(4)"};B.exports={FunctionNode:class x{constructor(u,l){if(!u&&!l.ast)throw new Error("source parameter is missing");if(l=l||{},this.source=u,this.ast=null,this.name="string"==typeof u?l.isRootKernel?"kernel":l.name||L.getFunctionNameFromString(u):null,this.calledFunctions=[],this.constants={},this.constantTypes={},this.constantBitRatios={},this.isRootKernel=!1,this.isSubKernel=!1,this.debug=null,this.functions=null,this.identifiers=null,this.contexts=null,this.functionCalls=null,this.states=[],this.needsArgumentType=null,this.assignArgumentType=null,this.lookupReturnType=null,this.lookupFunctionArgumentTypes=null,this.lookupFunctionArgumentBitRatio=null,this.triggerImplyArgumentType=null,this.triggerImplyArgumentBitRatio=null,this.onNestedFunction=null,this.onFunctionCall=null,this.optimizeFloatMemory=null,this.precision=null,this.loopMaxIterations=null,this.argumentNames="string"==typeof this.source?L.getArgumentNamesFromString(this.source):null,this.argumentTypes=[],this.argumentSizes=[],this.argumentBitRatios=null,this.returnType=null,this.output=[],this.plugins=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.dynamicOutput=null,this.dynamicArguments=null,this.strictTypingChecking=!1,this.fixIntegerDivisionAccuracy=null,l)for(const y in l)!l.hasOwnProperty(y)||!this.hasOwnProperty(y)||(this[y]=l[y]);this.literalTypes={},this.validate(),this._string=null,this._internalVariableNames={}}validate(){if("string"!=typeof this.source&&!this.ast)throw new Error("this.source not a string");if(!this.ast&&!L.isFunctionString(this.source))throw new Error("this.source not a function string");if(!this.name)throw new Error("this.name could not be set");if(this.argumentTypes.length>0&&this.argumentTypes.length!==this.argumentNames.length)throw new Error(`argumentTypes count of ${this.argumentTypes.length} exceeds ${this.argumentNames.length}`);if(this.output.length<1)throw new Error("this.output is not big enough")}isIdentifierConstant(u){return!!this.constants&&this.constants.hasOwnProperty(u)}isInput(u){return"Input"===this.argumentTypes[this.argumentNames.indexOf(u)]}pushState(u){this.states.push(u)}popState(u){if(this.state!==u)throw new Error(`Cannot popState ${u} when in ${this.state}`);this.states.pop()}isState(u){return this.state===u}get state(){return this.states[this.states.length-1]}astMemberExpressionUnroll(u){if("Identifier"===u.type)return u.name;if("ThisExpression"===u.type)return"this";if("MemberExpression"===u.type&&u.object&&u.property)return u.object.hasOwnProperty("name")&&"Math"!==u.object.name?this.astMemberExpressionUnroll(u.property):this.astMemberExpressionUnroll(u.object)+"."+this.astMemberExpressionUnroll(u.property);if(u.hasOwnProperty("expressions")){const l=u.expressions[0];if("Literal"===l.type&&0===l.value&&2===u.expressions.length)return this.astMemberExpressionUnroll(u.expressions[1])}throw this.astErrorOutput("Unknown astMemberExpressionUnroll",u)}getJsAST(u){if(this.ast)return this.ast;if("object"==typeof this.source)return this.traceFunctionAST(this.source),this.ast=this.source;if(null===(u=u||F))throw new Error("Missing JS to AST parser");const l=Object.freeze(u.parse(`const parser_${this.name} = ${this.source};`,{locations:!0})),y=l.body[0].declarations[0].init;if(this.traceFunctionAST(y),!l)throw new Error("Failed to parse JS code");return this.ast=y}traceFunctionAST(u){const{contexts:l,declarations:y,functions:E,identifiers:N,functionCalls:w}=new A(u);this.contexts=l,this.identifiers=N,this.functionCalls=w,this.functions=E;for(let R=0;R<y.length;R++){const M=y[R],{ast:b,inForLoopInit:S,inForLoopTest:I}=M,{init:U}=b,W=this.getDependencies(U);let v=null;if(S&&I)v="Integer";else if(U){const g=this.getType(U);switch(g){case"Integer":case"Float":case"Number":v="MemberExpression"===U.type?g:"Number";break;case"LiteralInteger":v="Number";break;default:v=g}}M.valueType=v,M.dependencies=W,M.isSafe=this.isSafeDependencies(W)}for(let R=0;R<E.length;R++)this.onNestedFunction(E[R],this.source)}getDeclaration(u){for(let l=0;l<this.identifiers.length;l++){const y=this.identifiers[l];if(u===y.ast)return y.declaration}return null}getVariableType(u){if("Identifier"!==u.type)throw new Error(`ast of ${u.type} not "Identifier"`);let l=null;const y=this.argumentNames.indexOf(u.name);if(-1===y){const E=this.getDeclaration(u);if(E)return E.valueType}else{const E=this.argumentTypes[y];E&&(l=E)}if(!l&&this.strictTypingChecking)throw new Error(`Declaration of ${name} not found`);return l}getLookupType(u){if(!h.hasOwnProperty(u))throw new Error(`unknown typeLookupMap ${u}`);return h[u]}getConstantType(u){if(this.constantTypes[u]){const l=this.constantTypes[u];return"Float"===l?"Number":l}throw new Error(`Type for constant "${u}" not declared`)}toString(){return this._string?this._string:this._string=this.astGeneric(this.getJsAST(),[]).join("").trim()}toJSON(){return{ast:this.ast,settings:{source:this.source,name:this.name,constants:this.constants,constantTypes:this.constantTypes,isRootKernel:this.isRootKernel,isSubKernel:this.isSubKernel,debug:this.debug,output:this.output,loopMaxIterations:this.loopMaxIterations,argumentNames:this.argumentNames,argumentTypes:this.argumentTypes,argumentSizes:this.argumentSizes,returnType:this.returnType,leadingReturnStatement:this.leadingReturnStatement,followingReturnStatement:this.followingReturnStatement}}}getType(u){if(Array.isArray(u))return this.getType(u[u.length-1]);switch(u.type){case"BlockStatement":return this.getType(u.body);case"ArrayExpression":switch(this.getType(u.elements[0])){case"Array(2)":case"Array(3)":case"Array(4)":return`Matrix(${u.elements.length})`}return`Array(${u.elements.length})`;case"Literal":const y=this.astKey(u);return this.literalTypes[y]?this.literalTypes[y]:Number.isInteger(u.value)?"LiteralInteger":!0===u.value||!1===u.value?"Boolean":"Number";case"AssignmentExpression":return this.getType(u.left);case"CallExpression":if(this.isAstMathFunction(u))return"Number";if(!u.callee||!u.callee.name){if("SequenceExpression"===u.callee.type&&u.callee.expressions[u.callee.expressions.length-1].property.name){const M=u.callee.expressions[u.callee.expressions.length-1].property.name;return this.inferArgumentTypesIfNeeded(M,u.arguments),this.lookupReturnType(M,u,this)}if("this.color"===this.getVariableSignature(u.callee,!0))return null;if("MemberExpression"===u.callee.type&&u.callee.object&&u.callee.property&&u.callee.property.name&&u.arguments){const M=u.callee.property.name;return this.inferArgumentTypesIfNeeded(M,u.arguments),this.lookupReturnType(M,u,this)}throw this.astErrorOutput("Unknown call expression",u)}if(u.callee&&u.callee.name){const M=u.callee.name;return this.inferArgumentTypesIfNeeded(M,u.arguments),this.lookupReturnType(M,u,this)}throw this.astErrorOutput(`Unhandled getType Type "${u.type}"`,u);case"LogicalExpression":return"Boolean";case"BinaryExpression":switch(u.operator){case"%":case"/":if(this.fixIntegerDivisionAccuracy)return"Number";break;case">":case"<":return"Boolean";case"&":case"|":case"^":case"<<":case">>":case">>>":return"Integer"}const E=this.getType(u.left);if(this.isState("skip-literal-correction"))return E;if("LiteralInteger"===E){const M=this.getType(u.right);return"LiteralInteger"===M?u.left.value%1==0?"Integer":"Float":M}return h[E]||E;case"UpdateExpression":case"ReturnStatement":return this.getType(u.argument);case"UnaryExpression":return"~"===u.operator?"Integer":this.getType(u.argument);case"VariableDeclaration":{const M=u.declarations;let b;for(let S=0;S<M.length;S++)b=this.getType(M[S]);if(!b)throw this.astErrorOutput("Unable to find type for declaration",u);return b}case"VariableDeclarator":const N=this.getDeclaration(u.id);if(!N)throw this.astErrorOutput("Unable to find declarator",u);if(!N.valueType)throw this.astErrorOutput("Unable to find declarator valueType",u);return N.valueType;case"Identifier":if("Infinity"===u.name)return"Number";if(this.isAstVariable(u)&&"value"===this.getVariableSignature(u))return this.getCheckVariableType(u);const w=this.findIdentifierOrigin(u);return w&&w.init?this.getType(w.init):null;case"MemberExpression":if(this.isAstMathFunction(u)){switch(u.property.name){case"ceil":case"floor":case"round":return"Integer"}return"Number"}if(this.isAstVariable(u)){switch(this.getVariableSignature(u)){case"value[]":return this.getLookupType(this.getCheckVariableType(u.object));case"value[][]":return this.getLookupType(this.getCheckVariableType(u.object.object));case"value[][][]":return this.getLookupType(this.getCheckVariableType(u.object.object.object));case"value[][][][]":return this.getLookupType(this.getCheckVariableType(u.object.object.object.object));case"value.thread.value":case"this.thread.value":return"Integer";case"this.output.value":return this.dynamicOutput?"Integer":"LiteralInteger";case"this.constants.value":return this.getConstantType(u.property.name);case"this.constants.value[]":return this.getLookupType(this.getConstantType(u.object.property.name));case"this.constants.value[][]":return this.getLookupType(this.getConstantType(u.object.object.property.name));case"this.constants.value[][][]":return this.getLookupType(this.getConstantType(u.object.object.object.property.name));case"this.constants.value[][][][]":return this.getLookupType(this.getConstantType(u.object.object.object.object.property.name));case"fn()[]":case"fn()[][]":case"fn()[][][]":return this.getLookupType(this.getType(u.object));case"value.value":if(this.isAstMathVariable(u))return"Number";switch(u.property.name){case"r":case"g":case"b":case"a":return this.getLookupType(this.getCheckVariableType(u.object))}case"[][]":return"Number"}throw this.astErrorOutput("Unhandled getType MemberExpression",u)}throw this.astErrorOutput("Unhandled getType MemberExpression",u);case"ConditionalExpression":case"IfStatement":return this.getType(u.consequent);case"FunctionDeclaration":case"FunctionExpression":const R=this.findLastReturn(u.body);return R?this.getType(R):null;case"SequenceExpression":return this.getType(u.expressions[u.expressions.length-1]);default:throw this.astErrorOutput(`Unhandled getType Type "${u.type}"`,u)}}getCheckVariableType(u){const l=this.getVariableType(u);if(!l)throw this.astErrorOutput(`${u.type} is not defined`,u);return l}inferArgumentTypesIfNeeded(u,l){for(let y=0;y<l.length;y++){if(!this.needsArgumentType(u,y))continue;const E=this.getType(l[y]);if(!E)throw this.astErrorOutput(`Unable to infer argument ${y}`,l[y]);this.assignArgumentType(u,y,E)}}isAstMathVariable(u){return"MemberExpression"===u.type&&u.object&&"Identifier"===u.object.type&&"Math"===u.object.name&&u.property&&"Identifier"===u.property.type&&["E","PI","SQRT2","SQRT1_2","LN2","LN10","LOG2E","LOG10E"].indexOf(u.property.name)>-1}isAstMathFunction(u){return"CallExpression"===u.type&&u.callee&&"MemberExpression"===u.callee.type&&u.callee.object&&"Identifier"===u.callee.object.type&&"Math"===u.callee.object.name&&u.callee.property&&"Identifier"===u.callee.property.type&&["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","expm1","exp","floor","fround","imul","log","log2","log10","log1p","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"].indexOf(u.callee.property.name)>-1}isAstVariable(u){return"Identifier"===u.type||"MemberExpression"===u.type}isSafe(u){return this.isSafeDependencies(this.getDependencies(u))}isSafeDependencies(u){return!u||!u.every||u.every(l=>l.isSafe)}getDependencies(u,l,y){if(l||(l=[]),!u)return null;if(Array.isArray(u)){for(let E=0;E<u.length;E++)this.getDependencies(u[E],l,y);return l}switch(u.type){case"AssignmentExpression":return this.getDependencies(u.left,l,y),this.getDependencies(u.right,l,y),l;case"ConditionalExpression":return this.getDependencies(u.test,l,y),this.getDependencies(u.alternate,l,y),this.getDependencies(u.consequent,l,y),l;case"Literal":l.push({origin:"literal",value:u.value,isSafe:!0!==y&&u.value>-1/0&&u.value<1/0&&!isNaN(u.value)});break;case"VariableDeclarator":return this.getDependencies(u.init,l,y);case"Identifier":const E=this.getDeclaration(u);if(E)l.push({name:u.name,origin:"declaration",isSafe:!y&&this.isSafeDependencies(E.dependencies)});else if(this.argumentNames.indexOf(u.name)>-1)l.push({name:u.name,origin:"argument",isSafe:!1});else if(this.strictTypingChecking)throw new Error(`Cannot find identifier origin "${u.name}"`);break;case"FunctionDeclaration":return this.getDependencies(u.body.body[u.body.body.length-1],l,y);case"ReturnStatement":return this.getDependencies(u.argument,l);case"BinaryExpression":case"LogicalExpression":return this.getDependencies(u.left,l,y="/"===u.operator||"*"===u.operator),this.getDependencies(u.right,l,y),l;case"UnaryExpression":case"UpdateExpression":return this.getDependencies(u.argument,l,y);case"VariableDeclaration":return this.getDependencies(u.declarations,l,y);case"ArrayExpression":return l.push({origin:"declaration",isSafe:!0}),l;case"CallExpression":return l.push({origin:"function",isSafe:!0}),l;case"MemberExpression":const N=this.getMemberExpressionDetails(u);switch(N.signature){case"value[]":this.getDependencies(u.object,l,y);break;case"value[][]":this.getDependencies(u.object.object,l,y);break;case"value[][][]":this.getDependencies(u.object.object.object,l,y);break;case"this.output.value":this.dynamicOutput&&l.push({name:N.name,origin:"output",isSafe:!1})}if(N)return N.property&&this.getDependencies(N.property,l,y),N.xProperty&&this.getDependencies(N.xProperty,l,y),N.yProperty&&this.getDependencies(N.yProperty,l,y),N.zProperty&&this.getDependencies(N.zProperty,l,y),l;case"SequenceExpression":return this.getDependencies(u.expressions,l,y);default:throw this.astErrorOutput(`Unhandled type ${u.type} in getDependencies`,u)}return l}getVariableSignature(u,l){if(!this.isAstVariable(u))throw new Error(`ast of type "${u.type}" is not a variable signature`);if("Identifier"===u.type)return"value";const y=[];for(;u;)u.computed?y.push("[]"):y.unshift("ThisExpression"===u.type?"this":u.property&&u.property.name?"x"===u.property.name||"y"===u.property.name||"z"===u.property.name?l?"."+u.property.name:".value":"constants"===u.property.name||"thread"===u.property.name||"output"===u.property.name||l?"."+u.property.name:".value":u.name?l?u.name:"value":u.callee&&u.callee.name?l?u.callee.name+"()":"fn()":u.elements?"[]":"unknown"),u=u.object;const E=y.join("");return l||["value","value[]","value[][]","value[][][]","value[][][][]","value.value","value.thread.value","this.thread.value","this.output.value","this.constants.value","this.constants.value[]","this.constants.value[][]","this.constants.value[][][]","this.constants.value[][][][]","fn()[]","fn()[][]","fn()[][][]","[][]"].indexOf(E)>-1?E:null}build(){return this.toString().length>0}astGeneric(u,l){if(null===u)throw this.astErrorOutput("NULL ast",u);if(Array.isArray(u)){for(let y=0;y<u.length;y++)this.astGeneric(u[y],l);return l}switch(u.type){case"FunctionDeclaration":return this.astFunctionDeclaration(u,l);case"FunctionExpression":return this.astFunctionExpression(u,l);case"ReturnStatement":return this.astReturnStatement(u,l);case"Literal":return this.astLiteral(u,l);case"BinaryExpression":return this.astBinaryExpression(u,l);case"Identifier":return this.astIdentifierExpression(u,l);case"AssignmentExpression":return this.astAssignmentExpression(u,l);case"ExpressionStatement":return this.astExpressionStatement(u,l);case"EmptyStatement":return this.astEmptyStatement(u,l);case"BlockStatement":return this.astBlockStatement(u,l);case"IfStatement":return this.astIfStatement(u,l);case"SwitchStatement":return this.astSwitchStatement(u,l);case"BreakStatement":return this.astBreakStatement(u,l);case"ContinueStatement":return this.astContinueStatement(u,l);case"ForStatement":return this.astForStatement(u,l);case"WhileStatement":return this.astWhileStatement(u,l);case"DoWhileStatement":return this.astDoWhileStatement(u,l);case"VariableDeclaration":return this.astVariableDeclaration(u,l);case"VariableDeclarator":return this.astVariableDeclarator(u,l);case"ThisExpression":return this.astThisExpression(u,l);case"SequenceExpression":return this.astSequenceExpression(u,l);case"UnaryExpression":return this.astUnaryExpression(u,l);case"UpdateExpression":return this.astUpdateExpression(u,l);case"LogicalExpression":return this.astLogicalExpression(u,l);case"MemberExpression":return this.astMemberExpression(u,l);case"CallExpression":return this.astCallExpression(u,l);case"ArrayExpression":return this.astArrayExpression(u,l);case"DebuggerStatement":return this.astDebuggerStatement(u,l);case"ConditionalExpression":return this.astConditionalExpression(u,l)}throw this.astErrorOutput("Unknown ast type : "+u.type,u)}astErrorOutput(u,l){if("string"!=typeof this.source)return new Error(u);const y=L.getAstString(this.source,l),N=this.source.substr(l.start).split(/\n/);return new Error(`${u} on line ${N.length}, position ${(N.length>0?N[N.length-1]:0).length}:\n ${y}`)}astDebuggerStatement(u,l){return l}astConditionalExpression(u,l){if("ConditionalExpression"!==u.type)throw this.astErrorOutput("Not a conditional expression",u);return l.push("("),this.astGeneric(u.test,l),l.push("?"),this.astGeneric(u.consequent,l),l.push(":"),this.astGeneric(u.alternate,l),l.push(")"),l}astFunction(u,l){throw new Error(`"astFunction" not defined on ${this.constructor.name}`)}astFunctionDeclaration(u,l){return this.isChildFunction(u)?l:this.astFunction(u,l)}astFunctionExpression(u,l){return this.isChildFunction(u)?l:this.astFunction(u,l)}isChildFunction(u){for(let l=0;l<this.functions.length;l++)if(this.functions[l]===u)return!0;return!1}astReturnStatement(u,l){return l}astLiteral(u,l){return this.literalTypes[this.astKey(u)]="Number",l}astBinaryExpression(u,l){return l}astIdentifierExpression(u,l){return l}astAssignmentExpression(u,l){return l}astExpressionStatement(u,l){return this.astGeneric(u.expression,l),l.push(";"),l}astEmptyStatement(u,l){return l}astBlockStatement(u,l){return l}astIfStatement(u,l){return l}astSwitchStatement(u,l){return l}astBreakStatement(u,l){return l.push("break;"),l}astContinueStatement(u,l){return l.push("continue;\n"),l}astForStatement(u,l){return l}astWhileStatement(u,l){return l}astDoWhileStatement(u,l){return l}astVariableDeclarator(u,l){return this.astGeneric(u.id,l),null!==u.init&&(l.push("="),this.astGeneric(u.init,l)),l}astThisExpression(u,l){return l}astSequenceExpression(u,l){const{expressions:y}=u,E=[];for(let N=0;N<y.length;N++){const R=[];this.astGeneric(y[N],R),E.push(R.join(""))}return E.length>1?l.push("(",E.join(","),")"):l.push(E[0]),l}astUnaryExpression(u,l){return this.checkAndUpconvertBitwiseUnary(u,l)||(u.prefix?(l.push(u.operator),this.astGeneric(u.argument,l)):(this.astGeneric(u.argument,l),l.push(u.operator))),l}checkAndUpconvertBitwiseUnary(u,l){}astUpdateExpression(u,l){return u.prefix?(l.push(u.operator),this.astGeneric(u.argument,l)):(this.astGeneric(u.argument,l),l.push(u.operator)),l}astLogicalExpression(u,l){return l.push("("),this.astGeneric(u.left,l),l.push(u.operator),this.astGeneric(u.right,l),l.push(")"),l}astMemberExpression(u,l){return l}astCallExpression(u,l){return l}astArrayExpression(u,l){return l}getMemberExpressionDetails(u){if("MemberExpression"!==u.type)throw this.astErrorOutput(`Expression ${u.type} not a MemberExpression`,u);let l=null,y=null;const E=this.getVariableSignature(u);switch(E){case"value":return null;case"value.thread.value":case"this.thread.value":case"this.output.value":return{signature:E,type:"Integer",name:u.property.name};case"value[]":if("string"!=typeof u.object.name)throw this.astErrorOutput("Unexpected expression",u);return l=u.object.name,{name:l,origin:"user",signature:E,type:this.getVariableType(u.object),xProperty:u.property};case"value[][]":if("string"!=typeof u.object.object.name)throw this.astErrorOutput("Unexpected expression",u);return l=u.object.object.name,{name:l,origin:"user",signature:E,type:this.getVariableType(u.object.object),yProperty:u.object.property,xProperty:u.property};case"value[][][]":if("string"!=typeof u.object.object.object.name)throw this.astErrorOutput("Unexpected expression",u);return l=u.object.object.object.name,{name:l,origin:"user",signature:E,type:this.getVariableType(u.object.object.object),zProperty:u.object.object.property,yProperty:u.object.property,xProperty:u.property};case"value[][][][]":if("string"!=typeof u.object.object.object.object.name)throw this.astErrorOutput("Unexpected expression",u);return l=u.object.object.object.object.name,{name:l,origin:"user",signature:E,type:this.getVariableType(u.object.object.object.object),zProperty:u.object.object.property,yProperty:u.object.property,xProperty:u.property};case"value.value":if("string"!=typeof u.property.name)throw this.astErrorOutput("Unexpected expression",u);if(this.isAstMathVariable(u))return l=u.property.name,{name:l,origin:"Math",type:"Number",signature:E};switch(u.property.name){case"r":case"g":case"b":case"a":return l=u.object.name,{name:l,property:u.property.name,origin:"user",signature:E,type:"Number"};default:throw this.astErrorOutput("Unexpected expression",u)}case"this.constants.value":if("string"!=typeof u.property.name)throw this.astErrorOutput("Unexpected expression",u);if(l=u.property.name,y=this.getConstantType(l),!y)throw this.astErrorOutput("Constant has no type",u);return{name:l,type:y,origin:"constants",signature:E};case"this.constants.value[]":if("string"!=typeof u.object.property.name)throw this.astErrorOutput("Unexpected expression",u);if(l=u.object.property.name,y=this.getConstantType(l),!y)throw this.astErrorOutput("Constant has no type",u);return{name:l,type:y,origin:"constants",signature:E,xProperty:u.property};case"this.constants.value[][]":if("string"!=typeof u.object.object.property.name)throw this.astErrorOutput("Unexpected expression",u);if(l=u.object.object.property.name,y=this.getConstantType(l),!y)throw this.astErrorOutput("Constant has no type",u);return{name:l,type:y,origin:"constants",signature:E,yProperty:u.object.property,xProperty:u.property};case"this.constants.value[][][]":if("string"!=typeof u.object.object.object.property.name)throw this.astErrorOutput("Unexpected expression",u);if(l=u.object.object.object.property.name,y=this.getConstantType(l),!y)throw this.astErrorOutput("Constant has no type",u);return{name:l,type:y,origin:"constants",signature:E,zProperty:u.object.object.property,yProperty:u.object.property,xProperty:u.property};case"fn()[]":case"fn()[][]":case"[][]":return{signature:E,property:u.property};default:throw this.astErrorOutput("Unexpected expression",u)}}findIdentifierOrigin(u){const l=[this.ast];for(;l.length>0;){const y=l[0];if("VariableDeclarator"===y.type&&y.id&&y.id.name&&y.id.name===u.name)return y;if(l.shift(),y.argument)l.push(y.argument);else if(y.body)l.push(y.body);else if(y.declarations)l.push(y.declarations);else if(Array.isArray(y))for(let E=0;E<y.length;E++)l.push(y[E])}return null}findLastReturn(u){const l=[u||this.ast];for(;l.length>0;){const y=l.pop();if("ReturnStatement"===y.type)return y;if("FunctionDeclaration"!==y.type)if(y.argument)l.push(y.argument);else if(y.body)l.push(y.body);else if(y.declarations)l.push(y.declarations);else if(Array.isArray(y))for(let E=0;E<y.length;E++)l.push(y[E]);else y.consequent?l.push(y.consequent):y.cases&&l.push(y.cases)}return null}getInternalVariableName(u){return this._internalVariableNames.hasOwnProperty(u)||(this._internalVariableNames[u]=0),this._internalVariableNames[u]++,1===this._internalVariableNames[u]?u:u+this._internalVariableNames[u]}astKey(u,l=","){if(!u.start||!u.end)throw new Error("AST start and end needed");return`${u.start}${l}${u.end}`}}}},{"../utils":114,"./function-tracer":11,acorn:1}],11:[function(T,B,q){const{utils:F}=T("../utils");function L(h){return h.length>0?h[h.length-1]:null}const A_trackIdentifiers="trackIdentifiers",A_memberExpression="memberExpression",A_inForLoopInit="inForLoopInit";B.exports={FunctionTracer:class x{constructor(d){this.runningContexts=[],this.functionContexts=[],this.contexts=[],this.functionCalls=[],this.declarations=[],this.identifiers=[],this.functions=[],this.returnStatements=[],this.trackedIdentifiers=null,this.states=[],this.newFunctionContext(),this.scan(d)}isState(d){return this.states[this.states.length-1]===d}hasState(d){return this.states.indexOf(d)>-1}pushState(d){this.states.push(d)}popState(d){if(!this.isState(d))throw new Error(`Cannot pop the non-active state "${d}"`);this.states.pop()}get currentFunctionContext(){return L(this.functionContexts)}get currentContext(){return L(this.runningContexts)}newFunctionContext(){const d={"@contextType":"function"};this.contexts.push(d),this.functionContexts.push(d)}newContext(d){const u=Object.assign({"@contextType":"const/let"},this.currentContext);this.contexts.push(u),this.runningContexts.push(u),d();const{currentFunctionContext:l}=this;for(const y in l)!l.hasOwnProperty(y)||u.hasOwnProperty(y)||(u[y]=l[y]);return this.runningContexts.pop(),u}useFunctionContext(d){const u=L(this.functionContexts);this.runningContexts.push(u),d(),this.runningContexts.pop()}getIdentifiers(d){const u=this.trackedIdentifiers=[];return this.pushState(A_trackIdentifiers),d(),this.trackedIdentifiers=null,this.popState(A_trackIdentifiers),u}getDeclaration(d){const{currentContext:u,currentFunctionContext:l,runningContexts:y}=this,E=u[d]||l[d]||null;if(!E&&u===l&&y.length>0){const N=y[y.length-2];if(N[d])return N[d]}return E}scan(d){if(d){if(Array.isArray(d)){for(let u=0;u<d.length;u++)this.scan(d[u]);return}switch(d.type){case"Program":this.useFunctionContext(()=>{this.scan(d.body)});break;case"BlockStatement":this.newContext(()=>{this.scan(d.body)});break;case"AssignmentExpression":case"LogicalExpression":case"BinaryExpression":this.scan(d.left),this.scan(d.right);break;case"UpdateExpression":if("++"===d.operator){const u=this.getDeclaration(d.argument.name);u&&(u.suggestedType="Integer")}this.scan(d.argument);break;case"UnaryExpression":this.scan(d.argument);break;case"VariableDeclaration":"var"===d.kind?this.useFunctionContext(()=>{d.declarations=F.normalizeDeclarations(d),this.scan(d.declarations)}):(d.declarations=F.normalizeDeclarations(d),this.scan(d.declarations));break;case"VariableDeclarator":{const{currentContext:u}=this,l=this.hasState(A_inForLoopInit),y={ast:d,context:u,name:d.id.name,origin:"declaration",inForLoopInit:l,inForLoopTest:null,assignable:u===this.currentFunctionContext||!l&&!u.hasOwnProperty(d.id.name),suggestedType:null,valueType:null,dependencies:null,isSafe:null};u[d.id.name]||(u[d.id.name]=y),this.declarations.push(y),this.scan(d.id),this.scan(d.init);break}case"FunctionExpression":case"FunctionDeclaration":0===this.runningContexts.length?this.scan(d.body):this.functions.push(d);break;case"IfStatement":this.scan(d.test),this.scan(d.consequent),d.alternate&&this.scan(d.alternate);break;case"ForStatement":{let u;const l=this.newContext(()=>{this.pushState(A_inForLoopInit),this.scan(d.init),this.popState(A_inForLoopInit),u=this.getIdentifiers(()=>{this.scan(d.test)}),this.scan(d.update),this.newContext(()=>{this.scan(d.body)})});if(u)for(const y in l)"@contextType"!==y&&u.indexOf(y)>-1&&(l[y].inForLoopTest=!0);break}case"DoWhileStatement":case"WhileStatement":this.newContext(()=>{this.scan(d.body),this.scan(d.test)});break;case"Identifier":this.isState(A_trackIdentifiers)&&this.trackedIdentifiers.push(d.name),this.identifiers.push({context:this.currentContext,declaration:this.getDeclaration(d.name),ast:d});break;case"ReturnStatement":this.returnStatements.push(d),this.scan(d.argument);break;case"MemberExpression":this.pushState(A_memberExpression),this.scan(d.object),this.scan(d.property),this.popState(A_memberExpression);break;case"ExpressionStatement":this.scan(d.expression);break;case"SequenceExpression":this.scan(d.expressions);break;case"CallExpression":this.functionCalls.push({context:this.currentContext,ast:d}),this.scan(d.arguments);break;case"ArrayExpression":this.scan(d.elements);break;case"ConditionalExpression":this.scan(d.test),this.scan(d.alternate),this.scan(d.consequent);break;case"SwitchStatement":this.scan(d.discriminant),this.scan(d.cases);break;case"SwitchCase":this.scan(d.test),this.scan(d.consequent);break;case"ThisExpression":case"Literal":case"DebuggerStatement":case"EmptyStatement":case"BreakStatement":case"ContinueStatement":break;default:throw new Error(`unhandled type "${d.type}"`)}}}}}},{"../utils":114}],12:[function(T,B,q){const{glWiretap:F}=T("gl-wiretap"),{utils:L}=T("../../utils");function A(y){return y.toString().replace("=>","").replace(/^function /,"").replace(/utils[.]/g,"/*utils.*/")}function h(y,E){const N="single"===E.precision?y:`new Float32Array(${y}.buffer)`;return E.output[2]?`renderOutput(${N}, ${E.output[0]}, ${E.output[1]}, ${E.output[2]})`:E.output[1]?`renderOutput(${N}, ${E.output[0]}, ${E.output[1]})`:`renderOutput(${N}, ${E.output[0]})`}function u(y,E,N){const w=y.toArray.toString(),R=!/^function/.test(w);return`() => {\n  function framebuffer() { return ${N}; };\n  ${L.flattenFunctionToString(`${R?"function ":""}${w}`,{findDependency:(b,S)=>{if("utils"===b)return`const ${S} = ${L[S].toString()};`;if("this"===b)return"framebuffer"===S?"":`${R?"function ":""}${y[S].toString()}`;throw new Error("unhandled fromObject")},thisLookup:(b,S)=>{if("texture"===b)return E;if("context"===b)return S?null:"gl";if(y.hasOwnProperty(b))return JSON.stringify(y[b]);throw new Error(`unhandled thisLookup ${b}`)}})}\n  return toArray();\n  }`}function l(y,E,N,w,R){if(null===y||null===E)return null;switch(typeof y){case"boolean":case"number":return null}if("undefined"!=typeof HTMLImageElement&&y instanceof HTMLImageElement)for(let M=0;M<E.length;M++){const b=E[M];if("HTMLImageArray"!==b.type&&b||b.uploadValue!==y)continue;const S=N[M].indexOf(y);if(-1===S)continue;const I=`uploadValue_${b.name}[${S}]`;return w.insertVariable(I,y),I}for(let M=0;M<E.length;M++){const b=E[M];if(y!==b.uploadValue)continue;const S=`uploadValue_${b.name}`;return w.insertVariable(S,b),S}return null}B.exports={glKernelString:function x(y,E,N,w,R){N.built||N.build.apply(N,E),E=E?Array.from(E).map(we=>{switch(typeof we){case"boolean":return new Boolean(we);case"number":return new Number(we);default:return we}}):null;const b=[],S=F(N.context,{useTrackablePrimitives:!0,onReadPixels:we=>{if(ve.subKernels){if(I){const Ge=ve.subKernels[U++].property;b.push(`    result${isNaN(Ge)?"."+Ge:`[${Ge}]`} = ${h(we,ve)};`)}else b.push(`    const result = { result: ${h(we,ve)} };`),I=!0;U===ve.subKernels.length&&b.push("    return result;")}else b.push(we?`    return ${h(we,ve)};`:"    return null;")},onUnrecognizedArgumentLookup:we=>l(we,ve.kernelArguments,[],S)||l(we,ve.kernelConstants,G?Object.keys(G).map(rt=>G[rt]):[],S)||null});let I=!1,U=0;const{source:W,canvas:v,output:g,pipeline:O,graphical:$,loopMaxIterations:ee,constants:G,optimizeFloatMemory:j,precision:ie,fixIntegerDivisionAccuracy:X,functions:ge,nativeFunctions:fe,subKernels:re,immutable:pe,argumentTypes:_e,constantTypes:ye,kernelConstants:he,tactic:Ue}=N,ve=new y(W,{canvas:v,context:S,checkContext:!1,output:g,pipeline:O,graphical:$,loopMaxIterations:ee,constants:G,optimizeFloatMemory:j,precision:ie,fixIntegerDivisionAccuracy:X,functions:ge,nativeFunctions:fe,subKernels:re,immutable:pe,argumentTypes:_e,constantTypes:ye,tactic:Ue});let De=[];if(S.setIndent(2),ve.build.apply(ve,E),De.push(S.toString()),S.reset(),ve.kernelArguments.forEach((we,Ge)=>{switch(we.type){case"Integer":case"Boolean":case"Number":case"Float":case"Array":case"Array(2)":case"Array(3)":case"Array(4)":case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":case"Input":S.insertVariable(`uploadValue_${we.name}`,we.uploadValue);break;case"HTMLImageArray":for(let nt=0;nt<E[Ge].length;nt++)S.insertVariable(`uploadValue_${we.name}[${nt}]`,E[Ge][nt]);break;case"MemoryOptimizedNumberTexture":case"NumberTexture":case"Array1D(2)":case"Array1D(3)":case"Array1D(4)":case"Array2D(2)":case"Array2D(3)":case"Array2D(4)":case"Array3D(2)":case"Array3D(3)":case"Array3D(4)":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":S.insertVariable(`uploadValue_${we.name}`,E[Ge].texture);break;default:throw new Error(`unhandled kernelArgumentType insertion for glWiretap of type ${we.type}`)}}),De.push("/** start of injected functions **/"),De.push(`function ${A(L.flattenTo)}`),De.push(`function ${A(L.flatten2dArrayTo)}`),De.push(`function ${A(L.flatten3dArrayTo)}`),De.push(`function ${A(L.flatten4dArrayTo)}`),De.push(`function ${A(L.isArray)}`),ve.renderOutput!==ve.renderTexture&&ve.formatValues&&De.push(`  const renderOutput = function ${A(ve.formatValues)};`),De.push("/** end of injected functions **/"),De.push(`  const innerKernel = function (${ve.kernelArguments.map(we=>we.varName).join(", ")}) {`),S.setIndent(4),ve.run.apply(ve,E),ve.renderKernels?ve.renderKernels():ve.renderOutput&&ve.renderOutput(),De.push("    /** start setup uploads for kernel values **/"),ve.kernelArguments.forEach(we=>{De.push("    "+we.getStringValueHandler().split("\n").join("\n    "))}),De.push("    /** end setup uploads for kernel values **/"),De.push(S.toString()),ve.renderOutput===ve.renderTexture){S.reset();const we=S.getContextVariableName(ve.framebuffer);if(ve.renderKernels){const Ge=ve.renderKernels(),nt=S.getContextVariableName(ve.texture.texture);De.push(`    return {\n      result: {\n        texture: ${nt},\n        type: '${Ge.result.type}',\n        toArray: ${u(Ge.result,nt,we)}\n      },`);const{subKernels:rt,mappedTextures:Ee}=ve;for(let $e=0;$e<rt.length;$e++){const Tt=rt[$e],on=Ge[Tt.property],ur=S.getContextVariableName(Ee[$e].texture);De.push(`\n      ${Tt.property}: {\n        texture: ${ur},\n        type: '${on.type}',\n        toArray: ${u(on,ur,we)}\n      },`)}De.push("    };")}else{const Ge=ve.renderOutput(),nt=S.getContextVariableName(ve.texture.texture);De.push(`    return {\n        texture: ${nt},\n        type: '${Ge.type}',\n        toArray: ${u(Ge,nt,we)}\n      };`)}}De.push("    "+(R?"\n"+R+"    ":"")),De.push(b.join("\n")),De.push("  };"),ve.graphical&&(De.push(function d(y){const E=y.getPixels.toString(),N=!/^function/.test(E);return L.flattenFunctionToString(`${N?"function ":""}${E}`,{findDependency:(w,R)=>"utils"===w?`const ${R} = ${L[R].toString()};`:null,thisLookup:w=>{if("context"===w)return null;if(y.hasOwnProperty(w))return JSON.stringify(y[w]);throw new Error(`unhandled thisLookup ${w}`)}})}(ve)),De.push("  innerKernel.getPixels = getPixels;")),De.push("  return innerKernel;");let Pt=[];return he.forEach(we=>{Pt.push(`${we.getStringValueHandler()}`)}),`function kernel(settings) {\n  const { context, constants } = settings;\n  ${Pt.join("")}\n  ${w||""}\n${De.join("\n")}\n}`}}},{"../../utils":114,"gl-wiretap":3}],13:[function(T,B,q){const{Kernel:F}=T("../kernel"),{utils:L}=T("../../utils"),{GLTextureArray2Float:A}=T("./texture/array-2-float"),{GLTextureArray2Float2D:x}=T("./texture/array-2-float-2d"),{GLTextureArray2Float3D:h}=T("./texture/array-2-float-3d"),{GLTextureArray3Float:d}=T("./texture/array-3-float"),{GLTextureArray3Float2D:u}=T("./texture/array-3-float-2d"),{GLTextureArray3Float3D:l}=T("./texture/array-3-float-3d"),{GLTextureArray4Float:y}=T("./texture/array-4-float"),{GLTextureArray4Float2D:E}=T("./texture/array-4-float-2d"),{GLTextureArray4Float3D:N}=T("./texture/array-4-float-3d"),{GLTextureFloat:w}=T("./texture/float"),{GLTextureFloat2D:R}=T("./texture/float-2d"),{GLTextureFloat3D:M}=T("./texture/float-3d"),{GLTextureMemoryOptimized:b}=T("./texture/memory-optimized"),{GLTextureMemoryOptimized2D:S}=T("./texture/memory-optimized-2d"),{GLTextureMemoryOptimized3D:I}=T("./texture/memory-optimized-3d"),{GLTextureUnsigned:U}=T("./texture/unsigned"),{GLTextureUnsigned2D:W}=T("./texture/unsigned-2d"),{GLTextureUnsigned3D:v}=T("./texture/unsigned-3d"),{GLTextureGraphical:g}=T("./texture/graphical");const $={int:"Integer",float:"Number",vec2:"Array(2)",vec3:"Array(3)",vec4:"Array(4)"};B.exports={GLKernel:class O extends F{static get mode(){return"gpu"}static getIsFloatRead(){const j=new this("function kernelFunction() {\n      return 1;\n    }",{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[1],precision:"single",returnType:"Number",tactic:"speed"});j.build(),j.run();const ie=j.renderOutput();return j.destroy(!0),1===ie[0]}static getIsIntegerDivisionAccurate(){const j=new this(function G(ge,fe){return ge[this.thread.x]/fe[this.thread.x]}.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[2],returnType:"Number",precision:"unsigned",tactic:"speed"}),ie=[[6,6030401],[3,3991]];j.build.apply(j,ie),j.run.apply(j,ie);const X=j.renderOutput();return j.destroy(!0),2===X[0]&&1511===X[1]}static getIsSpeedTacticSupported(){const j=new this(function G(ge){return ge[this.thread.x]}.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[4],returnType:"Number",precision:"unsigned",tactic:"speed"}),ie=[[0,1,2,3]];j.build.apply(j,ie),j.run.apply(j,ie);const X=j.renderOutput();return j.destroy(!0),0===Math.round(X[0])&&1===Math.round(X[1])&&2===Math.round(X[2])&&3===Math.round(X[3])}static get testCanvas(){throw new Error(`"testCanvas" not defined on ${this.name}`)}static get testContext(){throw new Error(`"testContext" not defined on ${this.name}`)}static getFeatures(){const G=this.testContext,j=this.getIsDrawBuffers();return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),isTextureFloat:this.getIsTextureFloat(),isDrawBuffers:j,kernelMap:j,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.LOW_INT),lowFloatPrecision:G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.LOW_FLOAT),mediumIntPrecision:G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.MEDIUM_INT),mediumFloatPrecision:G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.MEDIUM_FLOAT),highIntPrecision:G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.HIGH_INT),highFloatPrecision:G.getShaderPrecisionFormat(G.FRAGMENT_SHADER,G.HIGH_FLOAT)})}static setupFeatureChecks(){throw new Error(`"setupFeatureChecks" not defined on ${this.name}`)}static getSignature(G,j){return G.getVariablePrecisionString()+(j.length>0?":"+j.join(","):"")}setFixIntegerDivisionAccuracy(G){return this.fixIntegerDivisionAccuracy=G,this}setPrecision(G){return this.precision=G,this}setFloatTextures(G){return L.warnDeprecated("method","setFloatTextures","setOptimizeFloatMemory"),this.floatTextures=G,this}static nativeFunctionArguments(G){const j=[],ie=[],X=[],ge=/^[a-zA-Z_]/,fe=/[a-zA-Z_0-9]/;let re=0,pe=null,_e=null;for(;re<G.length;){const ye=G[re],le=G[re+1],he=X.length>0?X[X.length-1]:null;if("FUNCTION_ARGUMENTS"!==he||"/"!==ye||"*"!==le)if("MULTI_LINE_COMMENT"!==he||"*"!==ye||"/"!==le)if("FUNCTION_ARGUMENTS"!==he||"/"!==ye||"/"!==le)if("COMMENT"!==he||"\n"!==ye)if(null!==he||"("!==ye){if("FUNCTION_ARGUMENTS"===he){if(")"===ye){X.pop();break}if("f"===ye&&"l"===le&&"o"===G[re+2]&&"a"===G[re+3]&&"t"===G[re+4]&&" "===G[re+5]){X.push("DECLARE_VARIABLE"),_e="float",pe="",re+=6;continue}if("i"===ye&&"n"===le&&"t"===G[re+2]&&" "===G[re+3]){X.push("DECLARE_VARIABLE"),_e="int",pe="",re+=4;continue}if("v"===ye&&"e"===le&&"c"===G[re+2]&&"2"===G[re+3]&&" "===G[re+4]){X.push("DECLARE_VARIABLE"),_e="vec2",pe="",re+=5;continue}if("v"===ye&&"e"===le&&"c"===G[re+2]&&"3"===G[re+3]&&" "===G[re+4]){X.push("DECLARE_VARIABLE"),_e="vec3",pe="",re+=5;continue}if("v"===ye&&"e"===le&&"c"===G[re+2]&&"4"===G[re+3]&&" "===G[re+4]){X.push("DECLARE_VARIABLE"),_e="vec4",pe="",re+=5;continue}}else if("DECLARE_VARIABLE"===he){if(""===pe){if(" "===ye){re++;continue}if(!ge.test(ye))throw new Error("variable name is not expected string")}pe+=ye,fe.test(le)||(X.pop(),ie.push(pe),j.push($[_e]))}re++}else X.push("FUNCTION_ARGUMENTS"),re++;else X.pop(),re++;else X.push("COMMENT"),re+=2;else X.pop(),re+=2;else X.push("MULTI_LINE_COMMENT"),re+=2}if(X.length>0)throw new Error("GLSL function was not parsable");return{argumentNames:ie,argumentTypes:j}}static nativeFunctionReturnType(G){return $[G.match(/int|float|vec[2-4]/)[0]]}static combineKernels(G,j){G.apply(null,arguments);const{texSize:ie,context:X,threadDim:ge}=j.texSize;let fe;if("single"===j.precision){const re=ie[0],pe=Math.ceil(ie[1]/4);fe=new Float32Array(re*pe*4*4),X.readPixels(0,0,re,4*pe,X.RGBA,X.FLOAT,fe)}else{const re=new Uint8Array(ie[0]*ie[1]*4);X.readPixels(0,0,ie[0],ie[1],X.RGBA,X.UNSIGNED_BYTE,re),fe=new Float32Array(re.buffer)}return fe=fe.subarray(0,ge[0]*ge[1]*ge[2]),1===j.output.length?fe:2===j.output.length?L.splitArray(fe,j.output[0]):3===j.output.length?L.splitArray(fe,j.output[0]*j.output[1]).map(function(pe){return L.splitArray(pe,j.output[0])}):void 0}constructor(G,j){super(G,j),this.transferValues=null,this.formatValues=null,this.TextureConstructor=null,this.renderOutput=null,this.renderRawOutput=null,this.texSize=null,this.translatedSource=null,this.compiledFragmentShader=null,this.compiledVertexShader=null,this.switchingKernels=null,this._textureSwitched=null,this._mappedTextureSwitched=null}checkTextureSize(){const{features:G}=this.constructor;if(this.texSize[0]>G.maxTextureSize||this.texSize[1]>G.maxTextureSize)throw new Error(`Texture size [${this.texSize[0]},${this.texSize[1]}] generated by kernel is larger than supported size [${G.maxTextureSize},${G.maxTextureSize}]`)}translateSource(){throw new Error(`"translateSource" not defined on ${this.constructor.name}`)}pickRenderStrategy(G){if(this.graphical)return this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=j=>j,this.TextureConstructor=g,null;if("unsigned"===this.precision)if(this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=this.readPackedPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,null!==this.subKernels&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=v,null):this.output[1]>0?(this.TextureConstructor=W,null):(this.TextureConstructor=U,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(G)}else switch(null!==this.subKernels&&(this.renderKernels=this.renderKernelsToArrays),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.renderOutput=this.renderValues,this.output[2]>0?(this.TextureConstructor=v,this.formatValues=L.erect3DPackedFloat,null):this.output[1]>0?(this.TextureConstructor=W,this.formatValues=L.erect2DPackedFloat,null):(this.TextureConstructor=U,this.formatValues=L.erectPackedFloat,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(G)}else{if("single"!==this.precision)throw new Error(`unhandled precision of "${this.precision}"`);if(this.renderRawOutput=this.readFloatPixelsToFloat32Array,this.transferValues=this.readFloatPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,null!==this.subKernels&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.optimizeFloatMemory?this.output[2]>0?(this.TextureConstructor=I,null):this.output[1]>0?(this.TextureConstructor=S,null):(this.TextureConstructor=b,null):this.output[2]>0?(this.TextureConstructor=M,null):this.output[1]>0?(this.TextureConstructor=R,null):(this.TextureConstructor=w,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=h,null):this.output[1]>0?(this.TextureConstructor=x,null):(this.TextureConstructor=A,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=l,null):this.output[1]>0?(this.TextureConstructor=u,null):(this.TextureConstructor=d,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=N,null):this.output[1]>0?(this.TextureConstructor=E,null):(this.TextureConstructor=y,null)}if(this.renderOutput=this.renderValues,null!==this.subKernels&&(this.renderKernels=this.renderKernelsToArrays),this.optimizeFloatMemory)switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=I,this.formatValues=L.erectMemoryOptimized3DFloat,null):this.output[1]>0?(this.TextureConstructor=S,this.formatValues=L.erectMemoryOptimized2DFloat,null):(this.TextureConstructor=b,this.formatValues=L.erectMemoryOptimizedFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=h,this.formatValues=L.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=x,this.formatValues=L.erect2DArray2,null):(this.TextureConstructor=A,this.formatValues=L.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=l,this.formatValues=L.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=u,this.formatValues=L.erect2DArray3,null):(this.TextureConstructor=d,this.formatValues=L.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=N,this.formatValues=L.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=E,this.formatValues=L.erect2DArray4,null):(this.TextureConstructor=y,this.formatValues=L.erectArray4,null)}else switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=M,this.formatValues=L.erect3DFloat,null):this.output[1]>0?(this.TextureConstructor=R,this.formatValues=L.erect2DFloat,null):(this.TextureConstructor=w,this.formatValues=L.erectFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=h,this.formatValues=L.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=x,this.formatValues=L.erect2DArray2,null):(this.TextureConstructor=A,this.formatValues=L.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=l,this.formatValues=L.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=u,this.formatValues=L.erect2DArray3,null):(this.TextureConstructor=d,this.formatValues=L.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=N,this.formatValues=L.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=E,this.formatValues=L.erect2DArray4,null):(this.TextureConstructor=y,this.formatValues=L.erectArray4,null)}}throw new Error(`unhandled return type "${this.returnType}"`)}getKernelString(){throw new Error("abstract method call")}getMainResultTexture(){switch(this.returnType){case"LiteralInteger":case"Float":case"Integer":case"Number":return this.getMainResultNumberTexture();case"Array(2)":return this.getMainResultArray2Texture();case"Array(3)":return this.getMainResultArray3Texture();case"Array(4)":return this.getMainResultArray4Texture();default:throw new Error(`unhandled returnType type ${this.returnType}`)}}getMainResultKernelNumberTexture(){throw new Error("abstract method call")}getMainResultSubKernelNumberTexture(){throw new Error("abstract method call")}getMainResultKernelArray2Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray2Texture(){throw new Error("abstract method call")}getMainResultKernelArray3Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray3Texture(){throw new Error("abstract method call")}getMainResultKernelArray4Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray4Texture(){throw new Error("abstract method call")}getMainResultGraphical(){throw new Error("abstract method call")}getMainResultMemoryOptimizedFloats(){throw new Error("abstract method call")}getMainResultPackedPixels(){throw new Error("abstract method call")}getMainResultString(){return this.graphical?this.getMainResultGraphical():"single"===this.precision?this.optimizeFloatMemory?this.getMainResultMemoryOptimizedFloats():this.getMainResultTexture():this.getMainResultPackedPixels()}getMainResultNumberTexture(){return L.linesToString(this.getMainResultKernelNumberTexture())+L.linesToString(this.getMainResultSubKernelNumberTexture())}getMainResultArray2Texture(){return L.linesToString(this.getMainResultKernelArray2Texture())+L.linesToString(this.getMainResultSubKernelArray2Texture())}getMainResultArray3Texture(){return L.linesToString(this.getMainResultKernelArray3Texture())+L.linesToString(this.getMainResultSubKernelArray3Texture())}getMainResultArray4Texture(){return L.linesToString(this.getMainResultKernelArray4Texture())+L.linesToString(this.getMainResultSubKernelArray4Texture())}getFloatTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} float;\n`}getIntTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic,!0)} int;\n`}getSampler2DTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2D;\n`}getSampler2DArrayTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2DArray;\n`}renderTexture(){return this.immutable?this.texture.clone():this.texture}readPackedPixelsToUint8Array(){if("unsigned"!==this.precision)throw new Error('Requires this.precision to be "unsigned"');const{texSize:G,context:j}=this,ie=new Uint8Array(G[0]*G[1]*4);return j.readPixels(0,0,G[0],G[1],j.RGBA,j.UNSIGNED_BYTE,ie),ie}readPackedPixelsToFloat32Array(){return new Float32Array(this.readPackedPixelsToUint8Array().buffer)}readFloatPixelsToFloat32Array(){if("single"!==this.precision)throw new Error('Requires this.precision to be "single"');const{texSize:G,context:j}=this,ie=G[0],X=G[1],ge=new Float32Array(ie*X*4);return j.readPixels(0,0,ie,X,j.RGBA,j.FLOAT,ge),ge}getPixels(G){const{context:j,output:ie}=this,[X,ge]=ie,fe=new Uint8Array(X*ge*4);return j.readPixels(0,0,X,ge,j.RGBA,j.UNSIGNED_BYTE,fe),new Uint8ClampedArray((G?fe:L.flipPixels(fe,X,ge)).buffer)}renderKernelsToArrays(){const G={result:this.renderOutput()};for(let j=0;j<this.subKernels.length;j++)G[this.subKernels[j].property]=this.mappedTextures[j].toArray();return G}renderKernelsToTextures(){const G={result:this.renderOutput()};if(this.immutable)for(let j=0;j<this.subKernels.length;j++)G[this.subKernels[j].property]=this.mappedTextures[j].clone();else for(let j=0;j<this.subKernels.length;j++)G[this.subKernels[j].property]=this.mappedTextures[j];return G}resetSwitchingKernels(){const G=this.switchingKernels;return this.switchingKernels=null,G}setOutput(G){const j=this.toKernelOutput(G);if(this.program){if(!this.dynamicOutput)throw new Error("Resizing a kernel with dynamicOutput: false is not possible");const ie=[j[0],j[1]||1,j[2]||1],X=L.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},ie),ge=this.texSize;if(ge){const re=this.getVariablePrecisionString(ge,this.tactic),pe=this.getVariablePrecisionString(X,this.tactic);if(re!==pe)return this.debug&&console.warn("Precision requirement changed, asking GPU instance to recompile"),void this.switchKernels({type:"outputPrecisionMismatch",precision:pe,needed:G})}this.output=j,this.threadDim=ie,this.texSize=X;const{context:fe}=this;if(fe.bindFramebuffer(fe.FRAMEBUFFER,this.framebuffer),this.updateMaxTexSize(),this.framebuffer.width=this.texSize[0],this.framebuffer.height=this.texSize[1],fe.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),this.canvas.width=this.maxTexSize[0],this.canvas.height=this.maxTexSize[1],this.texture&&this.texture.delete(),this.texture=null,this._setupOutputTexture(),this.mappedTextures&&this.mappedTextures.length>0){for(let re=0;re<this.mappedTextures.length;re++)this.mappedTextures[re].delete();this.mappedTextures=null,this._setupSubOutputTextures()}}else this.output=j;return this}renderValues(){return this.formatValues(this.transferValues(),this.output[0],this.output[1],this.output[2])}switchKernels(G){this.switchingKernels?this.switchingKernels.push(G):this.switchingKernels=[G]}getVariablePrecisionString(G=this.texSize,j=this.tactic,ie=!1){if(!j){if(!this.constructor.features.isSpeedTacticSupported)return"highp";const X=this.constructor.features[ie?"lowIntPrecision":"lowFloatPrecision"],ge=this.constructor.features[ie?"mediumIntPrecision":"mediumFloatPrecision"],fe=this.constructor.features[ie?"highIntPrecision":"highFloatPrecision"],re=Math.log2(G[0]*G[1]);if(re<=X.rangeMax)return"lowp";if(re<=ge.rangeMax)return"mediump";if(re<=fe.rangeMax)return"highp";throw new Error("The required size exceeds that of the ability of your system")}switch(j){case"speed":return"lowp";case"balanced":return"mediump";case"precision":return"highp";default:throw new Error(`Unknown tactic "${j}" use "speed", "balanced", "precision", or empty for auto`)}}updateTextureArgumentRefs(G,j){if(this.immutable)if(this.texture.texture===j.texture){const{prevArg:ie}=G;ie&&(1===ie.texture._refs&&(this.texture.delete(),this.texture=ie.clone(),this._textureSwitched=!0),ie.delete()),G.prevArg=j.clone()}else if(this.mappedTextures&&this.mappedTextures.length>0){const{mappedTextures:ie}=this;for(let X=0;X<ie.length;X++){const ge=ie[X];if(ge.texture===j.texture){const{prevArg:fe}=G;return fe&&(1===fe.texture._refs&&(ge.delete(),ie[X]=fe.clone(),this._mappedTextureSwitched[X]=!0),fe.delete()),void(G.prevArg=j.clone())}}}}onActivate(G){if(this._textureSwitched=!0,this.texture=G.texture,this.mappedTextures){for(let j=0;j<this.mappedTextures.length;j++)this._mappedTextureSwitched[j]=!0;this.mappedTextures=G.mappedTextures}}initCanvas(){}}}},{"../../utils":114,"../kernel":36,"./texture/array-2-float":16,"./texture/array-2-float-2d":14,"./texture/array-2-float-3d":15,"./texture/array-3-float":19,"./texture/array-3-float-2d":17,"./texture/array-3-float-3d":18,"./texture/array-4-float":22,"./texture/array-4-float-2d":20,"./texture/array-4-float-3d":21,"./texture/float":25,"./texture/float-2d":23,"./texture/float-3d":24,"./texture/graphical":26,"./texture/memory-optimized":30,"./texture/memory-optimized-2d":28,"./texture/memory-optimized-3d":29,"./texture/unsigned":33,"./texture/unsigned-2d":31,"./texture/unsigned-3d":32}],14:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureArray2Float2D:class A extends L{constructor(h){super(h),this.type="ArrayTexture(2)"}toArray(){return F.erect2DArray2(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],15:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureArray2Float3D:class A extends L{constructor(h){super(h),this.type="ArrayTexture(2)"}toArray(){return F.erect3DArray2(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],16:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureArray2Float:class A extends L{constructor(h){super(h),this.type="ArrayTexture(2)"}toArray(){return F.erectArray2(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],17:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureArray3Float2D:class A extends L{constructor(h){super(h),this.type="ArrayTexture(3)"}toArray(){return F.erect2DArray3(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],18:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureArray3Float3D:class A extends L{constructor(h){super(h),this.type="ArrayTexture(3)"}toArray(){return F.erect3DArray3(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],19:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureArray3Float:class A extends L{constructor(h){super(h),this.type="ArrayTexture(3)"}toArray(){return F.erectArray3(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./float":25}],20:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureArray4Float2D:class A extends L{constructor(h){super(h),this.type="ArrayTexture(4)"}toArray(){return F.erect2DArray4(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],21:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureArray4Float3D:class A extends L{constructor(h){super(h),this.type="ArrayTexture(4)"}toArray(){return F.erect3DArray4(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],22:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureArray4Float:class A extends L{constructor(h){super(h),this.type="ArrayTexture(4)"}toArray(){return F.erectArray4(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./float":25}],23:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureFloat2D:class A extends L{constructor(h){super(h),this.type="ArrayTexture(1)"}toArray(){return F.erect2DFloat(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],24:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureFloat3D:class A extends L{constructor(h){super(h),this.type="ArrayTexture(1)"}toArray(){return F.erect3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],25:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTexture:L}=T("./index");B.exports={GLTextureFloat:class A extends L{get textureType(){return this.context.FLOAT}constructor(h){super(h),this.type="ArrayTexture(1)"}renderRawOutput(){const h=this.context,d=this.size;h.bindFramebuffer(h.FRAMEBUFFER,this.framebuffer()),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,this.texture,0);const u=new Float32Array(d[0]*d[1]*4);return h.readPixels(0,0,d[0],d[1],h.RGBA,h.FLOAT,u),u}renderValues(){return this._deleted?null:this.renderRawOutput()}toArray(){return F.erectFloat(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./index":27}],26:[function(T,B,q){const{GLTextureUnsigned:F}=T("./unsigned");B.exports={GLTextureGraphical:class L extends F{constructor(x){super(x),this.type="ArrayTexture(4)"}toArray(){return this.renderValues()}}}},{"./unsigned":33}],27:[function(T,B,q){const{Texture:F}=T("../../../texture");function A(x,h){x.activeTexture(x.TEXTURE15),x.bindTexture(x.TEXTURE_2D,h),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST)}B.exports={GLTexture:class L extends F{get textureType(){throw new Error(`"textureType" not implemented on ${this.name}`)}clone(){return new this.constructor(this)}beforeMutate(){return this.texture._refs>1&&(this.newTexture(),!0)}cloneTexture(){this.texture._refs--;const{context:h,size:d,texture:u,kernel:l}=this;l.debug&&console.warn("cloning internal texture"),h.bindFramebuffer(h.FRAMEBUFFER,this.framebuffer()),A(h,u),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,u,0);const y=h.createTexture();A(h,y),h.texImage2D(h.TEXTURE_2D,0,this.internalFormat,d[0],d[1],0,this.textureFormat,this.textureType,null),h.copyTexSubImage2D(h.TEXTURE_2D,0,0,0,0,0,d[0],d[1]),y._refs=1,this.texture=y}newTexture(){this.texture._refs--;const h=this.context,d=this.size;this.kernel.debug&&console.warn("new internal texture");const l=h.createTexture();A(h,l),h.texImage2D(h.TEXTURE_2D,0,this.internalFormat,d[0],d[1],0,this.textureFormat,this.textureType,null),l._refs=1,this.texture=l}clear(){if(this.texture._refs){this.texture._refs--;const u=this.context,l=this.texture=u.createTexture();A(u,l);const y=this.size;l._refs=1,u.texImage2D(u.TEXTURE_2D,0,this.internalFormat,y[0],y[1],0,this.textureFormat,this.textureType,null)}const{context:h,texture:d}=this;h.bindFramebuffer(h.FRAMEBUFFER,this.framebuffer()),h.bindTexture(h.TEXTURE_2D,d),A(h,d),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,d,0),h.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)}delete(){this._deleted||(this._deleted=!0,(!this.texture._refs||(this.texture._refs--,!this.texture._refs))&&this.context.deleteTexture(this.texture))}framebuffer(){return this._framebuffer||(this._framebuffer=this.kernel.getRawValueFramebuffer(this.size[0],this.size[1])),this._framebuffer}}}},{"../../../texture":113}],28:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureMemoryOptimized2D:class A extends L{constructor(h){super(h),this.type="MemoryOptimizedNumberTexture"}toArray(){return F.erectMemoryOptimized2DFloat(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./float":25}],29:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureMemoryOptimized3D:class A extends L{constructor(h){super(h),this.type="MemoryOptimizedNumberTexture"}toArray(){return F.erectMemoryOptimized3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./float":25}],30:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureFloat:L}=T("./float");B.exports={GLTextureMemoryOptimized:class A extends L{constructor(h){super(h),this.type="MemoryOptimizedNumberTexture"}toArray(){return F.erectMemoryOptimizedFloat(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./float":25}],31:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureUnsigned:L}=T("./unsigned");B.exports={GLTextureUnsigned2D:class A extends L{constructor(h){super(h),this.type="NumberTexture"}toArray(){return F.erect2DPackedFloat(this.renderValues(),this.output[0],this.output[1])}}}},{"../../../utils":114,"./unsigned":33}],32:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTextureUnsigned:L}=T("./unsigned");B.exports={GLTextureUnsigned3D:class A extends L{constructor(h){super(h),this.type="NumberTexture"}toArray(){return F.erect3DPackedFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}}},{"../../../utils":114,"./unsigned":33}],33:[function(T,B,q){const{utils:F}=T("../../../utils"),{GLTexture:L}=T("./index");B.exports={GLTextureUnsigned:class A extends L{get textureType(){return this.context.UNSIGNED_BYTE}constructor(h){super(h),this.type="NumberTexture"}renderRawOutput(){const{context:h}=this;h.bindFramebuffer(h.FRAMEBUFFER,this.framebuffer()),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,this.texture,0);const d=new Uint8Array(this.size[0]*this.size[1]*4);return h.readPixels(0,0,this.size[0],this.size[1],h.RGBA,h.UNSIGNED_BYTE,d),d}renderValues(){return this._deleted?null:new Float32Array(this.renderRawOutput().buffer)}toArray(){return F.erectPackedFloat(this.renderValues(),this.output[0])}}}},{"../../../utils":114,"./index":27}],34:[function(T,B,q){const F=T("gl"),{WebGLKernel:L}=T("../web-gl/kernel"),{glKernelString:A}=T("../gl/kernel-string");let x=null,h=null,d=null,u=null,l=null;B.exports={HeadlessGLKernel:class y extends L{static get isSupported(){return null!==x||(this.setupFeatureChecks(),x=null!==d),x}static setupFeatureChecks(){if(h=null,u=null,"function"==typeof F)try{if(d=F(2,2,{preserveDrawingBuffer:!0}),!d||!d.getExtension)return;u={STACKGL_resize_drawingbuffer:d.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:d.getExtension("STACKGL_destroy_context"),OES_texture_float:d.getExtension("OES_texture_float"),OES_texture_float_linear:d.getExtension("OES_texture_float_linear"),OES_element_index_uint:d.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:d.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:d.getExtension("WEBGL_color_buffer_float")},l=this.getFeatures()}catch(N){console.warn(N)}}static isContextMatch(N){try{return"ANGLE"===N.getParameter(N.RENDERER)}catch(w){return!1}}static getIsTextureFloat(){return Boolean(u.OES_texture_float)}static getIsDrawBuffers(){return Boolean(u.WEBGL_draw_buffers)}static getChannelCount(){return u.WEBGL_draw_buffers?d.getParameter(u.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return d.getParameter(d.MAX_TEXTURE_SIZE)}static get testCanvas(){return h}static get testContext(){return d}static get features(){return l}initCanvas(){return{}}initContext(){return F(2,2,{preserveDrawingBuffer:!0})}initExtensions(){this.extensions={STACKGL_resize_drawingbuffer:this.context.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:this.context.getExtension("STACKGL_destroy_context"),OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers")}}build(){super.build.apply(this,arguments),this.fallbackRequested||this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1])}destroyExtensions(){this.extensions.STACKGL_resize_drawingbuffer=null,this.extensions.STACKGL_destroy_context=null,this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext(N){const w=N.getExtension("STACKGL_destroy_context");w&&w.destroy&&w.destroy()}toString(){return A(this.constructor,arguments,this,"const gl = context || require('gl')(1, 1);\n","    if (!context) { gl.getExtension('STACKGL_destroy_context').destroy(); }\n")}setOutput(N){return super.setOutput(N),this.graphical&&this.extensions.STACKGL_resize_drawingbuffer&&this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1]),this}}}},{"../gl/kernel-string":12,"../web-gl/kernel":70,gl:2}],35:[function(T,B,q){B.exports={KernelValue:class F{constructor(A,x){const{name:h,kernel:d,context:u,checkContext:l,onRequestContextHandle:y,onUpdateValueMismatch:E,origin:N,strictIntegers:w,type:R,tactic:M}=x;if(!h)throw new Error("name not set");if(!R)throw new Error("type not set");if(!N)throw new Error("origin not set");if("user"!==N&&"constants"!==N)throw new Error(`origin must be "user" or "constants" value is "${N}"`);if(!y)throw new Error("onRequestContextHandle is not set");this.name=h,this.origin=N,this.tactic=M,this.varName="constants"===N?`constants.${h}`:h,this.kernel=d,this.strictIntegers=w,this.type=A.type||R,this.size=A.size||null,this.index=null,this.context=u,this.checkContext=null==l||l,this.contextHandle=null,this.onRequestContextHandle=y,this.onUpdateValueMismatch=E,this.forceUploadEachRun=null}get id(){return`${this.origin}_${name}`}getSource(){throw new Error(`"getSource" not defined on ${this.constructor.name}`)}updateValue(A){throw new Error(`"updateValue" not defined on ${this.constructor.name}`)}}}},{}],36:[function(T,B,q){const{utils:F}=T("../utils"),{Input:L}=T("../input");B.exports={Kernel:class A{static get isSupported(){throw new Error(`"isSupported" not implemented on ${this.name}`)}static isContextMatch(d){throw new Error(`"isContextMatch" not implemented on ${this.name}`)}static getFeatures(){throw new Error(`"getFeatures" not implemented on ${this.name}`)}static destroyContext(d){throw new Error(`"destroyContext" called on ${this.name}`)}static nativeFunctionArguments(){throw new Error(`"nativeFunctionArguments" called on ${this.name}`)}static nativeFunctionReturnType(){throw new Error(`"nativeFunctionReturnType" called on ${this.name}`)}static combineKernels(){throw new Error(`"combineKernels" called on ${this.name}`)}constructor(d,u){if("object"!=typeof d){if("string"!=typeof d)throw new Error("source not a string");if(!F.isFunctionString(d))throw new Error("source not a function string")}this.useLegacyEncoder=!1,this.fallbackRequested=!1,this.onRequestFallback=null,this.argumentNames="string"==typeof d?F.getArgumentNamesFromString(d):null,this.argumentTypes=null,this.argumentSizes=null,this.argumentBitRatios=null,this.kernelArguments=null,this.kernelConstants=null,this.forceUploadKernelConstants=null,this.source=d,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.constantTypes=null,this.constantBitRatios=null,this.dynamicArguments=!1,this.dynamicOutput=!1,this.canvas=null,this.context=null,this.checkContext=null,this.gpu=null,this.functions=null,this.nativeFunctions=null,this.injectedNative=null,this.subKernels=null,this.validate=!0,this.immutable=!1,this.pipeline=!1,this.precision=null,this.tactic=null,this.plugins=null,this.returnType=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.optimizeFloatMemory=null,this.strictIntegers=!1,this.fixIntegerDivisionAccuracy=null,this.built=!1,this.signature=null}mergeSettings(d){for(let u in d)if(d.hasOwnProperty(u)&&this.hasOwnProperty(u)){switch(u){case"output":if(!Array.isArray(d.output)){this.setOutput(d.output);continue}break;case"functions":this.functions=[];for(let l=0;l<d.functions.length;l++)this.addFunction(d.functions[l]);continue;case"graphical":d[u]&&!d.hasOwnProperty("precision")&&(this.precision="unsigned"),this[u]=d[u];continue;case"nativeFunctions":if(!d.nativeFunctions)continue;this.nativeFunctions=[];for(let l=0;l<d.nativeFunctions.length;l++){const y=d.nativeFunctions[l],{name:E,source:N}=y;this.addNativeFunction(E,N,y)}continue}this[u]=d[u]}this.canvas||(this.canvas=this.initCanvas()),this.context||(this.context=this.initContext()),this.plugins||(this.plugins=this.initPlugins(d))}build(){throw new Error(`"build" not defined on ${this.constructor.name}`)}run(){throw new Error(`"run" not defined on ${this.constructor.name}`)}initCanvas(){throw new Error(`"initCanvas" not defined on ${this.constructor.name}`)}initContext(){throw new Error(`"initContext" not defined on ${this.constructor.name}`)}initPlugins(d){throw new Error(`"initPlugins" not defined on ${this.constructor.name}`)}addFunction(d,u={}){if(d.name&&d.source&&d.argumentTypes&&"returnType"in d)this.functions.push(d);else if("settings"in d&&"source"in d)this.functions.push(this.functionToIGPUFunction(d.source,d.settings));else{if("string"!=typeof d&&"function"!=typeof d)throw new Error("function not properly defined");this.functions.push(this.functionToIGPUFunction(d,u))}return this}addNativeFunction(d,u,l={}){const{argumentTypes:y,argumentNames:E}=l.argumentTypes?function x(h){const d=Object.keys(h),u=[];for(let l=0;l<d.length;l++)u.push(h[d[l]]);return{argumentTypes:u,argumentNames:d}}(l.argumentTypes):this.constructor.nativeFunctionArguments(u)||{};return this.nativeFunctions.push({name:d,source:u,settings:l,argumentTypes:y,argumentNames:E,returnType:l.returnType||this.constructor.nativeFunctionReturnType(u)}),this}setupArguments(d){if(this.kernelArguments=[],this.argumentTypes)for(let u=0;u<this.argumentTypes.length;u++)this.kernelArguments.push({type:this.argumentTypes[u]});else if(!this.argumentTypes){this.argumentTypes=[];for(let u=0;u<d.length;u++){const l=F.getVariableType(d[u],this.strictIntegers),y="Integer"===l?"Number":l;this.argumentTypes.push(y),this.kernelArguments.push({type:y})}}this.argumentSizes=new Array(d.length),this.argumentBitRatios=new Int32Array(d.length);for(let u=0;u<d.length;u++){const l=d[u];this.argumentSizes[u]=l.constructor===L?l.size:null,this.argumentBitRatios[u]=this.getBitRatio(l)}if(this.argumentNames.length!==d.length)throw new Error("arguments are miss-aligned")}setupConstants(){this.kernelConstants=[];let d=null===this.constantTypes;if(d&&(this.constantTypes={}),this.constantBitRatios={},this.constants)for(let u in this.constants){if(d){const l=F.getVariableType(this.constants[u],this.strictIntegers);this.constantTypes[u]=l,this.kernelConstants.push({name:u,type:l})}else this.kernelConstants.push({name:u,type:this.constantTypes[u]});this.constantBitRatios[u]=this.getBitRatio(this.constants[u])}}setOptimizeFloatMemory(d){return this.optimizeFloatMemory=d,this}toKernelOutput(d){return d.hasOwnProperty("x")?d.hasOwnProperty("y")?d.hasOwnProperty("z")?[d.x,d.y,d.z]:[d.x,d.y]:[d.x]:d}setOutput(d){return this.output=this.toKernelOutput(d),this}setDebug(d){return this.debug=d,this}setGraphical(d){return this.graphical=d,this.precision="unsigned",this}setLoopMaxIterations(d){return this.loopMaxIterations=d,this}setConstants(d){return this.constants=d,this}setConstantTypes(d){return this.constantTypes=d,this}setFunctions(d){for(let u=0;u<d.length;u++)this.addFunction(d[u]);return this}setNativeFunctions(d){for(let u=0;u<d.length;u++){const l=d[u],{name:y,source:E}=l;this.addNativeFunction(y,E,l)}return this}setInjectedNative(d){return this.injectedNative=d,this}setPipeline(d){return this.pipeline=d,this}setPrecision(d){return this.precision=d,this}setDimensions(d){return F.warnDeprecated("method","setDimensions","setOutput"),this.output=d,this}setOutputToTexture(d){return F.warnDeprecated("method","setOutputToTexture","setPipeline"),this.pipeline=d,this}setImmutable(d){return this.immutable=d,this}setCanvas(d){return this.canvas=d,this}setStrictIntegers(d){return this.strictIntegers=d,this}setDynamicOutput(d){return this.dynamicOutput=d,this}setHardcodeConstants(d){return F.warnDeprecated("method","setHardcodeConstants"),this.setDynamicOutput(d),this.setDynamicArguments(d),this}setDynamicArguments(d){return this.dynamicArguments=d,this}setUseLegacyEncoder(d){return this.useLegacyEncoder=d,this}setWarnVarUsage(d){return F.warnDeprecated("method","setWarnVarUsage"),this}getCanvas(){return F.warnDeprecated("method","getCanvas"),this.canvas}getWebGl(){return F.warnDeprecated("method","getWebGl"),this.context}setContext(d){return this.context=d,this}setArgumentTypes(d){if(Array.isArray(d))this.argumentTypes=d;else{this.argumentTypes=[];for(const u in d){if(!d.hasOwnProperty(u))continue;const l=this.argumentNames.indexOf(u);if(-1===l)throw new Error(`unable to find argument ${u}`);this.argumentTypes[l]=d[u]}}return this}setTactic(d){return this.tactic=d,this}requestFallback(d){if(!this.onRequestFallback)throw new Error(`"onRequestFallback" not defined on ${this.constructor.name}`);return this.fallbackRequested=!0,this.onRequestFallback(d)}validateSettings(){throw new Error(`"validateSettings" not defined on ${this.constructor.name}`)}addSubKernel(d){if(null===this.subKernels&&(this.subKernels=[]),!d.source)throw new Error('subKernel missing "source" property');if(!d.property&&isNaN(d.property))throw new Error('subKernel missing "property" property');if(!d.name)throw new Error('subKernel missing "name" property');return this.subKernels.push(d),this}destroy(d){throw new Error(`"destroy" called on ${this.constructor.name}`)}getBitRatio(d){if("single"===this.precision)return 4;if(Array.isArray(d[0]))return this.getBitRatio(d[0]);if(d.constructor===L)return this.getBitRatio(d.value);switch(d.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}getPixels(d){throw new Error(`"getPixels" called on ${this.constructor.name}`)}checkOutput(){if(!this.output||!F.isArray(this.output))throw new Error("kernel.output not an array");if(this.output.length<1)throw new Error("kernel.output is empty, needs at least 1 value");for(let d=0;d<this.output.length;d++)if(isNaN(this.output[d])||this.output[d]<1)throw new Error(`${this.constructor.name}.output[${d}] incorrectly defined as \`${this.output[d]}\`, needs to be numeric, and greater than 0`)}prependString(d){throw new Error(`"prependString" called on ${this.constructor.name}`)}hasPrependString(d){throw new Error(`"hasPrependString" called on ${this.constructor.name}`)}toJSON(){return{settings:{output:this.output,pipeline:this.pipeline,argumentNames:this.argumentNames,argumentsTypes:this.argumentTypes,constants:this.constants,pluginNames:this.plugins?this.plugins.map(d=>d.name):null,returnType:this.returnType}}}buildSignature(d){const u=this.constructor;this.signature=u.getSignature(this,u.getArgumentTypes(this,d))}static getArgumentTypes(d,u){const l=new Array(u.length);for(let y=0;y<u.length;y++){const E=u[y],N=d.argumentTypes[y];if(E.type)l[y]=E.type;else switch(N){case"Number":case"Integer":case"Float":case"ArrayTexture(1)":l[y]=F.getVariableType(E);break;default:l[y]=N}}return l}static getSignature(d,u){throw new Error(`"getSignature" not implemented on ${this.name}`)}functionToIGPUFunction(d,u={}){if("string"!=typeof d&&"function"!=typeof d)throw new Error("source not a string or function");const l="string"==typeof d?d:d.toString();let y=[];return y=Array.isArray(u.argumentTypes)?u.argumentTypes:"object"==typeof u.argumentTypes?F.getArgumentNamesFromString(l).map(E=>u.argumentTypes[E])||[]:u.argumentTypes||[],{name:F.getFunctionNameFromString(l)||null,source:l,argumentTypes:y,returnType:u.returnType||null}}onActivate(d){}}}},{"../input":110,"../utils":114}],37:[function(T,B,q){const F=`__HEADER__;\n__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n\nconst int LOOP_MAX = __LOOP_MAX__;\n\n__PLUGINS__;\n__CONSTANTS__;\n\nvarying vec2 vTexCoord;\n\nfloat acosh(float x) {\n  return log(x + sqrt(x * x - 1.0));\n}\n\nfloat sinh(float x) {\n  return (pow(${Math.E}, x) - pow(${Math.E}, -x)) / 2.0;\n}\n\nfloat asinh(float x) {\n  return log(x + sqrt(x * x + 1.0));\n}\n\nfloat atan2(float v1, float v2) {\n  if (v1 == 0.0 || v2 == 0.0) return 0.0;\n  return atan(v1 / v2);\n}\n\nfloat atanh(float x) {\n  x = (x + 1.0) / (x - 1.0);\n  if (x < 0.0) {\n    return 0.5 * log(-x);\n  }\n  return 0.5 * log(x);\n}\n\nfloat cbrt(float x) {\n  if (x >= 0.0) {\n    return pow(x, 1.0 / 3.0);\n  } else {\n    return -pow(x, 1.0 / 3.0);\n  }\n}\n\nfloat cosh(float x) {\n  return (pow(${Math.E}, x) + pow(${Math.E}, -x)) / 2.0; \n}\n\nfloat expm1(float x) {\n  return pow(${Math.E}, x) - 1.0; \n}\n\nfloat fround(highp float x) {\n  return x;\n}\n\nfloat imul(float v1, float v2) {\n  return float(int(v1) * int(v2));\n}\n\nfloat log10(float x) {\n  return log2(x) * (1.0 / log2(10.0));\n}\n\nfloat log1p(float x) {\n  return log(1.0 + x);\n}\n\nfloat _pow(float v1, float v2) {\n  if (v2 == 0.0) return 1.0;\n  return pow(v1, v2);\n}\n\nfloat tanh(float x) {\n  float e = exp(2.0 * x);\n  return (e - 1.0) / (e + 1.0);\n}\n\nfloat trunc(float x) {\n  if (x >= 0.0) {\n    return floor(x); \n  } else {\n    return ceil(x);\n  }\n}\n\nvec4 _round(vec4 x) {\n  return floor(x + 0.5);\n}\n\nfloat _round(float x) {\n  return floor(x + 0.5);\n}\n\nconst int BIT_COUNT = 32;\nint modi(int x, int y) {\n  return x - y * (x / y);\n}\n\nint bitwiseOr(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseXOR(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseAnd(int a, int b) {\n  int result = 0;\n  int n = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 && b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseNot(int a) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (modi(a, 2) == 0) {\n      result += n;    \n    }\n    a = a / 2;\n    n = n * 2;\n  }\n  return result;\n}\nint bitwiseZeroFillLeftShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n *= 2;\n  }\n\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nint bitwiseSignedRightShift(int num, int shifts) {\n  return int(floor(float(num) / pow(2.0, float(shifts))));\n}\n\nint bitwiseZeroFillRightShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n /= 2;\n  }\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x / y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 texel) {\n  __DECODE32_ENDIANNESS__;\n  texel *= 255.0;\n  vec2 gte128;\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(_round(exponent));\n  texel.b = texel.b - 128.0 * gte128.x;\n  res = dot(texel, SCALE_FACTOR) * exp2(_round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nfloat decode16(vec4 texel, int index) {\n  int channel = integerMod(index, 2);\n  if (channel == 0) return texel.r * 255.0 + texel.g * 65280.0;\n  if (channel == 1) return texel.b * 255.0 + texel.a * 65280.0;\n  return 0.0;\n}\n\nfloat decode8(vec4 texel, int index) {\n  int channel = integerMod(index, 4);\n  if (channel == 0) return texel.r * 255.0;\n  if (channel == 1) return texel.g * 255.0;\n  if (channel == 2) return texel.b * 255.0;\n  if (channel == 3) return texel.a * 255.0;\n  return 0.0;\n}\n\nvec4 legacyEncode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  texel.rg = integerMod(texel.rg, 256.0);\n  texel.b = integerMod(texel.b, 128.0);\n  texel.a = exponent*0.5 + 63.5;\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  texel = floor(texel);\n  texel *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return texel;\n}\n\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\nvec4 encode32(float value) {\n  if (value == 0.0) return vec4(0, 0, 0, 0);\n\n  float exponent;\n  float mantissa;\n  vec4  result;\n  float sgn;\n\n  sgn = step(0.0, -value);\n  value = abs(value);\n\n  exponent = floor(log2(value));\n\n  mantissa = value*pow(2.0, -exponent)-1.0;\n  exponent = exponent+127.0;\n  result   = vec4(0,0,0,0);\n\n  result.a = floor(exponent/2.0);\n  exponent = exponent - result.a*2.0;\n  result.a = result.a + 128.0*sgn;\n\n  result.b = floor(mantissa * 128.0);\n  mantissa = mantissa - result.b / 128.0;\n  result.b = result.b + exponent*128.0;\n\n  result.g = floor(mantissa*32768.0);\n  mantissa = mantissa - result.g/32768.0;\n\n  result.r = floor(mantissa*8388608.0);\n  return result/255.0;\n}\n// Dragons end here\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  return decode32(texel);\n}\n\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x * 2;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 2, texSize.y));\n  return decode16(texel, index);\n}\n\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x * 4;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize.x * 4, texSize.y));\n  return decode8(texel, index);\n}\n\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 4);\n  index = index / 4;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  if (channel == 0) return texel.r;\n  if (channel == 1) return texel.g;\n  if (channel == 2) return texel.b;\n  if (channel == 3) return texel.a;\n  return 0.0;\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  return texture2D(tex, st / vec2(texSize));\n}\n\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return result[0];\n}\n\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec2(result[0], result[1]);\n}\n\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int channel = integerMod(index, 2);\n  index = index / 2;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  if (channel == 0) return vec2(texel.r, texel.g);\n  if (channel == 1) return vec2(texel.b, texel.a);\n  return vec2(0.0, 0.0);\n}\n\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec3(result[0], result[1], result[2]);\n}\n\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\n  int vectorIndex = fieldIndex / 4;\n  int vectorOffset = fieldIndex - vectorIndex * 4;\n  int readY = vectorIndex / texSize.x;\n  int readX = vectorIndex - readY * texSize.x;\n  vec4 tex1 = texture2D(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\n  \n  if (vectorOffset == 0) {\n    return tex1.xyz;\n  } else if (vectorOffset == 1) {\n    return tex1.yzw;\n  } else {\n    readX++;\n    if (readX >= texSize.x) {\n      readX = 0;\n      readY++;\n    }\n    vec4 tex2 = texture2D(tex, vec2(readX, readY) / vec2(texSize));\n    if (vectorOffset == 2) {\n      return vec3(tex1.z, tex1.w, tex2.x);\n    } else {\n      return vec3(tex1.w, tex2.x, tex2.y);\n    }\n  }\n}\n\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  return getImage2D(tex, texSize, texDim, z, y, x);\n}\n\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 2);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  return vec4(texel.r, texel.g, texel.b, texel.a);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\nvoid color(sampler2D image) {\n  actualColor = texture2D(image, vTexCoord);\n}\n\nfloat modulo(float number, float divisor) {\n  if (number < 0.0) {\n    number = abs(number);\n    if (divisor < 0.0) {\n      divisor = abs(divisor);\n    }\n    return -mod(number, divisor);\n  }\n  if (divisor < 0.0) {\n    divisor = abs(divisor);\n  }\n  return mod(number, divisor);\n}\n\n__INJECTED_NATIVE__;\n__MAIN_CONSTANTS__;\n__MAIN_ARGUMENTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}`;B.exports={fragmentShader:F}},{}],38:[function(T,B,q){const{utils:F}=T("../../utils"),{FunctionNode:L}=T("../function-node");const x={Array:"sampler2D","Array(2)":"vec2","Array(3)":"vec3","Array(4)":"vec4","Matrix(2)":"mat2","Matrix(3)":"mat3","Matrix(4)":"mat4",Array2D:"sampler2D",Array3D:"sampler2D",Boolean:"bool",Float:"float",Input:"sampler2D",Integer:"int",Number:"float",LiteralInteger:"float",NumberTexture:"sampler2D",MemoryOptimizedNumberTexture:"sampler2D","ArrayTexture(1)":"sampler2D","ArrayTexture(2)":"sampler2D","ArrayTexture(3)":"sampler2D","ArrayTexture(4)":"sampler2D",HTMLVideo:"sampler2D",HTMLCanvas:"sampler2D",OffscreenCanvas:"sampler2D",HTMLImage:"sampler2D",ImageBitmap:"sampler2D",ImageData:"sampler2D",HTMLImageArray:"sampler2DArray"},h={"===":"==","!==":"!="};B.exports={WebGLFunctionNode:class A extends L{constructor(u,l){super(u,l),l&&l.hasOwnProperty("fixIntegerDivisionAccuracy")&&(this.fixIntegerDivisionAccuracy=l.fixIntegerDivisionAccuracy)}astConditionalExpression(u,l){if("ConditionalExpression"!==u.type)throw this.astErrorOutput("Not a conditional expression",u);const y=this.getType(u.consequent),E=this.getType(u.alternate);return null===y&&null===E?(l.push("if ("),this.astGeneric(u.test,l),l.push(") {"),this.astGeneric(u.consequent,l),l.push(";"),l.push("} else {"),this.astGeneric(u.alternate,l),l.push(";"),l.push("}"),l):(l.push("("),this.astGeneric(u.test,l),l.push("?"),this.astGeneric(u.consequent,l),l.push(":"),this.astGeneric(u.alternate,l),l.push(")"),l)}astFunction(u,l){if(this.isRootKernel)l.push("void");else{this.returnType||this.findLastReturn()&&(this.returnType=this.getType(u.body),"LiteralInteger"===this.returnType&&(this.returnType="Number"));const{returnType:y}=this;if(y){const E=x[y];if(!E)throw new Error(`unknown type ${y}`);l.push(E)}else l.push("void")}if(l.push(" "),l.push(this.name),l.push("("),!this.isRootKernel)for(let y=0;y<this.argumentNames.length;++y){const E=this.argumentNames[y];y>0&&l.push(", ");let N=this.argumentTypes[this.argumentNames.indexOf(E)];if(!N)throw this.astErrorOutput(`Unknown argument ${E} type`,u);"LiteralInteger"===N&&(this.argumentTypes[y]=N="Number");const w=x[N];if(!w)throw this.astErrorOutput("Unexpected expression",u);const R=F.sanitizeName(E);l.push("sampler2D"===w||"sampler2DArray"===w?`${w} user_${R},ivec2 user_${R}Size,ivec3 user_${R}Dim`:`${w} user_${R}`)}l.push(") {\n");for(let y=0;y<u.body.body.length;++y)this.astGeneric(u.body.body[y],l),l.push("\n");return l.push("}\n"),l}astReturnStatement(u,l){if(!u.argument)throw this.astErrorOutput("Unexpected return statement",u);this.pushState("skip-literal-correction");const y=this.getType(u.argument);this.popState("skip-literal-correction");const E=[];switch(this.returnType||(this.returnType="LiteralInteger"===y||"Integer"===y?"Number":y),this.returnType){case"LiteralInteger":case"Number":case"Float":switch(y){case"Integer":E.push("float("),this.astGeneric(u.argument,E),E.push(")");break;case"LiteralInteger":this.castLiteralToFloat(u.argument,E),"Integer"===this.getType(u)&&(E.unshift("float("),E.push(")"));break;default:this.astGeneric(u.argument,E)}break;case"Integer":switch(y){case"Float":case"Number":this.castValueToInteger(u.argument,E);break;case"LiteralInteger":this.castLiteralToInteger(u.argument,E);break;default:this.astGeneric(u.argument,E)}break;case"Array(4)":case"Array(3)":case"Array(2)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":case"Input":this.astGeneric(u.argument,E);break;default:throw this.astErrorOutput(`unhandled return type ${this.returnType}`,u)}return this.isRootKernel?(l.push(`kernelResult = ${E.join("")};`),l.push("return;")):this.isSubKernel?(l.push(`subKernelResult_${this.name} = ${E.join("")};`),l.push(`return subKernelResult_${this.name};`)):l.push(`return ${E.join("")};`),l}astLiteral(u,l){if(isNaN(u.value))throw this.astErrorOutput("Non-numeric literal not supported : "+u.value,u);const y=this.astKey(u);return Number.isInteger(u.value)?this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[y]="Integer",l.push(`${u.value}`)):(this.isState("casting-to-float")||this.isState("building-float"),this.literalTypes[y]="Number",l.push(`${u.value}.0`)):this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[y]="Integer",l.push(Math.round(u.value))):(this.literalTypes[y]="Number",l.push(`${u.value}`)),l}astBinaryExpression(u,l){if(this.checkAndUpconvertOperator(u,l))return l;if(this.fixIntegerDivisionAccuracy&&"/"===u.operator){switch(l.push("divWithIntCheck("),this.pushState("building-float"),this.getType(u.left)){case"Integer":this.castValueToFloat(u.left,l);break;case"LiteralInteger":this.castLiteralToFloat(u.left,l);break;default:this.astGeneric(u.left,l)}switch(l.push(", "),this.getType(u.right)){case"Integer":this.castValueToFloat(u.right,l);break;case"LiteralInteger":this.castLiteralToFloat(u.right,l);break;default:this.astGeneric(u.right,l)}return this.popState("building-float"),l.push(")"),l}l.push("(");const y=this.getType(u.left)||"Number",E=this.getType(u.right)||"Number";if(!y||!E)throw this.astErrorOutput("Unhandled binary expression",u);const N=y+" & "+E;switch(N){case"Integer & Integer":this.pushState("building-integer"),this.astGeneric(u.left,l),l.push(h[u.operator]||u.operator),this.astGeneric(u.right,l),this.popState("building-integer");break;case"Number & Float":case"Float & Number":case"Float & Float":case"Number & Number":this.pushState("building-float"),this.astGeneric(u.left,l),l.push(h[u.operator]||u.operator),this.astGeneric(u.right,l),this.popState("building-float");break;case"LiteralInteger & LiteralInteger":this.isState("casting-to-integer")||this.isState("building-integer")?(this.pushState("building-integer"),this.astGeneric(u.left,l),l.push(h[u.operator]||u.operator),this.astGeneric(u.right,l),this.popState("building-integer")):(this.pushState("building-float"),this.castLiteralToFloat(u.left,l),l.push(h[u.operator]||u.operator),this.castLiteralToFloat(u.right,l),this.popState("building-float"));break;case"Integer & Float":case"Integer & Number":if((">"===u.operator||"<"===u.operator&&"Literal"===u.right.type)&&!Number.isInteger(u.right.value)){this.pushState("building-float"),this.castValueToFloat(u.left,l),l.push(h[u.operator]||u.operator),this.astGeneric(u.right,l),this.popState("building-float");break}if(this.pushState("building-integer"),this.astGeneric(u.left,l),l.push(h[u.operator]||u.operator),this.pushState("casting-to-integer"),"Literal"===u.right.type){const w=[];if(this.astGeneric(u.right,w),"Integer"!==this.getType(u.right))throw this.astErrorOutput("Unhandled binary expression with literal",u);l.push(w.join(""))}else l.push("int("),this.astGeneric(u.right,l),l.push(")");this.popState("casting-to-integer"),this.popState("building-integer");break;case"Integer & LiteralInteger":this.pushState("building-integer"),this.astGeneric(u.left,l),l.push(h[u.operator]||u.operator),this.castLiteralToInteger(u.right,l),this.popState("building-integer");break;case"Number & Integer":case"Float & Integer":this.pushState("building-float"),this.astGeneric(u.left,l),l.push(h[u.operator]||u.operator),this.castValueToFloat(u.right,l),this.popState("building-float");break;case"Float & LiteralInteger":case"Number & LiteralInteger":this.pushState("building-float"),this.astGeneric(u.left,l),l.push(h[u.operator]||u.operator),this.castLiteralToFloat(u.right,l),this.popState("building-float");break;case"LiteralInteger & Float":case"LiteralInteger & Number":this.isState("casting-to-integer")?(this.pushState("building-integer"),this.castLiteralToInteger(u.left,l),l.push(h[u.operator]||u.operator),this.castValueToInteger(u.right,l),this.popState("building-integer")):(this.pushState("building-float"),this.astGeneric(u.left,l),l.push(h[u.operator]||u.operator),this.pushState("casting-to-float"),this.astGeneric(u.right,l),this.popState("casting-to-float"),this.popState("building-float"));break;case"LiteralInteger & Integer":this.pushState("building-integer"),this.castLiteralToInteger(u.left,l),l.push(h[u.operator]||u.operator),this.astGeneric(u.right,l),this.popState("building-integer");break;case"Boolean & Boolean":this.pushState("building-boolean"),this.astGeneric(u.left,l),l.push(h[u.operator]||u.operator),this.astGeneric(u.right,l),this.popState("building-boolean");break;default:throw this.astErrorOutput(`Unhandled binary expression between ${N}`,u)}return l.push(")"),l}checkAndUpconvertOperator(u,l){const y=this.checkAndUpconvertBitwiseOperators(u,l);if(y)return y;const N={"%":this.fixIntegerDivisionAccuracy?"integerCorrectionModulo":"modulo","**":"pow"}[u.operator];if(!N)return null;switch(l.push(N),l.push("("),this.getType(u.left)){case"Integer":this.castValueToFloat(u.left,l);break;case"LiteralInteger":this.castLiteralToFloat(u.left,l);break;default:this.astGeneric(u.left,l)}switch(l.push(","),this.getType(u.right)){case"Integer":this.castValueToFloat(u.right,l);break;case"LiteralInteger":this.castLiteralToFloat(u.right,l);break;default:this.astGeneric(u.right,l)}return l.push(")"),l}checkAndUpconvertBitwiseOperators(u,l){const E={"&":"bitwiseAnd","|":"bitwiseOr","^":"bitwiseXOR","<<":"bitwiseZeroFillLeftShift",">>":"bitwiseSignedRightShift",">>>":"bitwiseZeroFillRightShift"}[u.operator];if(!E)return null;switch(l.push(E),l.push("("),this.getType(u.left)){case"Number":case"Float":this.castValueToInteger(u.left,l);break;case"LiteralInteger":this.castLiteralToInteger(u.left,l);break;default:this.astGeneric(u.left,l)}switch(l.push(","),this.getType(u.right)){case"Number":case"Float":this.castValueToInteger(u.right,l);break;case"LiteralInteger":this.castLiteralToInteger(u.right,l);break;default:this.astGeneric(u.right,l)}return l.push(")"),l}checkAndUpconvertBitwiseUnary(u,l){const E={"~":"bitwiseNot"}[u.operator];if(!E)return null;switch(l.push(E),l.push("("),this.getType(u.argument)){case"Number":case"Float":this.castValueToInteger(u.argument,l);break;case"LiteralInteger":this.castLiteralToInteger(u.argument,l);break;default:this.astGeneric(u.argument,l)}return l.push(")"),l}castLiteralToInteger(u,l){return this.pushState("casting-to-integer"),this.astGeneric(u,l),this.popState("casting-to-integer"),l}castLiteralToFloat(u,l){return this.pushState("casting-to-float"),this.astGeneric(u,l),this.popState("casting-to-float"),l}castValueToInteger(u,l){return this.pushState("casting-to-integer"),l.push("int("),this.astGeneric(u,l),l.push(")"),this.popState("casting-to-integer"),l}castValueToFloat(u,l){return this.pushState("casting-to-float"),l.push("float("),this.astGeneric(u,l),l.push(")"),this.popState("casting-to-float"),l}astIdentifierExpression(u,l){if("Identifier"!==u.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",u);const y=this.getType(u),E=F.sanitizeName(u.name);return"Infinity"===u.name?l.push("3.402823466e+38"):"Boolean"===y&&this.argumentNames.indexOf(E)>-1?l.push(`bool(user_${E})`):l.push(`user_${E}`),l}astForStatement(u,l){if("ForStatement"!==u.type)throw this.astErrorOutput("Invalid for statement",u);const y=[],E=[],N=[],w=[];let R=null;if(u.init){const{declarations:M}=u.init;M.length>1&&(R=!1),this.astGeneric(u.init,y);for(let b=0;b<M.length;b++)M[b].init&&"Literal"!==M[b].init.type&&(R=!1)}else R=!1;if(u.test?this.astGeneric(u.test,E):R=!1,u.update?this.astGeneric(u.update,N):R=!1,u.body&&(this.pushState("loop-body"),this.astGeneric(u.body,w),this.popState("loop-body")),null===R&&(R=this.isSafe(u.init)&&this.isSafe(u.test)),R){const M=y.join("");l.push(`for (${M}${";"!==M[M.length-1]?";":""}${E.join("")};${N.join("")}){\n`),l.push(w.join("")),l.push("}\n")}else{const M=this.getInternalVariableName("safeI");y.length>0&&l.push(y.join(""),"\n"),l.push(`for (int ${M}=0;${M}<LOOP_MAX;${M}++){\n`),E.length>0&&l.push(`if (!${E.join("")}) break;\n`),l.push(w.join("")),l.push(`\n${N.join("")};`),l.push("}\n")}return l}astWhileStatement(u,l){if("WhileStatement"!==u.type)throw this.astErrorOutput("Invalid while statement",u);const y=this.getInternalVariableName("safeI");return l.push(`for (int ${y}=0;${y}<LOOP_MAX;${y}++){\n`),l.push("if (!"),this.astGeneric(u.test,l),l.push(") break;\n"),this.astGeneric(u.body,l),l.push("}\n"),l}astDoWhileStatement(u,l){if("DoWhileStatement"!==u.type)throw this.astErrorOutput("Invalid while statement",u);const y=this.getInternalVariableName("safeI");return l.push(`for (int ${y}=0;${y}<LOOP_MAX;${y}++){\n`),this.astGeneric(u.body,l),l.push("if (!"),this.astGeneric(u.test,l),l.push(") break;\n"),l.push("}\n"),l}astAssignmentExpression(u,l){if("%="===u.operator)this.astGeneric(u.left,l),l.push("="),l.push("mod("),this.astGeneric(u.left,l),l.push(","),this.astGeneric(u.right,l),l.push(")");else{if("**="!==u.operator){const y=this.getType(u.left),E=this.getType(u.right);return this.astGeneric(u.left,l),l.push(u.operator),"Integer"!==y&&"Integer"===E?(l.push("float("),this.astGeneric(u.right,l),l.push(")")):this.astGeneric(u.right,l),l}this.astGeneric(u.left,l),l.push("="),l.push("pow("),this.astGeneric(u.left,l),l.push(","),this.astGeneric(u.right,l),l.push(")")}}astBlockStatement(u,l){if(this.isState("loop-body")){this.pushState("block-body");for(let y=0;y<u.body.length;y++)this.astGeneric(u.body[y],l);this.popState("block-body")}else{l.push("{\n");for(let y=0;y<u.body.length;y++)this.astGeneric(u.body[y],l);l.push("}\n")}return l}astVariableDeclaration(u,l){const y=u.declarations;if(!y||!y[0]||!y[0].init)throw this.astErrorOutput("Unexpected expression",u);const E=[];let N=null;const w=[];let R=[];for(let M=0;M<y.length;M++){const b=y[M],S=b.init,I=this.getDeclaration(b.id),U=this.getType(b.init);let W=U;"LiteralInteger"===W&&(W="Integer"===I.suggestedType?"Integer":"Number");const v=x[W];if(!v)throw this.astErrorOutput(`Markup type ${W} not handled`,u);const g=[];if("Integer"===U&&"Integer"===W){if(I.valueType="Number",0===M||null===N)g.push("float ");else if(W!==N)throw new Error("Unhandled declaration");N=W,g.push(`user_${F.sanitizeName(b.id.name)}=`),g.push("float("),this.astGeneric(S,g),g.push(")")}else I.valueType=W,0===M||null===N?g.push(`${v} `):W!==N&&(w.push(R.join(",")),R=[],g.push(`${v} `)),N=W,g.push(`user_${F.sanitizeName(b.id.name)}=`),"Number"===U&&"Integer"===W?S.left&&"Literal"===S.left.type?this.astGeneric(S,g):(g.push("int("),this.astGeneric(S,g),g.push(")")):"LiteralInteger"===U&&"Integer"===W?this.castLiteralToInteger(S,g):this.astGeneric(S,g);R.push(g.join(""))}return R.length>0&&w.push(R.join(",")),E.push(w.join(";")),l.push(E.join("")),l.push(";"),l}astIfStatement(u,l){return l.push("if ("),this.astGeneric(u.test,l),l.push(")"),"BlockStatement"===u.consequent.type?this.astGeneric(u.consequent,l):(l.push(" {\n"),this.astGeneric(u.consequent,l),l.push("\n}\n")),u.alternate&&(l.push("else "),"BlockStatement"===u.alternate.type||"IfStatement"===u.alternate.type?this.astGeneric(u.alternate,l):(l.push(" {\n"),this.astGeneric(u.alternate,l),l.push("\n}\n"))),l}astSwitchStatement(u,l){if("SwitchStatement"!==u.type)throw this.astErrorOutput("Invalid switch statement",u);const{discriminant:y,cases:E}=u,N=this.getType(y),w=`switchDiscriminant${this.astKey(u,"_")}`;switch(N){case"Float":case"Number":l.push(`float ${w} = `),this.astGeneric(y,l),l.push(";\n");break;case"Integer":l.push(`int ${w} = `),this.astGeneric(y,l),l.push(";\n")}if(1===E.length&&!E[0].test)return this.astGeneric(E[0].consequent,l),l;let R=!1,M=[],b=!1,S=!1;for(let I=0;I<E.length;I++){if(E[I].test){if(0!==I&&S?R?(l.push(`${w} == `),R=!1):l.push(` else if (${w} == `):(S=!0,l.push(`if (${w} == `)),"Integer"===N)switch(this.getType(E[I].test)){case"Number":case"Float":this.castValueToInteger(E[I].test,l);break;case"LiteralInteger":this.castLiteralToInteger(E[I].test,l)}else{if("Float"!==N)throw new Error("unhanlded");switch(this.getType(E[I].test)){case"LiteralInteger":this.castLiteralToFloat(E[I].test,l);break;case"Integer":this.castValueToFloat(E[I].test,l)}}if(!E[I].consequent||0===E[I].consequent.length){R=!0,l.push(" || ");continue}l.push(") {\n")}else{if(E.length>I+1){b=!0,this.astGeneric(E[I].consequent,M);continue}l.push(" else {\n")}this.astGeneric(E[I].consequent,l),l.push("\n}")}return b&&(l.push(" else {"),l.push(M.join("")),l.push("}")),l}astThisExpression(u,l){return l.push("this"),l}astMemberExpression(u,l){const{property:y,name:E,signature:N,origin:w,type:R,xProperty:M,yProperty:b,zProperty:S}=this.getMemberExpressionDetails(u);switch(N){case"value.thread.value":case"this.thread.value":if("x"!==E&&"y"!==E&&"z"!==E)throw this.astErrorOutput("Unexpected expression, expected `this.thread.x`, `this.thread.y`, or `this.thread.z`",u);return l.push(`threadId.${E}`),l;case"this.output.value":if(this.dynamicOutput)switch(E){case"x":this.isState("casting-to-float")?l.push("float(uOutputDim.x)"):l.push("uOutputDim.x");break;case"y":this.isState("casting-to-float")?l.push("float(uOutputDim.y)"):l.push("uOutputDim.y");break;case"z":this.isState("casting-to-float")?l.push("float(uOutputDim.z)"):l.push("uOutputDim.z");break;default:throw this.astErrorOutput("Unexpected expression",u)}else switch(E){case"x":this.isState("casting-to-integer")?l.push(this.output[0]):l.push(this.output[0],".0");break;case"y":this.isState("casting-to-integer")?l.push(this.output[1]):l.push(this.output[1],".0");break;case"z":this.isState("casting-to-integer")?l.push(this.output[2]):l.push(this.output[2],".0");break;default:throw this.astErrorOutput("Unexpected expression",u)}return l;case"value":throw this.astErrorOutput("Unexpected expression",u);case"value[]":case"value[][]":case"value[][][]":case"value[][][][]":case"value.value":if("Math"===w)return l.push(Math[E]),l;const U=F.sanitizeName(E);switch(y){case"r":return l.push(`user_${U}.r`),l;case"g":return l.push(`user_${U}.g`),l;case"b":return l.push(`user_${U}.b`),l;case"a":return l.push(`user_${U}.a`),l}break;case"this.constants.value":if(void 0===M)switch(R){case"Array(2)":case"Array(3)":case"Array(4)":return l.push(`constants_${F.sanitizeName(E)}`),l}case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":case"this.constants.value[][][][]":break;case"fn()[]":return this.astCallExpression(u.object,l),l.push("["),l.push(this.memberExpressionPropertyMarkup(y)),l.push("]"),l;case"fn()[][]":return this.astCallExpression(u.object.object,l),l.push("["),l.push(this.memberExpressionPropertyMarkup(u.object.property)),l.push("]"),l.push("["),l.push(this.memberExpressionPropertyMarkup(u.property)),l.push("]"),l;case"[][]":return this.astArrayExpression(u.object,l),l.push("["),l.push(this.memberExpressionPropertyMarkup(y)),l.push("]"),l;default:throw this.astErrorOutput("Unexpected expression",u)}if(!1===u.computed)switch(R){case"Number":case"Integer":case"Float":case"Boolean":return l.push(`${w}_${F.sanitizeName(E)}`),l}const I=`${w}_${F.sanitizeName(E)}`;switch(R){case"Array(2)":case"Array(3)":case"Array(4)":this.astGeneric(u.object,l),l.push("["),l.push(this.memberExpressionPropertyMarkup(M)),l.push("]");break;case"HTMLImageArray":l.push(`getImage3D(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");break;case"ArrayTexture(1)":l.push(`getFloatFromSampler2D(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");break;case"Array1D(2)":case"Array2D(2)":case"Array3D(2)":l.push(`getMemoryOptimizedVec2(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");break;case"ArrayTexture(2)":l.push(`getVec2FromSampler2D(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");break;case"Array1D(3)":case"Array2D(3)":case"Array3D(3)":l.push(`getMemoryOptimizedVec3(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");break;case"ArrayTexture(3)":l.push(`getVec3FromSampler2D(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");break;case"Array1D(4)":case"Array2D(4)":case"Array3D(4)":l.push(`getMemoryOptimizedVec4(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");break;case"ArrayTexture(4)":case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLVideo":l.push(`getVec4FromSampler2D(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");break;case"NumberTexture":case"Array":case"Array2D":case"Array3D":case"Array4D":case"Input":case"Number":case"Float":case"Integer":if("single"===this.precision)l.push(`getMemoryOptimized32(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");else{const U="user"===w?this.lookupFunctionArgumentBitRatio(this.name,E):this.constantBitRatios[E];switch(U){case 1:l.push(`get8(${I}, ${I}Size, ${I}Dim, `);break;case 2:l.push(`get16(${I}, ${I}Size, ${I}Dim, `);break;case 4:case 0:l.push(`get32(${I}, ${I}Size, ${I}Dim, `);break;default:throw new Error(`unhandled bit ratio of ${U}`)}this.memberExpressionXYZ(M,b,S,l),l.push(")")}break;case"MemoryOptimizedNumberTexture":l.push(`getMemoryOptimized32(${I}, ${I}Size, ${I}Dim, `),this.memberExpressionXYZ(M,b,S,l),l.push(")");break;case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":l.push(`${I}[${this.memberExpressionPropertyMarkup(b)}]`),b&&l.push(`[${this.memberExpressionPropertyMarkup(M)}]`);break;default:throw new Error(`unhandled member expression "${R}"`)}return l}astCallExpression(u,l){if(!u.callee)throw this.astErrorOutput("Unknown CallExpression",u);let y=null;const E=this.isAstMathFunction(u);if(y=E||u.callee.object&&"ThisExpression"===u.callee.object.type?u.callee.property.name:"SequenceExpression"!==u.callee.type||"Literal"!==u.callee.expressions[0].type||isNaN(u.callee.expressions[0].raw)?u.callee.name:u.callee.expressions[1].property.name,!y)throw this.astErrorOutput("Unhandled function, couldn't find name",u);switch(y){case"pow":y="_pow";break;case"round":y="_round"}if(this.calledFunctions.indexOf(y)<0&&this.calledFunctions.push(y),"random"===y&&this.plugins&&this.plugins.length>0)for(let N=0;N<this.plugins.length;N++){const w=this.plugins[N];if("Math.random()"===w.functionMatch&&w.functionReplace)return l.push(w.functionReplace),l}if(this.onFunctionCall&&this.onFunctionCall(this.name,y,u.arguments),l.push(y),l.push("("),E)for(let N=0;N<u.arguments.length;++N){const w=u.arguments[N],R=this.getType(w);"Integer"===(N>0&&l.push(", "),R)?this.castValueToFloat(w,l):this.astGeneric(w,l)}else{const N=this.lookupFunctionArgumentTypes(y)||[];for(let w=0;w<u.arguments.length;++w){const R=u.arguments[w];let M=N[w];w>0&&l.push(", ");const b=this.getType(R);switch(M||(this.triggerImplyArgumentType(y,w,b,this),M=b),b){case"Boolean":this.astGeneric(R,l);continue;case"Number":case"Float":if("Integer"===M){l.push("int("),this.astGeneric(R,l),l.push(")");continue}if("Number"===M||"Float"===M){this.astGeneric(R,l);continue}if("LiteralInteger"===M){this.castLiteralToFloat(R,l);continue}break;case"Integer":if("Number"===M||"Float"===M){l.push("float("),this.astGeneric(R,l),l.push(")");continue}if("Integer"===M){this.astGeneric(R,l);continue}break;case"LiteralInteger":if("Integer"===M){this.castLiteralToInteger(R,l);continue}if("Number"===M||"Float"===M){this.castLiteralToFloat(R,l);continue}if("LiteralInteger"===M){this.astGeneric(R,l);continue}break;case"Array(2)":case"Array(3)":case"Array(4)":if(M===b){if("Identifier"===R.type)l.push(`user_${F.sanitizeName(R.name)}`);else{if("ArrayExpression"!==R.type&&"MemberExpression"!==R.type&&"CallExpression"!==R.type)throw this.astErrorOutput(`Unhandled argument type ${R.type}`,u);this.astGeneric(R,l)}continue}break;case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLImageArray":case"HTMLVideo":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"Array":case"Input":if(M===b){if("Identifier"!==R.type)throw this.astErrorOutput(`Unhandled argument type ${R.type}`,u);this.triggerImplyArgumentBitRatio(this.name,R.name,y,w);const S=F.sanitizeName(R.name);l.push(`user_${S},user_${S}Size,user_${S}Dim`);continue}}throw this.astErrorOutput(`Unhandled argument combination of ${b} and ${M} for argument named "${R.name}"`,u)}}return l.push(")"),l}astArrayExpression(u,l){const y=this.getType(u),E=u.elements.length;switch(y){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":l.push(`mat${E}(`);break;default:l.push(`vec${E}(`)}for(let N=0;N<E;++N)N>0&&l.push(", "),this.astGeneric(u.elements[N],l);return l.push(")"),l}memberExpressionXYZ(u,l,y,E){return y?E.push(this.memberExpressionPropertyMarkup(y),", "):E.push("0, "),l?E.push(this.memberExpressionPropertyMarkup(l),", "):E.push("0, "),E.push(this.memberExpressionPropertyMarkup(u)),E}memberExpressionPropertyMarkup(u){if(!u)throw new Error("Property not set");const y=[];switch(this.getType(u)){case"Number":case"Float":this.castValueToInteger(u,y);break;case"LiteralInteger":this.castLiteralToInteger(u,y);break;default:this.astGeneric(u,y)}return y.join("")}}}},{"../../utils":114,"../function-node":10}],39:[function(T,B,q){const{WebGLKernelValueBoolean:F}=T("./kernel-value/boolean"),{WebGLKernelValueFloat:L}=T("./kernel-value/float"),{WebGLKernelValueInteger:A}=T("./kernel-value/integer"),{WebGLKernelValueHTMLImage:x}=T("./kernel-value/html-image"),{WebGLKernelValueDynamicHTMLImage:h}=T("./kernel-value/dynamic-html-image"),{WebGLKernelValueHTMLVideo:d}=T("./kernel-value/html-video"),{WebGLKernelValueDynamicHTMLVideo:u}=T("./kernel-value/dynamic-html-video"),{WebGLKernelValueSingleInput:l}=T("./kernel-value/single-input"),{WebGLKernelValueDynamicSingleInput:y}=T("./kernel-value/dynamic-single-input"),{WebGLKernelValueUnsignedInput:E}=T("./kernel-value/unsigned-input"),{WebGLKernelValueDynamicUnsignedInput:N}=T("./kernel-value/dynamic-unsigned-input"),{WebGLKernelValueMemoryOptimizedNumberTexture:w}=T("./kernel-value/memory-optimized-number-texture"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:R}=T("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGLKernelValueNumberTexture:M}=T("./kernel-value/number-texture"),{WebGLKernelValueDynamicNumberTexture:b}=T("./kernel-value/dynamic-number-texture"),{WebGLKernelValueSingleArray:S}=T("./kernel-value/single-array"),{WebGLKernelValueDynamicSingleArray:I}=T("./kernel-value/dynamic-single-array"),{WebGLKernelValueSingleArray1DI:U}=T("./kernel-value/single-array1d-i"),{WebGLKernelValueDynamicSingleArray1DI:W}=T("./kernel-value/dynamic-single-array1d-i"),{WebGLKernelValueSingleArray2DI:v}=T("./kernel-value/single-array2d-i"),{WebGLKernelValueDynamicSingleArray2DI:g}=T("./kernel-value/dynamic-single-array2d-i"),{WebGLKernelValueSingleArray3DI:O}=T("./kernel-value/single-array3d-i"),{WebGLKernelValueDynamicSingleArray3DI:$}=T("./kernel-value/dynamic-single-array3d-i"),{WebGLKernelValueArray2:ee}=T("./kernel-value/array2"),{WebGLKernelValueArray3:G}=T("./kernel-value/array3"),{WebGLKernelValueArray4:j}=T("./kernel-value/array4"),{WebGLKernelValueUnsignedArray:ie}=T("./kernel-value/unsigned-array"),{WebGLKernelValueDynamicUnsignedArray:X}=T("./kernel-value/dynamic-unsigned-array"),ge={unsigned:{dynamic:{Boolean:F,Integer:A,Float:L,Array:X,"Array(2)":ee,"Array(3)":G,"Array(4)":j,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:N,NumberTexture:b,"ArrayTexture(1)":b,"ArrayTexture(2)":b,"ArrayTexture(3)":b,"ArrayTexture(4)":b,MemoryOptimizedNumberTexture:R,HTMLCanvas:h,OffscreenCanvas:h,HTMLImage:h,ImageBitmap:h,ImageData:h,HTMLImageArray:!1,HTMLVideo:u},static:{Boolean:F,Float:L,Integer:A,Array:ie,"Array(2)":ee,"Array(3)":G,"Array(4)":j,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:E,NumberTexture:M,"ArrayTexture(1)":M,"ArrayTexture(2)":M,"ArrayTexture(3)":M,"ArrayTexture(4)":M,MemoryOptimizedNumberTexture:w,HTMLCanvas:x,OffscreenCanvas:x,HTMLImage:x,ImageBitmap:x,ImageData:x,HTMLImageArray:!1,HTMLVideo:d}},single:{dynamic:{Boolean:F,Integer:A,Float:L,Array:I,"Array(2)":ee,"Array(3)":G,"Array(4)":j,"Array1D(2)":W,"Array1D(3)":W,"Array1D(4)":W,"Array2D(2)":g,"Array2D(3)":g,"Array2D(4)":g,"Array3D(2)":$,"Array3D(3)":$,"Array3D(4)":$,Input:y,NumberTexture:b,"ArrayTexture(1)":b,"ArrayTexture(2)":b,"ArrayTexture(3)":b,"ArrayTexture(4)":b,MemoryOptimizedNumberTexture:R,HTMLCanvas:h,OffscreenCanvas:h,HTMLImage:h,ImageBitmap:h,ImageData:h,HTMLImageArray:!1,HTMLVideo:u},static:{Boolean:F,Float:L,Integer:A,Array:S,"Array(2)":ee,"Array(3)":G,"Array(4)":j,"Array1D(2)":U,"Array1D(3)":U,"Array1D(4)":U,"Array2D(2)":v,"Array2D(3)":v,"Array2D(4)":v,"Array3D(2)":O,"Array3D(3)":O,"Array3D(4)":O,Input:l,NumberTexture:M,"ArrayTexture(1)":M,"ArrayTexture(2)":M,"ArrayTexture(3)":M,"ArrayTexture(4)":M,MemoryOptimizedNumberTexture:w,HTMLCanvas:x,OffscreenCanvas:x,HTMLImage:x,ImageBitmap:x,ImageData:x,HTMLImageArray:!1,HTMLVideo:d}}};B.exports={lookupKernelValueType:function fe(re,pe,_e,ye){if(!re)throw new Error("type missing");if(!pe)throw new Error("dynamic missing");if(!_e)throw new Error("precision missing");ye.type&&(re=ye.type);const le=ge[_e][pe];if(!1===le[re])return null;if(void 0===le[re])throw new Error(`Could not find a KernelValue for ${re}`);return le[re]},kernelValueMaps:ge}},{"./kernel-value/array2":41,"./kernel-value/array3":42,"./kernel-value/array4":43,"./kernel-value/boolean":44,"./kernel-value/dynamic-html-image":45,"./kernel-value/dynamic-html-video":46,"./kernel-value/dynamic-memory-optimized-number-texture":47,"./kernel-value/dynamic-number-texture":48,"./kernel-value/dynamic-single-array":49,"./kernel-value/dynamic-single-array1d-i":50,"./kernel-value/dynamic-single-array2d-i":51,"./kernel-value/dynamic-single-array3d-i":52,"./kernel-value/dynamic-single-input":53,"./kernel-value/dynamic-unsigned-array":54,"./kernel-value/dynamic-unsigned-input":55,"./kernel-value/float":56,"./kernel-value/html-image":57,"./kernel-value/html-video":58,"./kernel-value/integer":60,"./kernel-value/memory-optimized-number-texture":61,"./kernel-value/number-texture":62,"./kernel-value/single-array":63,"./kernel-value/single-array1d-i":64,"./kernel-value/single-array2d-i":65,"./kernel-value/single-array3d-i":66,"./kernel-value/single-input":67,"./kernel-value/unsigned-array":68,"./kernel-value/unsigned-input":69}],40:[function(T,B,q){const{WebGLKernelValue:F}=T("./index"),{Input:L}=T("../../../input");B.exports={WebGLKernelArray:class A extends F{checkSize(h,d){if(!this.kernel.validate)return;const{maxTextureSize:u}=this.kernel.constructor.features;if(h>u||d>u)throw h>d?new Error(`Argument texture width of ${h} larger than maximum size of ${u} for your GPU`):h<d?new Error(`Argument texture height of ${d} larger than maximum size of ${u} for your GPU`):new Error(`Argument texture height and width of ${d} larger than maximum size of ${u} for your GPU`)}setup(){this.requestTexture(),this.setupTexture(),this.defineTexture()}requestTexture(){this.texture=this.onRequestTexture()}defineTexture(){const{context:h}=this;h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST)}setupTexture(){this.contextHandle=this.onRequestContextHandle(),this.index=this.onRequestIndex(),this.dimensionsId=this.id+"Dim",this.sizeId=this.id+"Size"}getBitRatio(h){if(Array.isArray(h[0]))return this.getBitRatio(h[0]);if(h.constructor===L)return this.getBitRatio(h.value);switch(h.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}destroy(){this.prevArg&&this.prevArg.delete(),this.context.deleteTexture(this.texture)}}}},{"../../../input":110,"./index":59}],41:[function(T,B,q){const{WebGLKernelValue:F}=T("./index");B.exports={WebGLKernelValueArray2:class L extends F{constructor(x,h){super(x,h),this.uploadValue=x}getSource(x){return"constants"===this.origin?`const vec2 ${this.id} = vec2(${x[0]},${x[1]});\n`:`uniform vec2 ${this.id};\n`}getStringValueHandler(){return"constants"===this.origin?"":`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(x){"constants"!==this.origin&&this.kernel.setUniform2fv(this.id,this.uploadValue=x)}}}},{"./index":59}],42:[function(T,B,q){const{WebGLKernelValue:F}=T("./index");B.exports={WebGLKernelValueArray3:class L extends F{constructor(x,h){super(x,h),this.uploadValue=x}getSource(x){return"constants"===this.origin?`const vec3 ${this.id} = vec3(${x[0]},${x[1]},${x[2]});\n`:`uniform vec3 ${this.id};\n`}getStringValueHandler(){return"constants"===this.origin?"":`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(x){"constants"!==this.origin&&this.kernel.setUniform3fv(this.id,this.uploadValue=x)}}}},{"./index":59}],43:[function(T,B,q){const{WebGLKernelValue:F}=T("./index");B.exports={WebGLKernelValueArray4:class L extends F{constructor(x,h){super(x,h),this.uploadValue=x}getSource(x){return"constants"===this.origin?`const vec4 ${this.id} = vec4(${x[0]},${x[1]},${x[2]},${x[3]});\n`:`uniform vec4 ${this.id};\n`}getStringValueHandler(){return"constants"===this.origin?"":`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(x){"constants"!==this.origin&&this.kernel.setUniform4fv(this.id,this.uploadValue=x)}}}},{"./index":59}],44:[function(T,B,q){T("../../../utils");const{WebGLKernelValue:L}=T("./index");B.exports={WebGLKernelValueBoolean:class A extends L{constructor(h,d){super(h,d),this.uploadValue=h}getSource(h){return"constants"===this.origin?`const bool ${this.id} = ${h};\n`:`uniform bool ${this.id};\n`}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(h){"constants"!==this.origin&&this.kernel.setUniform1i(this.id,this.uploadValue=h)}}}},{"../../../utils":114,"./index":59}],45:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueHTMLImage:L}=T("./html-image");B.exports={WebGLKernelValueDynamicHTMLImage:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){const{width:d,height:u}=h;this.checkSize(d,u),this.dimensions=[d,u,1],this.textureSize=[d,u],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./html-image":57}],46:[function(T,B,q){const{WebGLKernelValueDynamicHTMLImage:F}=T("./dynamic-html-image");B.exports={WebGLKernelValueDynamicHTMLVideo:class L extends F{}}},{"./dynamic-html-image":45}],47:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:L}=T("./memory-optimized-number-texture");B.exports={WebGLKernelValueDynamicMemoryOptimizedNumberTexture:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){this.dimensions=h.dimensions,this.checkSize(h.size[0],h.size[1]),this.textureSize=h.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./memory-optimized-number-texture":61}],48:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueNumberTexture:L}=T("./number-texture");B.exports={WebGLKernelValueDynamicNumberTexture:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){this.dimensions=h.dimensions,this.checkSize(h.size[0],h.size[1]),this.textureSize=h.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./number-texture":62}],49:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleArray:L}=T("./single-array");B.exports={WebGLKernelValueDynamicSingleArray:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){this.dimensions=F.getDimensions(h,!0),this.textureSize=F.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./single-array":63}],50:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleArray1DI:L}=T("./single-array1d-i");B.exports={WebGLKernelValueDynamicSingleArray1DI:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){this.setShape(h),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./single-array1d-i":64}],51:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleArray2DI:L}=T("./single-array2d-i");B.exports={WebGLKernelValueDynamicSingleArray2DI:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){this.setShape(h),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./single-array2d-i":65}],52:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleArray3DI:L}=T("./single-array3d-i");B.exports={WebGLKernelValueDynamicSingleArray3DI:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){this.setShape(h),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./single-array3d-i":66}],53:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleInput:L}=T("./single-input");B.exports={WebGLKernelValueDynamicSingleInput:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){let[d,u,l]=h.size;this.dimensions=new Int32Array([d||1,u||1,l||1]),this.textureSize=F.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./single-input":67}],54:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueUnsignedArray:L}=T("./unsigned-array");B.exports={WebGLKernelValueDynamicUnsignedArray:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){this.dimensions=F.getDimensions(h,!0),this.textureSize=F.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);const d=this.getTransferArrayType(h);this.preUploadValue=new d(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./unsigned-array":68}],55:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueUnsignedInput:L}=T("./unsigned-input");B.exports={WebGLKernelValueDynamicUnsignedInput:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(h){let[d,u,l]=h.size;this.dimensions=new Int32Array([d||1,u||1,l||1]),this.textureSize=F.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);const y=this.getTransferArrayType(h.value);this.preUploadValue=new y(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./unsigned-input":69}],56:[function(T,B,q){T("../../../utils");const{WebGLKernelValue:L}=T("./index");B.exports={WebGLKernelValueFloat:class A extends L{constructor(h,d){super(h,d),this.uploadValue=h}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(h){return"constants"===this.origin?Number.isInteger(h)?`const float ${this.id} = ${h}.0;\n`:`const float ${this.id} = ${h};\n`:`uniform float ${this.id};\n`}updateValue(h){"constants"!==this.origin&&this.kernel.setUniform1f(this.id,this.uploadValue=h)}}}},{"../../../utils":114,"./index":59}],57:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array");B.exports={WebGLKernelValueHTMLImage:class A extends L{constructor(h,d){super(h,d);const{width:u,height:l}=h;this.checkSize(u,l),this.dimensions=[u,l,1],this.textureSize=[u,l],this.uploadValue=h}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,this.uploadValue=h),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],58:[function(T,B,q){const{WebGLKernelValueHTMLImage:F}=T("./html-image");B.exports={WebGLKernelValueHTMLVideo:class L extends F{}}},{"./html-image":57}],59:[function(T,B,q){const{utils:F}=T("../../../utils"),{KernelValue:L}=T("../../kernel-value");B.exports={WebGLKernelValue:class A extends L{constructor(h,d){super(h,d),this.dimensionsId=null,this.sizeId=null,this.initialValueConstructor=h.constructor,this.onRequestTexture=d.onRequestTexture,this.onRequestIndex=d.onRequestIndex,this.uploadValue=null,this.textureSize=null,this.bitRatio=null,this.prevArg=null}get id(){return`${this.origin}_${F.sanitizeName(this.name)}`}setup(){}getTransferArrayType(h){if(Array.isArray(h[0]))return this.getTransferArrayType(h[0]);switch(h.constructor){case Array:case Int32Array:case Int16Array:case Int8Array:return Float32Array;case Uint8ClampedArray:case Uint8Array:case Uint16Array:case Uint32Array:case Float32Array:case Float64Array:return h.constructor}return console.warn("Unfamiliar constructor type.  Will go ahead and use, but likley this may result in a transfer of zeros"),h.constructor}getStringValueHandler(){throw new Error(`"getStringValueHandler" not implemented on ${this.constructor.name}`)}getVariablePrecisionString(){return this.kernel.getVariablePrecisionString(this.textureSize||void 0,this.tactic||void 0)}destroy(){}}}},{"../../../utils":114,"../../kernel-value":35}],60:[function(T,B,q){T("../../../utils");const{WebGLKernelValue:L}=T("./index");B.exports={WebGLKernelValueInteger:class A extends L{constructor(h,d){super(h,d),this.uploadValue=h}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(h){return"constants"===this.origin?`const int ${this.id} = ${parseInt(h)};\n`:`uniform int ${this.id};\n`}updateValue(h){"constants"!==this.origin&&this.kernel.setUniform1i(this.id,this.uploadValue=h)}}}},{"../../../utils":114,"./index":59}],61:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array"),A="Source and destination textures are the same.  Use immutable = true and manually cleanup kernel output texture memory with texture.delete()";B.exports={WebGLKernelValueMemoryOptimizedNumberTexture:class x extends L{constructor(d,u){super(d,u);const[l,y]=d.size;this.checkSize(l,y),this.dimensions=d.dimensions,this.textureSize=d.size,this.uploadValue=d.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;\n`}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(d){if(d.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(d.constructor);if(this.checkContext&&d.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);const{kernel:u,context:l}=this;if(u.pipeline)if(u.immutable)u.updateTextureArgumentRefs(this,d);else{if(u.texture&&u.texture.texture===d.texture)throw new Error(A);if(u.mappedTextures){const{mappedTextures:y}=u;for(let E=0;E<y.length;E++)if(y[E].texture===d.texture)throw new Error(A)}}l.activeTexture(this.contextHandle),l.bindTexture(l.TEXTURE_2D,this.uploadValue=d.texture),this.kernel.setUniform1i(this.id,this.index)}},sameError:A}},{"../../../utils":114,"./array":40}],62:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array"),{sameError:A}=T("./memory-optimized-number-texture");B.exports={WebGLKernelValueNumberTexture:class x extends L{constructor(d,u){super(d,u);const[l,y]=d.size;this.checkSize(l,y);const{size:E,dimensions:N}=d;this.bitRatio=this.getBitRatio(d),this.dimensions=N,this.textureSize=E,this.uploadValue=d.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;\n`}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(d){if(d.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(d.constructor);if(this.checkContext&&d.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);const{kernel:u,context:l}=this;if(u.pipeline)if(u.immutable)u.updateTextureArgumentRefs(this,d);else{if(u.texture&&u.texture.texture===d.texture)throw new Error(A);if(u.mappedTextures){const{mappedTextures:y}=u;for(let E=0;E<y.length;E++)if(y[E].texture===d.texture)throw new Error(A)}}l.activeTexture(this.contextHandle),l.bindTexture(l.TEXTURE_2D,this.uploadValue=d.texture),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40,"./memory-optimized-number-texture":61}],63:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array");B.exports={WebGLKernelValueSingleArray:class A extends L{constructor(h,d){super(h,d),this.bitRatio=4,this.dimensions=F.getDimensions(h,!0),this.textureSize=F.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return F.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flattenTo(h,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],64:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array");B.exports={WebGLKernelValueSingleArray1DI:class A extends L{constructor(h,d){super(h,d),this.bitRatio=4,this.setShape(h)}setShape(h){const d=F.getDimensions(h,!0);this.textureSize=F.getMemoryOptimizedFloatTextureSize(d,this.bitRatio),this.dimensions=new Int32Array([d[1],1,1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return F.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flatten2dArrayTo(h,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],65:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array");B.exports={WebGLKernelValueSingleArray2DI:class A extends L{constructor(h,d){super(h,d),this.bitRatio=4,this.setShape(h)}setShape(h){const d=F.getDimensions(h,!0);this.textureSize=F.getMemoryOptimizedFloatTextureSize(d,this.bitRatio),this.dimensions=new Int32Array([d[1],d[2],1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return F.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flatten3dArrayTo(h,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],66:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array");B.exports={WebGLKernelValueSingleArray3DI:class A extends L{constructor(h,d){super(h,d),this.bitRatio=4,this.setShape(h)}setShape(h){const d=F.getDimensions(h,!0);this.textureSize=F.getMemoryOptimizedFloatTextureSize(d,this.bitRatio),this.dimensions=new Int32Array([d[1],d[2],d[3]]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return F.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flatten4dArrayTo(h,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],67:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array");B.exports={WebGLKernelValueSingleInput:class A extends L{constructor(h,d){super(h,d),this.bitRatio=4;let[u,l,y]=h.size;this.dimensions=new Int32Array([u||1,l||1,y||1]),this.textureSize=F.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return F.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}.value, uploadValue_${this.name})`])}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flattenTo(h.value,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],68:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array");B.exports={WebGLKernelValueUnsignedArray:class A extends L{constructor(h,d){super(h,d),this.bitRatio=this.getBitRatio(h),this.dimensions=F.getDimensions(h,!0),this.textureSize=F.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(h),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return F.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}, preUploadValue_${this.name})`])}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flattenTo(h,this.preUploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],69:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("./array");B.exports={WebGLKernelValueUnsignedInput:class A extends L{constructor(h,d){super(h,d),this.bitRatio=this.getBitRatio(h);const[u,l,y]=h.size;this.dimensions=new Int32Array([u||1,l||1,y||1]),this.textureSize=F.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(h.value),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return F.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}.value, preUploadValue_${this.name})`])}getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(value.constructor);const{context:d}=this;F.flattenTo(h.value,this.preUploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"./array":40}],70:[function(T,B,q){const{GLKernel:F}=T("../gl/kernel"),{FunctionBuilder:L}=T("../function-builder"),{WebGLFunctionNode:A}=T("./function-node"),{utils:x}=T("../../utils"),h=T("../../plugins/math-random-uniformly-distributed"),{fragmentShader:d}=T("./fragment-shader"),{vertexShader:u}=T("./vertex-shader"),{glKernelString:l}=T("../gl/kernel-string"),{lookupKernelValueType:y}=T("./kernel-value-maps");let E=null,N=null,w=null,R=null,M=null;const b=[h],S=[],I={};B.exports={WebGLKernel:class U extends F{static get isSupported(){return null!==E||(this.setupFeatureChecks(),E=this.isContextMatch(w)),E}static setupFeatureChecks(){"undefined"!=typeof document?N=document.createElement("canvas"):"undefined"!=typeof OffscreenCanvas&&(N=new OffscreenCanvas(0,0)),N&&(w=N.getContext("webgl")||N.getContext("experimental-webgl"),w&&w.getExtension&&(R={OES_texture_float:w.getExtension("OES_texture_float"),OES_texture_float_linear:w.getExtension("OES_texture_float_linear"),OES_element_index_uint:w.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:w.getExtension("WEBGL_draw_buffers")},M=this.getFeatures()))}static isContextMatch(v){return"undefined"!=typeof WebGLRenderingContext&&v instanceof WebGLRenderingContext}static getIsTextureFloat(){return Boolean(R.OES_texture_float)}static getIsDrawBuffers(){return Boolean(R.WEBGL_draw_buffers)}static getChannelCount(){return R.WEBGL_draw_buffers?w.getParameter(R.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return w.getParameter(w.MAX_TEXTURE_SIZE)}static lookupKernelValueType(v,g,O,$){return y(v,g,O,$)}static get testCanvas(){return N}static get testContext(){return w}static get features(){return M}static get fragmentShader(){return d}static get vertexShader(){return u}constructor(v,g){super(v,g),this.program=null,this.pipeline=g.pipeline,this.endianness=x.systemEndianness(),this.extensions={},this.argumentTextureCount=0,this.constantTextureCount=0,this.fragShader=null,this.vertShader=null,this.drawBuffersMap=null,this.maxTexSize=null,this.onRequestSwitchKernel=null,this.texture=null,this.mappedTextures=null,this.mergeSettings(v.settings||g),this.threadDim=null,this.framebuffer=null,this.buffer=null,this.textureCache=[],this.programUniformLocationCache={},this.uniform1fCache={},this.uniform1iCache={},this.uniform2fCache={},this.uniform2fvCache={},this.uniform2ivCache={},this.uniform3fvCache={},this.uniform3ivCache={},this.uniform4fvCache={},this.uniform4ivCache={}}initCanvas(){if("undefined"!=typeof document){const v=document.createElement("canvas");return v.width=2,v.height=2,v}if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(0,0)}initContext(){const v={alpha:!1,depth:!1,antialias:!1};return this.canvas.getContext("webgl",v)||this.canvas.getContext("experimental-webgl",v)}initPlugins(v){const g=[],{source:O}=this;if("string"==typeof O)for(let $=0;$<b.length;$++){const ee=b[$];O.match(ee.functionMatch)&&g.push(ee)}else if("object"==typeof O&&v.pluginNames)for(let $=0;$<b.length;$++){const ee=b[$];v.pluginNames.some(j=>j===ee.name)&&g.push(ee)}return g}initExtensions(){this.extensions={OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:this.context.getExtension("WEBGL_color_buffer_float")}}validateSettings(v){if(!this.validate)return void(this.texSize=x.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output));const{features:g}=this.constructor;if(!0===this.optimizeFloatMemory&&!g.isTextureFloat)throw new Error("Float textures are not supported");if("single"===this.precision&&!g.isFloatRead)throw new Error("Single precision not supported");if(!this.graphical&&null===this.precision&&g.isTextureFloat&&(this.precision=g.isFloatRead?"single":"unsigned"),this.subKernels&&this.subKernels.length>0&&!this.extensions.WEBGL_draw_buffers)throw new Error("could not instantiate draw buffers extension");if(null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=!g.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&g.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||0===this.output.length){if(1!==v.length)throw new Error("Auto output only supported for kernels with only one input");const O=x.getVariableType(v[0],this.strictIntegers);switch(O){case"Array":this.output=x.getDimensions(O);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=v[0].output;break;default:throw new Error("Auto output not supported for input type: "+O)}}if(this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");return"precision"===this.precision&&(this.precision="unsigned",console.warn("Cannot use graphical mode and single precision at the same time")),void(this.texSize=x.clone(this.output))}null===this.precision&&g.isTextureFloat&&(this.precision="single"),this.texSize=x.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}updateMaxTexSize(){const{texSize:v,canvas:g}=this;if(null===this.maxTexSize){let O=S.indexOf(g);-1===O&&(O=S.length,S.push(g),I[O]=[v[0],v[1]]),this.maxTexSize=I[O]}this.maxTexSize[0]<v[0]&&(this.maxTexSize[0]=v[0]),this.maxTexSize[1]<v[1]&&(this.maxTexSize[1]=v[1])}setupArguments(v){this.kernelArguments=[],this.argumentTextureCount=0;const g=null===this.argumentTypes;if(g&&(this.argumentTypes=[]),this.argumentSizes=[],this.argumentBitRatios=[],v.length<this.argumentNames.length)throw new Error("not enough arguments for kernel");if(v.length>this.argumentNames.length)throw new Error("too many arguments for kernel");const{context:O}=this;let $=0;const ee=()=>this.createTexture(),G=()=>this.constantTextureCount+$++,j=X=>{this.switchKernels({type:"argumentMismatch",needed:X})},ie=()=>O.TEXTURE0+this.constantTextureCount+this.argumentTextureCount++;for(let X=0;X<v.length;X++){const ge=v[X],fe=this.argumentNames[X];let re;g?(re=x.getVariableType(ge,this.strictIntegers),this.argumentTypes.push(re)):re=this.argumentTypes[X];const pe=this.constructor.lookupKernelValueType(re,this.dynamicArguments?"dynamic":"static",this.precision,v[X]);if(null===pe)return this.requestFallback(v);const _e=new pe(ge,{name:fe,type:re,tactic:this.tactic,origin:"user",context:O,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:ee,onRequestIndex:G,onUpdateValueMismatch:j,onRequestContextHandle:ie});this.kernelArguments.push(_e),_e.setup(),this.argumentSizes.push(_e.textureSize),this.argumentBitRatios[X]=_e.bitRatio}}createTexture(){const v=this.context.createTexture();return this.textureCache.push(v),v}setupConstants(v){const{context:g}=this;this.kernelConstants=[],this.forceUploadKernelConstants=[];let O=null===this.constantTypes;O&&(this.constantTypes={}),this.constantBitRatios={};let $=0;for(const ee in this.constants){const G=this.constants[ee];let j;O?(j=x.getVariableType(G,this.strictIntegers),this.constantTypes[ee]=j):j=this.constantTypes[ee];const ie=this.constructor.lookupKernelValueType(j,"static",this.precision,G);if(null===ie)return this.requestFallback(v);const X=new ie(G,{name:ee,type:j,tactic:this.tactic,origin:"constants",context:this.context,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:()=>this.createTexture(),onRequestIndex:()=>$++,onRequestContextHandle:()=>g.TEXTURE0+this.constantTextureCount++});this.constantBitRatios[ee]=X.bitRatio,this.kernelConstants.push(X),X.setup(),X.forceUploadEachRun&&this.forceUploadKernelConstants.push(X)}}build(){if(this.built||(this.initExtensions(),this.validateSettings(arguments),this.setupConstants(arguments),this.fallbackRequested)||(this.setupArguments(arguments),this.fallbackRequested))return;this.updateMaxTexSize(),this.translateSource();const v=this.pickRenderStrategy(arguments);if(v)return v;const{texSize:g,context:O,canvas:$}=this;O.enable(O.SCISSOR_TEST),O.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),$.width=this.maxTexSize[0],$.height=this.maxTexSize[1];const ee=this.threadDim=Array.from(this.output);for(;ee.length<3;)ee.push(1);const G=this.getVertexShader(arguments),j=O.createShader(O.VERTEX_SHADER);O.shaderSource(j,G),O.compileShader(j),this.vertShader=j;const ie=this.getFragmentShader(arguments),X=O.createShader(O.FRAGMENT_SHADER);if(O.shaderSource(X,ie),O.compileShader(X),this.fragShader=X,this.debug&&(console.log("GLSL Shader Output:"),console.log(ie)),!O.getShaderParameter(j,O.COMPILE_STATUS))throw new Error("Error compiling vertex shader: "+O.getShaderInfoLog(j));if(!O.getShaderParameter(X,O.COMPILE_STATUS))throw new Error("Error compiling fragment shader: "+O.getShaderInfoLog(X));const ge=this.program=O.createProgram();O.attachShader(ge,j),O.attachShader(ge,X),O.linkProgram(ge),this.framebuffer=O.createFramebuffer(),this.framebuffer.width=g[0],this.framebuffer.height=g[1],this.rawValueFramebuffers={};const fe=new Float32Array([-1,-1,1,-1,-1,1,1,1]),re=new Float32Array([0,0,1,0,0,1,1,1]),pe=fe.byteLength;let _e=this.buffer;_e?O.bindBuffer(O.ARRAY_BUFFER,_e):(_e=this.buffer=O.createBuffer(),O.bindBuffer(O.ARRAY_BUFFER,_e),O.bufferData(O.ARRAY_BUFFER,fe.byteLength+re.byteLength,O.STATIC_DRAW)),O.bufferSubData(O.ARRAY_BUFFER,0,fe),O.bufferSubData(O.ARRAY_BUFFER,pe,re);const ye=O.getAttribLocation(this.program,"aPos");O.enableVertexAttribArray(ye),O.vertexAttribPointer(ye,2,O.FLOAT,!1,0,0);const le=O.getAttribLocation(this.program,"aTexCoord");O.enableVertexAttribArray(le),O.vertexAttribPointer(le,2,O.FLOAT,!1,0,pe),O.bindFramebuffer(O.FRAMEBUFFER,this.framebuffer);let he=0;O.useProgram(this.program);for(let Ue in this.constants)this.kernelConstants[he++].updateValue(this.constants[Ue]);this._setupOutputTexture(),null!==this.subKernels&&this.subKernels.length>0&&(this._mappedTextureSwitched={},this._setupSubOutputTextures()),this.buildSignature(arguments),this.built=!0}translateSource(){const v=L.fromKernel(this,A,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=v.getPrototypeString("kernel"),this.setupReturnTypes(v)}setupReturnTypes(v){if(!this.graphical&&!this.returnType&&(this.returnType=v.getKernelResultType()),this.subKernels&&this.subKernels.length>0)for(let g=0;g<this.subKernels.length;g++){const O=this.subKernels[g];O.returnType||(O.returnType=v.getSubKernelResultType(g))}}run(){const{kernelArguments:v,texSize:g,forceUploadKernelConstants:O,context:$}=this;$.useProgram(this.program),$.scissor(0,0,g[0],g[1]),this.dynamicOutput&&(this.setUniform3iv("uOutputDim",new Int32Array(this.threadDim)),this.setUniform2iv("uTexSize",g)),this.setUniform2f("ratio",g[0]/this.maxTexSize[0],g[1]/this.maxTexSize[1]);for(let ee=0;ee<O.length;ee++){const G=O[ee];if(G.updateValue(this.constants[G.name]),this.switchingKernels)return}for(let ee=0;ee<v.length;ee++)if(v[ee].updateValue(arguments[ee]),this.switchingKernels)return;if(this.plugins)for(let ee=0;ee<this.plugins.length;ee++){const G=this.plugins[ee];G.onBeforeRun&&G.onBeforeRun(this)}if(this.graphical)return this.pipeline?($.bindRenderbuffer($.RENDERBUFFER,null),$.bindFramebuffer($.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),$.drawArrays($.TRIANGLE_STRIP,0,4),this.immutable?this.texture.clone():this.texture):($.bindRenderbuffer($.RENDERBUFFER,null),$.bindFramebuffer($.FRAMEBUFFER,null),void $.drawArrays($.TRIANGLE_STRIP,0,4));$.bindFramebuffer($.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),null!==this.subKernels&&(this.immutable&&this._replaceSubOutputTextures(),this.drawBuffers()),$.drawArrays($.TRIANGLE_STRIP,0,4)}drawBuffers(){this.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(this.drawBuffersMap)}getInternalFormat(){return this.context.RGBA}getTextureFormat(){const{context:v}=this;if(this.getInternalFormat()===v.RGBA)return v.RGBA;throw new Error("Unknown internal format")}_replaceOutputTexture(){if(this.texture.beforeMutate()||this._textureSwitched){const v=this.context;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,this.texture.texture,0),this._textureSwitched=!1}}_setupOutputTexture(){const v=this.context,g=this.texSize;if(this.texture)return void v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,this.texture.texture,0);const O=this.createTexture();v.activeTexture(v.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),v.bindTexture(v.TEXTURE_2D,O),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST);const $=this.getInternalFormat();"single"===this.precision?v.texImage2D(v.TEXTURE_2D,0,$,g[0],g[1],0,v.RGBA,v.FLOAT,null):v.texImage2D(v.TEXTURE_2D,0,$,g[0],g[1],0,$,v.UNSIGNED_BYTE,null),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,O,0),this.texture=new this.TextureConstructor({texture:O,size:g,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_replaceSubOutputTextures(){const v=this.context;for(let g=0;g<this.mappedTextures.length;g++){const O=this.mappedTextures[g];(O.beforeMutate()||this._mappedTextureSwitched[g])&&(v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0+g+1,v.TEXTURE_2D,O.texture,0),this._mappedTextureSwitched[g]=!1)}}_setupSubOutputTextures(){const v=this.context;if(this.mappedTextures){for(let O=0;O<this.subKernels.length;O++)v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0+O+1,v.TEXTURE_2D,this.mappedTextures[O].texture,0);return}const g=this.texSize;this.drawBuffersMap=[v.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let O=0;O<this.subKernels.length;O++){const $=this.createTexture();this.drawBuffersMap.push(v.COLOR_ATTACHMENT0+O+1),v.activeTexture(v.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+O),v.bindTexture(v.TEXTURE_2D,$),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST),v.texImage2D(v.TEXTURE_2D,0,v.RGBA,g[0],g[1],0,v.RGBA,"single"===this.precision?v.FLOAT:v.UNSIGNED_BYTE,null),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0+O+1,v.TEXTURE_2D,$,0),this.mappedTextures.push(new this.TextureConstructor({texture:$,size:g,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}setUniform1f(v,g){if(this.uniform1fCache.hasOwnProperty(v)&&g===this.uniform1fCache[v])return;this.uniform1fCache[v]=g;const O=this.getUniformLocation(v);this.context.uniform1f(O,g)}setUniform1i(v,g){if(this.uniform1iCache.hasOwnProperty(v)&&g===this.uniform1iCache[v])return;this.uniform1iCache[v]=g;const O=this.getUniformLocation(v);this.context.uniform1i(O,g)}setUniform2f(v,g,O){if(this.uniform2fCache.hasOwnProperty(v)){const ee=this.uniform2fCache[v];if(g===ee[0]&&O===ee[1])return}this.uniform2fCache[v]=[g,O];const $=this.getUniformLocation(v);this.context.uniform2f($,g,O)}setUniform2fv(v,g){if(this.uniform2fvCache.hasOwnProperty(v)){const $=this.uniform2fvCache[v];if(g[0]===$[0]&&g[1]===$[1])return}this.uniform2fvCache[v]=g;const O=this.getUniformLocation(v);this.context.uniform2fv(O,g)}setUniform2iv(v,g){if(this.uniform2ivCache.hasOwnProperty(v)){const $=this.uniform2ivCache[v];if(g[0]===$[0]&&g[1]===$[1])return}this.uniform2ivCache[v]=g;const O=this.getUniformLocation(v);this.context.uniform2iv(O,g)}setUniform3fv(v,g){if(this.uniform3fvCache.hasOwnProperty(v)){const $=this.uniform3fvCache[v];if(g[0]===$[0]&&g[1]===$[1]&&g[2]===$[2])return}this.uniform3fvCache[v]=g;const O=this.getUniformLocation(v);this.context.uniform3fv(O,g)}setUniform3iv(v,g){if(this.uniform3ivCache.hasOwnProperty(v)){const $=this.uniform3ivCache[v];if(g[0]===$[0]&&g[1]===$[1]&&g[2]===$[2])return}this.uniform3ivCache[v]=g;const O=this.getUniformLocation(v);this.context.uniform3iv(O,g)}setUniform4fv(v,g){if(this.uniform4fvCache.hasOwnProperty(v)){const $=this.uniform4fvCache[v];if(g[0]===$[0]&&g[1]===$[1]&&g[2]===$[2]&&g[3]===$[3])return}this.uniform4fvCache[v]=g;const O=this.getUniformLocation(v);this.context.uniform4fv(O,g)}setUniform4iv(v,g){if(this.uniform4ivCache.hasOwnProperty(v)){const $=this.uniform4ivCache[v];if(g[0]===$[0]&&g[1]===$[1]&&g[2]===$[2]&&g[3]===$[3])return}this.uniform4ivCache[v]=g;const O=this.getUniformLocation(v);this.context.uniform4iv(O,g)}getUniformLocation(v){return this.programUniformLocationCache.hasOwnProperty(v)?this.programUniformLocationCache[v]:this.programUniformLocationCache[v]=this.context.getUniformLocation(this.program,v)}_getFragShaderArtifactMap(v){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),PLUGINS:this._getPluginsString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),DIVIDE_WITH_INTEGER_CHECK:this._getDivideWithIntegerCheckString(),INJECTED_NATIVE:this._getInjectedNative(),MAIN_CONSTANTS:this._getMainConstantsString(),MAIN_ARGUMENTS:this._getMainArgumentsString(v),KERNEL:this.getKernelString(),MAIN_RESULT:this.getMainResultString(),FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getVertShaderArtifactMap(v){return{FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getHeaderString(){return null!==this.subKernels?"#extension GL_EXT_draw_buffers : require\n":""}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};\n`:" 1000;\n"}_getPluginsString(){return this.plugins?this.plugins.map(v=>v.source&&this.source.match(v.functionMatch)?v.source:"").join("\n"):"\n"}_getConstantsString(){const v=[],{threadDim:g,texSize:O}=this;return this.dynamicOutput?v.push("uniform ivec3 uOutputDim","uniform ivec2 uTexSize"):v.push(`ivec3 uOutputDim = ivec3(${g[0]}, ${g[1]}, ${g[2]})`,`ivec2 uTexSize = ivec2(${O[0]}, ${O[1]})`),x.linesToString(v)}_getTextureCoordinate(){const v=this.subKernels;return null===v||v.length<1?"varying vec2 vTexCoord;\n":"out vec2 vTexCoord;\n"}_getDecode32EndiannessString(){return"LE"===this.endianness?"":"  texel.rgba = texel.abgr;\n"}_getEncode32EndiannessString(){return"LE"===this.endianness?"":"  texel.rgba = texel.abgr;\n"}_getDivideWithIntegerCheckString(){return this.fixIntegerDivisionAccuracy?"float divWithIntCheck(float x, float y) {\n  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {\n    return float(int(x) / int(y));\n  }\n  return x / y;\n}\n\nfloat integerCorrectionModulo(float number, float divisor) {\n  if (number < 0.0) {\n    number = abs(number);\n    if (divisor < 0.0) {\n      divisor = abs(divisor);\n    }\n    return -(number - (divisor * floor(divWithIntCheck(number, divisor))));\n  }\n  if (divisor < 0.0) {\n    divisor = abs(divisor);\n  }\n  return number - (divisor * floor(divWithIntCheck(number, divisor)));\n}":""}_getMainArgumentsString(v){const g=[],{argumentNames:O}=this;for(let $=0;$<O.length;$++)g.push(this.kernelArguments[$].getSource(v[$]));return g.join("")}_getInjectedNative(){return this.injectedNative||""}_getMainConstantsString(){const v=[],{constants:g}=this;if(g){let O=0;for(const $ in g)!this.constants.hasOwnProperty($)||v.push(this.kernelConstants[O++].getSource(this.constants[$]))}return v.join("")}getRawValueFramebuffer(v,g){if(this.rawValueFramebuffers[v]||(this.rawValueFramebuffers[v]={}),!this.rawValueFramebuffers[v][g]){const O=this.context.createFramebuffer();O.width=v,O.height=g,this.rawValueFramebuffers[v][g]=O}return this.rawValueFramebuffers[v][g]}getKernelResultDeclaration(){switch(this.returnType){case"Array(2)":return"vec2 kernelResult";case"Array(3)":return"vec3 kernelResult";case"Array(4)":return"vec4 kernelResult";case"LiteralInteger":case"Float":case"Number":case"Integer":return"float kernelResult";default:if(this.graphical)return"float kernelResult";throw new Error(`unrecognized output type "${this.returnType}"`)}}getKernelString(){const v=[this.getKernelResultDeclaration()],{subKernels:g}=this;if(null!==g)switch(this.returnType){case"Number":case"Float":case"Integer":for(let O=0;O<g.length;O++){const $=g[O];v.push("Integer"===$.returnType?`int subKernelResult_${$.name} = 0`:`float subKernelResult_${$.name} = 0.0`)}break;case"Array(2)":for(let O=0;O<g.length;O++)v.push(`vec2 subKernelResult_${g[O].name}`);break;case"Array(3)":for(let O=0;O<g.length;O++)v.push(`vec3 subKernelResult_${g[O].name}`);break;case"Array(4)":for(let O=0;O<g.length;O++)v.push(`vec4 subKernelResult_${g[O].name}`)}return x.linesToString(v)+this.translatedSource}getMainResultGraphical(){return x.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return x.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){const v=[];if(!this.subKernels)return"";for(let g=0;g<this.subKernels.length;g++)v.push("Integer"===this.subKernels[g].returnType?`  gl_FragData[${g+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[g].name}))`:`  gl_FragData[${g+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[g].name})`);return x.linesToString(v)}getMainResultMemoryOptimizedFloats(){const v=["  index *= 4"];switch(this.returnType){case"Number":case"Integer":case"Float":const g=["r","g","b","a"];for(let O=0;O<g.length;O++){const $=g[O];this.getMainResultKernelMemoryOptimizedFloats(v,$),this.getMainResultSubKernelMemoryOptimizedFloats(v,$),O+1<g.length&&v.push("  index += 1")}break;default:throw new Error(`optimized output only usable with Numbers, ${this.returnType} specified`)}return x.linesToString(v)}getMainResultKernelMemoryOptimizedFloats(v,g){v.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0].${g} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats(v,g){if(!this.subKernels)return v;for(let O=0;O<this.subKernels.length;O++)v.push("Integer"===this.subKernels[O].returnType?`  gl_FragData[${O+1}].${g} = float(subKernelResult_${this.subKernels[O].name})`:`  gl_FragData[${O+1}].${g} = subKernelResult_${this.subKernels[O].name}`)}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult"]}getMainResultSubKernelNumberTexture(){const v=[];if(!this.subKernels)return v;for(let g=0;g<this.subKernels.length;++g){const O=this.subKernels[g];v.push("Integer"===O.returnType?`  gl_FragData[${g+1}][0] = float(subKernelResult_${O.name})`:`  gl_FragData[${g+1}][0] = subKernelResult_${O.name}`)}return v}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){const v=[];if(!this.subKernels)return v;for(let g=0;g<this.subKernels.length;++g)v.push(`  gl_FragData[${g+1}][0] = subKernelResult_${this.subKernels[g].name}[0]`,`  gl_FragData[${g+1}][1] = subKernelResult_${this.subKernels[g].name}[1]`);return v}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]","  gl_FragData[0][2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){const v=[];if(!this.subKernels)return v;for(let g=0;g<this.subKernels.length;++g)v.push(`  gl_FragData[${g+1}][0] = subKernelResult_${this.subKernels[g].name}[0]`,`  gl_FragData[${g+1}][1] = subKernelResult_${this.subKernels[g].name}[1]`,`  gl_FragData[${g+1}][2] = subKernelResult_${this.subKernels[g].name}[2]`);return v}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0] = kernelResult"]}getMainResultSubKernelArray4Texture(){const v=[];if(!this.subKernels)return v;switch(this.returnType){case"Number":case"Float":case"Integer":for(let g=0;g<this.subKernels.length;++g)v.push("Integer"===this.subKernels[g].returnType?`  gl_FragData[${g+1}] = float(subKernelResult_${this.subKernels[g].name})`:`  gl_FragData[${g+1}] = subKernelResult_${this.subKernels[g].name}`);break;case"Array(2)":for(let g=0;g<this.subKernels.length;++g)v.push(`  gl_FragData[${g+1}][0] = subKernelResult_${this.subKernels[g].name}[0]`,`  gl_FragData[${g+1}][1] = subKernelResult_${this.subKernels[g].name}[1]`);break;case"Array(3)":for(let g=0;g<this.subKernels.length;++g)v.push(`  gl_FragData[${g+1}][0] = subKernelResult_${this.subKernels[g].name}[0]`,`  gl_FragData[${g+1}][1] = subKernelResult_${this.subKernels[g].name}[1]`,`  gl_FragData[${g+1}][2] = subKernelResult_${this.subKernels[g].name}[2]`);break;case"Array(4)":for(let g=0;g<this.subKernels.length;++g)v.push(`  gl_FragData[${g+1}][0] = subKernelResult_${this.subKernels[g].name}[0]`,`  gl_FragData[${g+1}][1] = subKernelResult_${this.subKernels[g].name}[1]`,`  gl_FragData[${g+1}][2] = subKernelResult_${this.subKernels[g].name}[2]`,`  gl_FragData[${g+1}][3] = subKernelResult_${this.subKernels[g].name}[3]`)}return v}replaceArtifacts(v,g){return v.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z]*[0-9]?)*)__;\n/g,(O,$)=>{if(g.hasOwnProperty($))return g[$];throw`unhandled artifact ${$}`})}getFragmentShader(v){return null!==this.compiledFragmentShader?this.compiledFragmentShader:this.compiledFragmentShader=this.replaceArtifacts(this.constructor.fragmentShader,this._getFragShaderArtifactMap(v))}getVertexShader(v){return null!==this.compiledVertexShader?this.compiledVertexShader:this.compiledVertexShader=this.replaceArtifacts(this.constructor.vertexShader,this._getVertShaderArtifactMap(v))}toString(){const v=x.linesToString(["const gl = context"]);return l(this.constructor,arguments,this,v)}destroy(v){if(!this.context)return;this.buffer&&this.context.deleteBuffer(this.buffer),this.framebuffer&&this.context.deleteFramebuffer(this.framebuffer);for(const O in this.rawValueFramebuffers){for(const $ in this.rawValueFramebuffers[O])this.context.deleteFramebuffer(this.rawValueFramebuffers[O][$]),delete this.rawValueFramebuffers[O][$];delete this.rawValueFramebuffers[O]}if(this.vertShader&&this.context.deleteShader(this.vertShader),this.fragShader&&this.context.deleteShader(this.fragShader),this.program&&this.context.deleteProgram(this.program),this.texture){this.texture.delete();const O=this.textureCache.indexOf(this.texture.texture);O>-1&&this.textureCache.splice(O,1),this.texture=null}if(this.mappedTextures&&this.mappedTextures.length){for(let O=0;O<this.mappedTextures.length;O++){const $=this.mappedTextures[O];$.delete();const ee=this.textureCache.indexOf($.texture);ee>-1&&this.textureCache.splice(ee,1)}this.mappedTextures=null}if(this.kernelArguments)for(let O=0;O<this.kernelArguments.length;O++)this.kernelArguments[O].destroy();if(this.kernelConstants)for(let O=0;O<this.kernelConstants.length;O++)this.kernelConstants[O].destroy();for(;this.textureCache.length>0;){const O=this.textureCache.pop();this.context.deleteTexture(O)}if(v){const O=S.indexOf(this.canvas);O>=0&&(S[O]=null,I[O]=null)}if(this.destroyExtensions(),delete this.context,delete this.canvas,!this.gpu)return;const g=this.gpu.kernels.indexOf(this);-1!==g&&this.gpu.kernels.splice(g,1)}destroyExtensions(){this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext(v){const g=v.getExtension("WEBGL_lose_context");g&&g.loseContext()}toJSON(){const v=super.toJSON();return v.functionNodes=L.fromKernel(this,A).toJSON(),v.settings.threadDim=this.threadDim,v}}}},{"../../plugins/math-random-uniformly-distributed":112,"../../utils":114,"../function-builder":9,"../gl/kernel":13,"../gl/kernel-string":12,"./fragment-shader":37,"./function-node":38,"./kernel-value-maps":39,"./vertex-shader":71}],71:[function(T,B,q){B.exports={vertexShader:"__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n\nattribute vec2 aPos;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"}},{}],72:[function(T,B,q){const F=`#version 300 es\n__HEADER__;\n__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n__SAMPLER_2D_ARRAY_TACTIC_DECLARATION__;\n\nconst int LOOP_MAX = __LOOP_MAX__;\n\n__PLUGINS__;\n__CONSTANTS__;\n\nin vec2 vTexCoord;\n\nfloat atan2(float v1, float v2) {\n  if (v1 == 0.0 || v2 == 0.0) return 0.0;\n  return atan(v1 / v2);\n}\n\nfloat cbrt(float x) {\n  if (x >= 0.0) {\n    return pow(x, 1.0 / 3.0);\n  } else {\n    return -pow(x, 1.0 / 3.0);\n  }\n}\n\nfloat expm1(float x) {\n  return pow(${Math.E}, x) - 1.0; \n}\n\nfloat fround(highp float x) {\n  return x;\n}\n\nfloat imul(float v1, float v2) {\n  return float(int(v1) * int(v2));\n}\n\nfloat log10(float x) {\n  return log2(x) * (1.0 / log2(10.0));\n}\n\nfloat log1p(float x) {\n  return log(1.0 + x);\n}\n\nfloat _pow(float v1, float v2) {\n  if (v2 == 0.0) return 1.0;\n  return pow(v1, v2);\n}\n\nfloat _round(float x) {\n  return floor(x + 0.5);\n}\n\n\nconst int BIT_COUNT = 32;\nint modi(int x, int y) {\n  return x - y * (x / y);\n}\n\nint bitwiseOr(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseXOR(int a, int b) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 || b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseAnd(int a, int b) {\n  int result = 0;\n  int n = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n      result += n;\n    }\n    a = a / 2;\n    b = b / 2;\n    n = n * 2;\n    if(!(a > 0 && b > 0)) {\n      break;\n    }\n  }\n  return result;\n}\nint bitwiseNot(int a) {\n  int result = 0;\n  int n = 1;\n  \n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (modi(a, 2) == 0) {\n      result += n;    \n    }\n    a = a / 2;\n    n = n * 2;\n  }\n  return result;\n}\nint bitwiseZeroFillLeftShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n *= 2;\n  }\n\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nint bitwiseSignedRightShift(int num, int shifts) {\n  return int(floor(float(num) / pow(2.0, float(shifts))));\n}\n\nint bitwiseZeroFillRightShift(int n, int shift) {\n  int maxBytes = BIT_COUNT;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (maxBytes >= n) {\n      break;\n    }\n    maxBytes *= 2;\n  }\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= shift) {\n      break;\n    }\n    n /= 2;\n  }\n  int result = 0;\n  int byteVal = 1;\n  for (int i = 0; i < BIT_COUNT; i++) {\n    if (i >= maxBytes) break;\n    if (modi(n, 2) > 0) { result += byteVal; }\n    n = int(n / 2);\n    byteVal *= 2;\n  }\n  return result;\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x/y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 texel) {\n  __DECODE32_ENDIANNESS__;\n  texel *= 255.0;\n  vec2 gte128;\n  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  texel.b = texel.b - 128.0 * gte128.x;\n  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nfloat decode16(vec4 texel, int index) {\n  int channel = integerMod(index, 2);\n  return texel[channel*2] * 255.0 + texel[channel*2 + 1] * 65280.0;\n}\n\nfloat decode8(vec4 texel, int index) {\n  int channel = integerMod(index, 4);\n  return texel[channel] * 255.0;\n}\n\nvec4 legacyEncode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  texel.rg = integerMod(texel.rg, 256.0);\n  texel.b = integerMod(texel.b, 128.0);\n  texel.a = exponent*0.5 + 63.5;\n  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  texel = floor(texel);\n  texel *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return texel;\n}\n\n// https://github.com/gpujs/gpu.js/wiki/Encoder-details\nvec4 encode32(float value) {\n  if (value == 0.0) return vec4(0, 0, 0, 0);\n\n  float exponent;\n  float mantissa;\n  vec4  result;\n  float sgn;\n\n  sgn = step(0.0, -value);\n  value = abs(value);\n\n  exponent = floor(log2(value));\n\n  mantissa = value*pow(2.0, -exponent)-1.0;\n  exponent = exponent+127.0;\n  result   = vec4(0,0,0,0);\n\n  result.a = floor(exponent/2.0);\n  exponent = exponent - result.a*2.0;\n  result.a = result.a + 128.0*sgn;\n\n  result.b = floor(mantissa * 128.0);\n  mantissa = mantissa - result.b / 128.0;\n  result.b = result.b + exponent*128.0;\n\n  result.g = floor(mantissa*32768.0);\n  mantissa = mantissa - result.g/32768.0;\n\n  result.r = floor(mantissa*8388608.0);\n  return result/255.0;\n}\n// Dragons end here\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  return decode32(texel);\n}\n\nfloat get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int w = texSize.x * 2;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize.x * 2, texSize.y));\n  return decode16(texel, index);\n}\n\nfloat get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int w = texSize.x * 4;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize.x * 4, texSize.y));\n  return decode8(texel, index);\n}\n\nfloat getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + (texDim.x * (y + (texDim.y * z)));\n  int channel = integerMod(index, 4);\n  index = index / 4;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  index = index / 4;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  return texel[channel];\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  return texture(tex, st / vec2(texSize));\n}\n\nvec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  return texture(tex, vec3(st / vec2(texSize), z));\n}\n\nfloat getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return result[0];\n}\n\nvec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec2(result[0], result[1]);\n}\n\nvec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 2);\n  index = index / 2;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  if (channel == 0) return vec2(texel.r, texel.g);\n  if (channel == 1) return vec2(texel.b, texel.a);\n  return vec2(0.0, 0.0);\n}\n\nvec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n  return vec3(result[0], result[1], result[2]);\n}\n\nvec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\n  int vectorIndex = fieldIndex / 4;\n  int vectorOffset = fieldIndex - vectorIndex * 4;\n  int readY = vectorIndex / texSize.x;\n  int readX = vectorIndex - readY * texSize.x;\n  vec4 tex1 = texture(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\n\n  if (vectorOffset == 0) {\n    return tex1.xyz;\n  } else if (vectorOffset == 1) {\n    return tex1.yzw;\n  } else {\n    readX++;\n    if (readX >= texSize.x) {\n      readX = 0;\n      readY++;\n    }\n    vec4 tex2 = texture(tex, vec2(readX, readY) / vec2(texSize));\n    if (vectorOffset == 2) {\n      return vec3(tex1.z, tex1.w, tex2.x);\n    } else {\n      return vec3(tex1.w, tex2.x, tex2.y);\n    }\n  }\n}\n\nvec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  return getImage2D(tex, texSize, texDim, z, y, x);\n}\n\nvec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  int index = x + texDim.x * (y + texDim.y * z);\n  int channel = integerMod(index, 2);\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  return vec4(texel.r, texel.g, texel.b, texel.a);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\nfloat modulo(float number, float divisor) {\n  if (number < 0.0) {\n    number = abs(number);\n    if (divisor < 0.0) {\n      divisor = abs(divisor);\n    }\n    return -mod(number, divisor);\n  }\n  if (divisor < 0.0) {\n    divisor = abs(divisor);\n  }\n  return mod(number, divisor);\n}\n\n__INJECTED_NATIVE__;\n__MAIN_CONSTANTS__;\n__MAIN_ARGUMENTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}`;B.exports={fragmentShader:F}},{}],73:[function(T,B,q){const{utils:F}=T("../../utils"),{WebGLFunctionNode:L}=T("../web-gl/function-node");B.exports={WebGL2FunctionNode:class A extends L{astIdentifierExpression(h,d){if("Identifier"!==h.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",h);const u=this.getType(h),l=F.sanitizeName(h.name);return"Infinity"===h.name?d.push("intBitsToFloat(2139095039)"):"Boolean"===u&&this.argumentNames.indexOf(l)>-1?d.push(`bool(user_${l})`):d.push(`user_${l}`),d}}}},{"../../utils":114,"../web-gl/function-node":38}],74:[function(T,B,q){const{WebGL2KernelValueBoolean:F}=T("./kernel-value/boolean"),{WebGL2KernelValueFloat:L}=T("./kernel-value/float"),{WebGL2KernelValueInteger:A}=T("./kernel-value/integer"),{WebGL2KernelValueHTMLImage:x}=T("./kernel-value/html-image"),{WebGL2KernelValueDynamicHTMLImage:h}=T("./kernel-value/dynamic-html-image"),{WebGL2KernelValueHTMLImageArray:d}=T("./kernel-value/html-image-array"),{WebGL2KernelValueDynamicHTMLImageArray:u}=T("./kernel-value/dynamic-html-image-array"),{WebGL2KernelValueHTMLVideo:l}=T("./kernel-value/html-video"),{WebGL2KernelValueDynamicHTMLVideo:y}=T("./kernel-value/dynamic-html-video"),{WebGL2KernelValueSingleInput:E}=T("./kernel-value/single-input"),{WebGL2KernelValueDynamicSingleInput:N}=T("./kernel-value/dynamic-single-input"),{WebGL2KernelValueUnsignedInput:w}=T("./kernel-value/unsigned-input"),{WebGL2KernelValueDynamicUnsignedInput:R}=T("./kernel-value/dynamic-unsigned-input"),{WebGL2KernelValueMemoryOptimizedNumberTexture:M}=T("./kernel-value/memory-optimized-number-texture"),{WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:b}=T("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGL2KernelValueNumberTexture:S}=T("./kernel-value/number-texture"),{WebGL2KernelValueDynamicNumberTexture:I}=T("./kernel-value/dynamic-number-texture"),{WebGL2KernelValueSingleArray:U}=T("./kernel-value/single-array"),{WebGL2KernelValueDynamicSingleArray:W}=T("./kernel-value/dynamic-single-array"),{WebGL2KernelValueSingleArray1DI:v}=T("./kernel-value/single-array1d-i"),{WebGL2KernelValueDynamicSingleArray1DI:g}=T("./kernel-value/dynamic-single-array1d-i"),{WebGL2KernelValueSingleArray2DI:O}=T("./kernel-value/single-array2d-i"),{WebGL2KernelValueDynamicSingleArray2DI:$}=T("./kernel-value/dynamic-single-array2d-i"),{WebGL2KernelValueSingleArray3DI:ee}=T("./kernel-value/single-array3d-i"),{WebGL2KernelValueDynamicSingleArray3DI:G}=T("./kernel-value/dynamic-single-array3d-i"),{WebGL2KernelValueArray2:j}=T("./kernel-value/array2"),{WebGL2KernelValueArray3:ie}=T("./kernel-value/array3"),{WebGL2KernelValueArray4:X}=T("./kernel-value/array4"),{WebGL2KernelValueUnsignedArray:ge}=T("./kernel-value/unsigned-array"),{WebGL2KernelValueDynamicUnsignedArray:fe}=T("./kernel-value/dynamic-unsigned-array"),re={unsigned:{dynamic:{Boolean:F,Integer:A,Float:L,Array:fe,"Array(2)":j,"Array(3)":ie,"Array(4)":X,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:R,NumberTexture:I,"ArrayTexture(1)":I,"ArrayTexture(2)":I,"ArrayTexture(3)":I,"ArrayTexture(4)":I,MemoryOptimizedNumberTexture:b,HTMLCanvas:h,OffscreenCanvas:h,HTMLImage:h,ImageBitmap:h,ImageData:h,HTMLImageArray:u,HTMLVideo:y},static:{Boolean:F,Float:L,Integer:A,Array:ge,"Array(2)":j,"Array(3)":ie,"Array(4)":X,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:w,NumberTexture:S,"ArrayTexture(1)":S,"ArrayTexture(2)":S,"ArrayTexture(3)":S,"ArrayTexture(4)":S,MemoryOptimizedNumberTexture:b,HTMLCanvas:x,OffscreenCanvas:x,HTMLImage:x,ImageBitmap:x,ImageData:x,HTMLImageArray:d,HTMLVideo:l}},single:{dynamic:{Boolean:F,Integer:A,Float:L,Array:W,"Array(2)":j,"Array(3)":ie,"Array(4)":X,"Array1D(2)":g,"Array1D(3)":g,"Array1D(4)":g,"Array2D(2)":$,"Array2D(3)":$,"Array2D(4)":$,"Array3D(2)":G,"Array3D(3)":G,"Array3D(4)":G,Input:N,NumberTexture:I,"ArrayTexture(1)":I,"ArrayTexture(2)":I,"ArrayTexture(3)":I,"ArrayTexture(4)":I,MemoryOptimizedNumberTexture:b,HTMLCanvas:h,OffscreenCanvas:h,HTMLImage:h,ImageBitmap:h,ImageData:h,HTMLImageArray:u,HTMLVideo:y},static:{Boolean:F,Float:L,Integer:A,Array:U,"Array(2)":j,"Array(3)":ie,"Array(4)":X,"Array1D(2)":v,"Array1D(3)":v,"Array1D(4)":v,"Array2D(2)":O,"Array2D(3)":O,"Array2D(4)":O,"Array3D(2)":ee,"Array3D(3)":ee,"Array3D(4)":ee,Input:E,NumberTexture:S,"ArrayTexture(1)":S,"ArrayTexture(2)":S,"ArrayTexture(3)":S,"ArrayTexture(4)":S,MemoryOptimizedNumberTexture:M,HTMLCanvas:x,OffscreenCanvas:x,HTMLImage:x,ImageBitmap:x,ImageData:x,HTMLImageArray:d,HTMLVideo:l}}};B.exports={kernelValueMaps:re,lookupKernelValueType:function pe(_e,ye,le,he){if(!_e)throw new Error("type missing");if(!ye)throw new Error("dynamic missing");if(!le)throw new Error("precision missing");he.type&&(_e=he.type);const Ue=re[le][ye];if(!1===Ue[_e])return null;if(void 0===Ue[_e])throw new Error(`Could not find a KernelValue for ${_e}`);return Ue[_e]}}},{"./kernel-value/array2":75,"./kernel-value/array3":76,"./kernel-value/array4":77,"./kernel-value/boolean":78,"./kernel-value/dynamic-html-image":80,"./kernel-value/dynamic-html-image-array":79,"./kernel-value/dynamic-html-video":81,"./kernel-value/dynamic-memory-optimized-number-texture":82,"./kernel-value/dynamic-number-texture":83,"./kernel-value/dynamic-single-array":84,"./kernel-value/dynamic-single-array1d-i":85,"./kernel-value/dynamic-single-array2d-i":86,"./kernel-value/dynamic-single-array3d-i":87,"./kernel-value/dynamic-single-input":88,"./kernel-value/dynamic-unsigned-array":89,"./kernel-value/dynamic-unsigned-input":90,"./kernel-value/float":91,"./kernel-value/html-image":93,"./kernel-value/html-image-array":92,"./kernel-value/html-video":94,"./kernel-value/integer":95,"./kernel-value/memory-optimized-number-texture":96,"./kernel-value/number-texture":97,"./kernel-value/single-array":98,"./kernel-value/single-array1d-i":99,"./kernel-value/single-array2d-i":100,"./kernel-value/single-array3d-i":101,"./kernel-value/single-input":102,"./kernel-value/unsigned-array":103,"./kernel-value/unsigned-input":104}],75:[function(T,B,q){const{WebGLKernelValueArray2:F}=T("../../web-gl/kernel-value/array2");B.exports={WebGL2KernelValueArray2:class L extends F{}}},{"../../web-gl/kernel-value/array2":41}],76:[function(T,B,q){const{WebGLKernelValueArray3:F}=T("../../web-gl/kernel-value/array3");B.exports={WebGL2KernelValueArray3:class L extends F{}}},{"../../web-gl/kernel-value/array3":42}],77:[function(T,B,q){const{WebGLKernelValueArray4:F}=T("../../web-gl/kernel-value/array4");B.exports={WebGL2KernelValueArray4:class L extends F{}}},{"../../web-gl/kernel-value/array4":43}],78:[function(T,B,q){const{WebGLKernelValueBoolean:F}=T("../../web-gl/kernel-value/boolean");B.exports={WebGL2KernelValueBoolean:class L extends F{}}},{"../../web-gl/kernel-value/boolean":44}],79:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGL2KernelValueHTMLImageArray:L}=T("./html-image-array");B.exports={WebGL2KernelValueDynamicHTMLImageArray:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2DArray ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}updateValue(h){const{width:d,height:u}=h[0];this.checkSize(d,u),this.dimensions=[d,u,h.length],this.textureSize=[d,u],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"./html-image-array":92}],80:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueDynamicHTMLImage:L}=T("../../web-gl/kernel-value/dynamic-html-image");B.exports={WebGL2KernelValueDynamicHTMLImage:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-html-image":45}],81:[function(T,B,q){T("../../../utils");const{WebGL2KernelValueDynamicHTMLImage:L}=T("./dynamic-html-image");B.exports={WebGL2KernelValueDynamicHTMLVideo:class A extends L{}}},{"../../../utils":114,"./dynamic-html-image":80}],82:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:L}=T("../../web-gl/kernel-value/dynamic-memory-optimized-number-texture");B.exports={WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:class A extends L{getSource(){return F.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-memory-optimized-number-texture":47}],83:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueDynamicNumberTexture:L}=T("../../web-gl/kernel-value/dynamic-number-texture");B.exports={WebGL2KernelValueDynamicNumberTexture:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-number-texture":48}],84:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGL2KernelValueSingleArray:L}=T("../../web-gl2/kernel-value/single-array");B.exports={WebGL2KernelValueDynamicSingleArray:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}updateValue(h){this.dimensions=F.getDimensions(h,!0),this.textureSize=F.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array":98}],85:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGL2KernelValueSingleArray1DI:L}=T("../../web-gl2/kernel-value/single-array1d-i");B.exports={WebGL2KernelValueDynamicSingleArray1DI:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}updateValue(h){this.setShape(h),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array1d-i":99}],86:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGL2KernelValueSingleArray2DI:L}=T("../../web-gl2/kernel-value/single-array2d-i");B.exports={WebGL2KernelValueDynamicSingleArray2DI:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}updateValue(h){this.setShape(h),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array2d-i":100}],87:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGL2KernelValueSingleArray3DI:L}=T("../../web-gl2/kernel-value/single-array3d-i");B.exports={WebGL2KernelValueDynamicSingleArray3DI:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}updateValue(h){this.setShape(h),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array3d-i":101}],88:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGL2KernelValueSingleInput:L}=T("../../web-gl2/kernel-value/single-input");B.exports={WebGL2KernelValueDynamicSingleInput:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}updateValue(h){let[d,u,l]=h.size;this.dimensions=new Int32Array([d||1,u||1,l||1]),this.textureSize=F.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(h)}}}},{"../../../utils":114,"../../web-gl2/kernel-value/single-input":102}],89:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueDynamicUnsignedArray:L}=T("../../web-gl/kernel-value/dynamic-unsigned-array");B.exports={WebGL2KernelValueDynamicUnsignedArray:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-array":54}],90:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueDynamicUnsignedInput:L}=T("../../web-gl/kernel-value/dynamic-unsigned-input");B.exports={WebGL2KernelValueDynamicUnsignedInput:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`uniform ${h} ivec2 ${this.sizeId}`,`uniform ${h} ivec3 ${this.dimensionsId}`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-input":55}],91:[function(T,B,q){T("../../../utils");const{WebGLKernelValueFloat:L}=T("../../web-gl/kernel-value/float");B.exports={WebGL2KernelValueFloat:class A extends L{}}},{"../../../utils":114,"../../web-gl/kernel-value/float":56}],92:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelArray:L}=T("../../web-gl/kernel-value/array");B.exports={WebGL2KernelValueHTMLImageArray:class A extends L{constructor(h,d){super(h,d),this.checkSize(h[0].width,h[0].height),this.dimensions=[h[0].width,h[0].height,h.length],this.textureSize=[h[0].width,h[0].height]}defineTexture(){const{context:h}=this;h.activeTexture(this.contextHandle),h.bindTexture(h.TEXTURE_2D_ARRAY,this.texture),h.texParameteri(h.TEXTURE_2D_ARRAY,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D_ARRAY,h.TEXTURE_MIN_FILTER,h.NEAREST)}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2DArray ${this.id}`,`${h} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${h} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){const{context:d}=this;d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D_ARRAY,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0),d.texImage3D(d.TEXTURE_2D_ARRAY,0,d.RGBA,h[0].width,h[0].height,h.length,0,d.RGBA,d.UNSIGNED_BYTE,null);for(let u=0;u<h.length;u++)d.texSubImage3D(d.TEXTURE_2D_ARRAY,0,0,0,u,h[u].width,h[u].height,1,d.RGBA,d.UNSIGNED_BYTE,this.uploadValue=h[u]);this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/array":40}],93:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueHTMLImage:L}=T("../../web-gl/kernel-value/html-image");B.exports={WebGL2KernelValueHTMLImage:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`${h} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${h} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/html-image":57}],94:[function(T,B,q){T("../../../utils");const{WebGL2KernelValueHTMLImage:L}=T("./html-image");B.exports={WebGL2KernelValueHTMLVideo:class A extends L{}}},{"../../../utils":114,"./html-image":93}],95:[function(T,B,q){const{WebGLKernelValueInteger:F}=T("../../web-gl/kernel-value/integer");B.exports={WebGL2KernelValueInteger:class L extends F{getSource(x){const h=this.getVariablePrecisionString();return"constants"===this.origin?`const ${h} int ${this.id} = ${parseInt(x)};\n`:`uniform ${h} int ${this.id};\n`}updateValue(x){"constants"!==this.origin&&this.kernel.setUniform1i(this.id,this.uploadValue=x)}}}},{"../../web-gl/kernel-value/integer":60}],96:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:L}=T("../../web-gl/kernel-value/memory-optimized-number-texture");B.exports={WebGL2KernelValueMemoryOptimizedNumberTexture:class A extends L{getSource(){const{id:h,sizeId:d,textureSize:u,dimensionsId:l,dimensions:y}=this,E=this.getVariablePrecisionString();return F.linesToString([`uniform sampler2D ${h}`,`${E} ivec2 ${d} = ivec2(${u[0]}, ${u[1]})`,`${E} ivec3 ${l} = ivec3(${y[0]}, ${y[1]}, ${y[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/memory-optimized-number-texture":61}],97:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueNumberTexture:L}=T("../../web-gl/kernel-value/number-texture");B.exports={WebGL2KernelValueNumberTexture:class A extends L{getSource(){const{id:h,sizeId:d,textureSize:u,dimensionsId:l,dimensions:y}=this,E=this.getVariablePrecisionString();return F.linesToString([`uniform ${E} sampler2D ${h}`,`${E} ivec2 ${d} = ivec2(${u[0]}, ${u[1]})`,`${E} ivec3 ${l} = ivec3(${y[0]}, ${y[1]}, ${y[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/number-texture":62}],98:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleArray:L}=T("../../web-gl/kernel-value/single-array");B.exports={WebGL2KernelValueSingleArray:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`${h} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${h} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flattenTo(h,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA32F,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-array":63}],99:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleArray1DI:L}=T("../../web-gl/kernel-value/single-array1d-i");B.exports={WebGL2KernelValueSingleArray1DI:class A extends L{updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flattenTo(h,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA32F,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-array1d-i":64}],100:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleArray2DI:L}=T("../../web-gl/kernel-value/single-array2d-i");B.exports={WebGL2KernelValueSingleArray2DI:class A extends L{updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flattenTo(h,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA32F,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-array2d-i":65}],101:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleArray3DI:L}=T("../../web-gl/kernel-value/single-array3d-i");B.exports={WebGL2KernelValueSingleArray3DI:class A extends L{updateValue(h){if(h.constructor!==this.initialValueConstructor)return void this.onUpdateValueMismatch(h.constructor);const{context:d}=this;F.flattenTo(h,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA32F,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-array3d-i":66}],102:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueSingleInput:L}=T("../../web-gl/kernel-value/single-input");B.exports={WebGL2KernelValueSingleInput:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`${h} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${h} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(h){const{context:d}=this;F.flattenTo(h.value,this.uploadValue),d.activeTexture(this.contextHandle),d.bindTexture(d.TEXTURE_2D,this.texture),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texImage2D(d.TEXTURE_2D,0,d.RGBA32F,this.textureSize[0],this.textureSize[1],0,d.RGBA,d.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}}},{"../../../utils":114,"../../web-gl/kernel-value/single-input":67}],103:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueUnsignedArray:L}=T("../../web-gl/kernel-value/unsigned-array");B.exports={WebGL2KernelValueUnsignedArray:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`${h} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${h} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-array":68}],104:[function(T,B,q){const{utils:F}=T("../../../utils"),{WebGLKernelValueUnsignedInput:L}=T("../../web-gl/kernel-value/unsigned-input");B.exports={WebGL2KernelValueUnsignedInput:class A extends L{getSource(){const h=this.getVariablePrecisionString();return F.linesToString([`uniform ${h} sampler2D ${this.id}`,`${h} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${h} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-input":69}],105:[function(T,B,q){const{WebGLKernel:F}=T("../web-gl/kernel"),{WebGL2FunctionNode:L}=T("./function-node"),{FunctionBuilder:A}=T("../function-builder"),{utils:x}=T("../../utils"),{fragmentShader:h}=T("./fragment-shader"),{vertexShader:d}=T("./vertex-shader"),{lookupKernelValueType:u}=T("./kernel-value-maps");let l=null,y=null,E=null,N=null,w=null;B.exports={WebGL2Kernel:class R extends F{static get isSupported(){return null!==l||(this.setupFeatureChecks(),l=this.isContextMatch(E)),l}static setupFeatureChecks(){"undefined"!=typeof document?y=document.createElement("canvas"):"undefined"!=typeof OffscreenCanvas&&(y=new OffscreenCanvas(0,0)),y&&(E=y.getContext("webgl2"),E&&E.getExtension&&(N={EXT_color_buffer_float:E.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:E.getExtension("OES_texture_float_linear")},w=this.getFeatures()))}static isContextMatch(b){return"undefined"!=typeof WebGL2RenderingContext&&b instanceof WebGL2RenderingContext}static getFeatures(){const b=this.testContext;return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),kernelMap:!0,isTextureFloat:!0,isDrawBuffers:!0,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.LOW_INT),lowFloatPrecision:b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.LOW_FLOAT),mediumIntPrecision:b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_INT),mediumFloatPrecision:b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_FLOAT),highIntPrecision:b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_INT),highFloatPrecision:b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT)})}static getIsTextureFloat(){return!0}static getChannelCount(){return E.getParameter(E.MAX_DRAW_BUFFERS)}static getMaxTextureSize(){return E.getParameter(E.MAX_TEXTURE_SIZE)}static lookupKernelValueType(b,S,I,U){return u(b,S,I,U)}static get testCanvas(){return y}static get testContext(){return E}static get features(){return w}static get fragmentShader(){return h}static get vertexShader(){return d}initContext(){return this.canvas.getContext("webgl2",{alpha:!1,depth:!1,antialias:!1})}initExtensions(){this.extensions={EXT_color_buffer_float:this.context.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear")}}validateSettings(b){if(!this.validate)return void(this.texSize=x.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output));const{features:S}=this.constructor;if("single"===this.precision&&!S.isFloatRead)throw new Error("Float texture outputs are not supported");if(!this.graphical&&null===this.precision&&(this.precision=S.isFloatRead?"single":"unsigned"),null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=!S.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&S.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||0===this.output.length){if(1!==b.length)throw new Error("Auto output only supported for kernels with only one input");const I=x.getVariableType(b[0],this.strictIntegers);switch(I){case"Array":this.output=x.getDimensions(I);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=b[0].output;break;default:throw new Error("Auto output not supported for input type: "+I)}}if(this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");return"single"===this.precision&&(console.warn("Cannot use graphical mode and single precision at the same time"),this.precision="unsigned"),void(this.texSize=x.clone(this.output))}!this.graphical&&null===this.precision&&S.isTextureFloat&&(this.precision="single"),this.texSize=x.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}translateSource(){const b=A.fromKernel(this,L,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=b.getPrototypeString("kernel"),this.setupReturnTypes(b)}drawBuffers(){this.context.drawBuffers(this.drawBuffersMap)}getTextureFormat(){const{context:b}=this;switch(this.getInternalFormat()){case b.R32F:return b.RED;case b.RG32F:return b.RG;case b.RGBA32F:case b.RGBA:return b.RGBA;default:throw new Error("Unknown internal format")}}getInternalFormat(){const{context:b}=this;if("single"===this.precision){if(this.pipeline)switch(this.returnType){case"Number":case"Float":case"Integer":return this.optimizeFloatMemory?b.RGBA32F:b.R32F;case"Array(2)":return b.RG32F;case"Array(3)":case"Array(4)":return b.RGBA32F;default:throw new Error("Unhandled return type")}return b.RGBA32F}return b.RGBA}_setupOutputTexture(){const b=this.context;if(this.texture)return void b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.texture.texture,0);b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);const S=b.createTexture(),I=this.texSize;b.activeTexture(b.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),b.bindTexture(b.TEXTURE_2D,S),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);const U=this.getInternalFormat();"single"===this.precision?b.texStorage2D(b.TEXTURE_2D,1,U,I[0],I[1]):b.texImage2D(b.TEXTURE_2D,0,U,I[0],I[1],0,U,b.UNSIGNED_BYTE,null),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,S,0),this.texture=new this.TextureConstructor({texture:S,size:I,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_setupSubOutputTextures(){const b=this.context;if(this.mappedTextures){for(let I=0;I<this.subKernels.length;I++)b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+I+1,b.TEXTURE_2D,this.mappedTextures[I].texture,0);return}const S=this.texSize;this.drawBuffersMap=[b.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let I=0;I<this.subKernels.length;I++){const U=this.createTexture();this.drawBuffersMap.push(b.COLOR_ATTACHMENT0+I+1),b.activeTexture(b.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+I),b.bindTexture(b.TEXTURE_2D,U),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);const W=this.getInternalFormat();"single"===this.precision?b.texStorage2D(b.TEXTURE_2D,1,W,S[0],S[1]):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,S[0],S[1],0,b.RGBA,b.UNSIGNED_BYTE,null),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+I+1,b.TEXTURE_2D,U,0),this.mappedTextures.push(new this.TextureConstructor({texture:U,size:S,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}_getHeaderString(){return""}_getTextureCoordinate(){const b=this.subKernels,S=this.getVariablePrecisionString(this.texSize,this.tactic);return null===b||b.length<1?`in ${S} vec2 vTexCoord;\n`:`out ${S} vec2 vTexCoord;\n`}_getMainArgumentsString(b){const S=[],I=this.argumentNames;for(let U=0;U<I.length;U++)S.push(this.kernelArguments[U].getSource(b[U]));return S.join("")}getKernelString(){const b=[this.getKernelResultDeclaration()],S=this.subKernels;if(null!==S)switch(b.push("layout(location = 0) out vec4 data0"),this.returnType){case"Number":case"Float":case"Integer":for(let I=0;I<S.length;I++){const U=S[I];b.push("Integer"===U.returnType?`int subKernelResult_${U.name} = 0`:`float subKernelResult_${U.name} = 0.0`,`layout(location = ${I+1}) out vec4 data${I+1}`)}break;case"Array(2)":for(let I=0;I<S.length;I++)b.push(`vec2 subKernelResult_${S[I].name}`,`layout(location = ${I+1}) out vec4 data${I+1}`);break;case"Array(3)":for(let I=0;I<S.length;I++)b.push(`vec3 subKernelResult_${S[I].name}`,`layout(location = ${I+1}) out vec4 data${I+1}`);break;case"Array(4)":for(let I=0;I<S.length;I++)b.push(`vec4 subKernelResult_${S[I].name}`,`layout(location = ${I+1}) out vec4 data${I+1}`)}else b.push("out vec4 data0");return x.linesToString(b)+this.translatedSource}getMainResultGraphical(){return x.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return x.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0 = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){const b=[];if(!this.subKernels)return"";for(let S=0;S<this.subKernels.length;S++)b.push("Integer"===this.subKernels[S].returnType?`  data${S+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[S].name}))`:`  data${S+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[S].name})`);return x.linesToString(b)}getMainResultKernelMemoryOptimizedFloats(b,S){b.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0.${S} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats(b,S){if(!this.subKernels)return b;for(let I=0;I<this.subKernels.length;I++){const U=this.subKernels[I];b.push("Integer"===U.returnType?`  data${I+1}.${S} = float(subKernelResult_${U.name})`:`  data${I+1}.${S} = subKernelResult_${U.name}`)}}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult"]}getMainResultSubKernelNumberTexture(){const b=[];if(!this.subKernels)return b;for(let S=0;S<this.subKernels.length;++S){const I=this.subKernels[S];b.push("Integer"===I.returnType?`  data${S+1}[0] = float(subKernelResult_${I.name})`:`  data${S+1}[0] = subKernelResult_${I.name}`)}return b}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){const b=[];if(!this.subKernels)return b;for(let S=0;S<this.subKernels.length;++S){const I=this.subKernels[S];b.push(`  data${S+1}[0] = subKernelResult_${I.name}[0]`,`  data${S+1}[1] = subKernelResult_${I.name}[1]`)}return b}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]","  data0[2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){const b=[];if(!this.subKernels)return b;for(let S=0;S<this.subKernels.length;++S){const I=this.subKernels[S];b.push(`  data${S+1}[0] = subKernelResult_${I.name}[0]`,`  data${S+1}[1] = subKernelResult_${I.name}[1]`,`  data${S+1}[2] = subKernelResult_${I.name}[2]`)}return b}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = kernelResult"]}getMainResultSubKernelArray4Texture(){const b=[];if(!this.subKernels)return b;for(let S=0;S<this.subKernels.length;++S)b.push(`  data${S+1} = subKernelResult_${this.subKernels[S].name}`);return b}destroyExtensions(){this.extensions.EXT_color_buffer_float=null,this.extensions.OES_texture_float_linear=null}toJSON(){const b=super.toJSON();return b.functionNodes=A.fromKernel(this,L).toJSON(),b.settings.threadDim=this.threadDim,b}}}},{"../../utils":114,"../function-builder":9,"../web-gl/kernel":70,"./fragment-shader":72,"./function-node":73,"./kernel-value-maps":74,"./vertex-shader":106}],106:[function(T,B,q){B.exports={vertexShader:"#version 300 es\n__FLOAT_TACTIC_DECLARATION__;\n__INT_TACTIC_DECLARATION__;\n__SAMPLER_2D_TACTIC_DECLARATION__;\n\nin vec2 aPos;\nin vec2 aTexCoord;\n\nout vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"}},{}],107:[function(T,B,q){const F=T("./index"),L=F.GPU;for(const x in F)!F.hasOwnProperty(x)||"GPU"!==x&&(L[x]=F[x]);function A(x){x.GPU||Object.defineProperty(x,"GPU",{get:()=>L})}"undefined"!=typeof window&&A(window),"undefined"!=typeof self&&A(self),B.exports=F},{"./index":109}],108:[function(T,B,q){const{gpuMock:F}=T("gpu-mock.js"),{utils:L}=T("./utils"),{CPUKernel:x}=(T("./backend/kernel"),T("./backend/cpu/kernel")),{HeadlessGLKernel:h}=T("./backend/headless-gl/kernel"),{WebGL2Kernel:d}=T("./backend/web-gl2/kernel"),{WebGLKernel:u}=T("./backend/web-gl/kernel"),{kernelRunShortcut:l}=T("./kernel-run-shortcut"),y=[h,d,u],E=["gpu","cpu"],N={headlessgl:h,webgl2:d,webgl:u};let w=!0;function M(b){if(!b)return{};const S=Object.assign({},b);return b.hasOwnProperty("floatOutput")&&(L.warnDeprecated("setting","floatOutput","precision"),S.precision=b.floatOutput?"single":"unsigned"),b.hasOwnProperty("outputToTexture")&&(L.warnDeprecated("setting","outputToTexture","pipeline"),S.pipeline=Boolean(b.outputToTexture)),b.hasOwnProperty("outputImmutable")&&(L.warnDeprecated("setting","outputImmutable","immutable"),S.immutable=Boolean(b.outputImmutable)),b.hasOwnProperty("floatTextures")&&(L.warnDeprecated("setting","floatTextures","optimizeFloatMemory"),S.optimizeFloatMemory=Boolean(b.floatTextures)),S}B.exports={GPU:class R{static disableValidation(){w=!1}static enableValidation(){w=!0}static get isGPUSupported(){return y.some(S=>S.isSupported)}static get isKernelMapSupported(){return y.some(S=>S.isSupported&&S.features.kernelMap)}static get isOffscreenCanvasSupported(){return"undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas||"undefined"!=typeof importScripts}static get isWebGLSupported(){return u.isSupported}static get isWebGL2Supported(){return d.isSupported}static get isHeadlessGLSupported(){return h.isSupported}static get isCanvasSupported(){return"undefined"!=typeof HTMLCanvasElement}static get isGPUHTMLImageArraySupported(){return d.isSupported}static get isSinglePrecisionSupported(){return y.some(S=>S.isSupported&&S.features.isFloatRead&&S.features.isTextureFloat)}constructor(S){if(this.canvas=(S=S||{}).canvas||null,this.context=S.context||null,this.mode=S.mode,this.Kernel=null,this.kernels=[],this.functions=[],this.nativeFunctions=[],this.injectedNative=null,"dev"!==this.mode){if(this.chooseKernel(),S.functions)for(let I=0;I<S.functions.length;I++)this.addFunction(S.functions[I]);if(S.nativeFunctions)for(const I in S.nativeFunctions){if(!S.nativeFunctions.hasOwnProperty(I))continue;const U=S.nativeFunctions[I],{name:W,source:v}=U;this.addNativeFunction(W,v,U)}}}chooseKernel(){if(this.Kernel)return;let S=null;if(this.context){for(let I=0;I<y.length;I++){const U=y[I];if(U.isContextMatch(this.context)){if(!U.isSupported)throw new Error(`Kernel type ${U.name} not supported`);S=U;break}}if(null===S)throw new Error("unknown Context")}else if(this.mode){if(this.mode in N)(!w||N[this.mode].isSupported)&&(S=N[this.mode]);else if("gpu"===this.mode){for(let I=0;I<y.length;I++)if(y[I].isSupported){S=y[I];break}}else"cpu"===this.mode&&(S=x);if(!S)throw new Error(`A requested mode of "${this.mode}" and is not supported`)}else{for(let I=0;I<y.length;I++)if(y[I].isSupported){S=y[I];break}S||(S=x)}this.mode||(this.mode=S.mode),this.Kernel=S}createKernel(S,I){if(void 0===S)throw new Error("Missing source parameter");if("object"!=typeof S&&!L.isFunction(S)&&"string"!=typeof S)throw new Error("source parameter not a function");const U=this.kernels;if("dev"===this.mode){const j=F(S,M(I));return U.push(j),j}S="function"==typeof S?S.toString():S;const W={},v=M(I)||{};function g(j){console.warn("Falling back to CPU");const ie=new x(S,{argumentTypes:G.argumentTypes,constantTypes:G.constantTypes,graphical:G.graphical,loopMaxIterations:G.loopMaxIterations,constants:G.constants,dynamicOutput:G.dynamicOutput,dynamicArgument:G.dynamicArguments,output:G.output,precision:G.precision,pipeline:G.pipeline,immutable:G.immutable,optimizeFloatMemory:G.optimizeFloatMemory,fixIntegerDivisionAccuracy:G.fixIntegerDivisionAccuracy,functions:G.functions,nativeFunctions:G.nativeFunctions,injectedNative:G.injectedNative,subKernels:G.subKernels,strictIntegers:G.strictIntegers,debug:G.debug});ie.build.apply(ie,j);const X=ie.run.apply(ie,j);return G.replaceKernel(ie),X}I&&"object"==typeof I.argumentTypes&&(v.argumentTypes=Object.keys(I.argumentTypes).map(j=>I.argumentTypes[j]));const $=Object.assign({context:this.context,canvas:this.canvas,functions:this.functions,nativeFunctions:this.nativeFunctions,injectedNative:this.injectedNative,gpu:this,validate:w,onRequestFallback:g,onRequestSwitchKernel:function O(j,ie,X){X.debug&&console.warn("Switching kernels");let ge=null;if(X.signature&&!W[X.signature]&&(W[X.signature]=X),X.dynamicOutput)for(let le=j.length-1;le>=0;le--){const he=j[le];"outputPrecisionMismatch"===he.type&&(ge=he.needed)}const fe=X.constructor,re=fe.getArgumentTypes(X,ie),pe=fe.getSignature(X,re),_e=W[pe];if(_e)return _e.onActivate(X),_e;const ye=W[pe]=new fe(S,{argumentTypes:re,constantTypes:X.constantTypes,graphical:X.graphical,loopMaxIterations:X.loopMaxIterations,constants:X.constants,dynamicOutput:X.dynamicOutput,dynamicArgument:X.dynamicArguments,context:X.context,canvas:X.canvas,output:ge||X.output,precision:X.precision,pipeline:X.pipeline,immutable:X.immutable,optimizeFloatMemory:X.optimizeFloatMemory,fixIntegerDivisionAccuracy:X.fixIntegerDivisionAccuracy,functions:X.functions,nativeFunctions:X.nativeFunctions,injectedNative:X.injectedNative,subKernels:X.subKernels,strictIntegers:X.strictIntegers,debug:X.debug,gpu:X.gpu,validate:w,returnType:X.returnType,tactic:X.tactic,onRequestFallback:g,onRequestSwitchKernel:O,texture:X.texture,mappedTextures:X.mappedTextures,drawBuffersMap:X.drawBuffersMap});return ye.build.apply(ye,ie),G.replaceKernel(ye),U.push(ye),ye}},v),ee=new this.Kernel(S,$),G=l(ee);return this.canvas||(this.canvas=ee.canvas),this.context||(this.context=ee.context),U.push(ee),G}createKernelMap(){let S,I;const U=typeof arguments[arguments.length-2];if("function"===U||"string"===U?(S=arguments[arguments.length-2],I=arguments[arguments.length-1]):S=arguments[arguments.length-1],"dev"!==this.mode&&(!this.Kernel.isSupported||!this.Kernel.features.kernelMap)&&this.mode&&E.indexOf(this.mode)<0)throw new Error(`kernelMap not supported on ${this.Kernel.name}`);const W=M(I);if(I&&"object"==typeof I.argumentTypes&&(W.argumentTypes=Object.keys(I.argumentTypes).map(v=>I.argumentTypes[v])),Array.isArray(arguments[0])){W.subKernels=[];const v=arguments[0];for(let g=0;g<v.length;g++){const O=v[g].toString(),$=L.getFunctionNameFromString(O);W.subKernels.push({name:$,source:O,property:g})}}else{W.subKernels=[];const v=arguments[0];for(let g in v){if(!v.hasOwnProperty(g))continue;const O=v[g].toString(),$=L.getFunctionNameFromString(O);W.subKernels.push({name:$||g,source:O,property:g})}}return this.createKernel(S,W)}combineKernels(){const I=arguments[arguments.length-1];if("cpu"===arguments[0].kernel.constructor.mode)return I;const U=arguments[0].canvas,W=arguments[0].context,v=arguments.length-1;for(let g=0;g<v;g++)arguments[g].setCanvas(U).setContext(W).setPipeline(!0);return function(){const g=I.apply(this,arguments);return g.toArray?g.toArray():g}}setFunctions(S){return this.functions=S,this}setNativeFunctions(S){return this.nativeFunctions=S,this}addFunction(S,I){return this.functions.push({source:S,settings:I}),this}addNativeFunction(S,I,U){if(this.kernels.length>0)throw new Error('Cannot call "addNativeFunction" after "createKernels" has been called.');return this.nativeFunctions.push(Object.assign({name:S,source:I},U)),this}injectNative(S){return this.injectedNative=S,this}destroy(){return new Promise((S,I)=>{this.kernels||S(),setTimeout(()=>{try{for(let W=0;W<this.kernels.length;W++)this.kernels[W].destroy(!0);let U=this.kernels[0];U&&(U.kernel&&(U=U.kernel),U.constructor.destroyContext&&U.constructor.destroyContext(this.context))}catch(U){I(U)}S()},0)})}},kernelOrder:y,kernelTypes:E}},{"./backend/cpu/kernel":8,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/kernel":70,"./backend/web-gl2/kernel":105,"./kernel-run-shortcut":111,"./utils":114,"gpu-mock.js":4}],109:[function(T,B,q){const{GPU:F}=T("./gpu"),{alias:L}=T("./alias"),{utils:A}=T("./utils"),{Input:x,input:h}=T("./input"),{Texture:d}=T("./texture"),{FunctionBuilder:u}=T("./backend/function-builder"),{FunctionNode:l}=T("./backend/function-node"),{CPUFunctionNode:y}=T("./backend/cpu/function-node"),{CPUKernel:E}=T("./backend/cpu/kernel"),{HeadlessGLKernel:N}=T("./backend/headless-gl/kernel"),{WebGLFunctionNode:w}=T("./backend/web-gl/function-node"),{WebGLKernel:R}=T("./backend/web-gl/kernel"),{kernelValueMaps:M}=T("./backend/web-gl/kernel-value-maps"),{WebGL2FunctionNode:b}=T("./backend/web-gl2/function-node"),{WebGL2Kernel:S}=T("./backend/web-gl2/kernel"),{kernelValueMaps:I}=T("./backend/web-gl2/kernel-value-maps"),{GLKernel:U}=T("./backend/gl/kernel"),{Kernel:W}=T("./backend/kernel"),{FunctionTracer:v}=T("./backend/function-tracer"),g=T("./plugins/math-random-uniformly-distributed");B.exports={alias:L,CPUFunctionNode:y,CPUKernel:E,GPU:F,FunctionBuilder:u,FunctionNode:l,HeadlessGLKernel:N,Input:x,input:h,Texture:d,utils:A,WebGL2FunctionNode:b,WebGL2Kernel:S,webGL2KernelValueMaps:I,WebGLFunctionNode:w,WebGLKernel:R,webGLKernelValueMaps:M,GLKernel:U,Kernel:W,FunctionTracer:v,plugins:{mathRandom:g}}},{"./alias":5,"./backend/cpu/function-node":6,"./backend/cpu/kernel":8,"./backend/function-builder":9,"./backend/function-node":10,"./backend/function-tracer":11,"./backend/gl/kernel":13,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/function-node":38,"./backend/web-gl/kernel":70,"./backend/web-gl/kernel-value-maps":39,"./backend/web-gl2/function-node":73,"./backend/web-gl2/kernel":105,"./backend/web-gl2/kernel-value-maps":74,"./gpu":108,"./input":110,"./plugins/math-random-uniformly-distributed":112,"./texture":113,"./utils":114}],110:[function(T,B,q){class F{constructor(x,h){this.value=x,Array.isArray(h)?this.size=h:(this.size=new Int32Array(3),this.size=h.z?new Int32Array([h.x,h.y,h.z]):h.y?new Int32Array([h.x,h.y]):new Int32Array([h.x]));const[d,u,l]=this.size;if(l){if(this.value.length!==d*u*l)throw new Error(`Input size ${this.value.length} does not match ${d} * ${u} * ${l} = ${u*d*l}`)}else if(u){if(this.value.length!==d*u)throw new Error(`Input size ${this.value.length} does not match ${d} * ${u} = ${u*d}`)}else if(this.value.length!==d)throw new Error(`Input size ${this.value.length} does not match ${d}`)}toArray(){const{utils:x}=T("./utils"),[h,d,u]=this.size;return u?x.erectMemoryOptimized3DFloat(this.value.subarray?this.value:new Float32Array(this.value),h,d,u):d?x.erectMemoryOptimized2DFloat(this.value.subarray?this.value:new Float32Array(this.value),h,d):this.value}}B.exports={Input:F,input:function L(A,x){return new F(A,x)}}},{"./utils":114}],111:[function(T,B,q){const{utils:F}=T("./utils");function A(x,h){if(h.kernel)return void(h.kernel=x);const d=F.allPropertiesOf(x);for(let u=0;u<d.length;u++){const l=d[u];"_"===l[0]&&"_"===l[1]||("function"==typeof x[l]?h[l]="add"===l.substring(0,3)||"set"===l.substring(0,3)?function(){return h.kernel[l].apply(h.kernel,arguments),h}:function(){return h.kernel[l].apply(h.kernel,arguments)}:(h.__defineGetter__(l,()=>h.kernel[l]),h.__defineSetter__(l,y=>{h.kernel[l]=y})))}h.kernel=x}B.exports={kernelRunShortcut:function L(x){let h=function(){return x.build.apply(x,arguments),h=function(){let u=x.run.apply(x,arguments);if(x.switchingKernels){const l=x.resetSwitchingKernels(),y=x.onRequestSwitchKernel(l,arguments,x);d.kernel=x=y,u=y.run.apply(y,arguments)}return x.renderKernels?x.renderKernels():x.renderOutput?x.renderOutput():u},h.apply(x,arguments)};const d=function(){return h.apply(x,arguments)};return d.exec=function(){return new Promise((u,l)=>{try{u(h.apply(this,arguments))}catch(y){l(y)}})},d.replaceKernel=function(u){A(x=u,d)},A(x,d),d}}},{"./utils":114}],112:[function(T,B,q){B.exports={name:"math-random-uniformly-distributed",onBeforeRun:l=>{l.setUniform1f("randomSeed1",Math.random()),l.setUniform1f("randomSeed2",Math.random())},functionMatch:"Math.random()",functionReplace:"nrand(vTexCoord)",functionReturnType:"Number",source:"// https://www.shadertoy.com/view/4t2SDh\n//note: uniformly distributed, normalized rand, [0,1]\nhighp float randomSeedShift = 1.0;\nhighp float slide = 1.0;\nuniform highp float randomSeed1;\nuniform highp float randomSeed2;\n\nhighp float nrand(highp vec2 n) {\n  highp float result = fract(sin(dot((n.xy + 1.0) * vec2(randomSeed1 * slide, randomSeed2 * randomSeedShift), vec2(12.9898, 78.233))) * 43758.5453);\n  randomSeedShift = result;\n  if (randomSeedShift > 0.5) {\n    slide += 0.00009; \n  } else {\n    slide += 0.0009;\n  }\n  return result;\n}"}},{}],113:[function(T,B,q){B.exports={Texture:class F{constructor(A){const{texture:x,size:h,dimensions:d,output:u,context:l,type:y="NumberTexture",kernel:E,internalFormat:N,textureFormat:w}=A;if(!u)throw new Error('settings property "output" required.');if(!l)throw new Error('settings property "context" required.');if(!x)throw new Error('settings property "texture" required.');if(!E)throw new Error('settings property "kernel" required.');this.texture=x,x._refs?x._refs++:x._refs=1,this.size=h,this.dimensions=d,this.output=u,this.context=l,this.kernel=E,this.type=y,this._deleted=!1,this.internalFormat=N,this.textureFormat=w}toArray(){throw new Error(`Not implemented on ${this.constructor.name}`)}clone(){throw new Error(`Not implemented on ${this.constructor.name}`)}delete(){throw new Error(`Not implemented on ${this.constructor.name}`)}clear(){throw new Error(`Not implemented on ${this.constructor.name}`)}}}},{}],114:[function(T,B,q){const F=T("acorn"),{Input:L}=T("./input"),{Texture:A}=T("./texture"),x=/function ([^(]*)/,h=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,d=/([^\s,]+)/g,u={systemEndianness:()=>N,getSystemEndianness(){const w=new ArrayBuffer(4),R=new Uint32Array(w),M=new Uint8Array(w);if(R[0]=3735928559,239===M[0])return"LE";if(222===M[0])return"BE";throw new Error("unknown endianness")},isFunction:w=>"function"==typeof w,isFunctionString:w=>"string"==typeof w&&"function"===w.slice(0,"function".length).toLowerCase(),getFunctionNameFromString(w){const R=x.exec(w);return R&&0!==R.length?R[1].trim():null},getFunctionBodyFromString:w=>w.substring(w.indexOf("{")+1,w.lastIndexOf("}")),getArgumentNamesFromString(w){const R=w.replace(h,"");let M=R.slice(R.indexOf("(")+1,R.indexOf(")")).match(d);return null===M&&(M=[]),M},clone(w){if(null===w||"object"!=typeof w||w.hasOwnProperty("isActiveClone"))return w;const R=w.constructor();for(let M in w)Object.prototype.hasOwnProperty.call(w,M)&&(w.isActiveClone=null,R[M]=u.clone(w[M]),delete w.isActiveClone);return R},isArray:w=>!isNaN(w.length),getVariableType(w,R){if(u.isArray(w))return w.length>0&&"IMG"===w[0].nodeName?"HTMLImageArray":"Array";switch(w.constructor){case Boolean:return"Boolean";case Number:return R&&Number.isInteger(w)?"Integer":"Float";case A:return w.type;case L:return"Input"}if("nodeName"in w)switch(w.nodeName){case"IMG":case"CANVAS":return"HTMLImage";case"VIDEO":return"HTMLVideo"}else{if(w.hasOwnProperty("type"))return w.type;if("undefined"!=typeof OffscreenCanvas&&w instanceof OffscreenCanvas)return"OffscreenCanvas";if("undefined"!=typeof ImageBitmap&&w instanceof ImageBitmap)return"ImageBitmap";if("undefined"!=typeof ImageData&&w instanceof ImageData)return"ImageData"}return"Unknown"},getKernelTextureSize(w,R){let[M,b,S]=R,I=(M||1)*(b||1)*(S||1);return w.optimizeFloatMemory&&"single"===w.precision&&(M=I=Math.ceil(I/4)),b>1&&M*b===I?new Int32Array([M,b]):u.closestSquareDimensions(I)},closestSquareDimensions(w){const R=Math.sqrt(w);let M=Math.ceil(R),b=Math.floor(R);for(;M*b<w;)M--,b=Math.ceil(w/M);return new Int32Array([b,Math.ceil(w/b)])},getMemoryOptimizedFloatTextureSize(w,R){const b=u.roundTo((w[0]||1)*(w[1]||1)*(w[2]||1)*(w[3]||1),4)/R;return u.closestSquareDimensions(b)},getMemoryOptimizedPackedTextureSize(w,R){const[M,b,S]=w,U=u.roundTo((M||1)*(b||1)*(S||1),4)/(4/R);return u.closestSquareDimensions(U)},roundTo:(w,R)=>Math.floor((w+R-1)/R)*R,getDimensions(w,R){let M;if(u.isArray(w)){const b=[];let S=w;for(;u.isArray(S);)b.push(S.length),S=S[0];M=b.reverse()}else if(w instanceof A)M=w.output;else{if(!(w instanceof L))throw new Error(`Unknown dimensions of ${w}`);M=w.size}if(R)for(M=Array.from(M);M.length<3;)M.push(1);return new Int32Array(M)},flatten2dArrayTo(w,R){let M=0;for(let b=0;b<w.length;b++)R.set(w[b],M),M+=w[b].length},flatten3dArrayTo(w,R){let M=0;for(let b=0;b<w.length;b++)for(let S=0;S<w[b].length;S++)R.set(w[b][S],M),M+=w[b][S].length},flatten4dArrayTo(w,R){let M=0;for(let b=0;b<w.length;b++)for(let S=0;S<w[b].length;S++)for(let I=0;I<w[b][S].length;I++)R.set(w[b][S][I],M),M+=w[b][S][I].length},flattenTo(w,R){u.isArray(w[0])?u.isArray(w[0][0])?u.isArray(w[0][0][0])?u.flatten4dArrayTo(w,R):u.flatten3dArrayTo(w,R):u.flatten2dArrayTo(w,R):R.set(w)},splitArray(w,R){const M=[];for(let b=0;b<w.length;b+=R)M.push(new w.constructor(w.buffer,4*b+w.byteOffset,R));return M},getAstString(w,R){const M=Array.isArray(w)?w:w.split(/\r?\n/g),b=R.loc.start,S=R.loc.end,I=[];if(b.line===S.line)I.push(M[b.line-1].substring(b.column,S.column));else{I.push(M[b.line-1].slice(b.column));for(let U=b.line;U<S.line;U++)I.push(M[U]);I.push(M[S.line-1].slice(0,S.column))}return I.join("\n")},allPropertiesOf(w){const R=[];do{R.push.apply(R,Object.getOwnPropertyNames(w))}while(w=Object.getPrototypeOf(w));return R},linesToString:w=>w.length>0?w.join(";\n")+";\n":"\n",warnDeprecated(w,R,M){console.warn(M?`You are using a deprecated ${w} "${R}". It has been replaced with "${M}". Fixing, but please upgrade as it will soon be removed.`:`You are using a deprecated ${w} "${R}". It has been removed. Fixing, but please upgrade as it will soon be removed.`)},flipPixels:(w,R,M)=>{const b=M/2|0,S=4*R,I=new Uint8ClampedArray(4*R),U=w.slice(0);for(let W=0;W<b;++W){const v=W*S,g=(M-W-1)*S;I.set(U.subarray(v,v+S)),U.copyWithin(v,g,g+S),U.set(I,g)}return U},erectPackedFloat:(w,R)=>w.subarray(0,R),erect2DPackedFloat:(w,R,M)=>{const b=new Array(M);for(let S=0;S<M;S++){const I=S*R;b[S]=w.subarray(I,I+R)}return b},erect3DPackedFloat:(w,R,M,b)=>{const S=new Array(b);for(let I=0;I<b;I++){const U=new Array(M);for(let W=0;W<M;W++){const v=I*M*R+W*R;U[W]=w.subarray(v,v+R)}S[I]=U}return S},erectMemoryOptimizedFloat:(w,R)=>w.subarray(0,R),erectMemoryOptimized2DFloat:(w,R,M)=>{const b=new Array(M);for(let S=0;S<M;S++){const I=S*R;b[S]=w.subarray(I,I+R)}return b},erectMemoryOptimized3DFloat:(w,R,M,b)=>{const S=new Array(b);for(let I=0;I<b;I++){const U=new Array(M);for(let W=0;W<M;W++){const v=I*M*R+W*R;U[W]=w.subarray(v,v+R)}S[I]=U}return S},erectFloat:(w,R)=>{const M=new Float32Array(R);let b=0;for(let S=0;S<R;S++)M[S]=w[b],b+=4;return M},erect2DFloat:(w,R,M)=>{const b=new Array(M);let S=0;for(let I=0;I<M;I++){const U=new Float32Array(R);for(let W=0;W<R;W++)U[W]=w[S],S+=4;b[I]=U}return b},erect3DFloat:(w,R,M,b)=>{const S=new Array(b);let I=0;for(let U=0;U<b;U++){const W=new Array(M);for(let v=0;v<M;v++){const g=new Float32Array(R);for(let O=0;O<R;O++)g[O]=w[I],I+=4;W[v]=g}S[U]=W}return S},erectArray2:(w,R)=>{const M=new Array(R),b=4*R;let S=0;for(let I=0;I<b;I+=4)M[S++]=w.subarray(I,I+2);return M},erect2DArray2:(w,R,M)=>{const b=new Array(M),S=4*R;for(let I=0;I<M;I++){const U=new Array(R),W=I*S;let v=0;for(let g=0;g<S;g+=4)U[v++]=w.subarray(g+W,g+W+2);b[I]=U}return b},erect3DArray2:(w,R,M,b)=>{const S=4*R,I=new Array(b);for(let U=0;U<b;U++){const W=new Array(M);for(let v=0;v<M;v++){const g=new Array(R),O=U*S*M+v*S;let $=0;for(let ee=0;ee<S;ee+=4)g[$++]=w.subarray(ee+O,ee+O+2);W[v]=g}I[U]=W}return I},erectArray3:(w,R)=>{const M=new Array(R),b=4*R;let S=0;for(let I=0;I<b;I+=4)M[S++]=w.subarray(I,I+3);return M},erect2DArray3:(w,R,M)=>{const b=4*R,S=new Array(M);for(let I=0;I<M;I++){const U=new Array(R),W=I*b;let v=0;for(let g=0;g<b;g+=4)U[v++]=w.subarray(g+W,g+W+3);S[I]=U}return S},erect3DArray3:(w,R,M,b)=>{const S=4*R,I=new Array(b);for(let U=0;U<b;U++){const W=new Array(M);for(let v=0;v<M;v++){const g=new Array(R),O=U*S*M+v*S;let $=0;for(let ee=0;ee<S;ee+=4)g[$++]=w.subarray(ee+O,ee+O+3);W[v]=g}I[U]=W}return I},erectArray4:(w,R)=>{const M=new Array(w),b=4*R;let S=0;for(let I=0;I<b;I+=4)M[S++]=w.subarray(I,I+4);return M},erect2DArray4:(w,R,M)=>{const b=4*R,S=new Array(M);for(let I=0;I<M;I++){const U=new Array(R),W=I*b;let v=0;for(let g=0;g<b;g+=4)U[v++]=w.subarray(g+W,g+W+4);S[I]=U}return S},erect3DArray4:(w,R,M,b)=>{const S=4*R,I=new Array(b);for(let U=0;U<b;U++){const W=new Array(M);for(let v=0;v<M;v++){const g=new Array(R),O=U*S*M+v*S;let $=0;for(let ee=0;ee<S;ee+=4)g[$++]=w.subarray(ee+O,ee+O+4);W[v]=g}I[U]=W}return I},flattenFunctionToString:(w,R)=>{const{findDependency:M,thisLookup:b}=R;let I=R.flattened;I||(I=R.flattened={});const U=F.parse(w),W=[];let v=0;const O=function g($){if(Array.isArray($)){const ee=[];for(let G=0;G<$.length;G++)ee.push(g($[G]));return ee.join("")}switch($.type){case"Program":return g($.body)+("VariableDeclaration"===$.body[0].type?";":"");case"FunctionDeclaration":return`function ${$.id.name}(${$.params.map(g).join(", ")}) ${g($.body)}`;case"BlockStatement":{const G=[];v+=2;for(let j=0;j<$.body.length;j++){const ie=g($.body[j]);ie&&G.push(" ".repeat(v)+ie,";\n")}return v-=2,`{\n${G.join("")}}`}case"VariableDeclaration":const ee=u.normalizeDeclarations($).map(g).filter(G=>null!==G);return ee.length<1?"":`${$.kind} ${ee.join(",")}`;case"VariableDeclarator":return $.init.object&&"ThisExpression"===$.init.object.type?b($.init.property.name,!0)?`${$.id.name} = ${g($.init)}`:null:`${$.id.name} = ${g($.init)}`;case"CallExpression":if("subarray"===$.callee.property.name)return`${g($.callee.object)}.${g($.callee.property)}(${$.arguments.map(G=>g(G)).join(", ")})`;if("gl"===$.callee.object.name||"context"===$.callee.object.name)return`${g($.callee.object)}.${g($.callee.property)}(${$.arguments.map(G=>g(G)).join(", ")})`;if("ThisExpression"===$.callee.object.type)return W.push(M("this",$.callee.property.name)),`${$.callee.property.name}(${$.arguments.map(G=>g(G)).join(", ")})`;if($.callee.object.name){const G=M($.callee.object.name,$.callee.property.name);return null===G?`${$.callee.object.name}.${$.callee.property.name}(${$.arguments.map(j=>g(j)).join(", ")})`:(W.push(G),`${$.callee.property.name}(${$.arguments.map(j=>g(j)).join(", ")})`)}if("MemberExpression"===$.callee.object.type)return`${g($.callee.object)}.${$.callee.property.name}(${$.arguments.map(G=>g(G)).join(", ")})`;throw new Error("unknown ast.callee");case"ReturnStatement":return`return ${g($.argument)}`;case"BinaryExpression":return`(${g($.left)}${$.operator}${g($.right)})`;case"UnaryExpression":return $.prefix?`${$.operator} ${g($.argument)}`:`${g($.argument)} ${$.operator}`;case"ExpressionStatement":return`${g($.expression)}`;case"SequenceExpression":return`(${g($.expressions)})`;case"ArrowFunctionExpression":return`(${$.params.map(g).join(", ")}) => ${g($.body)}`;case"Literal":return $.raw;case"Identifier":return $.name;case"MemberExpression":return"ThisExpression"===$.object.type?b($.property.name):$.computed?`${g($.object)}[${g($.property)}]`:g($.object)+"."+g($.property);case"ThisExpression":return"this";case"NewExpression":return`new ${g($.callee)}(${$.arguments.map(G=>g(G)).join(", ")})`;case"ForStatement":return`for (${g($.init)};${g($.test)};${g($.update)}) ${g($.body)}`;case"AssignmentExpression":return`${g($.left)}${$.operator}${g($.right)}`;case"UpdateExpression":return`${g($.argument)}${$.operator}`;case"IfStatement":return`if (${g($.test)}) ${g($.consequent)}`;case"ThrowStatement":return`throw ${g($.argument)}`;case"ObjectPattern":return $.properties.map(g).join(", ");case"ArrayPattern":return $.elements.map(g).join(", ");case"DebuggerStatement":return"debugger;";case"ConditionalExpression":return`${g($.test)}?${g($.consequent)}:${g($.alternate)}`;case"Property":if("init"===$.kind)return g($.key)}throw new Error(`unhandled ast.type of ${$.type}`)}(U);if(W.length>0){const $=[];for(let ee=0;ee<W.length;ee++){const G=W[ee];I[G]||(I[G]=!0),G&&$.push(u.flattenFunctionToString(G,R)+"\n")}return $.join("")+O}return O},normalizeDeclarations:w=>{if("VariableDeclaration"!==w.type)throw new Error('Ast is not of type "VariableDeclaration"');const R=[];for(let M=0;M<w.declarations.length;M++){const b=w.declarations[M];if(b.id&&"ObjectPattern"===b.id.type&&b.id.properties){const{properties:S}=b.id;for(let I=0;I<S.length;I++){const U=S[I];if("ObjectPattern"===U.value.type&&U.value.properties)for(let W=0;W<U.value.properties.length;W++){const v=U.value.properties[W];if("Property"!==v.type)throw new Error("unexpected state");R.push({type:"VariableDeclarator",id:{type:"Identifier",name:v.key.name},init:{type:"MemberExpression",object:{type:"MemberExpression",object:b.init,property:{type:"Identifier",name:U.key.name},computed:!1},property:{type:"Identifier",name:v.key.name},computed:!1}})}else{if("Identifier"!==U.value.type)throw new Error("unexpected state");R.push({type:"VariableDeclarator",id:{type:"Identifier",name:U.value&&U.value.name?U.value.name:U.key.name},init:{type:"MemberExpression",object:b.init,property:{type:"Identifier",name:U.key.name},computed:!1}})}}}else if(b.id&&"ArrayPattern"===b.id.type&&b.id.elements){const{elements:S}=b.id;for(let I=0;I<S.length;I++){const U=S[I];if("Identifier"!==U.type)throw new Error("unexpected state");R.push({type:"VariableDeclarator",id:{type:"Identifier",name:U.name},init:{type:"MemberExpression",object:b.init,property:{type:"Literal",value:I,raw:I.toString(),start:U.start,end:U.end},computed:!0}})}}else R.push(b)}return R},splitHTMLImageToRGB:(w,R)=>{const M=w.createKernel(function(W){return 255*W[this.thread.y][this.thread.x].r},{output:[R.width,R.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),b=w.createKernel(function(W){return 255*W[this.thread.y][this.thread.x].g},{output:[R.width,R.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),S=w.createKernel(function(W){return 255*W[this.thread.y][this.thread.x].b},{output:[R.width,R.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),I=w.createKernel(function(W){return 255*W[this.thread.y][this.thread.x].a},{output:[R.width,R.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),U=[M(R),b(R),S(R),I(R)];return U.rKernel=M,U.gKernel=b,U.bKernel=S,U.aKernel=I,U.gpu=w,U},splitRGBAToCanvases:(w,R,M,b)=>{const S=w.createKernel(function(v){this.color(v[this.thread.y][this.thread.x].r/255,0,0,255)},{output:[M,b],graphical:!0,argumentTypes:{v:"Array2D(4)"}});S(R);const I=w.createKernel(function(v){this.color(0,v[this.thread.y][this.thread.x].g/255,0,255)},{output:[M,b],graphical:!0,argumentTypes:{v:"Array2D(4)"}});I(R);const U=w.createKernel(function(v){this.color(0,0,v[this.thread.y][this.thread.x].b/255,255)},{output:[M,b],graphical:!0,argumentTypes:{v:"Array2D(4)"}});U(R);const W=w.createKernel(function(v){this.color(255,255,255,v[this.thread.y][this.thread.x].a/255)},{output:[M,b],graphical:!0,argumentTypes:{v:"Array2D(4)"}});return W(R),[S.canvas,I.canvas,U.canvas,W.canvas]},getMinifySafeName:w=>{try{const R=F.parse(`const value = ${w.toString()}`),{init:M}=R.body[0].declarations[0];return M.body.name||M.body.body[0].argument.name}catch(R){throw new Error("Unrecognized function type.  Please use `() => yourFunctionVariableHere` or function() { return yourFunctionVariableHere; }")}},sanitizeName:function(w){return l.test(w)&&(w=w.replace(l,"S_S")),y.test(w)?w=w.replace(y,"U_U"):E.test(w)&&(w=w.replace(E,"u_u")),w}},l=/\$/,y=/__/,E=/_/,N=u.getSystemEndianness();B.exports={utils:u}},{"./input":110,"./texture":113,acorn:1}]},{},[107])(107)}},Si=>{Si(Si.s=550)}]);